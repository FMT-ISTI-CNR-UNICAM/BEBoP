<?xml version='1.0' encoding='UTF-8'?>
<xwikidoc version="1.1">
  <web>LearnPAdCode</web>
  <name>BPMNJS</name>
  <language/>
  <defaultLanguage>en</defaultLanguage>
  <translation>0</translation>
  <creator>XWiki.Admin</creator>
  <creationDate>1409494148000</creationDate>
  <author>XWiki.Admin</author>
  <contentAuthor>XWiki.Admin</contentAuthor>
  <date>1409494176000</date>
  <contentUpdateDate>1409494176000</contentUpdateDate>
  <version>4.1</version>
  <title>BPMNJS</title>
  <comment>Upload new attachment bpmn-viewer.js</comment>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <content/>
  <attachment>
    <filename>bpmn-viewer.js</filename>
    <author>XWiki.Admin</author>
    <date>1409494176000</date>
    <version>1.1</version>
    <comment/>
    <content>IWZ1bmN0aW9uKGUpe2lmKCJvYmplY3QiPT10eXBlb2YgZXhwb3J0cyYmInVuZGVmaW5lZCIhPXR5cGVvZiBtb2R1bGUpbW9kdWxlLmV4cG9ydHM9ZSgpO2Vsc2UgaWYoImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZClkZWZpbmUoW10sZSk7ZWxzZXt2YXIgZjsidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdz9mPXdpbmRvdzoidW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbD9mPWdsb2JhbDoidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGYmJihmPXNlbGYpLGYuQnBtbkpTPWUoKX19KGZ1bmN0aW9uKCl7dmFyIGRlZmluZSxtb2R1bGUsZXhwb3J0cztyZXR1cm4gKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT0iZnVuY3Rpb24iJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgZmluZCBtb2R1bGUgJyIrbysiJyIpfXZhciBmPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChmLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGYsZi5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pKHsxOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIERpYWdyYW0gPSBfZGVyZXFfKCdkaWFncmFtLWpzJyksCiAgICBCcG1uTW9kZGxlID0gX2RlcmVxXygnYnBtbi1tb2RkbGUnKSwKICAgICQgPSBfZGVyZXFfKCdqcXVlcnknKSwKICAgIF8gPSAod2luZG93Ll8pOwoKdmFyIEltcG9ydGVyID0gX2RlcmVxXygnLi9pbXBvcnQvSW1wb3J0ZXInKTsKCgpmdW5jdGlvbiBnZXRTdmdDb250ZW50cyhkaWFncmFtKSB7CiAgdmFyIG91dGVyTm9kZSA9IGRpYWdyYW0uZ2V0KCdjYW52YXMnKS5nZXRDb250YWluZXIoKTsKCiAgdmFyIHN2ZyA9IG91dGVyTm9kZS5pbm5lckhUTUw7CiAgcmV0dXJuIHN2Zy5yZXBsYWNlKC9eLio8c3ZnW14+XSo+fDxcL3N2Zz4uKiQvZywgJycpCiAgICAgICAgICAgIC5yZXBsYWNlKCc8ZGVzYz5DcmVhdGVkIHdpdGggU25hcDwvZGVzYz4nLCAnJykKICAgICAgICAgICAgLnJlcGxhY2UoLzxnIGNsYXNzPSJ2aWV3cG9ydCIoIHRyYW5zZm9ybT0iW14iXSoiKT8vLCAnPGcnKTsKfQoKZnVuY3Rpb24gaW5pdExpc3RlbmVycyhkaWFncmFtLCBsaXN0ZW5lcnMpIHsKICB2YXIgZXZlbnRzID0gZGlhZ3JhbS5nZXQoJ2V2ZW50QnVzJyk7CgogIGxpc3RlbmVycy5mb3JFYWNoKGZ1bmN0aW9uKGwpIHsKICAgIGV2ZW50cy5vbihsLmV2ZW50LCBsLmhhbmRsZXIpOwogIH0pOwp9CgpmdW5jdGlvbiBjaGVja1ZhbGlkYXRpb25FcnJvcihlcnIpIHsKCiAgLy8gY2hlY2sgaWYgd2UgY2FuIGhlbHAgdGhlIHVzZXIgYnkgaW5kaWNhdGluZyB3cm9uZyBCUE1OIDIuMCB4bWwKICAvLyAoaW4gY2FzZSBoZSBvciB0aGUgZXhwb3J0aW5nIHRvb2wgZGlkIG5vdCBnZXQgdGhhdCByaWdodCkKCiAgdmFyIHBhdHRlcm4gPSAvdW5wYXJzYWJsZSBjb250ZW50IDwoW14+XSspPiBkZXRlY3RlZChbXHNcU10qKSQvOwogIHZhciBtYXRjaCA9IHBhdHRlcm4uZXhlYyhlcnIubWVzc2FnZSk7CgogIGlmIChtYXRjaCkgewogICAgZXJyLm1lc3NhZ2UgPQogICAgICAndW5wYXJzYWJsZSBjb250ZW50IDwnICsgbWF0Y2hbMV0gKyAnPiBkZXRlY3RlZDsgJyArCiAgICAgICd0aGlzIG1heSBpbmRpY2F0ZSBhbiBpbnZhbGlkIEJQTU4gMi4wIGRpYWdyYW0gZmlsZScgKyBtYXRjaFsyXTsKICB9CgogIHJldHVybiBlcnI7Cn0KCi8qKgogKiBBIHZpZXdlciBmb3IgQlBNTiAyLjAgZGlhZ3JhbXMKICoKICogQGNsYXNzCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gY29uZmlndXJhdGlvbiBvcHRpb25zIHRvIHBhc3MgdG8gdGhlIHZpZXdlcgogKiBAcGFyYW0ge0RPTUVsZW1lbnR9IFtvcHRpb25zLmNvbnRhaW5lcl0gdGhlIGNvbnRhaW5lciB0byByZW5kZXIgdGhlIHZpZXdlciBpbiwgZGVmYXVsdHMgdG8gYm9keS4KICogQHBhcmFtIHtTdHJpbmd8TnVtYmVyfSBbb3B0aW9ucy53aWR0aF0gdGhlIHdpZHRoIG9mIHRoZSB2aWV3ZXIKICogQHBhcmFtIHtTdHJpbmd8TnVtYmVyfSBbb3B0aW9ucy5oZWlnaHRdIHRoZSBoZWlnaHQgb2YgdGhlIHZpZXdlcgogKiBAcGFyYW0ge0FycmF5PGRpZGkuTW9kdWxlPn0gW29wdGlvbnMubW9kdWxlc10gYSBsaXN0IG9mIG1vZHVsZXMgdG8gb3ZlcnJpZGUgdGhlIGRlZmF1bHQgbW9kdWxlcwogKiBAcGFyYW0ge0FycmF5PGRpZGkuTW9kdWxlPn0gW29wdGlvbnMuYWRkaXRpb25hbE1vZHVsZXNdIGEgbGlzdCBvZiBtb2R1bGVzIHRvIHVzZSB3aXRoIHRoZSBkZWZhdWx0IG1vZHVsZXMKICovCmZ1bmN0aW9uIFZpZXdlcihvcHRpb25zKSB7CiAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogIHZhciBwYXJlbnQgPSBvcHRpb25zLmNvbnRhaW5lciB8fCAkKCdib2R5Jyk7CgogIHZhciBjb250YWluZXIgPSAkKCc8ZGl2PjwvZGl2PicpLmFkZENsYXNzKCdianMtY29udGFpbmVyJykuY3NzKHsKICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnCiAgfSkuYXBwZW5kVG8ocGFyZW50KTsKCiAgXy5mb3JFYWNoKFsgJ3dpZHRoJywgJ2hlaWdodCcgXSwgZnVuY3Rpb24oYSkgewogICAgaWYgKG9wdGlvbnNbYV0pIHsKICAgICAgY29udGFpbmVyLmNzcyhhLCBvcHRpb25zW2FdKTsKICAgIH0KICB9KTsKCiAgLy8gdW53cmFwIGpxdWVyeQogIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyLmdldCgwKTsKCgogIC8qKgogICAqIFRoZSBjb2RlIGluIHRoZSA8cHJvamVjdC1sb2dvPjwvcHJvamVjdC1sb2dvPiBhcmVhCiAgICogbXVzdCBub3QgYmUgY2hhbmdlZCwgc2VlIGh0dHA6Ly9icG1uLmlvL2xpY2Vuc2UgZm9yIG1vcmUgaW5mb3JtYXRpb24KICAgKgogICAqIDxwcm9qZWN0LWxvZ28+CiAgICovCgogIC8qIGpzaGludCAtVzEwMSAqLwoKICAvLyBpbmxpbmVkIC4uL3Jlc291cmNlcy9icG1uanMucG5nCiAgdmFyIGxvZ29EYXRhID0gJ2lWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFEUUFBQUEwQ0FNQUFBRHlwdXZaQUFBQUdYUkZXSFJUYjJaMGQyRnlaUUJCWkc5aVpTQkpiV0ZuWlZKbFlXUjVjY2xsUEFBQUFEQlFURlJGaU10ZTlQcndsZEZ3ZmNaUHF0cU4wK3pFeU9lMVhMZ2p2dUtuY3NKQVo3MHk2ZlhoM3ZEVC8vLy9VclFWLy8vL0cyek4rQUFBQUJCMFVrNVQvLy8vLy8vLy8vLy8vLy8vLy8vL0FPQWpYUmtBQUFIRFNVUkJWSGphdkpaSmtvVWdERUJKbUFYODk3OXRNOHUzRTZ4MjBWbFlKZkZGTW9MNHZCRHhBVHhaY2FrSU9KVFdTbXh2S1dWSWtKOGpIdmxSdjFGMkxGclZJU0NaSSt0Q3RReCtYZmV3Z1ZUZnlZM3BsUGlRRUF6STN6V3kra1I2TkJoRkJZZUJ1c2NKTE9VdUEyV1ZMcENqVklhRnpyTlFaQXJ4QVpLVVFtNmdzajM3TDlDYjdkbklCVUt4RU5hYU1KUXFNcERYdlNMK2t0eGRHUm0ySXNLZ0pHR1BnN2F0d1VHNUNjRlVFdVN2K0N3UXFpelRydkRUTlhkTVUyYk1pRFdaZDhkN1FJeVNXVlJzYjJ2QkJpb3hPRnQ0T2luUEJhcEwrbmVBYjVLTDVJSjhzek96YTIvRFlvaXBVQ3grQ2pPMEJwc3YwVjZta3ROWitrOHJsQUJsV0cwRnJPcEtZVm84RFQzZEJlTEVqVUJBajdtb0RvZ1ZpaTduU1M5UXpabkZjT1ZCcDFnMlB5QlEzVnI1YUlhcE45MVZKeTMzSFRKTEMxaVgyRlk2RjhnUmRhQWVJRWZWT05ndEZDelpUbW9MRWRPakJEZnNJT0E2MTI4Z3czZXUxc2hBYWpkWk5BT1J4dVFESk41QTVQYkVHNmdOSXUyNFFKRDVpTnlSTVpJcjZic0hiQ3RDVS9PYU9hU3Zna1V5RE1kRGExQlhHZjVISjFUbysvWW02bUNLVDAyWSsvU2ExMjZaS3lkM2p4aHpwYzFyOHpWTDZZTTFReS9rUjRBQkFGSjZpUVVuaXZoQUFBQUFBRWxGVGtTdVFtQ0MnOwoKICAvKiBqc2hpbnQgK1cxMDEgKi8KCiAgdmFyIGEgPSAkKCc8YSBocmVmPSJodHRwOi8vYnBtbi5pbyIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJianMtcG93ZXJlZC1ieSIgdGl0bGU9IlBvd2VyZWQgYnkgYnBtbi5pbyIgLz4nKS5jc3MoewogICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICBib3R0b206IDE1LAogICAgcmlnaHQ6IDE1LAogICAgekluZGV4OiAxMDAKICB9KTsKCiAgdmFyIGxvZ28gPSAkKCc8aW1nLz4nKS5hdHRyKCdzcmMnLCAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LCcgKyBsb2dvRGF0YSkuYXBwZW5kVG8oYSk7CgogIGEuYXBwZW5kVG8oY29udGFpbmVyKTsKCiAgLyogPC9wcm9qZWN0LWxvZ28+ICovCn0KClZpZXdlci5wcm90b3R5cGUuaW1wb3J0WE1MID0gZnVuY3Rpb24oeG1sLCBkb25lKSB7CgogIHZhciBzZWxmID0gdGhpczsKCiAgdGhpcy5tb2RkbGUgPSB0aGlzLmNyZWF0ZU1vZGRsZSgpOwoKICB0aGlzLm1vZGRsZS5mcm9tWE1MKHhtbCwgJ2JwbW46RGVmaW5pdGlvbnMnLCBmdW5jdGlvbihlcnIsIGRlZmluaXRpb25zKSB7CgogICAgaWYgKGVycikgewogICAgICBlcnIgPSBjaGVja1ZhbGlkYXRpb25FcnJvcihlcnIpOwogICAgICByZXR1cm4gZG9uZShlcnIpOwogICAgfQoKICAgIHNlbGYuaW1wb3J0RGVmaW5pdGlvbnMoZGVmaW5pdGlvbnMsIGRvbmUpOwogIH0pOwp9OwoKVmlld2VyLnByb3RvdHlwZS5zYXZlWE1MID0gZnVuY3Rpb24ob3B0aW9ucywgZG9uZSkgewoKICBpZiAoIWRvbmUpIHsKICAgIGRvbmUgPSBvcHRpb25zOwogICAgb3B0aW9ucyA9IHt9OwogIH0KCiAgdmFyIGRlZmluaXRpb25zID0gdGhpcy5kZWZpbml0aW9uczsKCiAgaWYgKCFkZWZpbml0aW9ucykgewogICAgcmV0dXJuIGRvbmUobmV3IEVycm9yKCdubyBkZWZpbml0aW9ucyBsb2FkZWQnKSk7CiAgfQoKICB0aGlzLm1vZGRsZS50b1hNTChkZWZpbml0aW9ucywgb3B0aW9ucywgZnVuY3Rpb24oZXJyLCB4bWwpIHsKICAgIGRvbmUoZXJyLCB4bWwpOwogIH0pOwp9OwoKVmlld2VyLnByb3RvdHlwZS5jcmVhdGVNb2RkbGUgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gbmV3IEJwbW5Nb2RkbGUoKTsKfTsKCnZhciBTVkdfSEVBREVSID0KJzw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9InV0Zi04Ij8+XG4nICsKJzwhLS0gY3JlYXRlZCB3aXRoIGJwbW4tanMgLyBodHRwOi8vYnBtbi5pbyAtLT5cbicgKwonPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj5cbicgKwonPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiPlxuJzsKCnZhciBTVkdfRk9PVEVSID0gJzwvc3ZnPic7CgpWaWV3ZXIucHJvdG90eXBlLnNhdmVTVkcgPSBmdW5jdGlvbihvcHRpb25zLCBkb25lKSB7CiAgaWYgKCFkb25lKSB7CiAgICBkb25lID0gb3B0aW9uczsKICAgIG9wdGlvbnMgPSB7fTsKICB9CgogIGlmICghdGhpcy5kZWZpbml0aW9ucykgewogICAgcmV0dXJuIGRvbmUobmV3IEVycm9yKCdubyBkZWZpbml0aW9ucyBsb2FkZWQnKSk7CiAgfQoKICB2YXIgc3ZnQ29udGVudHMgPSBnZXRTdmdDb250ZW50cyh0aGlzLmRpYWdyYW0pOwoKICB2YXIgc3ZnID0gU1ZHX0hFQURFUiArIHN2Z0NvbnRlbnRzICsgU1ZHX0ZPT1RFUjsKCiAgZG9uZShudWxsLCBzdmcpOwp9OwoKVmlld2VyLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihuYW1lKSB7CgogIGlmICghdGhpcy5kaWFncmFtKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ25vIGRpYWdyYW0gbG9hZGVkJyk7CiAgfQoKICByZXR1cm4gdGhpcy5kaWFncmFtLmdldChuYW1lKTsKfTsKClZpZXdlci5wcm90b3R5cGUuaW52b2tlID0gZnVuY3Rpb24oZm4pIHsKCiAgaWYgKCF0aGlzLmRpYWdyYW0pIHsKICAgIHRocm93IG5ldyBFcnJvcignbm8gZGlhZ3JhbSBsb2FkZWQnKTsKICB9CgogIHJldHVybiB0aGlzLmRpYWdyYW0uaW52b2tlKGZuKTsKfTsKClZpZXdlci5wcm90b3R5cGUuaW1wb3J0RGVmaW5pdGlvbnMgPSBmdW5jdGlvbihkZWZpbml0aW9ucywgZG9uZSkgewoKICAvLyB1c2UgdHJ5L2NhdGNoIHRvIG5vdCBzd2FsbG93IHN5bmNocm9ub3VzIGV4Y2VwdGlvbnMKICAvLyB0aGF0IG1heSBiZSByYWlzZWQgZHVyaW5nIG1vZGVsIHBhcnNpbmcKICB0cnkgewogICAgaWYgKHRoaXMuZGlhZ3JhbSkgewogICAgICB0aGlzLmNsZWFyKCk7CiAgICB9CgogICAgdGhpcy5kZWZpbml0aW9ucyA9IGRlZmluaXRpb25zOwogICAgdGhpcy5kaWFncmFtID0gdGhpcy5fY3JlYXRlRGlhZ3JhbSh0aGlzLm9wdGlvbnMpOwoKICAgIHRoaXMuX2luaXQodGhpcy5kaWFncmFtKTsKCiAgICBJbXBvcnRlci5pbXBvcnRCcG1uRGlhZ3JhbSh0aGlzLmRpYWdyYW0sIGRlZmluaXRpb25zLCBkb25lKTsKICB9IGNhdGNoIChlKSB7CiAgICBkb25lKGUpOwogIH0KfTsKClZpZXdlci5wcm90b3R5cGUuX2luaXQgPSBmdW5jdGlvbihkaWFncmFtKSB7CiAgaW5pdExpc3RlbmVycyhkaWFncmFtLCB0aGlzLl9fbGlzdGVuZXJzIHx8IFtdKTsKfTsKClZpZXdlci5wcm90b3R5cGUuX2NyZWF0ZURpYWdyYW0gPSBmdW5jdGlvbihvcHRpb25zKSB7CgogIHZhciBtb2R1bGVzID0gW10uY29uY2F0KG9wdGlvbnMubW9kdWxlcyB8fCB0aGlzLmdldE1vZHVsZXMoKSwgb3B0aW9ucy5hZGRpdGlvbmFsTW9kdWxlcyB8fCBbXSk7CgogIC8vIGFkZCBzZWxmIGFzIGFuIGF2YWlsYWJsZSBzZXJ2aWNlCiAgbW9kdWxlcy51bnNoaWZ0KHsKICAgIGJwbW5qczogWyAndmFsdWUnLCB0aGlzIF0sCiAgICBtb2RkbGU6IFsgJ3ZhbHVlJywgdGhpcy5tb2RkbGUgXQogIH0pOwoKICBvcHRpb25zID0gXy5vbWl0KG9wdGlvbnMsICdhZGRpdGlvbmFsTW9kdWxlcycpOwoKICBvcHRpb25zID0gXy5leHRlbmQob3B0aW9ucywgewogICAgY2FudmFzOiB7IGNvbnRhaW5lcjogdGhpcy5jb250YWluZXIgfSwKICAgIG1vZHVsZXM6IG1vZHVsZXMKICB9KTsKCiAgcmV0dXJuIG5ldyBEaWFncmFtKG9wdGlvbnMpOwp9OwoKClZpZXdlci5wcm90b3R5cGUuZ2V0TW9kdWxlcyA9IGZ1bmN0aW9uKCkgewogIHJldHVybiB0aGlzLl9tb2R1bGVzOwp9OwoKLyoqCiAqIFJlbW92ZSBhbGwgZHJhd24gZWxlbWVudHMgZnJvbSB0aGUgdmlld2VyCiAqLwpWaWV3ZXIucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24oKSB7CiAgdmFyIGRpYWdyYW0gPSB0aGlzLmRpYWdyYW07CgogIGlmIChkaWFncmFtKSB7CiAgICBkaWFncmFtLmRlc3Ryb3koKTsKICB9Cn07CgovKioKICogUmVnaXN0ZXIgYW4gZXZlbnQgbGlzdGVuZXIgb24gdGhlIHZpZXdlcgogKgogKiBAcGFyYW0ge1N0cmluZ30gZXZlbnQKICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlcgogKi8KVmlld2VyLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKGV2ZW50LCBoYW5kbGVyKSB7CiAgdmFyIGRpYWdyYW0gPSB0aGlzLmRpYWdyYW0sCiAgICAgIGxpc3RlbmVycyA9IHRoaXMuX19saXN0ZW5lcnMgPSB0aGlzLl9fbGlzdGVuZXJzIHx8IFtdOwoKICBsaXN0ZW5lcnMgPSB0aGlzLl9fbGlzdGVuZXJzIHx8IFtdOwogIGxpc3RlbmVycy5wdXNoKHsgZXZlbnQ6IGV2ZW50LCBoYW5kbGVyOiBoYW5kbGVyIH0pOwoKICBpZiAoZGlhZ3JhbSkgewogICAgZGlhZ3JhbS5nZXQoJ2V2ZW50QnVzJykub24oZXZlbnQsIGhhbmRsZXIpOwogIH0KfTsKCi8vIG1vZHVsZXMgdGhlIHZpZXdlciBpcyBjb21wb3NlZCBvZgpWaWV3ZXIucHJvdG90eXBlLl9tb2R1bGVzID0gWwogIF9kZXJlcV8oJy4vY29yZScpLAogIF9kZXJlcV8oJy4vZHJhdycpLAogIF9kZXJlcV8oJ2RpYWdyYW0tanMvbGliL2ZlYXR1cmVzL3NlbGVjdGlvbicpLAogIF9kZXJlcV8oJ2RpYWdyYW0tanMvbGliL2ZlYXR1cmVzL292ZXJsYXlzJykKXTsKCm1vZHVsZS5leHBvcnRzID0gVmlld2VyOwoKfSx7Ii4vY29yZSI6MywiLi9kcmF3Ijo2LCIuL2ltcG9ydC9JbXBvcnRlciI6OCwiYnBtbi1tb2RkbGUiOjExLCJkaWFncmFtLWpzIjo0MSwiZGlhZ3JhbS1qcy9saWIvZmVhdHVyZXMvb3ZlcmxheXMiOjU5LCJkaWFncmFtLWpzL2xpYi9mZWF0dXJlcy9zZWxlY3Rpb24iOjYyfV0sMjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBfID0gKHdpbmRvdy5fKTsKCnZhciBMYWJlbFV0aWwgPSBfZGVyZXFfKCcuLi91dGlsL0xhYmVsJyk7Cgp2YXIgaGFzRXh0ZXJuYWxMYWJlbCA9IExhYmVsVXRpbC5oYXNFeHRlcm5hbExhYmVsLAogICAgZ2V0RXh0ZXJuYWxMYWJlbEJvdW5kcyA9IExhYmVsVXRpbC5nZXRFeHRlcm5hbExhYmVsQm91bmRzLAogICAgaXNFeHBhbmRlZCA9IF9kZXJlcV8oJy4uL3V0aWwvRGknKS5pc0V4cGFuZGVkOwoKCmZ1bmN0aW9uIGVsZW1lbnREYXRhKHNlbWFudGljLCBhdHRycykgewogIHJldHVybiBfLmV4dGVuZCh7CiAgICBpZDogc2VtYW50aWMuaWQsCiAgICB0eXBlOiBzZW1hbnRpYy4kdHlwZSwKICAgIGJ1c2luZXNzT2JqZWN0OiBzZW1hbnRpYwogIH0sIGF0dHJzKTsKfQoKZnVuY3Rpb24gY29sbGVjdFdheXBvaW50cyh3YXlwb2ludHMpIHsKICByZXR1cm4gXy5jb2xsZWN0KHdheXBvaW50cywgZnVuY3Rpb24ocCkgewogICAgcmV0dXJuIHsgeDogcC54LCB5OiBwLnkgfTsKICB9KTsKfQoKCi8qKgogKiBBbiBpbXBvcnRlciB0aGF0IGFkZHMgYnBtbiBlbGVtZW50cyB0byB0aGUgY2FudmFzCiAqCiAqIEBwYXJhbSB7RXZlbnRCdXN9IGV2ZW50QnVzCiAqIEBwYXJhbSB7Q2FudmFzfSBjYW52YXMKICogQHBhcmFtIHtFbGVtZW50RmFjdG9yeX0gZWxlbWVudEZhY3RvcnkKICogQHBhcmFtIHtFbGVtZW50UmVnaXN0cnl9IGVsZW1lbnRSZWdpc3RyeQogKi8KZnVuY3Rpb24gQnBtbkltcG9ydGVyKGV2ZW50QnVzLCBjYW52YXMsIGVsZW1lbnRGYWN0b3J5LCBlbGVtZW50UmVnaXN0cnkpIHsKICB0aGlzLl9ldmVudEJ1cyA9IGV2ZW50QnVzOwogIHRoaXMuX2NhbnZhcyA9IGNhbnZhczsKCiAgdGhpcy5fZWxlbWVudEZhY3RvcnkgPSBlbGVtZW50RmFjdG9yeTsKICB0aGlzLl9lbGVtZW50UmVnaXN0cnkgPSBlbGVtZW50UmVnaXN0cnk7Cn0KCkJwbW5JbXBvcnRlci4kaW5qZWN0ID0gWyAnZXZlbnRCdXMnLCAnY2FudmFzJywgJ2VsZW1lbnRGYWN0b3J5JywgJ2VsZW1lbnRSZWdpc3RyeScgXTsKCm1vZHVsZS5leHBvcnRzID0gQnBtbkltcG9ydGVyOwoKCi8qKgogKiBBZGQgYnBtbiBlbGVtZW50IChzZW1hbnRpYykgdG8gdGhlIGNhbnZhcyBvbnRvIHRoZQogKiBzcGVjaWZpZWQgcGFyZW50IHNoYXBlLgogKi8KQnBtbkltcG9ydGVyLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihzZW1hbnRpYywgcGFyZW50RWxlbWVudCkgewoKICB2YXIgZGkgPSBzZW1hbnRpYy5kaSwKICAgICAgZWxlbWVudDsKCiAgLy8gUk9PVCBFTEVNRU5UCiAgLy8gaGFuZGxlIHRoZSBzcGVjaWFsIGNhc2UgdGhhdCB3ZSBkZWFsIHdpdGggYQogIC8vIGludmlzaWJsZSByb290IGVsZW1lbnQgKHByb2Nlc3Mgb3IgY29sbGFib3JhdGlvbikKICBpZiAoZGkuJGluc3RhbmNlT2YoJ2JwbW5kaTpCUE1OUGxhbmUnKSkgewoKICAgIC8vIGFkZCBhIHZpcnR1YWwgZWxlbWVudCAobm90IGJlaW5nIGRyYXduKQogICAgZWxlbWVudCA9IHRoaXMuX2VsZW1lbnRGYWN0b3J5LmNyZWF0ZVJvb3QoZWxlbWVudERhdGEoc2VtYW50aWMpKTsKICB9CgogIC8vIFNIQVBFCiAgZWxzZSBpZiAoZGkuJGluc3RhbmNlT2YoJ2JwbW5kaTpCUE1OU2hhcGUnKSkgewoKICAgIHZhciBjb2xsYXBzZWQgPSAhaXNFeHBhbmRlZChzZW1hbnRpYyk7CiAgICB2YXIgaGlkZGVuID0gcGFyZW50RWxlbWVudCAmJiAocGFyZW50RWxlbWVudC5oaWRkZW4gfHwgcGFyZW50RWxlbWVudC5jb2xsYXBzZWQpOwoKICAgIHZhciBib3VuZHMgPSBzZW1hbnRpYy5kaS5ib3VuZHM7CgogICAgZWxlbWVudCA9IHRoaXMuX2VsZW1lbnRGYWN0b3J5LmNyZWF0ZVNoYXBlKGVsZW1lbnREYXRhKHNlbWFudGljLCB7CiAgICAgIGNvbGxhcHNlZDogY29sbGFwc2VkLAogICAgICBoaWRkZW46IGhpZGRlbiwKICAgICAgeDogYm91bmRzLngsCiAgICAgIHk6IGJvdW5kcy55LAogICAgICB3aWR0aDogYm91bmRzLndpZHRoLAogICAgICBoZWlnaHQ6IGJvdW5kcy5oZWlnaHQKICAgIH0pKTsKCiAgICB0aGlzLl9jYW52YXMuYWRkU2hhcGUoZWxlbWVudCwgcGFyZW50RWxlbWVudCk7CiAgfQoKICAvLyBDT05ORUNUSU9OCiAgZWxzZSBpZiAoZGkuJGluc3RhbmNlT2YoJ2JwbW5kaTpCUE1ORWRnZScpKSB7CgogICAgdmFyIHNvdXJjZSA9IHRoaXMuX2dldFNvdXJjZShzZW1hbnRpYyksCiAgICAgICAgdGFyZ2V0ID0gdGhpcy5fZ2V0VGFyZ2V0KHNlbWFudGljKTsKCiAgICBpZiAoIXNvdXJjZSB8fCAhdGFyZ2V0KSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignc291cmNlIG9yIHRhcmdldCBub3QgcmVuZGVyZWQgZm9yIGVsZW1lbnQgPCcgKyBzZW1hbnRpYy5pZCArICc+Jyk7CiAgICB9CgogICAgZWxlbWVudCA9IHRoaXMuX2VsZW1lbnRGYWN0b3J5LmNyZWF0ZUNvbm5lY3Rpb24oZWxlbWVudERhdGEoc2VtYW50aWMsIHsKICAgICAgc291cmNlOiBzb3VyY2UsCiAgICAgIHRhcmdldDogdGFyZ2V0LAogICAgICB3YXlwb2ludHM6IGNvbGxlY3RXYXlwb2ludHMoc2VtYW50aWMuZGkud2F5cG9pbnQpCiAgICB9KSk7CgogICAgdGhpcy5fY2FudmFzLmFkZENvbm5lY3Rpb24oZWxlbWVudCwgcGFyZW50RWxlbWVudCk7CiAgfSBlbHNlIHsKICAgIHRocm93IG5ldyBFcnJvcigndW5rbm93biBkaSA8JyArIGRpLiR0eXBlICsgJz4gZm9yIGVsZW1lbnQgPCcgKyBzZW1hbnRpYy5pZCArICc+Jyk7CiAgfQoKICAvLyAob3B0aW9uYWwpIExBQkVMCiAgaWYgKGhhc0V4dGVybmFsTGFiZWwoc2VtYW50aWMpKSB7CiAgICB0aGlzLmFkZExhYmVsKHNlbWFudGljLCBlbGVtZW50KTsKICB9CgogIHRoaXMuX2V2ZW50QnVzLmZpcmUoJ2JwbW5FbGVtZW50LmFkZGVkJywgeyBlbGVtZW50OiBlbGVtZW50IH0pOwoKICByZXR1cm4gZWxlbWVudDsKfTsKCgovKioKICogYWRkIGxhYmVsIGZvciBhbiBlbGVtZW50CiAqLwpCcG1uSW1wb3J0ZXIucHJvdG90eXBlLmFkZExhYmVsID0gZnVuY3Rpb24gKHNlbWFudGljLCBlbGVtZW50KSB7CiAgdmFyIGJvdW5kcyA9IGdldEV4dGVybmFsTGFiZWxCb3VuZHMoc2VtYW50aWMsIGVsZW1lbnQpOwoKICB2YXIgbGFiZWwgPSB0aGlzLl9lbGVtZW50RmFjdG9yeS5jcmVhdGVMYWJlbChlbGVtZW50RGF0YShzZW1hbnRpYywgewogICAgaWQ6IHNlbWFudGljLmlkICsgJ19sYWJlbCcsCiAgICBsYWJlbFRhcmdldDogZWxlbWVudCwKICAgIHR5cGU6ICdsYWJlbCcsCiAgICBoaWRkZW46IGVsZW1lbnQuaGlkZGVuLAogICAgeDogYm91bmRzLngsCiAgICB5OiBib3VuZHMueSwKICAgIHdpZHRoOiBib3VuZHMud2lkdGgsCiAgICBoZWlnaHQ6IGJvdW5kcy5oZWlnaHQKICB9KSk7CgogIHJldHVybiB0aGlzLl9jYW52YXMuYWRkU2hhcGUobGFiZWwsIGVsZW1lbnQucGFyZW50KTsKfTsKCgpCcG1uSW1wb3J0ZXIucHJvdG90eXBlLl9nZXRTb3VyY2UgPSBmdW5jdGlvbihzZW1hbnRpYykgewoKICB2YXIgZWxlbWVudCwKICAgICAgZWxlbWVudFNlbWFudGljID0gc2VtYW50aWMuc291cmNlUmVmOwoKICAvLyBoYW5kbGUgbXlzdGVyaW91cyBpc01hbnkgRGF0YUFzc29jaWF0aW9uI3NvdXJjZVJlZgogIGlmIChfLmlzQXJyYXkoZWxlbWVudFNlbWFudGljKSkgewogICAgZWxlbWVudFNlbWFudGljID0gZWxlbWVudFNlbWFudGljWzBdOwogIH0KCiAgaWYgKGVsZW1lbnRTZW1hbnRpYyAmJiBlbGVtZW50U2VtYW50aWMuJGluc3RhbmNlT2YoJ2JwbW46RGF0YU91dHB1dCcpKSB7CiAgICBlbGVtZW50U2VtYW50aWMgPSBlbGVtZW50U2VtYW50aWMuJHBhcmVudC4kcGFyZW50OwogIH0KCiAgZWxlbWVudCA9IGVsZW1lbnRTZW1hbnRpYyAmJiB0aGlzLl9nZXRFbGVtZW50KGVsZW1lbnRTZW1hbnRpYyk7CgogIGlmIChlbGVtZW50KSB7CiAgICByZXR1cm4gZWxlbWVudDsKICB9CgogIHRocm93IG5ldyBFcnJvcignZWxlbWVudCA8JyArIGVsZW1lbnRTZW1hbnRpYy5pZCArICc+IHJlZmVyZW5jZWQgYnkgPCcgKyBzZW1hbnRpYy5pZCArICc+IG5vdCB5ZXQgZHJhd24nKTsKfTsKCgpCcG1uSW1wb3J0ZXIucHJvdG90eXBlLl9nZXRUYXJnZXQgPSBmdW5jdGlvbihzZW1hbnRpYykgewoKICB2YXIgZWxlbWVudCwKICAgICAgZWxlbWVudFNlbWFudGljID0gc2VtYW50aWMudGFyZ2V0UmVmOwoKICBpZiAoZWxlbWVudFNlbWFudGljICYmIGVsZW1lbnRTZW1hbnRpYy4kaW5zdGFuY2VPZignYnBtbjpEYXRhSW5wdXQnKSkgewogICAgZWxlbWVudFNlbWFudGljID0gZWxlbWVudFNlbWFudGljLiRwYXJlbnQuJHBhcmVudDsKICB9CgogIGVsZW1lbnQgPSBlbGVtZW50U2VtYW50aWMgJiYgdGhpcy5fZ2V0RWxlbWVudChlbGVtZW50U2VtYW50aWMpOwoKICBpZiAoZWxlbWVudCkgewogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfQoKICB0aHJvdyBuZXcgRXJyb3IoJ2VsZW1lbnQgPCcgKyBlbGVtZW50U2VtYW50aWMuaWQgKyAnPiByZWZlcmVuY2VkIGJ5IDwnICsgc2VtYW50aWMuaWQgKyAnPiBub3QgeWV0IGRyYXduJyk7Cn07CgoKQnBtbkltcG9ydGVyLnByb3RvdHlwZS5fZ2V0RWxlbWVudCA9IGZ1bmN0aW9uKHNlbWFudGljKSB7CiAgcmV0dXJuIHRoaXMuX2VsZW1lbnRSZWdpc3RyeS5nZXRCeUlkKHNlbWFudGljLmlkKTsKfTsKfSx7Ii4uL3V0aWwvRGkiOjksIi4uL3V0aWwvTGFiZWwiOjEwfV0sMzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gewogIGJwbW5JbXBvcnRlcjogWyAndHlwZScsIF9kZXJlcV8oJy4vQnBtbkltcG9ydGVyJykgXQp9Owp9LHsiLi9CcG1uSW1wb3J0ZXIiOjJ9XSw0OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF8gPSAod2luZG93Ll8pOwoKdmFyIERlZmF1bHRSZW5kZXJlciA9IF9kZXJlcV8oJ2RpYWdyYW0tanMvbGliL2RyYXcvUmVuZGVyZXInKTsKdmFyIExhYmVsVXRpbCA9IF9kZXJlcV8oJ2RpYWdyYW0tanMvbGliL3V0aWwvTGFiZWxVdGlsJyk7Cgp2YXIgRGlVdGlsID0gX2RlcmVxXygnLi4vdXRpbC9EaScpOwoKdmFyIGZsYXR0ZW5Qb2ludHMgPSBEZWZhdWx0UmVuZGVyZXIuZmxhdHRlblBvaW50czsKCgpmdW5jdGlvbiBCcG1uUmVuZGVyZXIoZXZlbnRzLCBzdHlsZXMsIHBhdGhNYXApIHsKCiAgRGVmYXVsdFJlbmRlcmVyLmNhbGwodGhpcywgc3R5bGVzKTsKCiAgdmFyIFRBU0tfQk9SREVSX1JBRElVUyA9IDEwOwogIHZhciBJTk5FUl9PVVRFUl9ESVNUID0gMzsKCiAgdmFyIExBQkVMX1NUWUxFID0gewogICAgZm9udEZhbWlseTogJ0FyaWFsLCBzYW5zLXNlcmlmJywKICAgIGZvbnRTaXplOiAnMTJweCcKICB9OwoKICB2YXIgbGFiZWxVdGlsID0gbmV3IExhYmVsVXRpbCh7CiAgICBzdHlsZTogTEFCRUxfU1RZTEUsCiAgICBzaXplOiB7IHdpZHRoOiAxMDAgfQogIH0pOwoKICB2YXIgbWFya2VycyA9IHt9OwoKICBmdW5jdGlvbiBhZGRNYXJrZXIoaWQsIGVsZW1lbnQpIHsKICAgIG1hcmtlcnNbaWRdID0gZWxlbWVudDsKICB9CgogIGZ1bmN0aW9uIG1hcmtlcihpZCkgewogICAgcmV0dXJuIG1hcmtlcnNbaWRdOwogIH0KCiAgZnVuY3Rpb24gaW5pdE1hcmtlcnMocGFwZXIpIHsKCiAgICBmdW5jdGlvbiBjcmVhdGVNYXJrZXIoaWQsIG9wdGlvbnMpIHsKICAgICAgdmFyIGF0dHJzID0gXy5leHRlbmQoewogICAgICAgIGZpbGw6ICdibGFjaycsCiAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgc3Ryb2tlTGluZWNhcDogJ3JvdW5kJywKICAgICAgICBzdHJva2VEYXNoYXJyYXk6ICdub25lJwogICAgICB9LCBvcHRpb25zLmF0dHJzKTsKCiAgICAgIHZhciByZWYgPSBvcHRpb25zLnJlZiB8fCB7IHg6IDAsIHk6IDAgfTsKCiAgICAgIHZhciBzY2FsZSA9IG9wdGlvbnMuc2NhbGUgfHwgMTsKCiAgICAgIC8vIGZpeCBmb3Igc2FmYXJpIC8gY2hyb21lIC8gZmlyZWZveCBidWcgbm90IGNvcnJlY3RseQogICAgICAvLyByZXNldHRpbmcgc3Ryb2tlIGRhc2ggYXJyYXkKICAgICAgaWYgKGF0dHJzLnN0cm9rZURhc2hhcnJheSA9PT0gJ25vbmUnKSB7CiAgICAgICAgYXR0cnMuc3Ryb2tlRGFzaGFycmF5ID0gWzEwMDAwLCAxXTsKICAgICAgfQoKICAgICAgdmFyIG1hcmtlciA9IG9wdGlvbnMuZWxlbWVudAogICAgICAgICAgICAgICAgICAgICAuYXR0cihhdHRycykKICAgICAgICAgICAgICAgICAgICAgLm1hcmtlcigwLCAwLCAyMCwgMjAsIHJlZi54LCByZWYueSkKICAgICAgICAgICAgICAgICAgICAgLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgIG1hcmtlcldpZHRoOiAyMCAqIHNjYWxlLAogICAgICAgICAgICAgICAgICAgICAgIG1hcmtlckhlaWdodDogMjAgKiBzY2FsZQogICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgIHJldHVybiBhZGRNYXJrZXIoaWQsIG1hcmtlcik7CiAgICB9CgoKICAgIGNyZWF0ZU1hcmtlcignc2VxdWVuY2VmbG93LWVuZCcsIHsKICAgICAgZWxlbWVudDogcGFwZXIucGF0aCgnTSAxIDUgTCAxMSAxMCBMIDEgMTUgWicpLAogICAgICByZWY6IHsgeDogMTEsIHk6IDEwIH0sCiAgICAgIHNjYWxlOiAwLjUKICAgIH0pOwoKICAgIGNyZWF0ZU1hcmtlcignbWVzc2FnZWZsb3ctc3RhcnQnLCB7CiAgICAgIGVsZW1lbnQ6IHBhcGVyLmNpcmNsZSg2LCA2LCA1KSwKICAgICAgYXR0cnM6IHsKICAgICAgICBmaWxsOiAnd2hpdGUnLAogICAgICAgIHN0cm9rZTogJ2JsYWNrJwogICAgICB9LAogICAgICByZWY6IHsgeDogNiwgeTogNiB9CiAgICB9KTsKCiAgICBjcmVhdGVNYXJrZXIoJ21lc3NhZ2VmbG93LWVuZCcsIHsKICAgICAgZWxlbWVudDogcGFwZXIucGF0aCgnTSAxIDUgTCAxMSAxMCBMIDEgMTUgWicpLAogICAgICBhdHRyczogewogICAgICAgIGZpbGw6ICd3aGl0ZScsCiAgICAgICAgc3Ryb2tlOiAnYmxhY2snCiAgICAgIH0sCiAgICAgIHJlZjogeyB4OiAxMSwgeTogMTAgfQogICAgfSk7CgogICAgY3JlYXRlTWFya2VyKCdkYXRhLWFzc29jaWF0aW9uLWVuZCcsIHsKICAgICAgZWxlbWVudDogcGFwZXIucGF0aCgnTSAxIDUgTCAxMSAxMCBMIDEgMTUnKSwKICAgICAgYXR0cnM6IHsKICAgICAgICBmaWxsOiAnd2hpdGUnLAogICAgICAgIHN0cm9rZTogJ2JsYWNrJwogICAgICB9LAogICAgICByZWY6IHsgeDogMTEsIHk6IDEwIH0sCiAgICAgIHNjYWxlOiAwLjUKICAgIH0pOwoKICAgIGNyZWF0ZU1hcmtlcignY29uZGl0aW9uYWwtZmxvdy1tYXJrZXInLCB7CiAgICAgIGVsZW1lbnQ6IHBhcGVyLnBhdGgoJ00gMCAxMCBMIDggNiBMIDE2IDEwIEwgOCAxNCBaJyksCiAgICAgIGF0dHJzOiB7CiAgICAgICAgZmlsbDogJ3doaXRlJywKICAgICAgICBzdHJva2U6ICdibGFjaycKICAgICAgfSwKICAgICAgcmVmOiB7IHg6IC0xLCB5OiAxMCB9LAogICAgICBzY2FsZTogMC41CiAgICB9KTsKCiAgICBjcmVhdGVNYXJrZXIoJ2NvbmRpdGlvbmFsLWRlZmF1bHQtZmxvdy1tYXJrZXInLCB7CiAgICAgIGVsZW1lbnQ6IHBhcGVyLnBhdGgoJ00gMSA0IEwgNSAxNicpLAogICAgICBhdHRyczogewogICAgICAgIHN0cm9rZTogJ2JsYWNrJwogICAgICB9LAogICAgICByZWY6IHsgeDogLTUsIHk6IDEwIH0sCiAgICAgIHNjYWxlOiAwLjUKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gY29tcHV0ZVN0eWxlKGN1c3RvbSwgdHJhaXRzLCBkZWZhdWx0U3R5bGVzKSB7CiAgICBpZiAoIV8uaXNBcnJheSh0cmFpdHMpKSB7CiAgICAgIGRlZmF1bHRTdHlsZXMgPSB0cmFpdHM7CiAgICAgIHRyYWl0cyA9IFtdOwogICAgfQoKICAgIHJldHVybiBzdHlsZXMuc3R5bGUodHJhaXRzIHx8IFtdLCBfLmV4dGVuZChkZWZhdWx0U3R5bGVzLCBjdXN0b20gfHwge30pKTsKICB9CgogIGZ1bmN0aW9uIGRyYXdDaXJjbGUocCwgd2lkdGgsIGhlaWdodCwgb2Zmc2V0LCBhdHRycykgewoKICAgIGlmIChfLmlzT2JqZWN0KG9mZnNldCkpIHsKICAgICAgYXR0cnMgPSBvZmZzZXQ7CiAgICAgIG9mZnNldCA9IDA7CiAgICB9CgogICAgb2Zmc2V0ID0gb2Zmc2V0IHx8IDA7CgogICAgYXR0cnMgPSBjb21wdXRlU3R5bGUoYXR0cnMsIHsKICAgICAgc3Ryb2tlOiAnYmxhY2snLAogICAgICBzdHJva2VXaWR0aDogMiwKICAgICAgZmlsbDogJ3doaXRlJwogICAgfSk7CgogICAgdmFyIGN4ID0gd2lkdGggLyAyLAogICAgICAgIGN5ID0gaGVpZ2h0IC8gMjsKCiAgICByZXR1cm4gcC5jaXJjbGUoY3gsIGN5LCBNYXRoLnJvdW5kKCh3aWR0aCArIGhlaWdodCkgLyA0IC0gb2Zmc2V0KSkuYXR0cihhdHRycyk7CiAgfQoKICBmdW5jdGlvbiBkcmF3UmVjdChwLCB3aWR0aCwgaGVpZ2h0LCByLCBvZmZzZXQsIGF0dHJzKSB7CgogICAgaWYgKF8uaXNPYmplY3Qob2Zmc2V0KSkgewogICAgICBhdHRycyA9IG9mZnNldDsKICAgICAgb2Zmc2V0ID0gMDsKICAgIH0KCiAgICBvZmZzZXQgPSBvZmZzZXQgfHwgMDsKCiAgICBhdHRycyA9IGNvbXB1dGVTdHlsZShhdHRycywgewogICAgICBzdHJva2U6ICdibGFjaycsCiAgICAgIHN0cm9rZVdpZHRoOiAyLAogICAgICBmaWxsOiAnd2hpdGUnCiAgICB9KTsKCiAgICByZXR1cm4gcC5yZWN0KG9mZnNldCwgb2Zmc2V0LCB3aWR0aCAtIG9mZnNldCAqIDIsIGhlaWdodCAtIG9mZnNldCAqIDIsIHIpLmF0dHIoYXR0cnMpOwogIH0KCiAgZnVuY3Rpb24gZHJhd0RpYW1vbmQocCwgd2lkdGgsIGhlaWdodCwgYXR0cnMpIHsKCiAgICB2YXIgeF8yID0gd2lkdGggLyAyOwogICAgdmFyIHlfMiA9IGhlaWdodCAvIDI7CgogICAgdmFyIHBvaW50cyA9IFt4XzIsIDAsIHdpZHRoLCB5XzIsIHhfMiwgaGVpZ2h0LCAwLCB5XzIgXTsKCiAgICBhdHRycyA9IGNvbXB1dGVTdHlsZShhdHRycywgewogICAgICBzdHJva2U6ICdibGFjaycsCiAgICAgIHN0cm9rZVdpZHRoOiAyLAogICAgICBmaWxsOiAnd2hpdGUnCiAgICB9KTsKCiAgICByZXR1cm4gcC5wb2x5Z29uKHBvaW50cykuYXR0cihhdHRycyk7CiAgfQoKICBmdW5jdGlvbiBkcmF3TGluZShwLCB3YXlwb2ludHMsIGF0dHJzKSB7CiAgICB2YXIgcG9pbnRzID0gZmxhdHRlblBvaW50cyh3YXlwb2ludHMpOwoKICAgIGF0dHJzID0gY29tcHV0ZVN0eWxlKGF0dHJzLCBbICduby1maWxsJyBdLCB7CiAgICAgIHN0cm9rZTogJ2JsYWNrJywKICAgICAgc3Ryb2tlV2lkdGg6IDIsCiAgICAgIGZpbGw6ICdub25lJwogICAgfSk7CgogICAgcmV0dXJuIHAucG9seWxpbmUocG9pbnRzKS5hdHRyKGF0dHJzKTsKICB9CgogIGZ1bmN0aW9uIGRyYXdQYXRoKHAsIGQsIGF0dHJzKSB7CgogICAgYXR0cnMgPSBjb21wdXRlU3R5bGUoYXR0cnMsIFsgJ25vLWZpbGwnIF0sIHsKICAgICAgc3Ryb2tlV2lkdGg6IDIsCiAgICAgIHN0cm9rZTogJ2JsYWNrJwogICAgfSk7CgogICAgcmV0dXJuIHAucGF0aChkKS5hdHRyKGF0dHJzKTsKICB9CgogIGZ1bmN0aW9uIGFzKHR5cGUpIHsKICAgIHJldHVybiBmdW5jdGlvbihwLCBlbGVtZW50KSB7CiAgICAgIHJldHVybiBoYW5kbGVyc1t0eXBlXShwLCBlbGVtZW50KTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiByZW5kZXJlcih0eXBlKSB7CiAgICByZXR1cm4gaGFuZGxlcnNbdHlwZV07CiAgfQoKICBmdW5jdGlvbiByZW5kZXJFdmVudENvbnRlbnQoZWxlbWVudCwgcCkgewoKICAgIHZhciBldmVudCA9IGdldFNlbWFudGljKGVsZW1lbnQpOwogICAgdmFyIGlzVGhyb3dpbmcgPSBpc1Rocm93RXZlbnQoZXZlbnQpOwoKICAgIGlmIChpc1R5cGVkRXZlbnQoZXZlbnQsICdicG1uOk1lc3NhZ2VFdmVudERlZmluaXRpb24nKSkgewogICAgICByZXR1cm4gcmVuZGVyZXIoJ2JwbW46TWVzc2FnZUV2ZW50RGVmaW5pdGlvbicpKHAsIGVsZW1lbnQsIGlzVGhyb3dpbmcpOwogICAgfQoKICAgIGlmIChpc1R5cGVkRXZlbnQoZXZlbnQsICdicG1uOlRpbWVyRXZlbnREZWZpbml0aW9uJykpIHsKICAgICAgcmV0dXJuIHJlbmRlcmVyKCdicG1uOlRpbWVyRXZlbnREZWZpbml0aW9uJykocCwgZWxlbWVudCwgaXNUaHJvd2luZyk7CiAgICB9CgogICAgaWYgKGlzVHlwZWRFdmVudChldmVudCwgJ2JwbW46Q29uZGl0aW9uYWxFdmVudERlZmluaXRpb24nKSkgewogICAgICByZXR1cm4gcmVuZGVyZXIoJ2JwbW46Q29uZGl0aW9uYWxFdmVudERlZmluaXRpb24nKShwLCBlbGVtZW50KTsKICAgIH0KCiAgICBpZiAoaXNUeXBlZEV2ZW50KGV2ZW50LCAnYnBtbjpTaWduYWxFdmVudERlZmluaXRpb24nKSkgewogICAgICByZXR1cm4gcmVuZGVyZXIoJ2JwbW46U2lnbmFsRXZlbnREZWZpbml0aW9uJykocCwgZWxlbWVudCwgaXNUaHJvd2luZyk7CiAgICB9CgogICAgaWYgKGlzVHlwZWRFdmVudChldmVudCwgJ2JwbW46Q2FuY2VsRXZlbnREZWZpbml0aW9uJykgJiYKICAgICAgaXNUeXBlZEV2ZW50KGV2ZW50LCAnYnBtbjpUZXJtaW5hdGVFdmVudERlZmluaXRpb24nLCB7IHBhcmFsbGVsTXVsdGlwbGU6IGZhbHNlIH0pKSB7CiAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpNdWx0aXBsZUV2ZW50RGVmaW5pdGlvbicpKHAsIGVsZW1lbnQsIGlzVGhyb3dpbmcpOwogICAgfQoKICAgIGlmIChpc1R5cGVkRXZlbnQoZXZlbnQsICdicG1uOkNhbmNlbEV2ZW50RGVmaW5pdGlvbicpICYmCiAgICAgIGlzVHlwZWRFdmVudChldmVudCwgJ2JwbW46VGVybWluYXRlRXZlbnREZWZpbml0aW9uJywgeyBwYXJhbGxlbE11bHRpcGxlOiB0cnVlIH0pKSB7CiAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpQYXJhbGxlbE11bHRpcGxlRXZlbnREZWZpbml0aW9uJykocCwgZWxlbWVudCwgaXNUaHJvd2luZyk7CiAgICB9CgogICAgaWYgKGlzVHlwZWRFdmVudChldmVudCwgJ2JwbW46RXNjYWxhdGlvbkV2ZW50RGVmaW5pdGlvbicpKSB7CiAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpFc2NhbGF0aW9uRXZlbnREZWZpbml0aW9uJykocCwgZWxlbWVudCwgaXNUaHJvd2luZyk7CiAgICB9CgogICAgaWYgKGlzVHlwZWRFdmVudChldmVudCwgJ2JwbW46TGlua0V2ZW50RGVmaW5pdGlvbicpKSB7CiAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpMaW5rRXZlbnREZWZpbml0aW9uJykocCwgZWxlbWVudCwgaXNUaHJvd2luZyk7CiAgICB9CgogICAgaWYgKGlzVHlwZWRFdmVudChldmVudCwgJ2JwbW46RXJyb3JFdmVudERlZmluaXRpb24nKSkgewogICAgICByZXR1cm4gcmVuZGVyZXIoJ2JwbW46RXJyb3JFdmVudERlZmluaXRpb24nKShwLCBlbGVtZW50LCBpc1Rocm93aW5nKTsKICAgIH0KCiAgICBpZiAoaXNUeXBlZEV2ZW50KGV2ZW50LCAnYnBtbjpDYW5jZWxFdmVudERlZmluaXRpb24nKSkgewogICAgICByZXR1cm4gcmVuZGVyZXIoJ2JwbW46Q2FuY2VsRXZlbnREZWZpbml0aW9uJykocCwgZWxlbWVudCwgaXNUaHJvd2luZyk7CiAgICB9CgogICAgaWYgKGlzVHlwZWRFdmVudChldmVudCwgJ2JwbW46Q29tcGVuc2F0ZUV2ZW50RGVmaW5pdGlvbicpKSB7CiAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpDb21wZW5zYXRlRXZlbnREZWZpbml0aW9uJykocCwgZWxlbWVudCwgaXNUaHJvd2luZyk7CiAgICB9CgogICAgaWYgKGlzVHlwZWRFdmVudChldmVudCwgJ2JwbW46VGVybWluYXRlRXZlbnREZWZpbml0aW9uJykpIHsKICAgICAgcmV0dXJuIHJlbmRlcmVyKCdicG1uOlRlcm1pbmF0ZUV2ZW50RGVmaW5pdGlvbicpKHAsIGVsZW1lbnQsIGlzVGhyb3dpbmcpOwogICAgfQoKICAgIHJldHVybiBudWxsOwogIH0KCiAgZnVuY3Rpb24gcmVuZGVyTGFiZWwocCwgbGFiZWwsIG9wdGlvbnMpIHsKICAgIHJldHVybiBsYWJlbFV0aWwuY3JlYXRlTGFiZWwocCwgbGFiZWwgfHwgJycsIG9wdGlvbnMpLmFkZENsYXNzKCdkanMtbGFiZWwnKTsKICB9CgogIGZ1bmN0aW9uIHJlbmRlckVtYmVkZGVkTGFiZWwocCwgZWxlbWVudCwgYWxpZ24pIHsKICAgIHZhciBzZW1hbnRpYyA9IGdldFNlbWFudGljKGVsZW1lbnQpOwogICAgcmV0dXJuIHJlbmRlckxhYmVsKHAsIHNlbWFudGljLm5hbWUsIHsgYm94OiBlbGVtZW50LCBhbGlnbjogYWxpZ24gfSk7CiAgfQoKICBmdW5jdGlvbiByZW5kZXJFeHRlcm5hbExhYmVsKHAsIGVsZW1lbnQsIGFsaWduKSB7CiAgICB2YXIgc2VtYW50aWMgPSBnZXRTZW1hbnRpYyhlbGVtZW50KTsKICAgIHJldHVybiByZW5kZXJMYWJlbChwLCBzZW1hbnRpYy5uYW1lLCB7IGJveDogZWxlbWVudCwgYWxpZ246IGFsaWduLCBzdHlsZTogeyBmb250U2l6ZTogJzExcHgnIH0gfSk7CiAgfQoKICBmdW5jdGlvbiByZW5kZXJMYW5lTGFiZWwocCwgdGV4dCwgZWxlbWVudCkgewogICAgdmFyIHRleHRCb3ggPSByZW5kZXJMYWJlbChwLCB0ZXh0LCB7CiAgICAgIGJveDogeyBoZWlnaHQ6IDMwLCB3aWR0aDogZWxlbWVudC5oZWlnaHQgfSwKICAgICAgYWxpZ246ICdjZW50ZXItbWlkZGxlJwogICAgfSk7CgogICAgdmFyIHRvcCA9IC0xICogZWxlbWVudC5oZWlnaHQ7CiAgICB0ZXh0Qm94LnRyYW5zZm9ybSgKICAgICAgJ3JvdGF0ZSgyNzApICcgKwogICAgICAndHJhbnNsYXRlKCcgKyB0b3AgKyAnLCcgKyAwICsgJyknCiAgICApOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlUGF0aEZyb21Db25uZWN0aW9uKGNvbm5lY3Rpb24pIHsKICAgIHZhciB3YXlwb2ludHMgPSBjb25uZWN0aW9uLndheXBvaW50czsKCiAgICB2YXIgcGF0aERhdGEgPSAnbSAgJyArIHdheXBvaW50c1swXS54ICsgJywnICsgd2F5cG9pbnRzWzBdLnk7CiAgICBmb3IgKHZhciBpID0gMTsgaSA8IHdheXBvaW50cy5sZW5ndGg7IGkrKykgewogICAgICBwYXRoRGF0YSArPSAnTCcgKyB3YXlwb2ludHNbaV0ueCArICcsJyArIHdheXBvaW50c1tpXS55ICsgJyAnOwogICAgfQogICAgcmV0dXJuIHBhdGhEYXRhOwogIH0KCiAgdmFyIGhhbmRsZXJzID0gewogICAgJ2JwbW46RXZlbnQnOiBmdW5jdGlvbihwLCBlbGVtZW50LCBhdHRycykgewogICAgICByZXR1cm4gZHJhd0NpcmNsZShwLCBlbGVtZW50LndpZHRoLCBlbGVtZW50LmhlaWdodCwgIGF0dHJzKTsKICAgIH0sCiAgICAnYnBtbjpTdGFydEV2ZW50JzogZnVuY3Rpb24ocCwgZWxlbWVudCkgewogICAgICB2YXIgYXR0cnMgPSB7fTsKICAgICAgdmFyIHNlbWFudGljID0gZ2V0U2VtYW50aWMoZWxlbWVudCk7CgogICAgICBpZiAoIXNlbWFudGljLmlzSW50ZXJydXB0aW5nKSB7CiAgICAgICAgYXR0cnMgPSB7CiAgICAgICAgICBzdHJva2VEYXNoYXJyYXk6ICc2JywKICAgICAgICAgIHN0cm9rZUxpbmVjYXA6ICdyb3VuZCcKICAgICAgICB9OwogICAgICB9CgogICAgICB2YXIgY2lyY2xlID0gcmVuZGVyZXIoJ2JwbW46RXZlbnQnKShwLCBlbGVtZW50LCBhdHRycyk7CgogICAgICByZW5kZXJFdmVudENvbnRlbnQoZWxlbWVudCwgcCk7CgogICAgICByZXR1cm4gY2lyY2xlOwogICAgfSwKICAgICdicG1uOk1lc3NhZ2VFdmVudERlZmluaXRpb24nOiBmdW5jdGlvbihwLCBlbGVtZW50LCBpc1Rocm93aW5nKSB7CiAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnRVZFTlRfTUVTU0FHRScsIHsKICAgICAgICB4U2NhbGVGYWN0b3I6IDAuOSwKICAgICAgICB5U2NhbGVGYWN0b3I6IDAuOSwKICAgICAgICBjb250YWluZXJXaWR0aDogZWxlbWVudC53aWR0aCwKICAgICAgICBjb250YWluZXJIZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0LAogICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICBteDogMC4yMzUsCiAgICAgICAgICBteTogMC4zMTUKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdmFyIGZpbGwgPSBpc1Rocm93aW5nID8gJ2JsYWNrJyA6ICdub25lJzsKICAgICAgdmFyIHN0cm9rZSA9IGlzVGhyb3dpbmcgPyAnd2hpdGUnIDogJ2JsYWNrJzsKCiAgICAgIHZhciBtZXNzYWdlUGF0aCA9IGRyYXdQYXRoKHAsIHBhdGhEYXRhLCB7CiAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgZmlsbDogZmlsbCwKICAgICAgICBzdHJva2U6IHN0cm9rZQogICAgICB9KTsKCiAgICAgIHJldHVybiBtZXNzYWdlUGF0aDsKICAgIH0sCiAgICAnYnBtbjpUaW1lckV2ZW50RGVmaW5pdGlvbic6IGZ1bmN0aW9uKHAsIGVsZW1lbnQpIHsKCiAgICAgIHZhciBjaXJjbGUgPSBkcmF3Q2lyY2xlKHAsIGVsZW1lbnQud2lkdGgsIGVsZW1lbnQuaGVpZ2h0LCAwLjIgKiBlbGVtZW50LmhlaWdodCwgewogICAgICAgIHN0cm9rZVdpZHRoOiAyCiAgICAgIH0pOwoKICAgICAgdmFyIHBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdFVkVOVF9USU1FUl9XSCcsIHsKICAgICAgICB4U2NhbGVGYWN0b3I6IDAuNzUsCiAgICAgICAgeVNjYWxlRmFjdG9yOiAwLjc1LAogICAgICAgIGNvbnRhaW5lcldpZHRoOiBlbGVtZW50LndpZHRoLAogICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgIG14OiAwLjUsCiAgICAgICAgICBteTogMC41CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHZhciBwYXRoID0gZHJhd1BhdGgocCwgcGF0aERhdGEsIHsKICAgICAgICBzdHJva2VXaWR0aDogMgogICAgICB9KTsKCiAgICAgIHJldHVybiBjaXJjbGU7CiAgICB9LAogICAgJ2JwbW46RXNjYWxhdGlvbkV2ZW50RGVmaW5pdGlvbic6IGZ1bmN0aW9uKHAsIGV2ZW50LCBpc1Rocm93aW5nKSB7CiAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnRVZFTlRfRVNDQUxBVElPTicsIHsKICAgICAgICB4U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgeVNjYWxlRmFjdG9yOiAxLAogICAgICAgIGNvbnRhaW5lcldpZHRoOiBldmVudC53aWR0aCwKICAgICAgICBjb250YWluZXJIZWlnaHQ6IGV2ZW50LmhlaWdodCwKICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgbXg6IDAuNSwKICAgICAgICAgIG15OiAwLjU1NQogICAgICAgIH0KICAgICAgfSk7CgogICAgICB2YXIgZmlsbCA9IGlzVGhyb3dpbmcgPyAnYmxhY2snIDogJ25vbmUnOwoKICAgICAgcmV0dXJuIGRyYXdQYXRoKHAsIHBhdGhEYXRhLCB7CiAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgZmlsbDogZmlsbAogICAgICB9KTsKICAgIH0sCiAgICAnYnBtbjpDb25kaXRpb25hbEV2ZW50RGVmaW5pdGlvbic6IGZ1bmN0aW9uKHAsIGV2ZW50KSB7CiAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnRVZFTlRfQ09ORElUSU9OQUwnLCB7CiAgICAgICAgeFNjYWxlRmFjdG9yOiAxLAogICAgICAgIHlTY2FsZUZhY3RvcjogMSwKICAgICAgICBjb250YWluZXJXaWR0aDogZXZlbnQud2lkdGgsCiAgICAgICAgY29udGFpbmVySGVpZ2h0OiBldmVudC5oZWlnaHQsCiAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgIG14OiAwLjUsCiAgICAgICAgICBteTogMC4yMjIKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIGRyYXdQYXRoKHAsIHBhdGhEYXRhLCB7CiAgICAgICAgc3Ryb2tlV2lkdGg6IDEKICAgICAgfSk7CiAgICB9LAogICAgJ2JwbW46TGlua0V2ZW50RGVmaW5pdGlvbic6IGZ1bmN0aW9uKHAsIGV2ZW50KSB7CiAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnRVZFTlRfTElOSycsIHsKICAgICAgICB4U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgeVNjYWxlRmFjdG9yOiAxLAogICAgICAgIGNvbnRhaW5lcldpZHRoOiBldmVudC53aWR0aCwKICAgICAgICBjb250YWluZXJIZWlnaHQ6IGV2ZW50LmhlaWdodCwKICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgbXg6IDAuNTcsCiAgICAgICAgICBteTogMC4yNjMKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIGRyYXdQYXRoKHAsIHBhdGhEYXRhLCB7CiAgICAgICAgc3Ryb2tlV2lkdGg6IDEKICAgICAgfSk7CiAgICB9LAogICAgJ2JwbW46RXJyb3JFdmVudERlZmluaXRpb24nOiBmdW5jdGlvbihwLCBldmVudCwgaXNUaHJvd2luZykgewogICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ0VWRU5UX0VSUk9SJywgewogICAgICAgIHhTY2FsZUZhY3RvcjogMS4xLAogICAgICAgIHlTY2FsZUZhY3RvcjogMS4xLAogICAgICAgIGNvbnRhaW5lcldpZHRoOiBldmVudC53aWR0aCwKICAgICAgICBjb250YWluZXJIZWlnaHQ6IGV2ZW50LmhlaWdodCwKICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgbXg6IDAuMiwKICAgICAgICAgIG15OiAwLjcyMgogICAgICAgIH0KICAgICAgfSk7CgogICAgICB2YXIgZmlsbCA9IGlzVGhyb3dpbmcgPyAnYmxhY2snIDogJ25vbmUnOwoKICAgICAgcmV0dXJuIGRyYXdQYXRoKHAsIHBhdGhEYXRhLCB7CiAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgZmlsbDogZmlsbAogICAgICB9KTsKICAgIH0sCiAgICAnYnBtbjpDYW5jZWxFdmVudERlZmluaXRpb24nOiBmdW5jdGlvbihwLCBldmVudCwgaXNUaHJvd2luZykgewogICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ0VWRU5UX0NBTkNFTF80NScsIHsKICAgICAgICB4U2NhbGVGYWN0b3I6IDEuMCwKICAgICAgICB5U2NhbGVGYWN0b3I6IDEuMCwKICAgICAgICBjb250YWluZXJXaWR0aDogZXZlbnQud2lkdGgsCiAgICAgICAgY29udGFpbmVySGVpZ2h0OiBldmVudC5oZWlnaHQsCiAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgIG14OiAwLjYzOCwKICAgICAgICAgIG15OiAtMC4wNTUKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdmFyIGZpbGwgPSBpc1Rocm93aW5nID8gJ2JsYWNrJyA6ICdub25lJzsKCiAgICAgIHJldHVybiBkcmF3UGF0aChwLCBwYXRoRGF0YSwgewogICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgIGZpbGw6IGZpbGwKICAgICAgfSkudHJhbnNmb3JtKCdyb3RhdGUoNDUpJyk7CiAgICB9LAogICAgJ2JwbW46Q29tcGVuc2F0ZUV2ZW50RGVmaW5pdGlvbic6IGZ1bmN0aW9uKHAsIGV2ZW50LCBpc1Rocm93aW5nKSB7CiAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnRVZFTlRfQ09NUEVOU0FUSU9OJywgewogICAgICAgIHhTY2FsZUZhY3RvcjogMSwKICAgICAgICB5U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgY29udGFpbmVyV2lkdGg6IGV2ZW50LndpZHRoLAogICAgICAgIGNvbnRhaW5lckhlaWdodDogZXZlbnQuaGVpZ2h0LAogICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICBteDogMC4yMDEsCiAgICAgICAgICBteTogMC40NzIKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdmFyIGZpbGwgPSBpc1Rocm93aW5nID8gJ2JsYWNrJyA6ICdub25lJzsKCiAgICAgIHJldHVybiBkcmF3UGF0aChwLCBwYXRoRGF0YSwgewogICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgIGZpbGw6IGZpbGwKICAgICAgfSk7CiAgICB9LAogICAgJ2JwbW46U2lnbmFsRXZlbnREZWZpbml0aW9uJzogZnVuY3Rpb24ocCwgZXZlbnQsIGlzVGhyb3dpbmcpIHsKICAgICAgdmFyIHBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdFVkVOVF9TSUdOQUwnLCB7CiAgICAgICAgeFNjYWxlRmFjdG9yOiAwLjksCiAgICAgICAgeVNjYWxlRmFjdG9yOiAwLjksCiAgICAgICAgY29udGFpbmVyV2lkdGg6IGV2ZW50LndpZHRoLAogICAgICAgIGNvbnRhaW5lckhlaWdodDogZXZlbnQuaGVpZ2h0LAogICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICBteDogMC41LAogICAgICAgICAgbXk6IDAuMgogICAgICAgIH0KICAgICAgfSk7CgogICAgICB2YXIgZmlsbCA9IGlzVGhyb3dpbmcgPyAnYmxhY2snIDogJ25vbmUnOwoKICAgICAgcmV0dXJuIGRyYXdQYXRoKHAsIHBhdGhEYXRhLCB7CiAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgZmlsbDogZmlsbAogICAgICB9KTsKICAgIH0sCiAgICAnYnBtbjpNdWx0aXBsZUV2ZW50RGVmaW5pdGlvbic6IGZ1bmN0aW9uKHAsIGV2ZW50LCBpc1Rocm93aW5nKSB7CiAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnRVZFTlRfTVVMVElQTEUnLCB7CiAgICAgICAgeFNjYWxlRmFjdG9yOiAxLjEsCiAgICAgICAgeVNjYWxlRmFjdG9yOiAxLjEsCiAgICAgICAgY29udGFpbmVyV2lkdGg6IGV2ZW50LndpZHRoLAogICAgICAgIGNvbnRhaW5lckhlaWdodDogZXZlbnQuaGVpZ2h0LAogICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICBteDogMC4yMjIsCiAgICAgICAgICBteTogMC4zNgogICAgICAgIH0KICAgICAgfSk7CgogICAgICB2YXIgZmlsbCA9IGlzVGhyb3dpbmcgPyAnYmxhY2snIDogJ25vbmUnOwoKICAgICAgcmV0dXJuIGRyYXdQYXRoKHAsIHBhdGhEYXRhLCB7CiAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgZmlsbDogZmlsbAogICAgICB9KTsKICAgIH0sCiAgICAnYnBtbjpQYXJhbGxlbE11bHRpcGxlRXZlbnREZWZpbml0aW9uJzogZnVuY3Rpb24ocCwgZXZlbnQpIHsKICAgICAgdmFyIHBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdFVkVOVF9QQVJBTExFTF9NVUxUSVBMRScsIHsKICAgICAgICB4U2NhbGVGYWN0b3I6IDEuMiwKICAgICAgICB5U2NhbGVGYWN0b3I6IDEuMiwKICAgICAgICBjb250YWluZXJXaWR0aDogZXZlbnQud2lkdGgsCiAgICAgICAgY29udGFpbmVySGVpZ2h0OiBldmVudC5oZWlnaHQsCiAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgIG14OiAwLjQ1OCwKICAgICAgICAgIG15OiAwLjE5NAogICAgICAgIH0KICAgICAgfSk7CgogICAgICByZXR1cm4gZHJhd1BhdGgocCwgcGF0aERhdGEsIHsKICAgICAgICBzdHJva2VXaWR0aDogMQogICAgICB9KTsKICAgIH0sCiAgICAnYnBtbjpFbmRFdmVudCc6IGZ1bmN0aW9uKHAsIGVsZW1lbnQpIHsKICAgICAgdmFyIGNpcmNsZSA9IHJlbmRlcmVyKCdicG1uOkV2ZW50JykocCwgZWxlbWVudCwgewogICAgICAgIHN0cm9rZVdpZHRoOiA0CiAgICAgIH0pOwoKICAgICAgcmVuZGVyRXZlbnRDb250ZW50KGVsZW1lbnQsIHAsIHRydWUpOwoKICAgICAgcmV0dXJuIGNpcmNsZTsKICAgIH0sCiAgICAnYnBtbjpUZXJtaW5hdGVFdmVudERlZmluaXRpb24nOiBmdW5jdGlvbihwLCBlbGVtZW50KSB7CiAgICAgIHZhciBjaXJjbGUgPSBkcmF3Q2lyY2xlKHAsIGVsZW1lbnQud2lkdGgsIGVsZW1lbnQuaGVpZ2h0LCA4LCB7CiAgICAgICAgc3Ryb2tlV2lkdGg6IDQsCiAgICAgICAgZmlsbDogJ2JsYWNrJwogICAgICB9KTsKCiAgICAgIHJldHVybiBjaXJjbGU7CiAgICB9LAogICAgJ2JwbW46SW50ZXJtZWRpYXRlRXZlbnQnOiBmdW5jdGlvbihwLCBlbGVtZW50KSB7CiAgICAgIHZhciBvdXRlciA9IHJlbmRlcmVyKCdicG1uOkV2ZW50JykocCwgZWxlbWVudCwgeyBzdHJva2VXaWR0aDogMSB9KTsKICAgICAgdmFyIGlubmVyID0gZHJhd0NpcmNsZShwLCBlbGVtZW50LndpZHRoLCBlbGVtZW50LmhlaWdodCwgSU5ORVJfT1VURVJfRElTVCwgeyBzdHJva2VXaWR0aDogMSB9KTsKCiAgICAgIHJlbmRlckV2ZW50Q29udGVudChlbGVtZW50LCBwKTsKCiAgICAgIHJldHVybiBvdXRlcjsKICAgIH0sCiAgICAnYnBtbjpJbnRlcm1lZGlhdGVDYXRjaEV2ZW50JzogYXMoJ2JwbW46SW50ZXJtZWRpYXRlRXZlbnQnKSwKICAgICdicG1uOkludGVybWVkaWF0ZVRocm93RXZlbnQnOiBhcygnYnBtbjpJbnRlcm1lZGlhdGVFdmVudCcpLAoKICAgICdicG1uOkFjdGl2aXR5JzogZnVuY3Rpb24ocCwgZWxlbWVudCwgYXR0cnMpIHsKICAgICAgcmV0dXJuIGRyYXdSZWN0KHAsIGVsZW1lbnQud2lkdGgsIGVsZW1lbnQuaGVpZ2h0LCBUQVNLX0JPUkRFUl9SQURJVVMsIGF0dHJzKTsKICAgIH0sCgogICAgJ2JwbW46VGFzayc6IGZ1bmN0aW9uKHAsIGVsZW1lbnQpIHsKICAgICAgdmFyIHJlY3QgPSByZW5kZXJlcignYnBtbjpBY3Rpdml0eScpKHAsIGVsZW1lbnQpOwogICAgICByZW5kZXJFbWJlZGRlZExhYmVsKHAsIGVsZW1lbnQsICdjZW50ZXItbWlkZGxlJyk7CiAgICAgIGF0dGFjaFRhc2tNYXJrZXJzKHAsIGVsZW1lbnQpOwogICAgICByZXR1cm4gcmVjdDsKICAgIH0sCiAgICAnYnBtbjpTZXJ2aWNlVGFzayc6IGZ1bmN0aW9uKHAsIGVsZW1lbnQpIHsKICAgICAgdmFyIHRhc2sgPSByZW5kZXJlcignYnBtbjpUYXNrJykocCwgZWxlbWVudCk7CgogICAgICB2YXIgcGF0aERhdGFCRyA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnVEFTS19UWVBFX1NFUlZJQ0UnLCB7CiAgICAgICAgYWJzcG9zOiB7CiAgICAgICAgICB4OiAxMiwKICAgICAgICAgIHk6IDE4CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHZhciBzZXJ2aWNlUGF0aEJHID0gZHJhd1BhdGgocCwgcGF0aERhdGFCRywgewogICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgIGZpbGw6ICdub25lJwogICAgICB9KTsKCiAgICAgIHZhciBmaWxsUGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ1RBU0tfVFlQRV9TRVJWSUNFX0ZJTEwnLCB7CiAgICAgICAgYWJzcG9zOiB7CiAgICAgICAgICB4OiAxNy4yLAogICAgICAgICAgeTogMTgKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdmFyIHNlcnZpY2VGaWxsUGF0aCA9IGRyYXdQYXRoKHAsIGZpbGxQYXRoRGF0YSwgewogICAgICAgIHN0cm9rZVdpZHRoOiAwLAogICAgICAgIHN0cm9rZTogJ25vbmUnLAogICAgICAgIGZpbGw6ICd3aGl0ZScKICAgICAgfSk7CgogICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ1RBU0tfVFlQRV9TRVJWSUNFJywgewogICAgICAgIGFic3BvczogewogICAgICAgICAgeDogMTcsCiAgICAgICAgICB5OiAyMgogICAgICAgIH0KICAgICAgfSk7CgogICAgICB2YXIgc2VydmljZVBhdGggPSBkcmF3UGF0aChwLCBwYXRoRGF0YSwgewogICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgIGZpbGw6ICd3aGl0ZScKICAgICAgfSk7CgogICAgICByZXR1cm4gdGFzazsKICAgIH0sCiAgICAnYnBtbjpVc2VyVGFzayc6IGZ1bmN0aW9uKHAsIGVsZW1lbnQpIHsKICAgICAgdmFyIHRhc2sgPSByZW5kZXJlcignYnBtbjpUYXNrJykocCwgZWxlbWVudCk7CgogICAgICB2YXIgeCA9IDE1OwogICAgICB2YXIgeSA9IDEyOwoKICAgICAgdmFyIHBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdUQVNLX1RZUEVfVVNFUl8xJywgewogICAgICAgIGFic3BvczogewogICAgICAgICAgeDogeCwKICAgICAgICAgIHk6IHkKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdmFyIHVzZXJQYXRoID0gZHJhd1BhdGgocCwgcGF0aERhdGEsIHsKICAgICAgICBzdHJva2VXaWR0aDogMC41LAogICAgICAgIGZpbGw6ICdub25lJwogICAgICB9KTsKCiAgICAgIHZhciBwYXRoRGF0YTIgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ1RBU0tfVFlQRV9VU0VSXzInLCB7CiAgICAgICAgYWJzcG9zOiB7CiAgICAgICAgICB4OiB4LAogICAgICAgICAgeTogeQogICAgICAgIH0KICAgICAgfSk7CgogICAgICB2YXIgdXNlclBhdGgyID0gZHJhd1BhdGgocCwgcGF0aERhdGEyLCB7CiAgICAgICAgc3Ryb2tlV2lkdGg6IDAuNSwKICAgICAgICBmaWxsOiAnbm9uZScKICAgICAgfSk7CgogICAgICB2YXIgcGF0aERhdGEzID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdUQVNLX1RZUEVfVVNFUl8zJywgewogICAgICAgIGFic3BvczogewogICAgICAgICAgeDogeCwKICAgICAgICAgIHk6IHkKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdmFyIHVzZXJQYXRoMyA9IGRyYXdQYXRoKHAsIHBhdGhEYXRhMywgewogICAgICAgIHN0cm9rZVdpZHRoOiAwLjUsCiAgICAgICAgZmlsbDogJ2JsYWNrJwogICAgICB9KTsKCiAgICAgIHJldHVybiB0YXNrOwogICAgfSwKICAgICdicG1uOk1hbnVhbFRhc2snOiBmdW5jdGlvbihwLCBlbGVtZW50KSB7CiAgICAgIHZhciB0YXNrID0gcmVuZGVyZXIoJ2JwbW46VGFzaycpKHAsIGVsZW1lbnQpOwoKICAgICAgdmFyIHBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdUQVNLX1RZUEVfTUFOVUFMJywgewogICAgICAgIGFic3BvczogewogICAgICAgICAgeDogMTcsCiAgICAgICAgICB5OiAxNQogICAgICAgIH0KICAgICAgfSk7CgogICAgICB2YXIgdXNlclBhdGggPSBkcmF3UGF0aChwLCBwYXRoRGF0YSwgewogICAgICAgIHN0cm9rZVdpZHRoOiAwLjI1LAogICAgICAgIGZpbGw6ICdub25lJywKICAgICAgICBzdHJva2U6ICdibGFjaycKICAgICAgfSk7CgogICAgICByZXR1cm4gdGFzazsKICAgIH0sCiAgICAnYnBtbjpTZW5kVGFzayc6IGZ1bmN0aW9uKHAsIGVsZW1lbnQpIHsKICAgICAgdmFyIHRhc2sgPSByZW5kZXJlcignYnBtbjpUYXNrJykocCwgZWxlbWVudCk7CgogICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ1RBU0tfVFlQRV9TRU5EJywgewogICAgICAgIHhTY2FsZUZhY3RvcjogMSwKICAgICAgICB5U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgY29udGFpbmVyV2lkdGg6IDIxLAogICAgICAgIGNvbnRhaW5lckhlaWdodDogMTQsCiAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgIG14OiAwLjI4NSwKICAgICAgICAgIG15OiAwLjM1NwogICAgICAgIH0KICAgICAgfSk7CgogICAgICB2YXIgc2VuZFBhdGggPSBkcmF3UGF0aChwLCBwYXRoRGF0YSwgewogICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgIGZpbGw6ICdibGFjaycsCiAgICAgICAgc3Ryb2tlOiAnd2hpdGUnCiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHRhc2s7CiAgICB9LAogICAgJ2JwbW46UmVjZWl2ZVRhc2snIDogZnVuY3Rpb24ocCwgZWxlbWVudCkgewogICAgICB2YXIgc2VtYW50aWMgPSBnZXRTZW1hbnRpYyhlbGVtZW50KTsKCiAgICAgIHZhciB0YXNrID0gcmVuZGVyZXIoJ2JwbW46VGFzaycpKHAsIGVsZW1lbnQpOwogICAgICB2YXIgcGF0aERhdGE7CgogICAgICBpZiAoc2VtYW50aWMuaW5zdGFudGlhdGUpIHsKICAgICAgICBkcmF3Q2lyY2xlKHAsIDI4LCAyOCwgMjAgKiAwLjIyLCB7IHN0cm9rZVdpZHRoOiAxIH0pOwoKICAgICAgICBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnVEFTS19UWVBFX0lOU1RBTlRJQVRJTkdfU0VORCcsIHsKICAgICAgICAgIGFic3BvczogewogICAgICAgICAgICB4OiA3Ljc3LAogICAgICAgICAgICB5OiA5LjUyCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CgogICAgICAgIHBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdUQVNLX1RZUEVfU0VORCcsIHsKICAgICAgICAgIHhTY2FsZUZhY3RvcjogMC45LAogICAgICAgICAgeVNjYWxlRmFjdG9yOiAwLjksCiAgICAgICAgICBjb250YWluZXJXaWR0aDogMjEsCiAgICAgICAgICBjb250YWluZXJIZWlnaHQ6IDE0LAogICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgbXg6IDAuMywKICAgICAgICAgICAgbXk6IDAuNAogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICB2YXIgc2VuZFBhdGggPSBkcmF3UGF0aChwLCBwYXRoRGF0YSwgewogICAgICAgIHN0cm9rZVdpZHRoOiAxCiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHRhc2s7CiAgICB9LAogICAgJ2JwbW46U2NyaXB0VGFzayc6IGZ1bmN0aW9uKHAsIGVsZW1lbnQpIHsKICAgICAgdmFyIHRhc2sgPSByZW5kZXJlcignYnBtbjpUYXNrJykocCwgZWxlbWVudCk7CgogICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ1RBU0tfVFlQRV9TQ1JJUFQnLCB7CiAgICAgICAgYWJzcG9zOiB7CiAgICAgICAgICB4OiAxNSwKICAgICAgICAgIHk6IDIwCiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHZhciBzY3JpcHRQYXRoID0gZHJhd1BhdGgocCwgcGF0aERhdGEsIHsKICAgICAgICBzdHJva2VXaWR0aDogMQogICAgICB9KTsKCiAgICAgIHJldHVybiB0YXNrOwogICAgfSwKICAgICdicG1uOkJ1c2luZXNzUnVsZVRhc2snOiBmdW5jdGlvbihwLCBlbGVtZW50KSB7CiAgICAgIHZhciB0YXNrID0gcmVuZGVyZXIoJ2JwbW46VGFzaycpKHAsIGVsZW1lbnQpOwoKICAgICAgdmFyIGhlYWRlclBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdUQVNLX1RZUEVfQlVTSU5FU1NfUlVMRV9IRUFERVInLCB7CiAgICAgICAgYWJzcG9zOiB7CiAgICAgICAgICB4OiA4LAogICAgICAgICAgeTogOAogICAgICAgIH0KICAgICAgfSk7CgogICAgICB2YXIgYnVzaW5lc3NIZWFkZXJQYXRoID0gZHJhd1BhdGgocCwgaGVhZGVyUGF0aERhdGEpOwogICAgICBidXNpbmVzc0hlYWRlclBhdGguYXR0cih7CiAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgZmlsbDogJ0FBQScKICAgICAgfSk7CgogICAgICB2YXIgaGVhZGVyRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnVEFTS19UWVBFX0JVU0lORVNTX1JVTEVfTUFJTicsIHsKICAgICAgICBhYnNwb3M6IHsKICAgICAgICAgIHg6IDgsCiAgICAgICAgICB5OiA4CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHZhciBidXNpbmVzc1BhdGggPSBkcmF3UGF0aChwLCBoZWFkZXJEYXRhKTsKICAgICAgYnVzaW5lc3NQYXRoLmF0dHIoewogICAgICAgIHN0cm9rZVdpZHRoOiAxCiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHRhc2s7CiAgICB9LAogICAgJ2JwbW46U3ViUHJvY2Vzcyc6IGZ1bmN0aW9uKHAsIGVsZW1lbnQsIGF0dHJzKSB7CiAgICAgIHZhciByZWN0ID0gcmVuZGVyZXIoJ2JwbW46QWN0aXZpdHknKShwLCBlbGVtZW50LCBhdHRycyk7CgogICAgICB2YXIgc2VtYW50aWMgPSBnZXRTZW1hbnRpYyhlbGVtZW50KSwKICAgICAgICAgIGRpID0gZ2V0RGkoZWxlbWVudCk7CgogICAgICB2YXIgZXhwYW5kZWQgPSBEaVV0aWwuaXNFeHBhbmRlZChzZW1hbnRpYyk7CgogICAgICB2YXIgaXNFdmVudFN1YlByb2Nlc3MgPSAhIWdldFNlbWFudGljKGVsZW1lbnQpLnRyaWdnZXJlZEJ5RXZlbnQ7CiAgICAgIGlmIChpc0V2ZW50U3ViUHJvY2VzcykgewogICAgICAgIHJlY3QuYXR0cih7CiAgICAgICAgICBzdHJva2VEYXNoYXJyYXk6ICcxLDInCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJlbmRlckVtYmVkZGVkTGFiZWwocCwgZWxlbWVudCwgZXhwYW5kZWQgPyAnY2VudGVyLXRvcCcgOiAnY2VudGVyLW1pZGRsZScpOwoKICAgICAgaWYgKGV4cGFuZGVkKSB7CiAgICAgICAgYXR0YWNoVGFza01hcmtlcnMocCwgZWxlbWVudCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYXR0YWNoVGFza01hcmtlcnMocCwgZWxlbWVudCwgWydTdWJQcm9jZXNzTWFya2VyJ10pOwogICAgICB9CgogICAgICByZXR1cm4gcmVjdDsKICAgIH0sCiAgICAnYnBtbjpBZEhvY1N1YlByb2Nlc3MnOiBmdW5jdGlvbihwLCBlbGVtZW50KSB7CiAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpTdWJQcm9jZXNzJykocCwgZWxlbWVudCk7CiAgICB9LAogICAgJ2JwbW46VHJhbnNhY3Rpb24nOiBmdW5jdGlvbihwLCBlbGVtZW50KSB7CiAgICAgIHZhciBvdXRlciA9IHJlbmRlcmVyKCdicG1uOlN1YlByb2Nlc3MnKShwLCBlbGVtZW50KTsKCiAgICAgIHZhciBpbm5lckF0dHJzID0gc3R5bGVzLnN0eWxlKFsgJ25vLWZpbGwnLCAnbm8tZXZlbnRzJyBdKTsKICAgICAgdmFyIGlubmVyID0gZHJhd1JlY3QocCwgZWxlbWVudC53aWR0aCwgZWxlbWVudC5oZWlnaHQsIFRBU0tfQk9SREVSX1JBRElVUyAtIDIsIElOTkVSX09VVEVSX0RJU1QsIGlubmVyQXR0cnMpOwoKICAgICAgcmV0dXJuIG91dGVyOwogICAgfSwKICAgICdicG1uOkNhbGxBY3Rpdml0eSc6IGZ1bmN0aW9uKHAsIGVsZW1lbnQpIHsKICAgICAgcmV0dXJuIHJlbmRlcmVyKCdicG1uOlN1YlByb2Nlc3MnKShwLCBlbGVtZW50LCB7CiAgICAgICAgc3Ryb2tlV2lkdGg6IDUKICAgICAgfSk7CiAgICB9LAogICAgJ2JwbW46UGFydGljaXBhbnQnOiBmdW5jdGlvbihwLCBlbGVtZW50KSB7CgogICAgICB2YXIgbGFuZSA9IHJlbmRlcmVyKCdicG1uOkxhbmUnKShwLCBlbGVtZW50KTsKCiAgICAgIHZhciBleHBhbmRlZFBvb2wgPSBEaVV0aWwuaXNFeHBhbmRlZFBvb2woZ2V0U2VtYW50aWMoZWxlbWVudCkpOwoKICAgICAgaWYgKGV4cGFuZGVkUG9vbCkgewogICAgICAgIGRyYXdMaW5lKHAsIFsKICAgICAgICAgIHt4OiAzMCwgeTogMH0sCiAgICAgICAgICB7eDogMzAsIHk6IGVsZW1lbnQuaGVpZ2h0fQogICAgICAgIF0pOwogICAgICAgIHZhciB0ZXh0ID0gZ2V0U2VtYW50aWMoZWxlbWVudCkubmFtZTsKICAgICAgICByZW5kZXJMYW5lTGFiZWwocCwgdGV4dCwgZWxlbWVudCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gQ29sbGFwc2VkIHBvb2wgZHJhdyB0ZXh0IGlubGluZQogICAgICAgIHZhciB0ZXh0MiA9IGdldFNlbWFudGljKGVsZW1lbnQpLm5hbWU7CiAgICAgICAgcmVuZGVyTGFiZWwocCwgdGV4dDIsIHsgYm94OiBlbGVtZW50LCBhbGlnbjogJ2NlbnRlci1taWRkbGUnIH0pOwogICAgICB9CgogICAgICB2YXIgcGFydGljaXBhbnRNdWx0aXBsaWNpdHkgPSAhIShnZXRTZW1hbnRpYyhlbGVtZW50KS5wYXJ0aWNpcGFudE11bHRpcGxpY2l0eSk7CgogICAgICBpZihwYXJ0aWNpcGFudE11bHRpcGxpY2l0eSkgewogICAgICAgIHJlbmRlcmVyKCdQYXJ0aWNpcGFudE11bHRpcGxpY2l0eU1hcmtlcicpKHAsIGVsZW1lbnQpOwogICAgICB9CgogICAgICByZXR1cm4gbGFuZTsKICAgIH0sCiAgICAnYnBtbjpMYW5lJzogZnVuY3Rpb24ocCwgZWxlbWVudCkgewogICAgICB2YXIgcmVjdCA9IGRyYXdSZWN0KHAsIGVsZW1lbnQud2lkdGgsIGVsZW1lbnQuaGVpZ2h0LCAwLCB7CiAgICAgICAgZmlsbDogJ25vbmUnCiAgICAgIH0pOwoKICAgICAgdmFyIHNlbWFudGljID0gZ2V0U2VtYW50aWMoZWxlbWVudCk7CgogICAgICBpZiAoc2VtYW50aWMuJHR5cGUgPT09ICdicG1uOkxhbmUnKSB7CiAgICAgICAgdmFyIHRleHQgPSBzZW1hbnRpYy5uYW1lOwogICAgICAgIHJlbmRlckxhbmVMYWJlbChwLCB0ZXh0LCBlbGVtZW50KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlY3Q7CiAgICB9LAogICAgJ2JwbW46SW5jbHVzaXZlR2F0ZXdheSc6IGZ1bmN0aW9uKHAsIGVsZW1lbnQpIHsKICAgICAgdmFyIGRpYW1vbmQgPSBkcmF3RGlhbW9uZChwLCBlbGVtZW50LndpZHRoLCBlbGVtZW50LmhlaWdodCk7CgogICAgICB2YXIgY2lyY2xlID0gZHJhd0NpcmNsZShwLCBlbGVtZW50LndpZHRoLCBlbGVtZW50LmhlaWdodCwgZWxlbWVudC5oZWlnaHQgKiAwLjI0LCB7CiAgICAgICAgc3Ryb2tlV2lkdGg6IDIuNSwKICAgICAgICBmaWxsOiAnbm9uZScKICAgICAgfSk7CgogICAgICByZXR1cm4gZGlhbW9uZDsKICAgIH0sCiAgICAnYnBtbjpFeGNsdXNpdmVHYXRld2F5JzogZnVuY3Rpb24ocCwgZWxlbWVudCkgewogICAgICB2YXIgZGlhbW9uZCA9IGRyYXdEaWFtb25kKHAsIGVsZW1lbnQud2lkdGgsIGVsZW1lbnQuaGVpZ2h0KTsKCiAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnR0FURVdBWV9FWENMVVNJVkUnLCB7CiAgICAgICAgeFNjYWxlRmFjdG9yOiAwLjQsCiAgICAgICAgeVNjYWxlRmFjdG9yOiAwLjQsCiAgICAgICAgY29udGFpbmVyV2lkdGg6IGVsZW1lbnQud2lkdGgsCiAgICAgICAgY29udGFpbmVySGVpZ2h0OiBlbGVtZW50LmhlaWdodCwKICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgbXg6IDAuMzIsCiAgICAgICAgICBteTogMC4zCiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIGlmICghIShnZXREaShlbGVtZW50KS5pc01hcmtlclZpc2libGUpKSB7CiAgICAgICAgZHJhd1BhdGgocCwgcGF0aERhdGEsIHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgICAgZmlsbDogJ2JsYWNrJwogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gZGlhbW9uZDsKICAgIH0sCiAgICAnYnBtbjpDb21wbGV4R2F0ZXdheSc6IGZ1bmN0aW9uKHAsIGVsZW1lbnQpIHsKICAgICAgdmFyIGRpYW1vbmQgPSBkcmF3RGlhbW9uZChwLCBlbGVtZW50LndpZHRoLCBlbGVtZW50LmhlaWdodCk7CgogICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ0dBVEVXQVlfQ09NUExFWCcsIHsKICAgICAgICB4U2NhbGVGYWN0b3I6IDAuNSwKICAgICAgICB5U2NhbGVGYWN0b3I6MC41LAogICAgICAgIGNvbnRhaW5lcldpZHRoOiBlbGVtZW50LndpZHRoLAogICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgIG14OiAwLjQ2LAogICAgICAgICAgbXk6IDAuMjYKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdmFyIGNvbXBsZXhQYXRoID0gZHJhd1BhdGgocCwgcGF0aERhdGEsIHsKICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICBmaWxsOiAnYmxhY2snCiAgICAgIH0pOwoKICAgICAgcmV0dXJuIGRpYW1vbmQ7CiAgICB9LAogICAgJ2JwbW46UGFyYWxsZWxHYXRld2F5JzogZnVuY3Rpb24ocCwgZWxlbWVudCkgewogICAgICB2YXIgZGlhbW9uZCA9IGRyYXdEaWFtb25kKHAsIGVsZW1lbnQud2lkdGgsIGVsZW1lbnQuaGVpZ2h0KTsKCiAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnR0FURVdBWV9QQVJBTExFTCcsIHsKICAgICAgICB4U2NhbGVGYWN0b3I6IDAuNiwKICAgICAgICB5U2NhbGVGYWN0b3I6MC42LAogICAgICAgIGNvbnRhaW5lcldpZHRoOiBlbGVtZW50LndpZHRoLAogICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgIG14OiAwLjQ2LAogICAgICAgICAgbXk6IDAuMgogICAgICAgIH0KICAgICAgfSk7CgogICAgICB2YXIgcGFyYWxsZWxQYXRoID0gZHJhd1BhdGgocCwgcGF0aERhdGEsIHsKICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICBmaWxsOiAnYmxhY2snCiAgICAgIH0pOwoKICAgICAgcmV0dXJuIGRpYW1vbmQ7CiAgICB9LAogICAgJ2JwbW46RXZlbnRCYXNlZEdhdGV3YXknOiBmdW5jdGlvbihwLCBlbGVtZW50KSB7CgogICAgICB2YXIgc2VtYW50aWMgPSBnZXRTZW1hbnRpYyhlbGVtZW50KTsKCiAgICAgIHZhciBkaWFtb25kID0gZHJhd0RpYW1vbmQocCwgZWxlbWVudC53aWR0aCwgZWxlbWVudC5oZWlnaHQpOwoKICAgICAgdmFyIG91dGVyQ2lyY2xlID0gZHJhd0NpcmNsZShwLCBlbGVtZW50LndpZHRoLCBlbGVtZW50LmhlaWdodCwgZWxlbWVudC5oZWlnaHQgKiAwLjIwLCB7CiAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgZmlsbDogJ25vbmUnCiAgICAgIH0pOwoKICAgICAgdmFyIHR5cGUgPSBzZW1hbnRpYy5ldmVudEdhdGV3YXlUeXBlOwogICAgICB2YXIgaW5zdGFudGlhdGUgPSAhIXNlbWFudGljLmluc3RhbnRpYXRlOwoKICAgICAgZnVuY3Rpb24gZHJhd0V2ZW50KCkgewoKICAgICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ0dBVEVXQVlfRVZFTlRfQkFTRUQnLCB7CiAgICAgICAgICB4U2NhbGVGYWN0b3I6IDAuMTgsCiAgICAgICAgICB5U2NhbGVGYWN0b3I6IDAuMTgsCiAgICAgICAgICBjb250YWluZXJXaWR0aDogZWxlbWVudC53aWR0aCwKICAgICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICBteDogMC4zNiwKICAgICAgICAgICAgbXk6IDAuNDQKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdmFyIGV2ZW50UGF0aCA9IGRyYXdQYXRoKHAsIHBhdGhEYXRhLCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMiwKICAgICAgICAgIGZpbGw6ICdub25lJwogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAodHlwZSA9PT0gJ1BhcmFsbGVsJykgewoKICAgICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ0dBVEVXQVlfUEFSQUxMRUwnLCB7CiAgICAgICAgICB4U2NhbGVGYWN0b3I6IDAuNCwKICAgICAgICAgIHlTY2FsZUZhY3RvcjowLjQsCiAgICAgICAgICBjb250YWluZXJXaWR0aDogZWxlbWVudC53aWR0aCwKICAgICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICBteDogMC40NzQsCiAgICAgICAgICAgIG15OiAwLjI5NgogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgcGFyYWxsZWxQYXRoID0gZHJhd1BhdGgocCwgcGF0aERhdGEpOwogICAgICAgIHBhcmFsbGVsUGF0aC5hdHRyKHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgICAgZmlsbDogJ25vbmUnCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ0V4Y2x1c2l2ZScpIHsKCiAgICAgICAgaWYgKCFpbnN0YW50aWF0ZSkgewogICAgICAgICAgdmFyIGlubmVyQ2lyY2xlID0gZHJhd0NpcmNsZShwLCBlbGVtZW50LndpZHRoLCBlbGVtZW50LmhlaWdodCwgZWxlbWVudC5oZWlnaHQgKiAwLjI2KTsKICAgICAgICAgIGlubmVyQ2lyY2xlLmF0dHIoewogICAgICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICAgICAgZmlsbDogJ25vbmUnCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGRyYXdFdmVudCgpOwogICAgICB9CgoKICAgICAgcmV0dXJuIGRpYW1vbmQ7CiAgICB9LAogICAgJ2JwbW46R2F0ZXdheSc6IGZ1bmN0aW9uKHAsIGVsZW1lbnQpIHsKICAgICAgcmV0dXJuIGRyYXdEaWFtb25kKHAsIGVsZW1lbnQud2lkdGgsIGVsZW1lbnQuaGVpZ2h0KTsKICAgIH0sCiAgICAnYnBtbjpTZXF1ZW5jZUZsb3cnOiBmdW5jdGlvbihwLCBlbGVtZW50KSB7CiAgICAgIHZhciBwYXRoRGF0YSA9IGNyZWF0ZVBhdGhGcm9tQ29ubmVjdGlvbihlbGVtZW50KTsKICAgICAgdmFyIHBhdGggPSBkcmF3UGF0aChwLCBwYXRoRGF0YSwgewogICAgICAgIG1hcmtlckVuZDogbWFya2VyKCdzZXF1ZW5jZWZsb3ctZW5kJykKICAgICAgfSk7CgogICAgICB2YXIgc2VxdWVuY2VGbG93ID0gZ2V0U2VtYW50aWMoZWxlbWVudCk7CiAgICAgIHZhciBzb3VyY2UgPSBlbGVtZW50LnNvdXJjZS5idXNpbmVzc09iamVjdDsKCiAgICAgIC8vIGNvbmRpdGlvbmFsIGZsb3cgbWFya2VyCiAgICAgIGlmIChzZXF1ZW5jZUZsb3cuY29uZGl0aW9uRXhwcmVzc2lvbiAmJiBzb3VyY2UuJGluc3RhbmNlT2YoJ2JwbW46VGFzaycpKSB7CiAgICAgICAgcGF0aC5hdHRyKHsKICAgICAgICAgIG1hcmtlclN0YXJ0OiBtYXJrZXIoJ2NvbmRpdGlvbmFsLWZsb3ctbWFya2VyJykKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgLy8gZGVmYXVsdCBtYXJrZXIKICAgICAgaWYgKHNvdXJjZS5kZWZhdWx0ICYmIHNvdXJjZS4kaW5zdGFuY2VPZignYnBtbjpHYXRld2F5JykgJiYgc291cmNlLmRlZmF1bHQgPT09IHNlcXVlbmNlRmxvdykgewogICAgICAgIHBhdGguYXR0cih7CiAgICAgICAgICBtYXJrZXJTdGFydDogbWFya2VyKCdjb25kaXRpb25hbC1kZWZhdWx0LWZsb3ctbWFya2VyJykKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBhdGg7CiAgICB9LAogICAgJ2JwbW46QXNzb2NpYXRpb24nOiBmdW5jdGlvbihwLCBlbGVtZW50LCBhdHRycykgewoKICAgICAgYXR0cnMgPSBfLmV4dGVuZCh7CiAgICAgICAgc3Ryb2tlRGFzaGFycmF5OiAnMSw2JywKICAgICAgICBzdHJva2VMaW5lY2FwOiAncm91bmQnCiAgICAgIH0sIGF0dHJzIHx8IHt9KTsKCiAgICAgIC8vIFRPRE8obnJlKTogc3R5bGUgYWNjb3JkaW5nIHRvIGRpcmVjdGVkIHN0YXRlCiAgICAgIHJldHVybiBkcmF3TGluZShwLCBlbGVtZW50LndheXBvaW50cywgYXR0cnMpOwogICAgfSwKICAgICdicG1uOkRhdGFJbnB1dEFzc29jaWF0aW9uJzogZnVuY3Rpb24ocCwgZWxlbWVudCkgewogICAgICByZXR1cm4gcmVuZGVyZXIoJ2JwbW46QXNzb2NpYXRpb24nKShwLCBlbGVtZW50LCB7CiAgICAgICAgbWFya2VyRW5kOiBtYXJrZXIoJ2RhdGEtYXNzb2NpYXRpb24tZW5kJykKICAgICAgfSk7CiAgICB9LAogICAgJ2JwbW46RGF0YU91dHB1dEFzc29jaWF0aW9uJzogZnVuY3Rpb24ocCwgZWxlbWVudCkgewogICAgICByZXR1cm4gcmVuZGVyZXIoJ2JwbW46QXNzb2NpYXRpb24nKShwLCBlbGVtZW50LCB7CiAgICAgICAgbWFya2VyRW5kOiBtYXJrZXIoJ2RhdGEtYXNzb2NpYXRpb24tZW5kJykKICAgICAgfSk7CiAgICB9LAogICAgJ2JwbW46TWVzc2FnZUZsb3cnOiBmdW5jdGlvbihwLCBlbGVtZW50KSB7CgogICAgICB2YXIgZGkgPSBnZXREaShlbGVtZW50KTsKCiAgICAgIHZhciBwYXRoRGF0YSA9IGNyZWF0ZVBhdGhGcm9tQ29ubmVjdGlvbihlbGVtZW50KTsKICAgICAgdmFyIHBhdGggPSBkcmF3UGF0aChwLCBwYXRoRGF0YSwgewogICAgICAgIG1hcmtlckVuZDogbWFya2VyKCdtZXNzYWdlZmxvdy1lbmQnKSwKICAgICAgICBtYXJrZXJTdGFydDogbWFya2VyKCdtZXNzYWdlZmxvdy1zdGFydCcpLAogICAgICAgIHN0cm9rZURhc2hhcnJheTogJzEwJywKICAgICAgICBzdHJva2VMaW5lY2FwOiAncm91bmQnLAogICAgICAgIHN0cm9rZVdpZHRoOiAxCiAgICAgIH0pOwoKICAgICAgaWYgKCEhZGkubWVzc2FnZVZpc2libGVLaW5kKSB7CiAgICAgICAgdmFyIG1pZFBvaW50ID0gcGF0aC5nZXRQb2ludEF0TGVuZ3RoKHBhdGguZ2V0VG90YWxMZW5ndGgoKSAvIDIpOwoKICAgICAgICB2YXIgbWFya2VyUGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ01FU1NBR0VfRkxPV19NQVJLRVInLCB7CiAgICAgICAgICBhYnNwb3M6IHsKICAgICAgICAgICAgeDogbWlkUG9pbnQueCwKICAgICAgICAgICAgeTogbWlkUG9pbnQueQogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgbWVzc2FnZUF0dHJzID0geyBzdHJva2VXaWR0aDogMSB9OwoKICAgICAgICBpZiAoZGkubWVzc2FnZVZpc2libGVLaW5kID09PSAnaW5pdGlhdGluZycpIHsKICAgICAgICAgIG1lc3NhZ2VBdHRycy5maWxsID0gJ3doaXRlJzsKICAgICAgICAgIG1lc3NhZ2VBdHRycy5zdHJva2UgPSAnYmxhY2snOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtZXNzYWdlQXR0cnMuZmlsbCA9ICcjODg4JzsKICAgICAgICAgIG1lc3NhZ2VBdHRycy5zdHJva2UgPSAnd2hpdGUnOwogICAgICAgIH0KCiAgICAgICAgZHJhd1BhdGgocCwgbWFya2VyUGF0aERhdGEsIG1lc3NhZ2VBdHRycyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwYXRoOwogICAgfSwKICAgICdicG1uOkRhdGFPYmplY3QnOiBmdW5jdGlvbihwLCBlbGVtZW50KSB7CiAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnREFUQV9PQkpFQ1RfUEFUSCcsIHsKICAgICAgICB4U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgeVNjYWxlRmFjdG9yOiAxLAogICAgICAgIGNvbnRhaW5lcldpZHRoOiBlbGVtZW50LndpZHRoLAogICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgIG14OiAwLjQ3NCwKICAgICAgICAgIG15OiAwLjI5NgogICAgICAgIH0KICAgICAgfSk7CgogICAgICB2YXIgZWxlbWVudE9iamVjdCA9IGRyYXdQYXRoKHAsIHBhdGhEYXRhLCB7IGZpbGw6ICd3aGl0ZScgfSk7CgogICAgICB2YXIgc2VtYW50aWMgPSBnZXRTZW1hbnRpYyhlbGVtZW50KTsKCiAgICAgIGlmIChpc0NvbGxlY3Rpb24oc2VtYW50aWMpKSB7CiAgICAgICAgcmVuZGVyRGF0YUl0ZW1Db2xsZWN0aW9uKHAsIGVsZW1lbnQpOwogICAgICB9CgogICAgICByZXR1cm4gZWxlbWVudE9iamVjdDsKICAgIH0sCiAgICAnYnBtbjpEYXRhT2JqZWN0UmVmZXJlbmNlJzogYXMoJ2JwbW46RGF0YU9iamVjdCcpLAogICAgJ2JwbW46RGF0YUlucHV0JzogZnVuY3Rpb24ocCwgZWxlbWVudCkgewoKICAgICAgdmFyIGFycm93UGF0aERhdGEgPSBwYXRoTWFwLmdldFJhd1BhdGgoJ0RBVEFfQVJST1cnKTsKCiAgICAgIC8vIHBhZ2UKICAgICAgdmFyIGVsZW1lbnRPYmplY3QgPSByZW5kZXJlcignYnBtbjpEYXRhT2JqZWN0JykocCwgZWxlbWVudCk7CgogICAgICAvLyBhcnJvdwogICAgICB2YXIgZWxlbWVudElucHV0ID0gZHJhd1BhdGgocCwgYXJyb3dQYXRoRGF0YSwgeyBzdHJva2VXaWR0aDogMSB9KTsKCiAgICAgIHJldHVybiBlbGVtZW50T2JqZWN0OwogICAgfSwKICAgICdicG1uOkRhdGFPdXRwdXQnOiBmdW5jdGlvbihwLCBlbGVtZW50KSB7CiAgICAgIHZhciBhcnJvd1BhdGhEYXRhID0gcGF0aE1hcC5nZXRSYXdQYXRoKCdEQVRBX0FSUk9XJyk7CgogICAgICAvLyBwYWdlCiAgICAgIHZhciBlbGVtZW50T2JqZWN0ID0gcmVuZGVyZXIoJ2JwbW46RGF0YU9iamVjdCcpKHAsIGVsZW1lbnQpOwoKICAgICAgLy8gYXJyb3cKICAgICAgdmFyIGVsZW1lbnRJbnB1dCA9IGRyYXdQYXRoKHAsIGFycm93UGF0aERhdGEsIHsKICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICBmaWxsOiAnYmxhY2snCiAgICAgIH0pOwoKICAgICAgcmV0dXJuIGVsZW1lbnRPYmplY3Q7CiAgICB9LAogICAgJ2JwbW46RGF0YVN0b3JlUmVmZXJlbmNlJzogZnVuY3Rpb24ocCwgZWxlbWVudCkgewogICAgICB2YXIgREFUQV9TVE9SRV9QQVRIID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdEQVRBX1NUT1JFJywgewogICAgICAgIHhTY2FsZUZhY3RvcjogMSwKICAgICAgICB5U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgY29udGFpbmVyV2lkdGg6IGVsZW1lbnQud2lkdGgsCiAgICAgICAgY29udGFpbmVySGVpZ2h0OiBlbGVtZW50LmhlaWdodCwKICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgbXg6IDAsCiAgICAgICAgICBteTogMC4xMzMKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdmFyIGVsZW1lbnRTdG9yZSA9IGRyYXdQYXRoKHAsIERBVEFfU1RPUkVfUEFUSCwgewogICAgICAgIHN0cm9rZVdpZHRoOiAyLAogICAgICAgIGZpbGw6ICd3aGl0ZScKICAgICAgfSk7CgogICAgICByZXR1cm4gZWxlbWVudFN0b3JlOwogICAgfSwKICAgICdicG1uOkJvdW5kYXJ5RXZlbnQnOiBmdW5jdGlvbihwLCBlbGVtZW50KSB7CgogICAgICB2YXIgc2VtYW50aWMgPSBnZXRTZW1hbnRpYyhlbGVtZW50KSwKICAgICAgICAgIGNhbmNlbCA9IHNlbWFudGljLmNhbmNlbEFjdGl2aXR5OwoKICAgICAgdmFyIGF0dHJzID0gewogICAgICAgIHN0cm9rZUxpbmVjYXA6ICdyb3VuZCcsCiAgICAgICAgc3Ryb2tlV2lkdGg6IDEKICAgICAgfTsKCiAgICAgIGlmICghY2FuY2VsKSB7CiAgICAgICAgYXR0cnMuc3Ryb2tlRGFzaGFycmF5ID0gJzYnOwogICAgICB9CgogICAgICB2YXIgb3V0ZXIgPSByZW5kZXJlcignYnBtbjpFdmVudCcpKHAsIGVsZW1lbnQsIGF0dHJzKTsKICAgICAgdmFyIGlubmVyID0gZHJhd0NpcmNsZShwLCBlbGVtZW50LndpZHRoLCBlbGVtZW50LmhlaWdodCwgSU5ORVJfT1VURVJfRElTVCwgYXR0cnMpOwoKICAgICAgcmVuZGVyRXZlbnRDb250ZW50KGVsZW1lbnQsIHApOwoKICAgICAgcmV0dXJuIG91dGVyOwogICAgfSwKICAgICdicG1uOkdyb3VwJzogZnVuY3Rpb24ocCwgZWxlbWVudCkgewogICAgICByZXR1cm4gZHJhd1JlY3QocCwgZWxlbWVudC53aWR0aCwgZWxlbWVudC5oZWlnaHQsIFRBU0tfQk9SREVSX1JBRElVUywgewogICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgIHN0cm9rZURhc2hhcnJheTogJzgsMywxLDMnLAogICAgICAgIGZpbGw6ICdub25lJywKICAgICAgICBwb2ludGVyRXZlbnRzOiAnbm9uZScKICAgICAgfSk7CiAgICB9LAogICAgJ2xhYmVsJzogZnVuY3Rpb24ocCwgZWxlbWVudCkgewogICAgICByZXR1cm4gcmVuZGVyRXh0ZXJuYWxMYWJlbChwLCBlbGVtZW50LCAnJyk7CiAgICB9LAogICAgJ2JwbW46VGV4dEFubm90YXRpb24nOiBmdW5jdGlvbihwLCBlbGVtZW50KSB7CiAgICAgIHZhciBzdHlsZSA9IHsKICAgICAgICAnZmlsbCc6ICdub25lJywKICAgICAgICAnc3Ryb2tlJzogJ25vbmUnCiAgICAgIH07CiAgICAgIHZhciB0ZXh0RWxlbWVudCA9IGRyYXdSZWN0KHAsIGVsZW1lbnQud2lkdGgsIGVsZW1lbnQud2lkdGgsIDAsIDAsIHN0eWxlKTsKICAgICAgdmFyIHRleHRQYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnVEVYVF9BTk5PVEFUSU9OJywgewogICAgICAgIHhTY2FsZUZhY3RvcjogMSwKICAgICAgICB5U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgY29udGFpbmVyV2lkdGg6IGVsZW1lbnQud2lkdGgsCiAgICAgICAgY29udGFpbmVySGVpZ2h0OiBlbGVtZW50LmhlaWdodCwKICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgbXg6IDAuMCwKICAgICAgICAgIG15OiAwLjAKICAgICAgICB9CiAgICAgIH0pOwogICAgICBkcmF3UGF0aChwLCB0ZXh0UGF0aERhdGEpOwoKICAgICAgdmFyIHRleHQgPSBnZXRTZW1hbnRpYyhlbGVtZW50KS50ZXh0IHx8ICcnOwogICAgICByZW5kZXJMYWJlbChwLCB0ZXh0LCB7IGJveDogZWxlbWVudCwgYWxpZ246ICdsZWZ0LW1pZGRsZScgfSk7CgogICAgICByZXR1cm4gdGV4dEVsZW1lbnQ7CiAgICB9LAogICAgJ1BhcnRpY2lwYW50TXVsdGlwbGljaXR5TWFya2VyJzogZnVuY3Rpb24ocCwgZWxlbWVudCkgewogICAgICB2YXIgc3ViUHJvY2Vzc1BhdGggPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ01BUktFUl9QQVJBTExFTCcsIHsKICAgICAgICB4U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgeVNjYWxlRmFjdG9yOiAxLAogICAgICAgIGNvbnRhaW5lcldpZHRoOiBlbGVtZW50LndpZHRoLAogICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgIG14OiAoKGVsZW1lbnQud2lkdGggLyAyKSAvIGVsZW1lbnQud2lkdGgpLAogICAgICAgICAgbXk6IChlbGVtZW50LmhlaWdodCAtIDE1KSAvIGVsZW1lbnQuaGVpZ2h0CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIGRyYXdQYXRoKHAsIHN1YlByb2Nlc3NQYXRoKTsKICAgIH0sCiAgICAnU3ViUHJvY2Vzc01hcmtlcic6IGZ1bmN0aW9uKHAsIGVsZW1lbnQpIHsKICAgICAgdmFyIG1hcmtlclJlY3QgPSBkcmF3UmVjdChwLCAxNCwgMTQsIDAsIHsKICAgICAgICBzdHJva2VXaWR0aDogMQogICAgICB9KTsKCiAgICAgIC8vIFByb2Nlc3MgbWFya2VyIGlzIHBsYWNlZCBpbiB0aGUgbWlkZGxlIG9mIHRoZSBib3gKICAgICAgLy8gdGhlcmVmb3JlIGZpeGVkIHZhbHVlcyBjYW4gYmUgdXNlZCBoZXJlCiAgICAgIG1hcmtlclJlY3QudHJhbnNmb3JtKCd0cmFuc2xhdGUoJyArIChlbGVtZW50LndpZHRoIC8gMiAtIDcuNSkgKyAnLCcgKyAoZWxlbWVudC5oZWlnaHQgLSAyMCkgKyAnKScpOwoKICAgICAgdmFyIHN1YlByb2Nlc3NQYXRoID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdNQVJLRVJfU1VCX1BST0NFU1MnLCB7CiAgICAgICAgeFNjYWxlRmFjdG9yOiAxLjUsCiAgICAgICAgeVNjYWxlRmFjdG9yOiAxLjUsCiAgICAgICAgY29udGFpbmVyV2lkdGg6IGVsZW1lbnQud2lkdGgsCiAgICAgICAgY29udGFpbmVySGVpZ2h0OiBlbGVtZW50LmhlaWdodCwKICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgbXg6IChlbGVtZW50LndpZHRoIC8gMiAtIDcuNSkgLyBlbGVtZW50LndpZHRoLAogICAgICAgICAgbXk6IChlbGVtZW50LmhlaWdodCAtIDIwKSAvIGVsZW1lbnQuaGVpZ2h0CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIGRyYXdQYXRoKHAsIHN1YlByb2Nlc3NQYXRoKTsKICAgIH0sCiAgICAnUGFyYWxsZWxNYXJrZXInOiBmdW5jdGlvbihwLCBlbGVtZW50LCBwb3NpdGlvbikgewogICAgICB2YXIgc3ViUHJvY2Vzc1BhdGggPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ01BUktFUl9QQVJBTExFTCcsIHsKICAgICAgICB4U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgeVNjYWxlRmFjdG9yOiAxLAogICAgICAgIGNvbnRhaW5lcldpZHRoOiBlbGVtZW50LndpZHRoLAogICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgIG14OiAoKGVsZW1lbnQud2lkdGggLyAyICsgcG9zaXRpb24ucGFyYWxsZWwpIC8gZWxlbWVudC53aWR0aCksCiAgICAgICAgICBteTogKGVsZW1lbnQuaGVpZ2h0IC0gMjApIC8gZWxlbWVudC5oZWlnaHQKICAgICAgICB9CiAgICAgIH0pOwogICAgICBkcmF3UGF0aChwLCBzdWJQcm9jZXNzUGF0aCk7CiAgICB9LAogICAgJ1NlcXVlbnRpYWxNYXJrZXInOiBmdW5jdGlvbihwLCBlbGVtZW50LCBwb3NpdGlvbikgewogICAgICB2YXIgc2VxdWVudGlhbFBhdGggPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ01BUktFUl9TRVFVRU5USUFMJywgewogICAgICAgIHhTY2FsZUZhY3RvcjogMSwKICAgICAgICB5U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgY29udGFpbmVyV2lkdGg6IGVsZW1lbnQud2lkdGgsCiAgICAgICAgY29udGFpbmVySGVpZ2h0OiBlbGVtZW50LmhlaWdodCwKICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgbXg6ICgoZWxlbWVudC53aWR0aCAvIDIgKyBwb3NpdGlvbi5zZXEpIC8gZWxlbWVudC53aWR0aCksCiAgICAgICAgICBteTogKGVsZW1lbnQuaGVpZ2h0IC0gMTkpIC8gZWxlbWVudC5oZWlnaHQKICAgICAgICB9CiAgICAgIH0pOwogICAgICBkcmF3UGF0aChwLCBzZXF1ZW50aWFsUGF0aCk7CiAgICB9LAogICAgJ0NvbXBlbnNhdGlvbk1hcmtlcic6IGZ1bmN0aW9uKHAsIGVsZW1lbnQsIHBvc2l0aW9uKSB7CiAgICAgIHZhciBjb21wZW5zYXRpb25QYXRoID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdNQVJLRVJfQ09NUEVOU0FUSU9OJywgewogICAgICAgIHhTY2FsZUZhY3RvcjogMSwKICAgICAgICB5U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgY29udGFpbmVyV2lkdGg6IGVsZW1lbnQud2lkdGgsCiAgICAgICAgY29udGFpbmVySGVpZ2h0OiBlbGVtZW50LmhlaWdodCwKICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgbXg6ICgoZWxlbWVudC53aWR0aCAvIDIgKyBwb3NpdGlvbi5jb21wZW5zYXRpb24pIC8gZWxlbWVudC53aWR0aCksCiAgICAgICAgICBteTogKGVsZW1lbnQuaGVpZ2h0IC0gMTMpIC8gZWxlbWVudC5oZWlnaHQKICAgICAgICB9CiAgICAgIH0pOwogICAgICBkcmF3UGF0aChwLCBjb21wZW5zYXRpb25QYXRoLCB7IHN0cm9rZVdpZHRoOiAxIH0pOwogICAgfSwKICAgICdMb29wTWFya2VyJzogZnVuY3Rpb24ocCwgZWxlbWVudCwgcG9zaXRpb24pIHsKICAgICAgdmFyIGxvb3BQYXRoID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdNQVJLRVJfTE9PUCcsIHsKICAgICAgICB4U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgeVNjYWxlRmFjdG9yOiAxLAogICAgICAgIGNvbnRhaW5lcldpZHRoOiBlbGVtZW50LndpZHRoLAogICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgIG14OiAoKGVsZW1lbnQud2lkdGggLyAyICsgcG9zaXRpb24ubG9vcCkgLyBlbGVtZW50LndpZHRoKSwKICAgICAgICAgIG15OiAoZWxlbWVudC5oZWlnaHQgLSA3KSAvIGVsZW1lbnQuaGVpZ2h0CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIGRyYXdQYXRoKHAsIGxvb3BQYXRoLCB7CiAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgZmlsbDogJ25vbmUnLAogICAgICAgIHN0cm9rZUxpbmVjYXA6ICdyb3VuZCcsCiAgICAgICAgc3Ryb2tlTWl0ZXJsaW1pdDogMC41CiAgICAgIH0pOwogICAgfSwKICAgICdBZGhvY01hcmtlcic6IGZ1bmN0aW9uKHAsIGVsZW1lbnQsIHBvc2l0aW9uKSB7CiAgICAgIHZhciBsb29wUGF0aCA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnTUFSS0VSX0FESE9DJywgewogICAgICAgIHhTY2FsZUZhY3RvcjogMSwKICAgICAgICB5U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgY29udGFpbmVyV2lkdGg6IGVsZW1lbnQud2lkdGgsCiAgICAgICAgY29udGFpbmVySGVpZ2h0OiBlbGVtZW50LmhlaWdodCwKICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgbXg6ICgoZWxlbWVudC53aWR0aCAvIDIgKyBwb3NpdGlvbi5hZGhvYykgLyBlbGVtZW50LndpZHRoKSwKICAgICAgICAgIG15OiAoZWxlbWVudC5oZWlnaHQgLSAxNSkgLyBlbGVtZW50LmhlaWdodAogICAgICAgIH0KICAgICAgfSk7CgogICAgICBkcmF3UGF0aChwLCBsb29wUGF0aCwgewogICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgIGZpbGw6ICdibGFjaycKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gYXR0YWNoVGFza01hcmtlcnMocCwgZWxlbWVudCwgdGFza01hcmtlcnMpIHsKICAgIHZhciBvYmogPSBnZXRTZW1hbnRpYyhlbGVtZW50KTsKCiAgICB2YXIgc3VicHJvY2VzcyA9IF8uY29udGFpbnModGFza01hcmtlcnMsICdTdWJQcm9jZXNzTWFya2VyJyk7CiAgICB2YXIgcG9zaXRpb247CgogICAgaWYgKHN1YnByb2Nlc3MpIHsKICAgICAgcG9zaXRpb24gPSB7CiAgICAgICAgc2VxOiAtMjEsCiAgICAgICAgcGFyYWxsZWw6IC0yMiwKICAgICAgICBjb21wZW5zYXRpb246IC00MiwKICAgICAgICBsb29wOiAtMTgsCiAgICAgICAgYWRob2M6IDEwCiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICBwb3NpdGlvbiA9IHsKICAgICAgICBzZXE6IC0zLAogICAgICAgIHBhcmFsbGVsOiAtNiwKICAgICAgICBjb21wZW5zYXRpb246IC0yNywKICAgICAgICBsb29wOiAwLAogICAgICAgIGFkaG9jOiAxMAogICAgICB9OwogICAgfQoKICAgIF8uZm9yRWFjaCh0YXNrTWFya2VycywgZnVuY3Rpb24obWFya2VyKSB7CiAgICAgIHJlbmRlcmVyKG1hcmtlcikocCwgZWxlbWVudCwgcG9zaXRpb24pOwogICAgfSk7CgogICAgaWYgKG9iai4kdHlwZSA9PT0gJ2JwbW46QWRIb2NTdWJQcm9jZXNzJykgewogICAgICByZW5kZXJlcignQWRob2NNYXJrZXInKShwLCBlbGVtZW50LCBwb3NpdGlvbik7CiAgICB9CiAgICBpZiAob2JqLmxvb3BDaGFyYWN0ZXJpc3RpY3MgJiYgb2JqLmxvb3BDaGFyYWN0ZXJpc3RpY3MuaXNTZXF1ZW50aWFsID09PSB1bmRlZmluZWQpIHsKICAgICAgcmVuZGVyZXIoJ0xvb3BNYXJrZXInKShwLCBlbGVtZW50LCBwb3NpdGlvbik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChvYmoubG9vcENoYXJhY3RlcmlzdGljcyAmJgogICAgICBvYmoubG9vcENoYXJhY3RlcmlzdGljcy5pc1NlcXVlbnRpYWwgIT09IHVuZGVmaW5lZCAmJgogICAgICAhb2JqLmxvb3BDaGFyYWN0ZXJpc3RpY3MuaXNTZXF1ZW50aWFsKSB7CiAgICAgIHJlbmRlcmVyKCdQYXJhbGxlbE1hcmtlcicpKHAsIGVsZW1lbnQsIHBvc2l0aW9uKTsKICAgIH0KICAgIGlmIChvYmoubG9vcENoYXJhY3RlcmlzdGljcyAmJiAhIW9iai5sb29wQ2hhcmFjdGVyaXN0aWNzLmlzU2VxdWVudGlhbCkgewogICAgICByZW5kZXJlcignU2VxdWVudGlhbE1hcmtlcicpKHAsIGVsZW1lbnQsIHBvc2l0aW9uKTsKICAgIH0KICAgIGlmICghIW9iai5pc0ZvckNvbXBlbnNhdGlvbikgewogICAgICByZW5kZXJlcignQ29tcGVuc2F0aW9uTWFya2VyJykocCwgZWxlbWVudCwgcG9zaXRpb24pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZHJhd1NoYXBlKHBhcmVudCwgZWxlbWVudCkgewogICAgdmFyIHR5cGUgPSBlbGVtZW50LnR5cGU7CiAgICB2YXIgaCA9IGhhbmRsZXJzW3R5cGVdOwoKICAgIC8qIGpzaGludCAtVzA0MCAqLwogICAgaWYgKCFoKSB7CiAgICAgIHJldHVybiBEZWZhdWx0UmVuZGVyZXIucHJvdG90eXBlLmRyYXdTaGFwZS5hcHBseSh0aGlzLCBbIHBhcmVudCwgZWxlbWVudCBdKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBoKHBhcmVudCwgZWxlbWVudCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBkcmF3Q29ubmVjdGlvbihwYXJlbnQsIGVsZW1lbnQpIHsKICAgIHZhciB0eXBlID0gZWxlbWVudC50eXBlOwogICAgdmFyIGggPSBoYW5kbGVyc1t0eXBlXTsKCiAgICAvKiBqc2hpbnQgLVcwNDAgKi8KICAgIGlmICghaCkgewogICAgICByZXR1cm4gRGVmYXVsdFJlbmRlcmVyLnByb3RvdHlwZS5kcmF3Q29ubmVjdGlvbi5hcHBseSh0aGlzLCBbIHBhcmVudCwgZWxlbWVudCBdKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBoKHBhcmVudCwgZWxlbWVudCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiByZW5kZXJEYXRhSXRlbUNvbGxlY3Rpb24ocCwgZWxlbWVudCkgewoKICAgIHZhciB5UG9zaXRpb24gPSAoZWxlbWVudC5oZWlnaHQgLSAxNikgLyBlbGVtZW50LmhlaWdodDsKCiAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ0RBVEFfT0JKRUNUX0NPTExFQ1RJT05fUEFUSCcsIHsKICAgICAgeFNjYWxlRmFjdG9yOiAxLAogICAgICB5U2NhbGVGYWN0b3I6IDEsCiAgICAgIGNvbnRhaW5lcldpZHRoOiBlbGVtZW50LndpZHRoLAogICAgICBjb250YWluZXJIZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0LAogICAgICBwb3NpdGlvbjogewogICAgICAgIG14OiAwLjQ1MSwKICAgICAgICBteTogeVBvc2l0aW9uCiAgICAgIH0KICAgIH0pOwoKICAgIHZhciBjb2xsZWN0aW9uUGF0aCA9IGRyYXdQYXRoKHAsIHBhdGhEYXRhLCB7CiAgICAgIHN0cm9rZVdpZHRoOiAyCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGlzQ29sbGVjdGlvbihlbGVtZW50LCBmaWx0ZXIpIHsKICAgIHJldHVybiBlbGVtZW50LmlzQ29sbGVjdGlvbiB8fAogICAgICAgICAgIChlbGVtZW50LmVsZW1lbnRPYmplY3RSZWYgJiYgZWxlbWVudC5lbGVtZW50T2JqZWN0UmVmLmlzQ29sbGVjdGlvbik7CiAgfQoKICBmdW5jdGlvbiBnZXREaShlbGVtZW50KSB7CiAgICByZXR1cm4gZWxlbWVudC5idXNpbmVzc09iamVjdC5kaTsKICB9CgogIGZ1bmN0aW9uIGdldFNlbWFudGljKGVsZW1lbnQpIHsKICAgIHJldHVybiBlbGVtZW50LmJ1c2luZXNzT2JqZWN0OwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGV2ZW50RGVmaW5pdGlvbiBvZiB0aGUgZ2l2ZW4gZWxlbWVudCBtYXRjaGVzIHdpdGggc2VtYW50aWMgdHlwZS4KICAgKgogICAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgaWYgZWxlbWVudCBpcyBvZiB0aGUgZ2l2ZW4gc2VtYW50aWMgdHlwZQogICAqLwogIGZ1bmN0aW9uIGlzVHlwZWRFdmVudChldmVudCwgZXZlbnREZWZpbml0aW9uVHlwZSwgZmlsdGVyKSB7CgogICAgZnVuY3Rpb24gbWF0Y2hlcyhkZWZpbml0aW9uLCBmaWx0ZXIpIHsKICAgICAgcmV0dXJuIF8uYWxsKGZpbHRlciwgZnVuY3Rpb24odmFsLCBrZXkpIHsKCiAgICAgICAgLy8gd2Ugd2FudCBhID09IGNvbnZlcnNpb24gaGVyZSwgdG8gYmUgYWJsZSB0byBjYXRjaAogICAgICAgIC8vIHVuZGVmaW5lZCA9PSBmYWxzZSBhbmQgZnJpZW5kcwogICAgICAgIC8qIGpzaGludCAtVzExNiAqLwogICAgICAgIHJldHVybiBkZWZpbml0aW9uW2tleV0gPT0gdmFsOwogICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4gXy5hbnkoZXZlbnQuZXZlbnREZWZpbml0aW9ucywgZnVuY3Rpb24oZGVmaW5pdGlvbikgewogICAgICByZXR1cm4gZGVmaW5pdGlvbi4kdHlwZSA9PT0gZXZlbnREZWZpbml0aW9uVHlwZSAmJiBtYXRjaGVzKGV2ZW50LCBmaWx0ZXIpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBpc1Rocm93RXZlbnQoZXZlbnQpIHsKICAgIHJldHVybiAoZXZlbnQuJHR5cGUgPT09ICdicG1uOkludGVybWVkaWF0ZVRocm93RXZlbnQnKSB8fCAoZXZlbnQuJHR5cGUgPT09ICdicG1uOkVuZEV2ZW50Jyk7CiAgfQoKICAvLyBob29rIG9udG8gY2FudmFzIGluaXQgZXZlbnQgdG8gaW5pdGlhbGl6ZQogIC8vIGNvbm5lY3Rpb24gc3RhcnQvZW5kIG1hcmtlcnMgb24gcGFwZXIKICBldmVudHMub24oJ2NhbnZhcy5pbml0JywgZnVuY3Rpb24oZXZlbnQpIHsKICAgIHZhciBwYXBlciA9IGV2ZW50LnBhcGVyOwoKICAgIGluaXRNYXJrZXJzKHBhcGVyKTsKICB9KTsKCiAgdGhpcy5kcmF3U2hhcGUgPSBkcmF3U2hhcGU7CiAgdGhpcy5kcmF3Q29ubmVjdGlvbiA9IGRyYXdDb25uZWN0aW9uOwp9CgpCcG1uUmVuZGVyZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShEZWZhdWx0UmVuZGVyZXIucHJvdG90eXBlKTsKCgpCcG1uUmVuZGVyZXIuJGluamVjdCA9IFsgJ2V2ZW50QnVzJywgJ3N0eWxlcycsICdwYXRoTWFwJyBdOwoKbW9kdWxlLmV4cG9ydHMgPSBCcG1uUmVuZGVyZXI7Cn0seyIuLi91dGlsL0RpIjo5LCJkaWFncmFtLWpzL2xpYi9kcmF3L1JlbmRlcmVyIjo0OSwiZGlhZ3JhbS1qcy9saWIvdXRpbC9MYWJlbFV0aWwiOjY3fV0sNTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCi8qKgogKiBNYXAgY29udGFpbmluZyBTVkcgcGF0aHMgbmVlZGVkIGJ5IEJwbW5SZW5kZXJlci4KICovCgpmdW5jdGlvbiBQYXRoTWFwKFNuYXApIHsKCiAgLyoqCiAgICogQ29udGFpbnMgYSBtYXAgb2YgcGF0aCBlbGVtZW50cwogICAqCiAgICogPGgxPlBhdGggZGVmaW5pdGlvbjwvaDE+CiAgICogQSBwYXJhbWV0ZXJpemVkIHBhdGggaXMgZGVmaW5lZCBsaWtlIHRoaXM6CiAgICogPHByZT4KICAgKiAnR0FURVdBWV9QQVJBTExFTCc6IHsKICAgKiAgIGQ6ICdtIHtteH0se215fSB7ZS54MH0sMCAwLHtlLngxfSB7ZS54MX0sMCAwLHtlLnkwfSAte2UueDF9LDAgMCx7ZS55MX0gJyArCiAgICAgICAgICAnLXtlLngwfSwwIDAsLXtlLnkxfSAte2UueDF9LDAgMCwte2UueTB9IHtlLngxfSwwIHonLAogICAqICAgaGVpZ2h0OiAxNy41LAogICAqICAgd2lkdGg6ICAxNy41LAogICAqICAgaGVpZ2h0RWxlbWVudHM6IFsyLjUsIDcuNV0sCiAgICogICB3aWR0aEVsZW1lbnRzOiBbMi41LCA3LjVdCiAgICogfQogICAqIDwvcHJlPgogICAqIDxwPkl0J3MgaW1wb3J0YW50IHRvIHNwZWNpZnkgYSBjb3JyZWN0IDxiPmhlaWdodCBhbmQgd2lkdGg8L2I+IGZvciB0aGUgcGF0aCBhcyB0aGUgc2NhbGluZwogICAqIGlzIGJhc2VkIG9uIHRoZSByYXRpbyBiZXR3ZWVuIHRoZSBzcGVjaWZpZWQgaGVpZ2h0IGFuZCB3aWR0aCBpbiB0aGlzIG9iamVjdCBhbmQgdGhlCiAgICogaGVpZ2h0IGFuZCB3aWR0aCB0aGF0IGlzIHNldCBhcyBzY2FsZSB0YXJnZXQgKE5vdGUgeCx5IGNvb3JkaW5hdGVzIHdpbGwgYmUgc2NhbGVkIHdpdGgKICAgKiBpbmRpdmlkdWFsIHJhdGlvcykuPC9wPgogICAqIDxwPlRoZSAnPGI+aGVpZ2h0RWxlbWVudHM8L2I+JyBhbmQgJzxiPndpZHRoRWxlbWVudHM8L2I+JyBhcnJheSBtdXN0IGNvbnRhaW4gdGhlIHZhbHVlcyB0aGF0IHdpbGwgYmUgc2NhbGVkLgogICAqIFRoZSBzY2FsaW5nIGlzIGJhc2VkIG9uIHRoZSBjb21wdXRlZCByYXRpb3MuCiAgICogQ29vcmRpbmF0ZXMgb24gdGhlIHkgYXhpcyBzaG91bGQgYmUgaW4gdGhlIDxiPmhlaWdodEVsZW1lbnQ8L2I+J3MgYXJyYXksIHRoZXkgd2lsbCBiZSBzY2FsZWQgdXNpbmcKICAgKiB0aGUgY29tcHV0ZWQgcmF0aW8gY29lZmZpY2llbnQuCiAgICogSW4gdGhlIHBhcmFtZXRlcml6ZWQgcGF0aCB0aGUgc2NhbGVkIHZhbHVlcyBjYW4gYmUgYWNjZXNzZWQgdGhyb3VnaCB0aGUgJ2UnIG9iamVjdCBpbiB7fSBicmFja2V0cy4KICAgKiAgIDx1bD4KICAgKiAgICA8bGk+VGhlIHZhbHVlcyBmb3IgdGhlIHkgYXhpcyBjYW4gYmUgYWNjZXNzZWQgaW4gdGhlIHBhdGggc3RyaW5nIHVzaW5nIHtlLnkwfSwge2UueTF9LCAuLi4uPC9saT4KICAgKiAgICA8bGk+VGhlIHZhbHVlcyBmb3IgdGhlIHggYXhpcyBjYW4gYmUgYWNjZXNzZWQgaW4gdGhlIHBhdGggc3RyaW5nIHVzaW5nIHtlLngwfSwge2UueDF9LCAuLi4uPC9saT4KICAgKiAgIDwvdWw+CiAgICogICBUaGUgbnVtYmVycyB4MCwgeDEgcmVzcGVjdGl2ZWx5IHkwLCB5MSwgLi4uIG1hcCB0byB0aGUgY29ycmVzcG9uZGluZyBhcnJheSBpbmRleC4KICAgKiA8L3A+CiAgICovCiAgdGhpcy5wYXRoTWFwID0gewogICAgJ0VWRU5UX01FU1NBR0UnOiB7CiAgICAgIGQ6ICdtIHtteH0se215fSBsIDAse2UueTF9IGwge2UueDF9LDAgbCAwLC17ZS55MX0geiBsIHtlLngwfSx7ZS55MH0gbCB7ZS54MH0sLXtlLnkwfScsCiAgICAgIGhlaWdodDogMzYsCiAgICAgIHdpZHRoOiAgMzYsCiAgICAgIGhlaWdodEVsZW1lbnRzOiBbNiwgMTRdLAogICAgICB3aWR0aEVsZW1lbnRzOiBbMTAuNSwgMjFdCiAgICB9LAogICAgJ0VWRU5UX1NJR05BTCc6IHsKICAgICAgZDogJ00ge214fSx7bXl9IGwge2UueDB9LHtlLnkwfSBsIC17ZS54MX0sMCBaJywKICAgICAgaGVpZ2h0OiAzNiwKICAgICAgd2lkdGg6IDM2LAogICAgICBoZWlnaHRFbGVtZW50czogWzE4XSwKICAgICAgd2lkdGhFbGVtZW50czogWzEwLCAyMF0KICAgIH0sCiAgICAnRVZFTlRfRVNDQUxBVElPTic6IHsKICAgICAgZDogJ20ge214fSx7bXl9IGMgLXtlLngxfSx7ZS55MH0gLXtlLngzfSx7ZS55MX0gLXtlLng1fSx7ZS55NH0ge2UueDF9LC17ZS55M30ge2UueDN9LC17ZS55NX0ge2UueDV9LC17ZS55Nn0gJyArCiAgICAgICAgJ3tlLngwfSx7ZS55M30ge2UueDJ9LHtlLnk1fSB7ZS54NH0se2UueTZ9IC17ZS54MH0sLXtlLnkwfSAte2UueDJ9LC17ZS55MX0gLXtlLng0fSwte2UueTR9IHonLAogICAgICBoZWlnaHQ6IDM2LAogICAgICB3aWR0aDogMzYsCiAgICAgIGhlaWdodEVsZW1lbnRzOiBbMi4zODIsIDQuNzY0LCA0LjkyNiwgNi41ODkzMzMsIDcuMTQ2LCAxMy4xNzg2NjcsIDE5Ljc2OF0sCiAgICAgIHdpZHRoRWxlbWVudHM6IFsyLjQ2MywgMi44MDgsIDQuOTI2LCA1LjYxNiwgNy4zODksIDguNDI0XQogICAgfSwKICAgICdFVkVOVF9DT05ESVRJT05BTCc6IHsKICAgICAgZDogJ00ge2UueDB9LHtlLnkwfSBsIHtlLngxfSwwIGwgMCx7ZS55Mn0gbCAte2UueDF9LDAgWiAnICsKICAgICAgICAgJ00ge2UueDJ9LHtlLnkzfSBsIHtlLngwfSwwICcgKwogICAgICAgICAnTSB7ZS54Mn0se2UueTR9IGwge2UueDB9LDAgJyArCiAgICAgICAgICdNIHtlLngyfSx7ZS55NX0gbCB7ZS54MH0sMCAnICsKICAgICAgICAgJ00ge2UueDJ9LHtlLnk2fSBsIHtlLngwfSwwICcgKwogICAgICAgICAnTSB7ZS54Mn0se2UueTd9IGwge2UueDB9LDAgJyArCiAgICAgICAgICdNIHtlLngyfSx7ZS55OH0gbCB7ZS54MH0sMCAnLAogICAgICBoZWlnaHQ6IDM2LAogICAgICB3aWR0aDogIDM2LAogICAgICBoZWlnaHRFbGVtZW50czogWzguNSwgMTQuNSwgMTgsIDExLjUsIDE0LjUsIDE3LjUsIDIwLjUsIDIzLjUsIDI2LjVdLAogICAgICB3aWR0aEVsZW1lbnRzOiAgWzEwLjUsIDE0LjUsIDEyLjVdCiAgICB9LAogICAgJ0VWRU5UX0xJTksnOiB7CiAgICAgIGQ6ICdtIHtteH0se215fSAwLHtlLnkwfSAte2UueDF9LDAgMCx7ZS55MX0ge2UueDF9LDAgMCx7ZS55MH0ge2UueDB9LC17ZS55Mn0gLXtlLngwfSwte2UueTJ9IHonLAogICAgICBoZWlnaHQ6IDM2LAogICAgICB3aWR0aDogMzYsCiAgICAgIGhlaWdodEVsZW1lbnRzOiBbNC40Mzc1LCA2Ljc1LCA3LjgxMjVdLAogICAgICB3aWR0aEVsZW1lbnRzOiBbOS44NDM3NSwgMTMuNV0KICAgIH0sCiAgICAnRVZFTlRfRVJST1InOiB7CiAgICAgIGQ6ICdtIHtteH0se215fSB7ZS54MH0sLXtlLnkwfSB7ZS54MX0sLXtlLnkxfSB7ZS54Mn0se2UueTJ9IHtlLngzfSwte2UueTN9IC17ZS54NH0se2UueTR9IC17ZS54NX0sLXtlLnk1fSB6JywKICAgICAgaGVpZ2h0OiAzNiwKICAgICAgd2lkdGg6IDM2LAogICAgICBoZWlnaHRFbGVtZW50czogWzAuMDIzLCA4LjczNywgOC4xNTEsIDE2LjU2NCwgMTAuNTkxLCA4LjcxNF0sCiAgICAgIHdpZHRoRWxlbWVudHM6IFswLjA4NSwgNi42NzIsIDYuOTcsIDQuMjczLCA1LjMzNywgNi42MzZdCiAgICB9LAogICAgJ0VWRU5UX0NBTkNFTF80NSc6IHsKICAgICAgZDogJ20ge214fSx7bXl9IC17ZS54MX0sMCAwLHtlLngwfSB7ZS54MX0sMCAwLHtlLnkxfSB7ZS54MH0sMCAnICsKICAgICAgICAnMCwte2UueTF9IHtlLngxfSwwIDAsLXtlLnkwfSAte2UueDF9LDAgMCwte2UueTF9IC17ZS54MH0sMCB6JywKICAgICAgaGVpZ2h0OiAzNiwKICAgICAgd2lkdGg6IDM2LAogICAgICBoZWlnaHRFbGVtZW50czogWzQuNzUsIDguNV0sCiAgICAgIHdpZHRoRWxlbWVudHM6IFs0Ljc1LCA4LjVdCiAgICB9LAogICAgJ0VWRU5UX0NPTVBFTlNBVElPTic6IHsKICAgICAgZDogJ20ge214fSx7bXl9IHtlLngwfSwte2UueTB9IDAse2UueTF9IHogbSB7ZS54MH0sMCB7ZS54MH0sLXtlLnkwfSAwLHtlLnkxfSB6JywKICAgICAgaGVpZ2h0OiAzNiwKICAgICAgd2lkdGg6IDM2LAogICAgICBoZWlnaHRFbGVtZW50czogWzUsIDEwXSwKICAgICAgd2lkdGhFbGVtZW50czogWzEwXQogICAgfSwKICAgICdFVkVOVF9USU1FUl9XSCc6IHsKICAgICAgZDogJ00ge214fSx7bXl9IG0gLXtlLngxfSwte2UueTF9IGwge2UueDF9LHtlLnkxfSBsIHtlLngwfSwte2UueTB9JywKICAgICAgaGVpZ2h0OiAzNiwKICAgICAgd2lkdGg6ICAzNiwKICAgICAgaGVpZ2h0RWxlbWVudHM6IFszLjUsNF0sCiAgICAgIHdpZHRoRWxlbWVudHM6IFs4Ljc1LDEwLjVdCiAgICB9LAogICAgJ0VWRU5UX01VTFRJUExFJzogewogICAgICBkOidtIHtteH0se215fSB7ZS54MX0sLXtlLnkwfSB7ZS54MX0se2UueTB9IC17ZS54MH0se2UueTF9IC17ZS54Mn0sMCB6JywKICAgICAgaGVpZ2h0OiAzNiwKICAgICAgd2lkdGg6ICAzNiwKICAgICAgaGVpZ2h0RWxlbWVudHM6IFs2LjI4MDk5LCAxMi41NjE5OV0sCiAgICAgIHdpZHRoRWxlbWVudHM6IFszLjE0MDUsIDkuNDIxNDksIDEyLjU2MTk4XQogICAgfSwKICAgICdFVkVOVF9QQVJBTExFTF9NVUxUSVBMRSc6IHsKICAgICAgZDonbSB7bXh9LHtteX0ge2UueDB9LDAgMCx7ZS55MX0ge2UueDF9LDAgMCx7ZS55MH0gLXtlLngxfSwwIDAse2UueTF9ICcgKwogICAgICAgICcte2UueDB9LDAgMCwte2UueTF9IC17ZS54MX0sMCAwLC17ZS55MH0ge2UueDF9LDAgeicsCiAgICAgIGhlaWdodDogMzYsCiAgICAgIHdpZHRoOiAgMzYsCiAgICAgIGhlaWdodEVsZW1lbnRzOiBbMi41NjIyOCwgNy42ODY4M10sCiAgICAgIHdpZHRoRWxlbWVudHM6IFsyLjU2MjI4LCA3LjY4NjgzXQogICAgfSwKICAgICdHQVRFV0FZX0VYQ0xVU0lWRSc6IHsKICAgICAgZDonbSB7bXh9LHtteX0ge2UueDB9LHtlLnkwfSB7ZS54MX0se2UueTB9IHtlLngyfSwwIHtlLng0fSx7ZS55Mn0gJyArCiAgICAgICAgICAgICAgICAgICAgJ3tlLng0fSx7ZS55MX0ge2UueDJ9LDAge2UueDF9LHtlLnkzfSB7ZS54MH0se2UueTN9ICcgKwogICAgICAgICAgICAgICAgICAgICd7ZS54M30sMCB7ZS54NX0se2UueTF9IHtlLng1fSx7ZS55Mn0ge2UueDN9LDAgeicsCiAgICAgIGhlaWdodDogMTcuNSwKICAgICAgd2lkdGg6ICAxNy41LAogICAgICBoZWlnaHRFbGVtZW50czogWzguNSwgNi41MzEyLCAtNi41MzEyLCAtOC41XSwKICAgICAgd2lkdGhFbGVtZW50czogIFs2LjUsIC02LjUsIDMsIC0zLCA1LCAtNV0KICAgIH0sCiAgICAnR0FURVdBWV9QQVJBTExFTCc6IHsKICAgICAgZDonbSB7bXh9LHtteX0gMCx7ZS55MX0gLXtlLngxfSwwIDAse2UueTB9IHtlLngxfSwwIDAse2UueTF9IHtlLngwfSwwICcgKwogICAgICAgICcwLC17ZS55MX0ge2UueDF9LDAgMCwte2UueTB9IC17ZS54MX0sMCAwLC17ZS55MX0gLXtlLngwfSwwIHonLAogICAgICBoZWlnaHQ6IDMwLAogICAgICB3aWR0aDogIDMwLAogICAgICBoZWlnaHRFbGVtZW50czogWzUsIDEyLjVdLAogICAgICB3aWR0aEVsZW1lbnRzOiBbNSwgMTIuNV0KICAgIH0sCiAgICAnR0FURVdBWV9FVkVOVF9CQVNFRCc6IHsKICAgICAgZDonbSB7bXh9LHtteX0ge2UueDB9LHtlLnkwfSB7ZS54MH0se2UueTF9IHtlLngxfSx7ZS55Mn0ge2UueDJ9LDAgeicsCiAgICAgIGhlaWdodDogMTEsCiAgICAgIHdpZHRoOiAgMTEsCiAgICAgIGhlaWdodEVsZW1lbnRzOiBbLTYsIDYsIDEyLCAtMTJdLAogICAgICB3aWR0aEVsZW1lbnRzOiBbOSwgLTMsIC0xMl0KICAgIH0sCiAgICAnR0FURVdBWV9DT01QTEVYJzogewogICAgICBkOidtIHtteH0se215fSAwLHtlLnkwfSAte2UueDB9LC17ZS55MX0gLXtlLngxfSx7ZS55Mn0ge2UueDB9LHtlLnkxfSAte2UueDJ9LDAgMCx7ZS55M30gJyArCiAgICAgICAgJ3tlLngyfSwwICAte2UueDB9LHtlLnkxfSBsIHtlLngxfSx7ZS55Mn0ge2UueDB9LC17ZS55MX0gMCx7ZS55MH0ge2UueDN9LDAgMCwte2UueTB9IHtlLngwfSx7ZS55MX0gJyArCiAgICAgICAgJ3tlLngxfSwte2UueTJ9IC17ZS54MH0sLXtlLnkxfSB7ZS54Mn0sMCAwLC17ZS55M30gLXtlLngyfSwwIHtlLngwfSwte2UueTF9IC17ZS54MX0sLXtlLnkyfSAnICsKICAgICAgICAnLXtlLngwfSx7ZS55MX0gMCwte2UueTB9IC17ZS54M30sMCB6JywKICAgICAgaGVpZ2h0OiAxNy4xMjUsCiAgICAgIHdpZHRoOiAgMTcuMTI1LAogICAgICBoZWlnaHRFbGVtZW50czogWzQuODc1LCAzLjQzNzUsIDIuMTI1LCAzXSwKICAgICAgd2lkdGhFbGVtZW50czogWzMuNDM3NSwgMi4xMjUsIDQuODc1LCAzXQogICAgfSwKICAgICdEQVRBX09CSkVDVF9QQVRIJzogewogICAgICBkOidtIDAsMCB7ZS54MX0sMCB7ZS54MH0se2UueTB9IDAse2UueTF9IC17ZS54Mn0sMCAwLC17ZS55Mn0ge2UueDF9LDAgMCx7ZS55MH0ge2UueDB9LDAnLAogICAgICBoZWlnaHQ6IDYxLAogICAgICB3aWR0aDogIDUxLAogICAgICBoZWlnaHRFbGVtZW50czogWzEwLCA1MCwgNjBdLAogICAgICB3aWR0aEVsZW1lbnRzOiBbMTAsIDQwLCA1MCwgNjBdCiAgICB9LAogICAgJ0RBVEFfT0JKRUNUX0NPTExFQ1RJT05fUEFUSCc6IHsKICAgICAgZDonbSB7bXh9LCB7bXl9ICcgKwogICAgICAgICdtICAwIDE1ICBsIDAgLTE1ICcgKwogICAgICAgICdtICA0IDE1ICBsIDAgLTE1ICcgKwogICAgICAgICdtICA0IDE1ICBsIDAgLTE1ICcsCiAgICAgIGhlaWdodDogNjEsCiAgICAgIHdpZHRoOiAgNTEsCiAgICAgIGhlaWdodEVsZW1lbnRzOiBbMTJdLAogICAgICB3aWR0aEVsZW1lbnRzOiBbMSwgNiwgMTIsIDE1XQogICAgfSwKICAgICdEQVRBX0FSUk9XJzogewogICAgICBkOidtIDUsOSA5LDAgMCwtMyA1LDUgLTUsNSAwLC0zIC05LDAgeicsCiAgICAgIGhlaWdodDogNjEsCiAgICAgIHdpZHRoOiAgNTEsCiAgICAgIGhlaWdodEVsZW1lbnRzOiBbXSwKICAgICAgd2lkdGhFbGVtZW50czogW10KICAgIH0sCiAgICAnREFUQV9TVE9SRSc6IHsKICAgICAgZDonbSAge214fSx7bXl9ICcgKwogICAgICAgICdsICAwLHtlLnkyfSAnICsKICAgICAgICAnYyAge2UueDB9LHtlLnkxfSB7ZS54MX0se2UueTF9ICB7ZS54Mn0sMCAnICsKICAgICAgICAnbCAgMCwte2UueTJ9ICcgKwogICAgICAgICdjIC17ZS54MH0sLXtlLnkxfSAte2UueDF9LC17ZS55MX0gLXtlLngyfSwwJyArCiAgICAgICAgJ2MgIHtlLngwfSx7ZS55MX0ge2UueDF9LHtlLnkxfSAge2UueDJ9LDAgJyArCiAgICAgICAgJ20gIDAse2UueTB9JyArCiAgICAgICAgJ2MgLXtlLngwfSx7ZS55MX0gLXtlLngxfSx7ZS55MX0gLXtlLngyfSwwJyArCiAgICAgICAgJ20gIDAse2UueTB9JyArCiAgICAgICAgJ2MgIHtlLngwfSx7ZS55MX0ge2UueDF9LHtlLnkxfSAge2UueDJ9LDAnLAogICAgICBoZWlnaHQ6IDYxLAogICAgICB3aWR0aDogIDYxLAogICAgICBoZWlnaHRFbGVtZW50czogWzcsIDEwLCA0NV0sCiAgICAgIHdpZHRoRWxlbWVudHM6ICBbMiwgNTgsIDYwXQogICAgfSwKICAgICdURVhUX0FOTk9UQVRJT04nOiB7CiAgICAgIGQ6ICdtIHtteH0sIHtteX0gbSAxMCwwIGwgLTEwLDAgbCAwLHtlLnkwfSBsIDEwLDAnLAogICAgICBoZWlnaHQ6IDMwLAogICAgICB3aWR0aDogMTAsCiAgICAgIGhlaWdodEVsZW1lbnRzOiBbMzBdLAogICAgICB3aWR0aEVsZW1lbnRzOiBbMTBdCiAgICB9LAogICAgJ01BUktFUl9TVUJfUFJPQ0VTUyc6IHsKICAgICAgZDogJ217bXh9LHtteX0gbSA3LDIgbCAwLDEwIG0gLTUsLTUgbCAxMCwwJywKICAgICAgaGVpZ2h0OiAxMCwKICAgICAgd2lkdGg6IDEwLAogICAgICBoZWlnaHRFbGVtZW50czogW10sCiAgICAgIHdpZHRoRWxlbWVudHM6IFtdCiAgICB9LAogICAgJ01BUktFUl9QQVJBTExFTCc6IHsKICAgICAgZDogJ217bXh9LHtteX0gbSAzLDIgbCAwLDEwIG0gMywtMTAgbCAwLDEwIG0gMywtMTAgbCAwLDEwJywKICAgICAgaGVpZ2h0OiAxMCwKICAgICAgd2lkdGg6IDEwLAogICAgICBoZWlnaHRFbGVtZW50czogW10sCiAgICAgIHdpZHRoRWxlbWVudHM6IFtdCiAgICB9LAogICAgJ01BUktFUl9TRVFVRU5USUFMJzogewogICAgICBkOiAnbXtteH0se215fSBtIDAsMyBsIDEwLDAgbSAtMTAsMyBsIDEwLDAgbSAtMTAsMyBsIDEwLDAnLAogICAgICBoZWlnaHQ6IDEwLAogICAgICB3aWR0aDogMTAsCiAgICAgIGhlaWdodEVsZW1lbnRzOiBbXSwKICAgICAgd2lkdGhFbGVtZW50czogW10KICAgIH0sCiAgICAnTUFSS0VSX0NPTVBFTlNBVElPTic6IHsKICAgICAgZDogJ20ge214fSx7bXl9IDgsLTUgMCwxMCB6IG0gOSwwIDgsLTUgMCwxMCB6JywKICAgICAgaGVpZ2h0OiAxMCwKICAgICAgd2lkdGg6IDIxLAogICAgICBoZWlnaHRFbGVtZW50czogW10sCiAgICAgIHdpZHRoRWxlbWVudHM6IFtdCiAgICB9LAogICAgJ01BUktFUl9MT09QJzogewogICAgICBkOiAnbSB7bXh9LHtteX0gYyAzLjUyNjk3OSwwIDYuMzg2MTYxLC0yLjgyOTg1OCA2LjM4NjE2MSwtNi4zMjA2NjEgMCwtMy40OTA4MDYgLTIuODU5MTgyLC02LjMyMDY2MSAnICsKICAgICAgICAnLTYuMzg2MTYxLC02LjMyMDY2MSAtMy41MjY5NzgsMCAtNi4zODYxNiwyLjgyOTg1NSAtNi4zODYxNiw2LjMyMDY2MSAwLDEuNzQ1NDAyICcgKwogICAgICAgICcwLjcxNDc5NywzLjMyNTU2NyAxLjg3MDQ2Myw0LjQ2OTM4MSAwLjU3NzgzNCwwLjU3MTkwOCAxLjI2NTg4NSwxLjAzNDcyOCAyLjAyOTkxNiwxLjM1NDU3ICcgKwogICAgICAgICdsIC0wLjcxODE2MywtMy45MDk3OTMgbSAwLjcxODE2MywzLjkwOTc5MyAtMy44ODUyMTEsMC44MDI5MDInLAogICAgICBoZWlnaHQ6IDEzLjksCiAgICAgIHdpZHRoOiAxMy43LAogICAgICBoZWlnaHRFbGVtZW50czogW10sCiAgICAgIHdpZHRoRWxlbWVudHM6IFtdCiAgICB9LAogICAgJ01BUktFUl9BREhPQyc6IHsKICAgICAgZDogJ20ge214fSx7bXl9IG0gMC44NDQ2MSwyLjY0NDExIGMgMS4wNTUzMywtMS4yMzc4MDk5NiAyLjY0MzM3LC0yLjA3ODgyIDQuMjk2NTMsLTEuOTc5OTc5OTYgMi4wNTE2MywwLjA4MDUgJyArCiAgICAgICAgJzMuODU1NzksMS4xNTgwMyA1Ljc2MDgyLDEuNzkxMDcgMS4wNjM4NSwwLjM0MTM5OTk2IDIuMjQ0NTQsMC4xNDM4IDMuMTg3NTksLTAuNDM3NjcgMC42MTc0MywtMC4zMzY0MiAnICsKICAgICAgICAnMS4yNzc1LC0wLjY0MDc4IDEuNzU0MiwtMS4xNzUxMSAwLDAuNTYwMjMgMCwxLjEyMDQ2IDAsMS42ODA3IC0wLjk4NzA2LDAuOTYyMzc5OTYgLTIuMjk3OTIsMS42MjM5Mzk5NiAnICsKICAgICAgICAnLTMuNjkxOCwxLjY2MTgxOTk2IC0xLjI0NDU5LDAuMDkyNyAtMi40NjY3MSwtMC4yNDkxIC0zLjU5NTA1LC0wLjc0ODEyIC0xLjM1Nzg5LC0wLjU1OTY1ICcgKwogICAgICAgICctMi43NTEzMywtMS4zMzQzNjk5NiAtNC4yNzAyNywtMS4xODEyMTk5NiAtMS4zNzc0MSwwLjE0NjAxIC0yLjQxODQyLDEuMTM2ODU5OTYgLTMuNDQyODgsMS45Njc4Mjk5NiB6JywKICAgICAgaGVpZ2h0OiA0LAogICAgICB3aWR0aDogMTUsCiAgICAgIGhlaWdodEVsZW1lbnRzOiBbXSwKICAgICAgd2lkdGhFbGVtZW50czogW10KICAgIH0sCiAgICAnVEFTS19UWVBFX1NFTkQnOiB7CiAgICAgIGQ6ICdtIHtteH0se215fSBsIDAse2UueTF9IGwge2UueDF9LDAgbCAwLC17ZS55MX0geiBsIHtlLngwfSx7ZS55MH0gbCB7ZS54MH0sLXtlLnkwfScsCiAgICAgIGhlaWdodDogMTQsCiAgICAgIHdpZHRoOiAgMjEsCiAgICAgIGhlaWdodEVsZW1lbnRzOiBbNiwgMTRdLAogICAgICB3aWR0aEVsZW1lbnRzOiBbMTAuNSwgMjFdCiAgICB9LAogICAgJ1RBU0tfVFlQRV9TQ1JJUFQnOiB7CiAgICAgIGQ6ICdtIHtteH0se215fSBjIDkuOTY2NTUzLC02LjI3Mjc2IC04LjAwMDkyNiwtNy45MTkzMiAyLjk2ODk2OCwtMTQuOTM4IGwgLTguODAyNzI4LDAgJyArCiAgICAgICAgJ2MgLTEwLjk2OTg5NCw3LjAxODY4IDYuOTk3NTg1LDguNjY1MjQgLTIuOTY4OTY3LDE0LjkzOCB6ICcgKwogICAgICAgICdtIC03LC0xMiBsIDUsMCAnICsKICAgICAgICAnbSAtNC41LDMgbCA0LjUsMCAnICsKICAgICAgICAnbSAtMywzIGwgNSwwJyArCiAgICAgICAgJ20gLTQsMyBsIDUsMCcsCiAgICAgIGhlaWdodDogMTUsCiAgICAgIHdpZHRoOiAgMTIuNiwKICAgICAgaGVpZ2h0RWxlbWVudHM6IFs2LCAxNF0sCiAgICAgIHdpZHRoRWxlbWVudHM6IFsxMC41LCAyMV0KICAgIH0sCiAgICAnVEFTS19UWVBFX1VTRVJfMSc6IHsKICAgICAgZDogJ20ge214fSx7bXl9IGMgMC45MDksLTAuODQ1IDEuNTk0LC0yLjA0OSAxLjU5NCwtMy4zODUgMCwtMi41NTQgLTEuODA1LC00LjYyMTk5OTk5ICcgKwogICAgICAgICctNC4zNTcsLTQuNjIxOTk5OTkgLTIuNTUxOTk5OTgsMCAtNC4yODc5OTk5OCwyLjA2Nzk5OTk5IC00LjI4Nzk5OTk4LDQuNjIxOTk5OTkgMCwxLjM0OCAnICsKICAgICAgICAnMC45NzQsMi41NjIgMS44OTU5OTk5OCwzLjQwNSAtMC41Mjg5OTk5OCwwLjE4NyAtNS42NjksMi4wOTcgLTUuNzk0LDQuNzU2MDAwNSB2IDYuNzE4ICcgKwogICAgICAgICdoIDE3IHYgLTYuNzE4IGMgMCwtMi4yOTgwMDA1IC01LjUyNzk5OTYsLTQuNTk1MDAwNSAtNi4wNTA5OTk2LC00Ljc3NjAwMDUgeicgKwogICAgICAgICdtIC04LDYgbCAwLDUuNSBtIDExLDAgbCAwLC01JwogICAgfSwKICAgICdUQVNLX1RZUEVfVVNFUl8yJzogewogICAgICBkOiAnbSB7bXh9LHtteX0gbSAyLjE2MiwxLjAwOSBjIDAsMi40NDcwMDA1IC0yLjE1OCw0LjQzMTAwMDUgLTQuODIxLDQuNDMxMDAwNSAnICsKICAgICAgICAnLTIuNjY0OTk5OTgsMCAtNC44MjIsLTEuOTgxIC00LjgyMiwtNC40MzEwMDA1ICcKICAgIH0sCiAgICAnVEFTS19UWVBFX1VTRVJfMyc6IHsKICAgICAgZDogJ20ge214fSx7bXl9IG0gLTYuOSwtMy44MCBjIDAsMCAyLjI1MDk5OTk4LC0yLjM1OCA0LjI3Mzk5OTk4LC0xLjE3NyAyLjAyNCwxLjE4MSA0LjIyMSwxLjUzNyAnICsKICAgICAgICAnNC4xMjQsMC45NjUgLTAuMDk4LC0wLjU3IC0wLjExNywtMy43OTA5OTk5OSAtNC4xOTEsLTQuMTM1OTk5OTkgLTMuNTc0OTk5OTgsMC4wMDEgJyArCiAgICAgICAgJy00LjIwNzk5OTk4LDMuMzY2OTk5OTkgLTQuMjA2OTk5OTgsNC4zNDc5OTk5OSB6JwogICAgfSwKICAgICdUQVNLX1RZUEVfTUFOVUFMJzogewogICAgICBkOiAnbSB7bXh9LHtteX0gYyAwLjIzNCwtMC4wMSA1LjYwNCwwLjAwOCA4LjAyOSwwLjAwNCAwLjgwOCwwIDEuMjcxLC0wLjE3MiAxLjQxNywtMC43NTIgMC4yMjcsLTAuODk4ICcgKwogICAgICAgICctMC4zMzQsLTEuMzE0IC0xLjMzOCwtMS4zMTYgLTIuNDY3LC0wLjAxIC03Ljg4NiwtMC4wMDQgLTguMTA4LC0wLjAwNCAtMC4wMTQsLTAuMDc5IDAuMDE2LC0wLjUzMyAwLC0wLjYxICcgKwogICAgICAgICcwLjE5NSwtMC4wNDIgOC41MDcsMC4wMDYgOS42MTYsMC4wMDIgMC44NzcsLTAuMDA3IDEuMzUsLTAuNDM4IDEuMzUzLC0xLjIwOCAwLjAwMywtMC43NjggLTAuNDc5LC0xLjA5ICcgKwogICAgICAgICctMS4zNSwtMS4wOTEgLTIuOTY4LC0wLjAwMiAtOS42MTksLTAuMDEzIC05LjYxOSwtMC4wMTMgdiAtMC41OTEgYyAwLDAgNS4wNTIsLTAuMDE2IDcuMjI1LC0wLjAxNiAnICsKICAgICAgICAnMC44ODgsLTAuMDAyIDEuMzU0LC0wLjQxNiAxLjM1MSwtMS4xOTMgLTAuMDA2LC0wLjc2MSAtMC40OTIsLTEuMTk2IC0xLjM2MSwtMS4xOTYgLTMuNDczLC0wLjAwNSAnICsKICAgICAgICAnLTEwLjg2LC0wLjAwMyAtMTEuMDgyOTk5NSwtMC4wMDMgLTAuMDIyLC0wLjA0NyAtMC4wNDUsLTAuMDk0IC0wLjA2OSwtMC4xMzkgMC4zOTM5OTk1LC0wLjMxOSAnICsKICAgICAgICAnMi4wNDA5OTk1LC0xLjYyNiAyLjQxNDk5OTUsLTIuMDE3IDAuNDY5LC0wLjQ4NzAwMDUgMC41MTksLTEuMTY1MDAwNSAwLjE2MiwtMS42MDQwMDA1IC0wLjQxNCwtMC41MTEgJyArCiAgICAgICAgJy0wLjk3MywtMC41IC0xLjQ4LC0wLjIzNiAtMS40NjA5OTk1LDAuNzY0IC02LjU5OTk5OTUsMy42NDMwMDA1IC03LjczMjk5OTUsNC4yNzEwMDA1IC0wLjksMC40OTkgJyArCiAgICAgICAgJy0xLjUxNiwxLjI1MyAtMS44ODIsMi4xOSAtMC4zNzAwMDAwMiwwLjk1IC0wLjE3LDIuMDEgLTAuMTY2LDIuOTc5IDAuMDA0LDAuNzE4IC0wLjI3MzAwMDAyLDEuMzQ1ICcgKwogICAgICAgICctMC4wNTUsMi4wNjMgMC42MjksMi4wODcgMi40MjUsMy4zMTIgNC44NTksMy4zMTggNC42MTc5OTk1LDAuMDE0IDkuMjM3OTk5NSwtMC4xMzkgMTMuODU2OTk5NSwtMC4xNTggJyArCiAgICAgICAgJzAuNzU1LC0wLjAwNCAxLjE3MSwtMC4zMDEgMS4xODIsLTEuMDMzIDAuMDEyLC0wLjc1NCAtMC40MjMsLTAuOTY5IC0xLjE4MywtMC45NzMgLTEuNzc4LC0wLjAxICcgKwogICAgICAgICctNS44MjQsLTAuMDA0IC02LjA0LC0wLjAwNCAxMGUtNCwtMC4wODQgMC4wMDMsLTAuNTg2IDEwZS00LC0wLjY3IHonCiAgICB9LAogICAgJ1RBU0tfVFlQRV9JTlNUQU5USUFUSU5HX1NFTkQnOiB7CiAgICAgIGQ6ICdtIHtteH0se215fSBsIDAsOC40IGwgMTIuNiwwIGwgMCwtOC40IHogbCA2LjMsMy42IGwgNi4zLC0zLjYnCiAgICB9LAogICAgJ1RBU0tfVFlQRV9TRVJWSUNFJzogewogICAgICBkOiAnbSB7bXh9LHtteX0gdiAtMS43MTMzNSBjIDAuMzUyMzI2LC0wLjA3MDUgMC43MDM5MzIsLTAuMTc4MzggMS4wNDc2MjgsLTAuMzIxMzMgJyArCiAgICAgICAgJzAuMzQ0NDE2LC0wLjE0NDY1IDAuNjY1ODIyLC0wLjMyMTMzIDAuOTY2Mzc3LC0wLjUyMTQ1IGwgMS4xOTQzMSwxLjE4MDA1IDEuNTY3NDg3LC0xLjU3Njg4ICcgKwogICAgICAgICctMS4xOTUwMjgsLTEuMTgwMTQgYyAwLjQwMzM3NiwtMC42MTM5NCAwLjY4MzA3OSwtMS4yOTkwOCAwLjgyNTQ0NywtMi4wMTgyNCBsIDEuNjIyMTMzLC0wLjAxICcgKwogICAgICAgICd2IC0yLjIxOTYgbCAtMS42MzY1MTQsMC4wMSBjIC0wLjA3MzMzLC0wLjM1MTUzIC0wLjE3ODMxOSwtMC43MDAyNCAtMC4zMjM1NjQsLTEuMDQzNzIgJyArCiAgICAgICAgJy0wLjE0NTI0NCwtMC4zNDQwNiAtMC4zMjE0MDcsLTAuNjY0NCAtMC41MjI3MzUsLTAuOTYyMTcgbCAxLjEzMTAzNSwtMS4xMzYzMSAtMS41ODMzMDUsLTEuNTYyOTMgJyArCiAgICAgICAgJy0xLjEyOTU5OCwxLjEzNTg5IGMgLTAuNjE0MDUyLC0wLjQwMTA4IC0xLjMwMjg4MywtMC42ODA5MyAtMi4wMjI2MzMsLTAuODIyNDcgbCAwLjAwOTMsLTEuNjE4NTIgJyArCiAgICAgICAgJ2ggLTIuMjQxMTczIGwgMC4wMDQyLDEuNjMxMjQgYyAtMC4zNTM3NjMsMC4wNzM2IC0wLjcwNTM2OSwwLjE3OTc3IC0xLjA0OTc4NSwwLjMyMzcxIC0wLjM0NDQxNSwwLjE0NDM3ICcgKwogICAgICAgICctMC42NjUxMDIsMC4zMjA5MiAtMC45NjM1MDA2LDAuNTIwNDYgbCAtMS4xNjk4NjI4LC0xLjE1ODIzIC0xLjU2Njc2OTEsMS41NzkyIDEuMTY4NDI2NSwxLjE1NjY5ICcgKwogICAgICAgICdjIC0wLjQwMjY1NzMsMC42MTI4MyAtMC42ODMwOCwxLjI5Nzk3IC0wLjgyNDcyODcsMi4wMTcxMyBsIC0xLjY1ODgwNDEsMC4wMDMgdiAyLjIyMTc0ICcgKwogICAgICAgICdsIDEuNjcyNDY0OCwtMC4wMDYgYyAwLjA3MzMyNywwLjM1MDc3IDAuMTc5NzU5OCwwLjcwMjQzIDAuMzI0Mjg1MSwxLjA0NDcyIDAuMTQ1MjQyOCwwLjM0NDQ4ICcgKwogICAgICAgICcwLjMyMTQwNjQsMC42NjQ0IDAuNTIyNzMzOSwwLjk2MDY2IGwgLTEuMTk5MzQzMSwxLjE5NzIzIDEuNTg0MDI1NiwxLjU2MDExIDEuMTk2NDY2OCwtMS4xOTM0OCAnICsKICAgICAgICAnYyAwLjYxNDA1MTcsMC40MDM0NiAxLjMwMjg4MjcsMC42ODIzMiAyLjAyMzM1MTcsMC44MjMzMSBsIDcuMTllLTQsMS42OTg5MiBoIDIuMjI2ODQ4IHogJyArCiAgICAgICAgJ20gMC4yMjE0NjIsLTMuOTk1NyBjIC0xLjc4ODk0OCwwLjc1MDIgLTMuODU3NiwtMC4wOTI4IC00LjYwOTcwNTUsLTEuODc0MzggLTAuNzUyMTA2NSwtMS43ODMyMSAnICsKICAgICAgICAnMC4wOTA1OTgsLTMuODQ2MjcgMS44ODAyNjQ1LC00LjU5NjA0IDEuNzg4MjMsLTAuNzQ5MzYgMy44NTY4ODEsMC4wOTI5IDQuNjA4OTg3LDEuODc0MzcgJyArCiAgICAgICAgJzAuNzUyMTA2LDEuNzgxNjUgLTAuMDkwNiwzLjg0NjEyIC0xLjg3OTU0Niw0LjU5NjA1IHonCiAgICB9LAogICAgJ1RBU0tfVFlQRV9TRVJWSUNFX0ZJTEwnOiB7CiAgICAgIGQ6ICdtIHtteH0se215fSBjIC0xLjc4ODk0OCwwLjc1MDIgLTMuODU3NiwtMC4wOTI4IC00LjYwOTcwNTUsLTEuODc0MzggLTAuNzUyMTA2NSwtMS43ODMyMSAnICsKICAgICAgICAnMC4wOTA1OTgsLTMuODQ2MjcgMS44ODAyNjQ1LC00LjU5NjA0IDEuNzg4MjMsLTAuNzQ5MzYgMy44NTY4ODEsMC4wOTI5IDQuNjA4OTg3LDEuODc0MzcgJyArCiAgICAgICAgJzAuNzUyMTA2LDEuNzgxNjUgLTAuMDkwNiwzLjg0NjEyIC0xLjg3OTU0Niw0LjU5NjA1IHonCiAgICB9LAogICAgJ1RBU0tfVFlQRV9CVVNJTkVTU19SVUxFX0hFQURFUic6IHsKICAgICAgZDogJ20ge214fSx7bXl9IDAsNCAyMCwwIDAsLTQgeicKICAgIH0sCiAgICAnVEFTS19UWVBFX0JVU0lORVNTX1JVTEVfTUFJTic6IHsKICAgICAgZDogJ20ge214fSx7bXl9IDAsMTIgMjAsMCAwLC0xMiB6JyArCiAgICAgICAgJ20gMCw4IGwgMjAsMCAnICsKICAgICAgICAnbSAtMTMsLTQgbCAwLDgnCiAgICB9LAogICAgJ01FU1NBR0VfRkxPV19NQVJLRVInOiB7CiAgICAgIGQ6ICdtIHtteH0se215fSBtIC0xMC41ICwtNyBsIDAsMTQgbCAyMSwwIGwgMCwtMTQgeiBsIDEwLjUsNiBsIDEwLjUsLTYnCiAgICB9CiAgfTsKCiAgdGhpcy5nZXRSYXdQYXRoID0gZnVuY3Rpb24gZ2V0UmF3UGF0aChwYXRoSWQpIHsKICAgIHJldHVybiB0aGlzLnBhdGhNYXBbcGF0aElkXS5kOwogIH07CgogIC8qKgogICAqIFNjYWxlcyB0aGUgcGF0aCB0byB0aGUgZ2l2ZW4gaGVpZ2h0IGFuZCB3aWR0aC4KICAgKiA8aDE+VXNlIGNhc2U8L2gxPgogICAqIDxwPlVzZSBjYXNlIGlzIHRvIHNjYWxlIHRoZSBjb250ZW50IG9mIGVsZW1lbnRzIChldmVudCwgZ2F0ZXdheXMpIGJhc2VkCiAgICogb24gdGhlIGVsZW1lbnQgYm91bmRpbmcgYm94J3Mgc2l6ZS4KICAgKiA8L3A+CiAgICogPGgxPldoeSBub3QgdHJhbnNmb3JtPC9oMT4KICAgKiA8cD5TY2FsaW5nIGEgcGF0aCB3aXRoIHRyYW5zZm9ybSgpIHdpbGwgYWxzbyBzY2FsZSB0aGUgc3Ryb2tlIGFuZCBJRSBkb2VzIG5vdCBzdXBwb3J0CiAgICogdGhlIG9wdGlvbiAnbm9uLXNjYWxpbmctc3Ryb2tlJyB0byBwcmV2ZW50IHRoaXMuCiAgICogQWxzbyB0aGVyZSBhcmUgdXNlIGNhc2VzIHdoZXJlIG9ubHkgc29tZSBwYXJ0cyBvZiBhIHBhdGggc2hvdWxkIGJlCiAgICogc2NhbGVkLjwvcD4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoSWQgVGhlIElEIG9mIHRoZSBwYXRoLgogICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbSA8cD4KICAgKiAgIEV4YW1wbGUgcGFyYW0gb2JqZWN0IHNjYWxlcyB0aGUgcGF0aCB0byA2MCUgc2l6ZSBvZiB0aGUgY29udGFpbmVyIChkYXRhLndpZHRoLCBkYXRhLmhlaWdodCkuCiAgICogICA8cHJlPgogICAqICAgewogICAqICAgICB4U2NhbGVGYWN0b3I6IDAuNiwKICAgKiAgICAgeVNjYWxlRmFjdG9yOjAuNiwKICAgKiAgICAgY29udGFpbmVyV2lkdGg6IGRhdGEud2lkdGgsCiAgICogICAgIGNvbnRhaW5lckhlaWdodDogZGF0YS5oZWlnaHQsCiAgICogICAgIHBvc2l0aW9uOiB7CiAgICogICAgICAgbXg6IDAuNDYsCiAgICogICAgICAgbXk6IDAuMiwKICAgKiAgICAgfQogICAqICAgfQogICAqICAgPC9wcmU+CiAgICogICA8dWw+CiAgICogICAgPGxpPnRhcmdldHBhdGh3aWR0aCA9IHhTY2FsZUZhY3RvciAqIGNvbnRhaW5lcldpZHRoPC9saT4KICAgKiAgICA8bGk+dGFyZ2V0cGF0aGhlaWdodCA9IHlTY2FsZUZhY3RvciAqIGNvbnRhaW5lckhlaWdodDwvbGk+CiAgICogICAgPGxpPlBvc2l0aW9uIGlzIHVzZWQgdG8gc2V0IHRoZSBzdGFydGluZyBjb29yZGluYXRlIG9mIHRoZSBwYXRoLiBNIGlzIGNvbXB1dGVkOgogICAgKiAgICA8dWw+CiAgICAqICAgICAgPGxpPnBvc2l0aW9uLnggKiBjb250YWluZXJXaWR0aDwvbGk+CiAgICAqICAgICAgPGxpPnBvc2l0aW9uLnkgKiBjb250YWluZXJIZWlnaHQ8L2xpPgogICAgKiAgICA8L3VsPgogICAgKiAgICBDZW50ZXIgb2YgdGhlIGNvbnRhaW5lciA8cHJlPiBwb3NpdGlvbjogewogICAqICAgICAgIG14OiAwLjUsCiAgICogICAgICAgbXk6IDAuNSwKICAgKiAgICAgfTwvcHJlPgogICAqICAgICBVcHBlciBsZWZ0IGNvcm5lciBvZiB0aGUgY29udGFpbmVyCiAgICogICAgIDxwcmU+IHBvc2l0aW9uOiB7CiAgICogICAgICAgbXg6IDAuMCwKICAgKiAgICAgICBteTogMC4wLAogICAqICAgICB9PC9wcmU+CiAgICogICAgPC9saT4KICAgKiAgIDwvdWw+CiAgICogPC9wPgogICAqCiAgICovCiAgdGhpcy5nZXRTY2FsZWRQYXRoID0gZnVuY3Rpb24gZ2V0U2NhbGVkUGF0aChwYXRoSWQsIHBhcmFtKSB7CiAgICB2YXIgcmF3UGF0aCA9IHRoaXMucGF0aE1hcFtwYXRoSWRdOwoKICAgIC8vIHBvc2l0aW9uaW5nCiAgICAvLyBjb21wdXRlIHRoZSBzdGFydCBwb2ludCBvZiB0aGUgcGF0aAogICAgdmFyIG14LCBteTsKCiAgICBpZighIXBhcmFtLmFic3BvcykgewogICAgICBteCA9IHBhcmFtLmFic3Bvcy54OwogICAgICBteSA9IHBhcmFtLmFic3Bvcy55OwogICAgfSBlbHNlIHsKICAgICAgbXggPSBwYXJhbS5jb250YWluZXJXaWR0aCAqIHBhcmFtLnBvc2l0aW9uLm14OwogICAgICBteSA9IHBhcmFtLmNvbnRhaW5lckhlaWdodCAqIHBhcmFtLnBvc2l0aW9uLm15OwogICAgfQoKICAgIHZhciBjb29yZGluYXRlcyA9IHt9OyAvL21hcCBmb3IgdGhlIHNjYWxlZCBjb29yZGluYXRlcwogICAgaWYocGFyYW0ucG9zaXRpb24pIHsKCiAgICAgIC8vIHBhdGgKICAgICAgdmFyIGhlaWdodFJhdGlvID0gKHBhcmFtLmNvbnRhaW5lckhlaWdodCAvIHJhd1BhdGguaGVpZ2h0KSAqIHBhcmFtLnlTY2FsZUZhY3RvcjsKICAgICAgdmFyIHdpZHRoUmF0aW8gPSAocGFyYW0uY29udGFpbmVyV2lkdGggLyByYXdQYXRoLndpZHRoKSAqIHBhcmFtLnhTY2FsZUZhY3RvcjsKCgogICAgICAvL0FwcGx5IGhlaWdodCByYXRpbwogICAgICBmb3IgKHZhciBoZWlnaHRJbmRleCA9IDA7IGhlaWdodEluZGV4IDwgcmF3UGF0aC5oZWlnaHRFbGVtZW50cy5sZW5ndGg7IGhlaWdodEluZGV4KyspIHsKICAgICAgICBjb29yZGluYXRlc1sneScgKyBoZWlnaHRJbmRleF0gPSByYXdQYXRoLmhlaWdodEVsZW1lbnRzW2hlaWdodEluZGV4XSAqIGhlaWdodFJhdGlvOwogICAgICB9CgogICAgICAvL0FwcGx5IHdpZHRoIHJhdGlvCiAgICAgIGZvciAodmFyIHdpZHRoSW5kZXggPSAwOyB3aWR0aEluZGV4IDwgcmF3UGF0aC53aWR0aEVsZW1lbnRzLmxlbmd0aDsgd2lkdGhJbmRleCsrKSB7CiAgICAgICAgY29vcmRpbmF0ZXNbJ3gnICsgd2lkdGhJbmRleF0gPSByYXdQYXRoLndpZHRoRWxlbWVudHNbd2lkdGhJbmRleF0gKiB3aWR0aFJhdGlvOwogICAgICB9CiAgICB9CgogICAgLy9BcHBseSB2YWx1ZSB0byByYXcgcGF0aAogICAgdmFyIHBhdGggPSBTbmFwLmZvcm1hdCgKICAgICAgcmF3UGF0aC5kLCB7CiAgICAgICAgbXg6IG14LAogICAgICAgIG15OiBteSwKICAgICAgICBlOiBjb29yZGluYXRlcwogICAgICB9CiAgICApOwogICAgcmV0dXJuIHBhdGg7CiAgfTsKfQoKClBhdGhNYXAuJGluamVjdCA9IFsgJ3NuYXAnIF07Cgptb2R1bGUuZXhwb3J0cyA9IFBhdGhNYXA7Cn0se31dLDY6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cyA9IHsKICBfX2RlcGVuZHNfXzogWyBfZGVyZXFfKCcuLi9jb3JlJykgXSwKICByZW5kZXJlcjogWyAndHlwZScsIF9kZXJlcV8oJy4vQnBtblJlbmRlcmVyJykgXSwKICBwYXRoTWFwOiBbICd0eXBlJywgX2RlcmVxXygnLi9QYXRoTWFwJykgXQp9Owp9LHsiLi4vY29yZSI6MywiLi9CcG1uUmVuZGVyZXIiOjQsIi4vUGF0aE1hcCI6NX1dLDc6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgXyA9ICh3aW5kb3cuXyk7Cgp2YXIgUmVmcyA9IF9kZXJlcV8oJ29iamVjdC1yZWZzJyk7Cgp2YXIgZGlSZWZzID0gbmV3IFJlZnMoeyBuYW1lOiAnYnBtbkVsZW1lbnQnLCBlbnVtZXJhYmxlOiB0cnVlIH0sIHsgbmFtZTogJ2RpJyB9KTsKCgpmdW5jdGlvbiBCcG1uVHJlZVdhbGtlcihoYW5kbGVyKSB7CgogIC8vIGxpc3Qgb2YgY29udGFpbmVycyBhbHJlYWR5IHdhbGtlZAogIHZhciBoYW5kbGVkUHJvY2Vzc2VzID0gW107CgogIC8vIGxpc3Qgb2YgZWxlbWVudHMgdG8gaGFuZGxlIGRlZmVycmVkIHRvIGVuc3VyZQogIC8vIHByZXJlcXVpc2l0ZXMgYXJlIGRyYXduCiAgdmFyIGRlZmVycmVkID0gW107CgogIC8vLy8vIEhlbHBlcnMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogIGZ1bmN0aW9uIGNvbnRleHR1YWwoZm4sIGN0eCkgewogICAgcmV0dXJuIGZ1bmN0aW9uKGUpIHsKICAgICAgZm4oZSwgY3R4KTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBpcyhlbGVtZW50LCB0eXBlKSB7CiAgICByZXR1cm4gZWxlbWVudC4kaW5zdGFuY2VPZih0eXBlKTsKICB9CgogIGZ1bmN0aW9uIHZpc2l0KGVsZW1lbnQsIGN0eCkgewoKICAgIHZhciBnZnggPSBlbGVtZW50LmdmeDsKCiAgICAvLyBhdm9pZCBtdWx0aXBsZSByZW5kZXJpbmcgb2YgZWxlbWVudHMKICAgIGlmIChnZngpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdhbHJlYWR5IHJlbmRlcmVkIDwnICsgZWxlbWVudC5pZCArICc+Jyk7CiAgICB9CgogICAgLy8gY2FsbCBoYW5kbGVyCiAgICByZXR1cm4gaGFuZGxlci5lbGVtZW50KGVsZW1lbnQsIGN0eCk7CiAgfQoKICBmdW5jdGlvbiB2aXNpdFJvb3QoZWxlbWVudCwgZGlhZ3JhbSkgewogICAgcmV0dXJuIGhhbmRsZXIucm9vdChlbGVtZW50LCBkaWFncmFtKTsKICB9CgogIGZ1bmN0aW9uIHZpc2l0SWZEaShlbGVtZW50LCBjdHgpIHsKICAgIHRyeSB7CiAgICAgIGlmIChlbGVtZW50LmRpKSB7CiAgICAgICAgcmV0dXJuIHZpc2l0KGVsZW1lbnQsIGN0eCk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgbG9nRXJyb3IoZS5tZXNzYWdlLCB7IGVsZW1lbnQ6IGVsZW1lbnQsIGVycm9yOiBlIH0pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gbG9nRXJyb3IobWVzc2FnZSwgY29udGV4dCkgewogICAgaGFuZGxlci5lcnJvcihtZXNzYWdlLCBjb250ZXh0KTsKICB9CgogIC8vLy8vLyBESSBoYW5kbGluZyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogIGZ1bmN0aW9uIHJlZ2lzdGVyRGkoZGkpIHsKICAgIHZhciBicG1uRWxlbWVudCA9IGRpLmJwbW5FbGVtZW50OwoKICAgIGlmIChicG1uRWxlbWVudCkgewogICAgICBkaVJlZnMuYmluZChicG1uRWxlbWVudCwgJ2RpJyk7CiAgICAgIGJwbW5FbGVtZW50LmRpID0gZGk7CiAgICB9IGVsc2UgewogICAgICBsb2dFcnJvcignbm8gYnBtbkVsZW1lbnQgZm9yIDwnICsgZGkuJHR5cGUgKyAnIycgKyBkaS5pZCArICc+JywgeyBlbGVtZW50OiBkaSB9KTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGhhbmRsZURpYWdyYW0oZGlhZ3JhbSkgewogICAgaGFuZGxlUGxhbmUoZGlhZ3JhbS5wbGFuZSk7CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVQbGFuZShwbGFuZSkgewogICAgcmVnaXN0ZXJEaShwbGFuZSk7CgogICAgXy5mb3JFYWNoKHBsYW5lLnBsYW5lRWxlbWVudCwgaGFuZGxlUGxhbmVFbGVtZW50KTsKICB9CgogIGZ1bmN0aW9uIGhhbmRsZVBsYW5lRWxlbWVudChwbGFuZUVsZW1lbnQpIHsKICAgIHJlZ2lzdGVyRGkocGxhbmVFbGVtZW50KTsKICB9CgoKICAvLy8vLy8gU2VtYW50aWMgaGFuZGxpbmcgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICBmdW5jdGlvbiBoYW5kbGVEZWZpbml0aW9ucyhkZWZpbml0aW9ucywgZGlhZ3JhbSkgewogICAgLy8gbWFrZSBzdXJlIHdlIHdhbGsgdGhlIGNvcnJlY3QgYnBtbkVsZW1lbnQKCiAgICB2YXIgZGlhZ3JhbXMgPSBkZWZpbml0aW9ucy5kaWFncmFtczsKCiAgICBpZiAoZGlhZ3JhbSAmJiBkaWFncmFtcy5pbmRleE9mKGRpYWdyYW0pID09PSAtMSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2RpYWdyYW0gbm90IHBhcnQgb2YgYnBtbjpEZWZpbml0aW9ucycpOwogICAgfQoKICAgIGlmICghZGlhZ3JhbSAmJiBkaWFncmFtcyAmJiBkaWFncmFtcy5sZW5ndGgpIHsKICAgICAgZGlhZ3JhbSA9IGRpYWdyYW1zWzBdOwogICAgfQoKICAgIC8vIG5vIGRpYWdyYW0gLT4gbm90aGluZyB0byBpbXBvcnQKICAgIGlmICghZGlhZ3JhbSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gbG9hZCBESSBmcm9tIHNlbGVjdGVkIGRpYWdyYW0gb25seQogICAgaGFuZGxlRGlhZ3JhbShkaWFncmFtKTsKCiAgICB2YXIgcGxhbmUgPSBkaWFncmFtLnBsYW5lLAogICAgICAgIHJvb3RFbGVtZW50ID0gcGxhbmUuYnBtbkVsZW1lbnQ7CgogICAgaWYgKCFyb290RWxlbWVudCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ25vIHJvb3RFbGVtZW50IHJlZmVyZW5jZWQgaW4gQlBNTlBsYW5lIDwnICsgZGlhZ3JhbS5wbGFuZS5pZCArICc+Jyk7CiAgICB9CgoKICAgIHZhciBjdHggPSB2aXNpdFJvb3Qocm9vdEVsZW1lbnQsIHBsYW5lKTsKCiAgICBpZiAoaXMocm9vdEVsZW1lbnQsICdicG1uOlByb2Nlc3MnKSkgewogICAgICBoYW5kbGVQcm9jZXNzKHJvb3RFbGVtZW50LCBjdHgpOwogICAgfSBlbHNlIGlmIChpcyhyb290RWxlbWVudCwgJ2JwbW46Q29sbGFib3JhdGlvbicpKSB7CiAgICAgIGhhbmRsZUNvbGxhYm9yYXRpb24ocm9vdEVsZW1lbnQsIGN0eCk7CgogICAgICAvLyBmb3JjZSBkcmF3aW5nIG9mIGV2ZXJ5dGhpbmcgbm90IHlldCBkcmF3biB0aGF0IGlzIHBhcnQgb2YgdGhlIHRhcmdldCBESQogICAgICBoYW5kbGVVbmhhbmRsZWRQcm9jZXNzZXMoZGVmaW5pdGlvbnMucm9vdEVsZW1lbnRzLCBjdHgpOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCd1bnN1cHBvcnRlZCByb290IGVsZW1lbnQgZm9yIGJwbW5kaTpEaWFncmFtIDwnICsgcm9vdEVsZW1lbnQuJHR5cGUgKyAnPicpOwogICAgfQoKICAgIC8vIGhhbmRsZSBhbGwgZGVmZXJyZWQgZWxlbWVudHMKICAgIGhhbmRsZURlZmVycmVkKGRlZmVycmVkKTsKICB9CgogIGZ1bmN0aW9uIGhhbmRsZURlZmVycmVkKGRlZmVycmVkKSB7CiAgICBfLmZvckVhY2goZGVmZXJyZWQsIGZ1bmN0aW9uKGQpIHsgZCgpOyB9KTsKICB9CgogIGZ1bmN0aW9uIGhhbmRsZVByb2Nlc3MocHJvY2VzcywgY29udGV4dCkgewogICAgaGFuZGxlRmxvd0VsZW1lbnRzQ29udGFpbmVyKHByb2Nlc3MsIGNvbnRleHQpOwogICAgaGFuZGxlSW9TcGVjaWZpY2F0aW9uKHByb2Nlc3MuaW9TcGVjaWZpY2F0aW9uLCBjb250ZXh0KTsKCiAgICBoYW5kbGVBcnRpZmFjdHMocHJvY2Vzcy5hcnRpZmFjdHMsIGNvbnRleHQpOwoKICAgIC8vIGxvZyBwcm9jZXNzIGhhbmRsZWQKICAgIGhhbmRsZWRQcm9jZXNzZXMucHVzaChwcm9jZXNzKTsKICB9CgogIGZ1bmN0aW9uIGhhbmRsZVVuaGFuZGxlZFByb2Nlc3Nlcyhyb290RWxlbWVudHMpIHsKCiAgICAvLyB3YWxrIHRocm91Z2ggYWxsIHByb2Nlc3NlcyB0aGF0IGhhdmUgbm90IHlldCBiZWVuIGRyYXduIGFuZCBkcmF3IHRoZW0KICAgIC8vIGlmIHRoZXkgY29udGFpbiBsYW5lcyB3aXRoIERJIGluZm9ybWF0aW9uLgogICAgLy8gd2UgZG8gdGhpcyB0byBwYXNzIHRoZSBmcmVlLWZsb2F0aW5nIGxhbmUgdGVzdCBjYXNlcyBpbiB0aGUgTUlXRyB0ZXN0IHN1aXRlCiAgICB2YXIgcHJvY2Vzc2VzID0gXy5maWx0ZXIocm9vdEVsZW1lbnRzLCBmdW5jdGlvbihlKSB7CiAgICAgIHJldHVybiBpcyhlLCAnYnBtbjpQcm9jZXNzJykgJiYgZS5sYW5lU2V0cyAmJiBoYW5kbGVkUHJvY2Vzc2VzLmluZGV4T2YoZSkgPT09IC0xOwogICAgfSk7CgogICAgcHJvY2Vzc2VzLmZvckVhY2goY29udGV4dHVhbChoYW5kbGVQcm9jZXNzKSk7CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVNZXNzYWdlRmxvdyhtZXNzYWdlRmxvdywgY29udGV4dCkgewogICAgdmlzaXRJZkRpKG1lc3NhZ2VGbG93LCBjb250ZXh0KTsKICB9CgogIGZ1bmN0aW9uIGhhbmRsZU1lc3NhZ2VGbG93cyhtZXNzYWdlRmxvd3MsIGNvbnRleHQpIHsKICAgIGlmIChtZXNzYWdlRmxvd3MpIHsKICAgICAgXy5mb3JFYWNoKG1lc3NhZ2VGbG93cywgY29udGV4dHVhbChoYW5kbGVNZXNzYWdlRmxvdywgY29udGV4dCkpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaGFuZGxlRGF0YUFzc29jaWF0aW9uKGFzc29jaWF0aW9uLCBjb250ZXh0KSB7CiAgICB2aXNpdElmRGkoYXNzb2NpYXRpb24sIGNvbnRleHQpOwogIH0KCiAgZnVuY3Rpb24gaGFuZGxlRGF0YUlucHV0KGRhdGFJbnB1dCwgY29udGV4dCkgewogICAgdmlzaXRJZkRpKGRhdGFJbnB1dCwgY29udGV4dCk7CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVEYXRhT3V0cHV0KGRhdGFPdXRwdXQsIGNvbnRleHQpIHsKICAgIHZpc2l0SWZEaShkYXRhT3V0cHV0LCBjb250ZXh0KTsKICB9CgogIGZ1bmN0aW9uIGhhbmRsZUFydGlmYWN0KGFydGlmYWN0LCBjb250ZXh0KSB7CgogICAgLy8gYnBtbjpUZXh0QW5ub3RhdGlvbgogICAgLy8gYnBtbjpHcm91cAogICAgLy8gYnBtbjpBc3NvY2lhdGlvbgoKICAgIHZpc2l0SWZEaShhcnRpZmFjdCwgY29udGV4dCk7CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVBcnRpZmFjdHMoYXJ0aWZhY3RzLCBjb250ZXh0KSB7CiAgICBfLmZvckVhY2goYXJ0aWZhY3RzLCBjb250ZXh0dWFsKGhhbmRsZUFydGlmYWN0LCBjb250ZXh0KSk7CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVJb1NwZWNpZmljYXRpb24oaW9TcGVjaWZpY2F0aW9uLCBjb250ZXh0KSB7CgogICAgaWYgKCFpb1NwZWNpZmljYXRpb24pIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIF8uZm9yRWFjaChpb1NwZWNpZmljYXRpb24uZGF0YUlucHV0cywgY29udGV4dHVhbChoYW5kbGVEYXRhSW5wdXQsIGNvbnRleHQpKTsKICAgIF8uZm9yRWFjaChpb1NwZWNpZmljYXRpb24uZGF0YU91dHB1dHMsIGNvbnRleHR1YWwoaGFuZGxlRGF0YU91dHB1dCwgY29udGV4dCkpOwogIH0KCiAgZnVuY3Rpb24gaGFuZGxlU3ViUHJvY2VzcyhzdWJQcm9jZXNzLCBjb250ZXh0KSB7CiAgICBoYW5kbGVGbG93RWxlbWVudHNDb250YWluZXIoc3ViUHJvY2VzcywgY29udGV4dCk7CiAgICBoYW5kbGVBcnRpZmFjdHMoc3ViUHJvY2Vzcy5hcnRpZmFjdHMsIGNvbnRleHQpOwogIH0KCiAgZnVuY3Rpb24gaGFuZGxlRmxvd05vZGUoZmxvd05vZGUsIGNvbnRleHQpIHsKICAgIHZhciBjaGlsZEN0eCA9IHZpc2l0SWZEaShmbG93Tm9kZSwgY29udGV4dCk7CgogICAgaWYgKGlzKGZsb3dOb2RlLCAnYnBtbjpTdWJQcm9jZXNzJykpIHsKICAgICAgaGFuZGxlU3ViUHJvY2VzcyhmbG93Tm9kZSwgY2hpbGRDdHggfHwgY29udGV4dCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVTZXF1ZW5jZUZsb3coc2VxdWVuY2VGbG93LCBjb250ZXh0KSB7CiAgICB2aXNpdElmRGkoc2VxdWVuY2VGbG93LCBjb250ZXh0KTsKICB9CgogIGZ1bmN0aW9uIGhhbmRsZURhdGFFbGVtZW50KGRhdGFPYmplY3QsIGNvbnRleHQpIHsKICAgIHZpc2l0SWZEaShkYXRhT2JqZWN0LCBjb250ZXh0KTsKICB9CgogIGZ1bmN0aW9uIGhhbmRsZUJvdW5kYXJ5RXZlbnQoZGF0YU9iamVjdCwgY29udGV4dCkgewogICAgdmlzaXRJZkRpKGRhdGFPYmplY3QsIGNvbnRleHQpOwogIH0KCiAgZnVuY3Rpb24gaGFuZGxlTGFuZShsYW5lLCBjb250ZXh0KSB7CiAgICB2YXIgbmV3Q29udGV4dCA9IHZpc2l0SWZEaShsYW5lLCBjb250ZXh0KTsKCiAgICBpZiAobGFuZS5jaGlsZExhbmVTZXQpIHsKICAgICAgaGFuZGxlTGFuZVNldChsYW5lLmNoaWxkTGFuZVNldCwgbmV3Q29udGV4dCB8fCBjb250ZXh0KTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBmaWx0ZXJMaXN0ID0gXy5maWx0ZXIobGFuZS5mbG93Tm9kZVJlZiwgZnVuY3Rpb24oZSkgewogICAgICAgIHJldHVybiBlLiR0eXBlICE9PSAnYnBtbjpCb3VuZGFyeUV2ZW50JzsKICAgICAgfSk7CiAgICAgIGhhbmRsZUZsb3dFbGVtZW50cyhmaWx0ZXJMaXN0LCBuZXdDb250ZXh0IHx8IGNvbnRleHQpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaGFuZGxlTGFuZVNldChsYW5lU2V0LCBjb250ZXh0KSB7CiAgICBfLmZvckVhY2gobGFuZVNldC5sYW5lcywgY29udGV4dHVhbChoYW5kbGVMYW5lLCBjb250ZXh0KSk7CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVMYW5lU2V0cyhsYW5lU2V0cywgY29udGV4dCkgewogICAgXy5mb3JFYWNoKGxhbmVTZXRzLCBjb250ZXh0dWFsKGhhbmRsZUxhbmVTZXQsIGNvbnRleHQpKTsKICB9CgogIGZ1bmN0aW9uIGhhbmRsZUZsb3dFbGVtZW50c0NvbnRhaW5lcihjb250YWluZXIsIGNvbnRleHQpIHsKCiAgICBpZiAoY29udGFpbmVyLmxhbmVTZXRzKSB7CiAgICAgIGhhbmRsZUxhbmVTZXRzKGNvbnRhaW5lci5sYW5lU2V0cywgY29udGV4dCk7CiAgICAgIGhhbmRsZU5vbkZsb3dOb2Rlcyhjb250YWluZXIuZmxvd0VsZW1lbnRzKTsKICAgIH0gZWxzZSB7CiAgICAgIGhhbmRsZUZsb3dFbGVtZW50cyhjb250YWluZXIuZmxvd0VsZW1lbnRzLCBjb250ZXh0KTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGhhbmRsZU5vbkZsb3dOb2RlcyhmbG93RWxlbWVudHMsIGNvbnRleHQpIHsKICAgIF8uZm9yRWFjaChmbG93RWxlbWVudHMsIGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKGlzKGUsICdicG1uOlNlcXVlbmNlRmxvdycpKSB7CiAgICAgICAgZGVmZXJyZWQucHVzaChmdW5jdGlvbigpIHsKICAgICAgICAgIGhhbmRsZVNlcXVlbmNlRmxvdyhlLCBjb250ZXh0KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChpcyhlLCAnYnBtbjpCb3VuZGFyeUV2ZW50JykpIHsKICAgICAgICBkZWZlcnJlZC51bnNoaWZ0KGZ1bmN0aW9uKCkgewogICAgICAgICAgaGFuZGxlQm91bmRhcnlFdmVudChlLCBjb250ZXh0KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChpcyhlLCAnYnBtbjpEYXRhT2JqZWN0JykpIHsKICAgICAgICAvLyBTS0lQIChhc3N1bWUgY29ycmVjdCByZWZlcmVuY2luZyB2aWEgRGF0YU9iamVjdFJlZmVyZW5jZSkKICAgICAgfSBlbHNlIGlmIChpcyhlLCAnYnBtbjpEYXRhU3RvcmVSZWZlcmVuY2UnKSkgewogICAgICAgIGhhbmRsZURhdGFFbGVtZW50KGUsIGNvbnRleHQpOwogICAgICB9IGVsc2UgaWYgKGlzKGUsICdicG1uOkRhdGFPYmplY3RSZWZlcmVuY2UnKSkgewogICAgICAgIGhhbmRsZURhdGFFbGVtZW50KGUsIGNvbnRleHQpOwogICAgICB9CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGhhbmRsZUZsb3dFbGVtZW50cyhmbG93RWxlbWVudHMsIGNvbnRleHQpIHsKICAgIF8uZm9yRWFjaChmbG93RWxlbWVudHMsIGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKGlzKGUsICdicG1uOlNlcXVlbmNlRmxvdycpKSB7CiAgICAgICAgZGVmZXJyZWQucHVzaChmdW5jdGlvbigpIHsKICAgICAgICAgIGhhbmRsZVNlcXVlbmNlRmxvdyhlLCBjb250ZXh0KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChpcyhlLCAnYnBtbjpCb3VuZGFyeUV2ZW50JykpIHsKICAgICAgICBkZWZlcnJlZC51bnNoaWZ0KGZ1bmN0aW9uKCkgewogICAgICAgICAgaGFuZGxlQm91bmRhcnlFdmVudChlLCBjb250ZXh0KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChpcyhlLCAnYnBtbjpGbG93Tm9kZScpKSB7CiAgICAgICAgaGFuZGxlRmxvd05vZGUoZSwgY29udGV4dCk7CgogICAgICAgIGlmIChpcyhlLCAnYnBtbjpBY3Rpdml0eScpKSB7CgogICAgICAgICAgaGFuZGxlSW9TcGVjaWZpY2F0aW9uKGUuaW9TcGVjaWZpY2F0aW9uLCBjb250ZXh0KTsKCiAgICAgICAgICAvLyBkZWZlciBoYW5kbGluZyBvZiBhc3NvY2lhdGlvbnMKICAgICAgICAgIGRlZmVycmVkLnB1c2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIF8uZm9yRWFjaChlLmRhdGFJbnB1dEFzc29jaWF0aW9ucywgY29udGV4dHVhbChoYW5kbGVEYXRhQXNzb2NpYXRpb24sIGNvbnRleHQpKTsKICAgICAgICAgICAgXy5mb3JFYWNoKGUuZGF0YU91dHB1dEFzc29jaWF0aW9ucywgY29udGV4dHVhbChoYW5kbGVEYXRhQXNzb2NpYXRpb24sIGNvbnRleHQpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChpcyhlLCAnYnBtbjpEYXRhT2JqZWN0JykpIHsKICAgICAgICAvLyBTS0lQIChhc3N1bWUgY29ycmVjdCByZWZlcmVuY2luZyB2aWEgRGF0YU9iamVjdFJlZmVyZW5jZSkKICAgICAgfSBlbHNlIGlmIChpcyhlLCAnYnBtbjpEYXRhU3RvcmVSZWZlcmVuY2UnKSkgewogICAgICAgIGhhbmRsZURhdGFFbGVtZW50KGUsIGNvbnRleHQpOwogICAgICB9IGVsc2UgaWYgKGlzKGUsICdicG1uOkRhdGFPYmplY3RSZWZlcmVuY2UnKSkgewogICAgICAgIGhhbmRsZURhdGFFbGVtZW50KGUsIGNvbnRleHQpOwogICAgICB9IGVsc2UgewogICAgICAgIGxvZ0Vycm9yKAogICAgICAgICAgJ3VucmVjb2duaXplZCBmbG93RWxlbWVudCA8JyArIGUuJHR5cGUgKyAnPiBpbiBjb250ZXh0ICcgKyAoY29udGV4dCA/IGNvbnRleHQuaWQgOiBudWxsKSwKICAgICAgICAgIHsgZWxlbWVudDogZSwgY29udGV4dDogY29udGV4dCB9KTsKICAgICAgfQogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVQYXJ0aWNpcGFudChwYXJ0aWNpcGFudCwgY29udGV4dCkgewogICAgdmFyIG5ld0N0eCA9IHZpc2l0SWZEaShwYXJ0aWNpcGFudCwgY29udGV4dCk7CgogICAgdmFyIHByb2Nlc3MgPSBwYXJ0aWNpcGFudC5wcm9jZXNzUmVmOwogICAgaWYgKHByb2Nlc3MpIHsKICAgICAgaGFuZGxlUHJvY2Vzcyhwcm9jZXNzLCBuZXdDdHggfHwgY29udGV4dCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVDb2xsYWJvcmF0aW9uKGNvbGxhYm9yYXRpb24pIHsKCiAgICBfLmZvckVhY2goY29sbGFib3JhdGlvbi5wYXJ0aWNpcGFudHMsIGNvbnRleHR1YWwoaGFuZGxlUGFydGljaXBhbnQpKTsKCiAgICBoYW5kbGVBcnRpZmFjdHMoY29sbGFib3JhdGlvbi5hcnRpZmFjdHMpOwoKICAgIGhhbmRsZU1lc3NhZ2VGbG93cyhjb2xsYWJvcmF0aW9uLm1lc3NhZ2VGbG93cyk7CiAgfQoKCiAgLy8vLy8gQVBJIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogIHJldHVybiB7CiAgICBoYW5kbGVEZWZpbml0aW9uczogaGFuZGxlRGVmaW5pdGlvbnMKICB9Owp9Cgptb2R1bGUuZXhwb3J0cyA9IEJwbW5UcmVlV2Fsa2VyOwp9LHsib2JqZWN0LXJlZnMiOjc1fV0sODpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBCcG1uVHJlZVdhbGtlciA9IF9kZXJlcV8oJy4vQnBtblRyZWVXYWxrZXInKTsKCgovKioKICogSW1wb3J0IHRoZSBkZWZpbml0aW9ucyBpbnRvIGEgZGlhZ3JhbS4KICoKICogRXJyb3JzIGFuZCB3YXJuaW5ncyBhcmUgcmVwb3J0ZWQgdGhyb3VnaCB0aGUgc3BlY2lmaWVkIGNhbGxiYWNrLgogKgogKiBAcGFyYW0gIHtEaWFncmFtfSBkaWFncmFtCiAqIEBwYXJhbSAge01vZGRsZUVsZW1lbnR9IGRlZmluaXRpb25zCiAqIEBwYXJhbSAge0Z1bmN0aW9ufSBkb25lIHRoZSBjYWxsYmFjaywgaW52b2tlZCB3aXRoIChlcnIsIFsgd2FybmluZyBdKSBvbmNlIHRoZSBpbXBvcnQgaXMgZG9uZQogKi8KZnVuY3Rpb24gaW1wb3J0QnBtbkRpYWdyYW0oZGlhZ3JhbSwgZGVmaW5pdGlvbnMsIGRvbmUpIHsKCiAgdmFyIGltcG9ydGVyID0gZGlhZ3JhbS5nZXQoJ2JwbW5JbXBvcnRlcicpLAogICAgICBldmVudEJ1cyA9IGRpYWdyYW0uZ2V0KCdldmVudEJ1cycpOwoKICB2YXIgd2FybmluZ3MgPSBbXTsKCiAgdmFyIHZpc2l0b3IgPSB7CgogICAgcm9vdDogZnVuY3Rpb24oZWxlbWVudCkgewogICAgICByZXR1cm4gaW1wb3J0ZXIuYWRkKGVsZW1lbnQpOwogICAgfSwKCiAgICBlbGVtZW50OiBmdW5jdGlvbihlbGVtZW50LCBwYXJlbnRTaGFwZSkgewogICAgICByZXR1cm4gaW1wb3J0ZXIuYWRkKGVsZW1lbnQsIHBhcmVudFNoYXBlKTsKICAgIH0sCgogICAgZXJyb3I6IGZ1bmN0aW9uKG1lc3NhZ2UsIGNvbnRleHQpIHsKICAgICAgd2FybmluZ3MucHVzaCh7IG1lc3NhZ2U6IG1lc3NhZ2UsIGNvbnRleHQ6IGNvbnRleHQgfSk7CiAgICB9CiAgfTsKCiAgdmFyIHdhbGtlciA9IG5ldyBCcG1uVHJlZVdhbGtlcih2aXNpdG9yKTsKCiAgdHJ5IHsKICAgIGV2ZW50QnVzLmZpcmUoJ2ltcG9ydC5zdGFydCcpOwoKICAgIC8vIGltcG9ydAogICAgd2Fsa2VyLmhhbmRsZURlZmluaXRpb25zKGRlZmluaXRpb25zKTsKCiAgICBldmVudEJ1cy5maXJlKCdpbXBvcnQuc3VjY2VzcycsIHdhcm5pbmdzKTsKCiAgICBkb25lKG51bGwsIHdhcm5pbmdzKTsKICB9IGNhdGNoIChlKSB7CiAgICBldmVudEJ1cy5maXJlKCdpbXBvcnQuZXJyb3InLCBlKTsKICAgIGRvbmUoZSk7CiAgfQp9Cgptb2R1bGUuZXhwb3J0cy5pbXBvcnRCcG1uRGlhZ3JhbSA9IGltcG9ydEJwbW5EaWFncmFtOwp9LHsiLi9CcG1uVHJlZVdhbGtlciI6N31dLDk6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgptb2R1bGUuZXhwb3J0cy5pc0V4cGFuZGVkUG9vbCA9IGZ1bmN0aW9uKHNlbWFudGljKSB7CiAgcmV0dXJuICEhc2VtYW50aWMucHJvY2Vzc1JlZjsKfTsKCm1vZHVsZS5leHBvcnRzLmlzRXhwYW5kZWQgPSBmdW5jdGlvbihzZW1hbnRpYykgewogIHJldHVybiAhc2VtYW50aWMuJGluc3RhbmNlT2YoJ2JwbW46U3ViUHJvY2VzcycpIHx8IHNlbWFudGljLmRpLmlzRXhwYW5kZWQ7Cn07Cn0se31dLDEwOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF8gPSAod2luZG93Ll8pOwoKCnZhciBERUZBVUxUX0xBQkVMX1NJWkUgPSBtb2R1bGUuZXhwb3J0cy5ERUZBVUxUX0xBQkVMX1NJWkUgPSB7CiAgd2lkdGg6IDkwLAogIGhlaWdodDogNTAKfTsKCgovKioKICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBzZW1hbnRpYyBoYXMgYW4gZXh0ZXJuYWwgbGFiZWwKICoKICogQHBhcmFtIHtCcG1uRWxlbWVudH0gc2VtYW50aWMKICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZSBpZiBoYXMgbGFiZWwKICovCm1vZHVsZS5leHBvcnRzLmhhc0V4dGVybmFsTGFiZWwgPSBmdW5jdGlvbihzZW1hbnRpYykgewoKICByZXR1cm4gc2VtYW50aWMuJGluc3RhbmNlT2YoJ2JwbW46RXZlbnQnKSB8fAogICAgICAgICBzZW1hbnRpYy4kaW5zdGFuY2VPZignYnBtbjpHYXRld2F5JykgfHwKICAgICAgICAgc2VtYW50aWMuJGluc3RhbmNlT2YoJ2JwbW46RGF0YVN0b3JlUmVmZXJlbmNlJykgfHwKICAgICAgICAgc2VtYW50aWMuJGluc3RhbmNlT2YoJ2JwbW46RGF0YU9iamVjdFJlZmVyZW5jZScpIHx8CiAgICAgICAgIHNlbWFudGljLiRpbnN0YW5jZU9mKCdicG1uOlNlcXVlbmNlRmxvdycpIHx8CiAgICAgICAgIHNlbWFudGljLiRpbnN0YW5jZU9mKCdicG1uOk1lc3NhZ2VGbG93Jyk7Cn07CgoKLyoqCiAqIEdldCB0aGUgbWlkZGxlIG9mIGEgbnVtYmVyIG9mIHdheXBvaW50cwogKgogKiBAcGFyYW0gIHtBcnJheTxQb2ludD59IHdheXBvaW50cwogKiBAcmV0dXJuIHtQb2ludH0gdGhlIG1pZCBwb2ludAogKi8KdmFyIGdldFdheXBvaW50c01pZCA9IG1vZHVsZS5leHBvcnRzLmdldFdheXBvaW50c01pZCA9IGZ1bmN0aW9uKHdheXBvaW50cykgewoKICB2YXIgbWlkID0gd2F5cG9pbnRzLmxlbmd0aCAvIDIgLSAxOwoKICB2YXIgZmlyc3QgPSB3YXlwb2ludHNbTWF0aC5mbG9vcihtaWQpXTsKICB2YXIgc2Vjb25kID0gd2F5cG9pbnRzW01hdGguY2VpbChtaWQgKyAwLjAxKV07CgogIHJldHVybiB7CiAgICB4OiBmaXJzdC54ICsgKHNlY29uZC54IC0gZmlyc3QueCkgLyAyLAogICAgeTogZmlyc3QueSArIChzZWNvbmQueSAtIGZpcnN0LnkpIC8gMgogIH07Cn07CgoKdmFyIGdldEV4dGVybmFsTGFiZWxNaWQgPSBtb2R1bGUuZXhwb3J0cy5nZXRFeHRlcm5hbExhYmVsTWlkID0gZnVuY3Rpb24oZWxlbWVudCkgewoKICBpZiAoZWxlbWVudC53YXlwb2ludHMpIHsKICAgIHJldHVybiBnZXRXYXlwb2ludHNNaWQoZWxlbWVudC53YXlwb2ludHMpOwogIH0gZWxzZSB7CiAgICByZXR1cm4gewogICAgICB4OiBlbGVtZW50LnggKyBlbGVtZW50LndpZHRoIC8gMiwKICAgICAgeTogZWxlbWVudC55ICsgZWxlbWVudC5oZWlnaHQgKyBERUZBVUxUX0xBQkVMX1NJWkUuaGVpZ2h0IC8gMiAtIDUKICAgIH07CiAgfQp9OwoKLyoqCiAqIFJldHVybnMgdGhlIGJvdW5kcyBvZiBhbiBlbGVtZW50cyBsYWJlbCwgcGFyc2VkIGZyb20gdGhlIGVsZW1lbnRzIERJIG9yCiAqIGdlbmVyYXRlZCBmcm9tIGl0cyBib3VuZHMuCiAqCiAqIEBwYXJhbSB7QnBtbkVsZW1lbnR9IHNlbWFudGljCiAqIEBwYXJhbSB7ZGpzLm1vZGVsLkJhc2V9IGVsZW1lbnQKICovCm1vZHVsZS5leHBvcnRzLmdldEV4dGVybmFsTGFiZWxCb3VuZHMgPSBmdW5jdGlvbihzZW1hbnRpYywgZWxlbWVudCkgewoKICB2YXIgbWlkLAogICAgICBzaXplLAogICAgICBib3VuZHMsCiAgICAgIGRpID0gc2VtYW50aWMuZGksCiAgICAgIGxhYmVsID0gZGkubGFiZWw7CgogIGlmIChsYWJlbCAmJiBsYWJlbC5ib3VuZHMpIHsKICAgIGJvdW5kcyA9IGxhYmVsLmJvdW5kczsKCiAgICBzaXplID0gewogICAgICB3aWR0aDogTWF0aC5tYXgoMTUwLCBib3VuZHMud2lkdGgpLAogICAgICBoZWlnaHQ6IGJvdW5kcy5oZWlnaHQKICAgIH07CgogICAgbWlkID0gewogICAgICB4OiBib3VuZHMueCArIGJvdW5kcy53aWR0aCAvIDIsCiAgICAgIHk6IGJvdW5kcy55CiAgICB9OwogIH0gZWxzZSB7CgogICAgbWlkID0gZ2V0RXh0ZXJuYWxMYWJlbE1pZChlbGVtZW50KTsKCiAgICBzaXplID0gREVGQVVMVF9MQUJFTF9TSVpFOwogIH0KCiAgcmV0dXJuIF8uZXh0ZW5kKHsKICAgIHg6IG1pZC54IC0gc2l6ZS53aWR0aCAvIDIsCiAgICB5OiBtaWQueQogIH0sIHNpemUpOwp9Owp9LHt9XSwxMTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gX2RlcmVxXygnLi9saWIvc2ltcGxlJyk7Cn0seyIuL2xpYi9zaW1wbGUiOjEzfV0sMTI6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgXyA9ICh3aW5kb3cuXyk7Cgp2YXIgTW9kZGxlID0gX2RlcmVxXygnbW9kZGxlJyksCiAgICBNb2RkbGVYbWwgPSBfZGVyZXFfKCdtb2RkbGUteG1sJyk7CgoKZnVuY3Rpb24gY3JlYXRlTW9kZWwocGFja2FnZXMpIHsKICByZXR1cm4gbmV3IE1vZGRsZShwYWNrYWdlcyk7Cn0KCi8qKgogKiBBIHN1YiBjbGFzcyBvZiB7QGxpbmsgTW9kZGxlfSB3aXRoIHN1cHBvcnQgZm9yIGltcG9ydCBhbmQgZXhwb3J0IG9mIEJQTU4gMi4wIHhtbCBmaWxlcy4KICoKICogQGNsYXNzIEJwbW5Nb2RkbGUKICogQGV4dGVuZHMgTW9kZGxlCiAqCiAqIEBwYXJhbSB7T2JqZWN0fEFycmF5fSBwYWNrYWdlcyB0byB1c2UgZm9yIGluc3RhbnRpYXRpbmcgdGhlIG1vZGVsCiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gYWRkaXRpb25hbCBvcHRpb25zIHRvIHBhc3Mgb3ZlcgogKi8KZnVuY3Rpb24gQnBtbk1vZGRsZShwYWNrYWdlcywgb3B0aW9ucykgewogIE1vZGRsZS5jYWxsKHRoaXMsIHBhY2thZ2VzLCBvcHRpb25zKTsKfQoKQnBtbk1vZGRsZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKE1vZGRsZS5wcm90b3R5cGUpOwoKbW9kdWxlLmV4cG9ydHMgPSBCcG1uTW9kZGxlOwoKCi8qKgogKiBJbnN0YW50aWF0ZXMgYSBCUE1OIG1vZGVsIHRyZWUgZnJvbSBhIGdpdmVuIHhtbCBzdHJpbmcuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSAgIHhtbFN0cgogKiBAcGFyYW0ge1N0cmluZ30gICBbdHlwZU5hbWVdICAgbmFtZSBvZiB0aGUgcm9vdCBlbGVtZW50LCBkZWZhdWx0cyB0byAnYnBtbjpEZWZpbml0aW9ucycKICogQHBhcmFtIHtPYmplY3R9ICAgW29wdGlvbnNdICAgIG9wdGlvbnMgdG8gcGFzcyB0byB0aGUgdW5kZXJseWluZyByZWFkZXIKICogQHBhcmFtIHtGdW5jdGlvbn0gZG9uZSAgICAgICAgIGNhbGxiYWNrIHRoYXQgaXMgaW52b2tlZCB3aXRoIChlcnIsIHJlc3VsdCwgcGFyc2VDb250ZXh0KSBvbmNlIHRoZSBpbXBvcnQgY29tcGxldGVzCiAqLwpCcG1uTW9kZGxlLnByb3RvdHlwZS5mcm9tWE1MID0gZnVuY3Rpb24oeG1sU3RyLCB0eXBlTmFtZSwgb3B0aW9ucywgZG9uZSkgewoKICBpZiAoIV8uaXNTdHJpbmcodHlwZU5hbWUpKSB7CiAgICBkb25lID0gb3B0aW9uczsKICAgIG9wdGlvbnMgPSB0eXBlTmFtZTsKICAgIHR5cGVOYW1lID0gJ2JwbW46RGVmaW5pdGlvbnMnOwogIH0KCiAgaWYgKF8uaXNGdW5jdGlvbihvcHRpb25zKSkgewogICAgZG9uZSA9IG9wdGlvbnM7CiAgICBvcHRpb25zID0ge307CiAgfQoKICB2YXIgcmVhZGVyID0gbmV3IE1vZGRsZVhtbC5SZWFkZXIodGhpcywgb3B0aW9ucyk7CiAgdmFyIHJvb3RIYW5kbGVyID0gcmVhZGVyLmhhbmRsZXIodHlwZU5hbWUpOwoKICByZWFkZXIuZnJvbVhNTCh4bWxTdHIsIHJvb3RIYW5kbGVyLCBmdW5jdGlvbihlcnIsIHJlc3VsdCkgewogICAgZG9uZShlcnIsIHJlc3VsdCwgcm9vdEhhbmRsZXIuY29udGV4dCk7CiAgfSk7Cn07CgoKLyoqCiAqIFNlcmlhbGl6ZXMgYSBCUE1OIDIuMCBvYmplY3QgdHJlZSB0byBYTUwuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSAgIGVsZW1lbnQgICAgdGhlIHJvb3QgZWxlbWVudCwgdHlwaWNhbGx5IGFuIGluc3RhbmNlIG9mIGBicG1uOkRlZmluaXRpb25zYAogKiBAcGFyYW0ge09iamVjdH0gICBbb3B0aW9uc10gIHRvIHBhc3MgdG8gdGhlIHVuZGVybHlpbmcgd3JpdGVyCiAqIEBwYXJhbSB7RnVuY3Rpb259IGRvbmUgICAgICAgY2FsbGJhY2sgaW52b2tlZCB3aXRoIChlcnIsIHhtbFN0cikgb25jZSB0aGUgaW1wb3J0IGNvbXBsZXRlcwogKi8KQnBtbk1vZGRsZS5wcm90b3R5cGUudG9YTUwgPSBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zLCBkb25lKSB7CgogIGlmIChfLmlzRnVuY3Rpb24ob3B0aW9ucykpIHsKICAgIGRvbmUgPSBvcHRpb25zOwogICAgb3B0aW9ucyA9IHt9OwogIH0KCiAgdmFyIHdyaXRlciA9IG5ldyBNb2RkbGVYbWwuV3JpdGVyKG9wdGlvbnMpOwogIHRyeSB7CiAgICB2YXIgcmVzdWx0ID0gd3JpdGVyLnRvWE1MKGVsZW1lbnQpOwogICAgZG9uZShudWxsLCByZXN1bHQpOwogIH0gY2F0Y2ggKGUpIHsKICAgIGRvbmUoZSk7CiAgfQp9OwoKfSx7Im1vZGRsZSI6MjgsIm1vZGRsZS14bWwiOjE0fV0sMTM6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgQnBtbk1vZGRsZSA9IF9kZXJlcV8oJy4vYnBtbi1tb2RkbGUnKTsKCnZhciBwYWNrYWdlcyA9IHsKICBicG1uOiBfZGVyZXFfKCcuLi9yZXNvdXJjZXMvYnBtbi9qc29uL2JwbW4uanNvbicpLAogIGJwbW5kaTogX2RlcmVxXygnLi4vcmVzb3VyY2VzL2JwbW4vanNvbi9icG1uZGkuanNvbicpLAogIGRjOiBfZGVyZXFfKCcuLi9yZXNvdXJjZXMvYnBtbi9qc29uL2RjLmpzb24nKSwKICBkaTogX2RlcmVxXygnLi4vcmVzb3VyY2VzL2JwbW4vanNvbi9kaS5qc29uJykKfTsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIG5ldyBCcG1uTW9kZGxlKHBhY2thZ2VzKTsKfTsKfSx7Ii4uL3Jlc291cmNlcy9icG1uL2pzb24vYnBtbi5qc29uIjozNywiLi4vcmVzb3VyY2VzL2JwbW4vanNvbi9icG1uZGkuanNvbiI6MzgsIi4uL3Jlc291cmNlcy9icG1uL2pzb24vZGMuanNvbiI6MzksIi4uL3Jlc291cmNlcy9icG1uL2pzb24vZGkuanNvbiI6NDAsIi4vYnBtbi1tb2RkbGUiOjEyfV0sMTQ6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgptb2R1bGUuZXhwb3J0cy5SZWFkZXIgPSBfZGVyZXFfKCcuL2xpYi9SZWFkZXInKTsKbW9kdWxlLmV4cG9ydHMuV3JpdGVyID0gX2RlcmVxXygnLi9saWIvV3JpdGVyJyk7Cn0seyIuL2xpYi9SZWFkZXIiOjE1LCIuL2xpYi9Xcml0ZXIiOjE2fV0sMTU6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgc2F4ID0gKHdpbmRvdy5zYXgpLAogICAgXyA9ICh3aW5kb3cuXyk7Cgp2YXIgY29tbW9uID0gX2RlcmVxXygnLi9jb21tb24nKSwKICAgIFR5cGVzID0gX2RlcmVxXygnbW9kZGxlJykudHlwZXMsCiAgICBTdGFjayA9IF9kZXJlcV8oJ3Rpbnktc3RhY2snKSwKICAgIHBhcnNlTmFtZU5zID0gX2RlcmVxXygnbW9kZGxlJykubnMucGFyc2VOYW1lLAogICAgYWxpYXNUb05hbWUgPSBjb21tb24uYWxpYXNUb05hbWU7CgoKZnVuY3Rpb24gcGFyc2VOb2RlQXR0cmlidXRlcyhub2RlKSB7CiAgdmFyIG5vZGVBdHRycyA9IG5vZGUuYXR0cmlidXRlczsKCiAgcmV0dXJuIF8ucmVkdWNlKG5vZGVBdHRycywgZnVuY3Rpb24ocmVzdWx0LCB2LCBrKSB7CiAgICB2YXIgbmFtZSwgbnM7CgogICAgaWYgKCF2LmxvY2FsKSB7CiAgICAgIG5hbWUgPSB2LnByZWZpeDsKICAgIH0gZWxzZSB7CiAgICAgIG5zID0gcGFyc2VOYW1lTnModi5uYW1lLCB2LnByZWZpeCk7CiAgICAgIG5hbWUgPSBucy5uYW1lOwogICAgfQoKICAgIHJlc3VsdFtuYW1lXSA9IHYudmFsdWU7CiAgICByZXR1cm4gcmVzdWx0OwogIH0sIHt9KTsKfQoKLyoqCiAqIE5vcm1hbGl6ZXMgbmFtZXNwYWNlcyBmb3IgYSBub2RlIGdpdmVuIGFuIG9wdGlvbmFsIGRlZmF1bHQgbmFtZXNwYWNlIGFuZCBhCiAqIG51bWJlciBvZiBtYXBwaW5ncyBmcm9tIHVyaXMgdG8gZGVmYXVsdCBwcmVmaXhlcy4KICoKICogQHBhcmFtICB7WG1sTm9kZX0gbm9kZQogKiBAcGFyYW0gIHtNb2RlbH0gbW9kZWwgdGhlIG1vZGVsIGNvbnRhaW5pbmcgYWxsIHJlZ2lzdGVyZWQgbmFtZXNwYWNlcwogKiBAcGFyYW0gIHtVcml9IGRlZmF1bHROc1VyaQogKi8KZnVuY3Rpb24gbm9ybWFsaXplTmFtZXNwYWNlcyhub2RlLCBtb2RlbCwgZGVmYXVsdE5zVXJpKSB7CiAgdmFyIHVyaSwgY2hpbGRVcmksIHByZWZpeDsKCiAgdXJpID0gbm9kZS51cmkgfHwgZGVmYXVsdE5zVXJpOwoKICBpZiAodXJpKSB7CiAgICB2YXIgcGtnID0gbW9kZWwuZ2V0UGFja2FnZSh1cmkpOwoKICAgIGlmIChwa2cpIHsKICAgICAgcHJlZml4ID0gcGtnLnByZWZpeDsKICAgIH0gZWxzZSB7CiAgICAgIHByZWZpeCA9IG5vZGUucHJlZml4OwogICAgfQoKICAgIG5vZGUucHJlZml4ID0gcHJlZml4OwogICAgbm9kZS51cmkgPSB1cmk7CiAgfQoKICBfLmZvckVhY2gobm9kZS5hdHRyaWJ1dGVzLCBmdW5jdGlvbihhdHRyKSB7CiAgICBub3JtYWxpemVOYW1lc3BhY2VzKGF0dHIsIG1vZGVsLCBudWxsKTsKICB9KTsKfQoKLyoqCiAqIEEgcGFyc2UgY29udGV4dC4KICoKICogQGNsYXNzCiAqCiAqIEBwYXJhbSB7RWxlbWVudEhhbmRsZXJ9IHBhcnNlUm9vdCB0aGUgcm9vdCBoYW5kbGVyIGZvciBwYXJzaW5nIGEgZG9jdW1lbnQKICovCmZ1bmN0aW9uIENvbnRleHQocGFyc2VSb290KSB7CgogIHZhciBlbGVtZW50c0J5SWQgPSB7fTsKICB2YXIgcmVmZXJlbmNlcyA9IFtdOwoKICB2YXIgd2FybmluZ3MgPSBbXTsKCiAgdGhpcy5hZGRSZWZlcmVuY2UgPSBmdW5jdGlvbihyZWZlcmVuY2UpIHsKICAgIHJlZmVyZW5jZXMucHVzaChyZWZlcmVuY2UpOwogIH07CgogIHRoaXMuYWRkRWxlbWVudCA9IGZ1bmN0aW9uKGlkLCBlbGVtZW50KSB7CgogICAgaWYgKCFpZCB8fCAhZWxlbWVudCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1t4bWwtcmVhZGVyXSBpZCBvciBjdHggbXVzdCBub3QgYmUgbnVsbCcpOwogICAgfQoKICAgIGVsZW1lbnRzQnlJZFtpZF0gPSBlbGVtZW50OwogIH07CgogIHRoaXMuYWRkV2FybmluZyA9IGZ1bmN0aW9uICh3KSB7CiAgICB3YXJuaW5ncy5wdXNoKHcpOwogIH07CgogIHRoaXMud2FybmluZ3MgPSB3YXJuaW5nczsKICB0aGlzLnJlZmVyZW5jZXMgPSByZWZlcmVuY2VzOwoKICB0aGlzLmVsZW1lbnRzQnlJZCA9IGVsZW1lbnRzQnlJZDsKCiAgdGhpcy5wYXJzZVJvb3QgPSBwYXJzZVJvb3Q7Cn0KCgpmdW5jdGlvbiBCYXNlSGFuZGxlcigpIHt9CgpCYXNlSGFuZGxlci5wcm90b3R5cGUuaGFuZGxlRW5kID0gZnVuY3Rpb24oKSB7fTsKQmFzZUhhbmRsZXIucHJvdG90eXBlLmhhbmRsZVRleHQgPSBmdW5jdGlvbigpIHt9OwpCYXNlSGFuZGxlci5wcm90b3R5cGUuaGFuZGxlTm9kZSA9IGZ1bmN0aW9uKCkge307CkJhc2VIYW5kbGVyLnByb3RvdHlwZS5nZXRFbGVtZW50ID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMuZWxlbWVudDsKfTsKCmZ1bmN0aW9uIEJvZHlIYW5kbGVyKCkge30KCkJvZHlIYW5kbGVyLnByb3RvdHlwZSA9IG5ldyBCYXNlSGFuZGxlcigpOwoKQm9keUhhbmRsZXIucHJvdG90eXBlLmhhbmRsZVRleHQgPSBmdW5jdGlvbih0ZXh0KSB7CiAgdGhpcy5ib2R5ID0gKHRoaXMuYm9keSB8fCAnJykgKyB0ZXh0Owp9OwoKZnVuY3Rpb24gUmVmZXJlbmNlSGFuZGxlcihwcm9wZXJ0eSwgY29udGV4dCkgewogIHRoaXMucHJvcGVydHkgPSBwcm9wZXJ0eTsKICB0aGlzLmNvbnRleHQgPSBjb250ZXh0Owp9CgpSZWZlcmVuY2VIYW5kbGVyLnByb3RvdHlwZSA9IG5ldyBCb2R5SGFuZGxlcigpOwoKUmVmZXJlbmNlSGFuZGxlci5wcm90b3R5cGUuaGFuZGxlTm9kZSA9IGZ1bmN0aW9uKG5vZGUpIHsKCiAgaWYgKHRoaXMuZWxlbWVudCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdleHBlY3RlZCBubyBzdWIgbm9kZXMnKTsKICB9IGVsc2UgewogICAgdGhpcy5lbGVtZW50ID0gdGhpcy5jcmVhdGVSZWZlcmVuY2Uobm9kZSk7CiAgfQoKICByZXR1cm4gdGhpczsKfTsKClJlZmVyZW5jZUhhbmRsZXIucHJvdG90eXBlLmhhbmRsZUVuZCA9IGZ1bmN0aW9uKCkgewogIHRoaXMuZWxlbWVudC5pZCA9IHRoaXMuYm9keTsKfTsKClJlZmVyZW5jZUhhbmRsZXIucHJvdG90eXBlLmNyZWF0ZVJlZmVyZW5jZSA9IGZ1bmN0aW9uKCkgewogIHJldHVybiB7CiAgICBwcm9wZXJ0eTogdGhpcy5wcm9wZXJ0eS5ucy5uYW1lLAogICAgaWQ6ICcnCiAgfTsKfTsKCmZ1bmN0aW9uIFZhbHVlSGFuZGxlcihwcm9wZXJ0eURlc2MsIGVsZW1lbnQpIHsKICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50OwogIHRoaXMucHJvcGVydHlEZXNjID0gcHJvcGVydHlEZXNjOwp9CgpWYWx1ZUhhbmRsZXIucHJvdG90eXBlID0gbmV3IEJvZHlIYW5kbGVyKCk7CgpWYWx1ZUhhbmRsZXIucHJvdG90eXBlLmhhbmRsZUVuZCA9IGZ1bmN0aW9uKCkgewoKICB2YXIgdmFsdWUgPSB0aGlzLmJvZHksCiAgICAgIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsCiAgICAgIHByb3BlcnR5RGVzYyA9IHRoaXMucHJvcGVydHlEZXNjOwoKICB2YWx1ZSA9IFR5cGVzLmNvZXJjZVR5cGUocHJvcGVydHlEZXNjLnR5cGUsIHZhbHVlKTsKCiAgaWYgKHByb3BlcnR5RGVzYy5pc01hbnkpIHsKICAgIGVsZW1lbnQuZ2V0KHByb3BlcnR5RGVzYy5uYW1lKS5wdXNoKHZhbHVlKTsKICB9IGVsc2UgewogICAgZWxlbWVudC5zZXQocHJvcGVydHlEZXNjLm5hbWUsIHZhbHVlKTsKICB9Cn07CgoKZnVuY3Rpb24gQmFzZUVsZW1lbnRIYW5kbGVyKCkge30KCkJhc2VFbGVtZW50SGFuZGxlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEJvZHlIYW5kbGVyLnByb3RvdHlwZSk7CgpCYXNlRWxlbWVudEhhbmRsZXIucHJvdG90eXBlLmhhbmRsZU5vZGUgPSBmdW5jdGlvbihub2RlKSB7CiAgdmFyIHBhcnNlciA9IHRoaXM7CgogIGlmICghdGhpcy5lbGVtZW50KSB7CiAgICB0aGlzLmVsZW1lbnQgPSB0aGlzLmNyZWF0ZUVsZW1lbnQobm9kZSk7CiAgICB2YXIgaWQgPSB0aGlzLmVsZW1lbnQuaWQ7CgogICAgaWYgKGlkKSB7CiAgICAgIHRoaXMuY29udGV4dC5hZGRFbGVtZW50KGlkLCB0aGlzLmVsZW1lbnQpOwogICAgfQogIH0gZWxzZSB7CiAgICBwYXJzZXIgPSB0aGlzLmhhbmRsZUNoaWxkKG5vZGUpOwogIH0KCiAgcmV0dXJuIHBhcnNlcjsKfTsKCi8qKgogKiBAY2xhc3MgWE1MUmVhZGVyLkVsZW1lbnRIYW5kbGVyCiAqCiAqLwpmdW5jdGlvbiBFbGVtZW50SGFuZGxlcihtb2RlbCwgdHlwZSwgY29udGV4dCkgewogIHRoaXMubW9kZWwgPSBtb2RlbDsKICB0aGlzLnR5cGUgPSBtb2RlbC5nZXRUeXBlKHR5cGUpOwogIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7Cn0KCkVsZW1lbnRIYW5kbGVyLnByb3RvdHlwZSA9IG5ldyBCYXNlRWxlbWVudEhhbmRsZXIoKTsKCkVsZW1lbnRIYW5kbGVyLnByb3RvdHlwZS5hZGRSZWZlcmVuY2UgPSBmdW5jdGlvbihyZWZlcmVuY2UpIHsKICB0aGlzLmNvbnRleHQuYWRkUmVmZXJlbmNlKHJlZmVyZW5jZSk7Cn07CgpFbGVtZW50SGFuZGxlci5wcm90b3R5cGUuaGFuZGxlRW5kID0gZnVuY3Rpb24oKSB7CgogIHZhciB2YWx1ZSA9IHRoaXMuYm9keSwKICAgICAgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwKICAgICAgZGVzY3JpcHRvciA9IGVsZW1lbnQuJGRlc2NyaXB0b3IsCiAgICAgIGJvZHlQcm9wZXJ0eSA9IGRlc2NyaXB0b3IuYm9keVByb3BlcnR5OwoKICBpZiAoYm9keVByb3BlcnR5ICYmIHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgIHZhbHVlID0gVHlwZXMuY29lcmNlVHlwZShib2R5UHJvcGVydHkudHlwZSwgdmFsdWUpOwogICAgZWxlbWVudC5zZXQoYm9keVByb3BlcnR5Lm5hbWUsIHZhbHVlKTsKICB9Cn07CgovKioKICogQ3JlYXRlIGFuIGluc3RhbmNlIG9mIHRoZSBtb2RlbCBmcm9tIHRoZSBnaXZlbiBub2RlLgogKgogKiBAcGFyYW0gIHtFbGVtZW50fSBub2RlIHRoZSB4bWwgbm9kZQogKi8KRWxlbWVudEhhbmRsZXIucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbihub2RlKSB7CiAgdmFyIGF0dHJpYnV0ZXMgPSBwYXJzZU5vZGVBdHRyaWJ1dGVzKG5vZGUpLAogICAgICBUeXBlID0gdGhpcy50eXBlLAogICAgICBkZXNjcmlwdG9yID0gVHlwZS4kZGVzY3JpcHRvciwKICAgICAgY29udGV4dCA9IHRoaXMuY29udGV4dCwKICAgICAgaW5zdGFuY2UgPSBuZXcgVHlwZSh7fSk7CgogIF8uZm9yRWFjaChhdHRyaWJ1dGVzLCBmdW5jdGlvbih2YWx1ZSwgbmFtZSkgewoKICAgIHZhciBwcm9wID0gZGVzY3JpcHRvci5wcm9wZXJ0aWVzQnlOYW1lW25hbWVdOwoKICAgIGlmIChwcm9wICYmIHByb3AuaXNSZWZlcmVuY2UpIHsKICAgICAgY29udGV4dC5hZGRSZWZlcmVuY2UoewogICAgICAgIGVsZW1lbnQ6IGluc3RhbmNlLAogICAgICAgIHByb3BlcnR5OiBwcm9wLm5zLm5hbWUsCiAgICAgICAgaWQ6IHZhbHVlCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHByb3ApIHsKICAgICAgICB2YWx1ZSA9IFR5cGVzLmNvZXJjZVR5cGUocHJvcC50eXBlLCB2YWx1ZSk7CiAgICAgIH0KCiAgICAgIGluc3RhbmNlLnNldChuYW1lLCB2YWx1ZSk7CiAgICB9CiAgfSk7CgogIHJldHVybiBpbnN0YW5jZTsKfTsKCkVsZW1lbnRIYW5kbGVyLnByb3RvdHlwZS5nZXRQcm9wZXJ0eUZvckVsZW1lbnQgPSBmdW5jdGlvbihuYW1lTnMpIHsKICBpZiAoXy5pc1N0cmluZyhuYW1lTnMpKSB7CiAgICBuYW1lTnMgPSBwYXJzZU5hbWVOcyhuYW1lTnMpOwogIH0KCiAgdmFyIHR5cGUgPSB0aGlzLnR5cGUsCiAgICAgIG1vZGVsID0gdGhpcy5tb2RlbCwKICAgICAgZGVzY3JpcHRvciA9IHR5cGUuJGRlc2NyaXB0b3I7CgogIHZhciBwcm9wZXJ0eU5hbWUgPSBuYW1lTnMubmFtZTsKCiAgdmFyIHByb3BlcnR5ID0gZGVzY3JpcHRvci5wcm9wZXJ0aWVzQnlOYW1lW3Byb3BlcnR5TmFtZV07CgogIC8vIHNlYXJjaCBmb3IgcHJvcGVydGllcyBieSBuYW1lIGZpcnN0CiAgaWYgKHByb3BlcnR5KSB7CiAgICByZXR1cm4gcHJvcGVydHk7CiAgfQoKICB2YXIgcGtnID0gbW9kZWwuZ2V0UGFja2FnZShuYW1lTnMucHJlZml4KTsKCiAgaWYgKHBrZykgewogICAgdmFyIHR5cGVOYW1lID0gbmFtZU5zLnByZWZpeCArICc6JyArIGFsaWFzVG9OYW1lKG5hbWVOcy5sb2NhbE5hbWUsIGRlc2NyaXB0b3IuJHBrZyksCiAgICAgICAgZWxlbWVudFR5cGUgPSBtb2RlbC5nZXRUeXBlKHR5cGVOYW1lKTsKCiAgICAvLyBzZWFyY2ggZm9yIGNvbGxlY3Rpb24gbWVtYmVycyBsYXRlcgogICAgcHJvcGVydHkgPSBfLmZpbmQoZGVzY3JpcHRvci5wcm9wZXJ0aWVzLCBmdW5jdGlvbihwKSB7CiAgICAgIHJldHVybiAhcC5pc1ZpcnR1YWwgJiYgIXAuaXNSZWZlcmVuY2UgJiYgIXAuaXNBdHRyaWJ1dGUgJiYgZWxlbWVudFR5cGUuaGFzVHlwZShwLnR5cGUpOwogICAgfSk7CgogICAgaWYgKHByb3BlcnR5KSB7CiAgICAgIHJldHVybiBfLmV4dGVuZCh7fSwgcHJvcGVydHksIHsgZWZmZWN0aXZlVHlwZTogZWxlbWVudFR5cGUuJGRlc2NyaXB0b3IubmFtZSB9KTsKICAgIH0KICB9IGVsc2UgewogICAgLy8gcGFyc2UgdW5rbm93biBlbGVtZW50IChtYXliZSBleHRlbnNpb24pCiAgICBwcm9wZXJ0eSA9IF8uZmluZChkZXNjcmlwdG9yLnByb3BlcnRpZXMsIGZ1bmN0aW9uKHApIHsKICAgICAgcmV0dXJuICFwLmlzUmVmZXJlbmNlICYmICFwLmlzQXR0cmlidXRlICYmIHAudHlwZSA9PT0gJ0VsZW1lbnQnOwogICAgfSk7CgogICAgaWYgKHByb3BlcnR5KSB7CiAgICAgIHJldHVybiBwcm9wZXJ0eTsKICAgIH0KICB9CgogIHRocm93IG5ldyBFcnJvcigndW5yZWNvZ25pemVkIGVsZW1lbnQgPCcgKyBuYW1lTnMubmFtZSArICc+Jyk7Cn07CgpFbGVtZW50SGFuZGxlci5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gJ0VsZW1lbnREZXNjcmlwdG9yWycgKyB0aGlzLnR5cGUuJGRlc2NyaXB0b3IubmFtZSArICddJzsKfTsKCkVsZW1lbnRIYW5kbGVyLnByb3RvdHlwZS52YWx1ZUhhbmRsZXIgPSBmdW5jdGlvbihwcm9wZXJ0eURlc2MsIGVsZW1lbnQpIHsKICByZXR1cm4gbmV3IFZhbHVlSGFuZGxlcihwcm9wZXJ0eURlc2MsIGVsZW1lbnQpOwp9OwoKRWxlbWVudEhhbmRsZXIucHJvdG90eXBlLnJlZmVyZW5jZUhhbmRsZXIgPSBmdW5jdGlvbihwcm9wZXJ0eURlc2MpIHsKICByZXR1cm4gbmV3IFJlZmVyZW5jZUhhbmRsZXIocHJvcGVydHlEZXNjLCB0aGlzLmNvbnRleHQpOwp9OwoKRWxlbWVudEhhbmRsZXIucHJvdG90eXBlLmhhbmRsZXIgPSBmdW5jdGlvbih0eXBlKSB7CiAgaWYgKHR5cGUgPT09ICdFbGVtZW50JykgewogICAgcmV0dXJuIG5ldyBHZW5lcmljRWxlbWVudEhhbmRsZXIodGhpcy5tb2RlbCwgdHlwZSwgdGhpcy5jb250ZXh0KTsKICB9IGVsc2UgewogICAgcmV0dXJuIG5ldyBFbGVtZW50SGFuZGxlcih0aGlzLm1vZGVsLCB0eXBlLCB0aGlzLmNvbnRleHQpOwogIH0KfTsKCi8qKgogKiBIYW5kbGUgdGhlIGNoaWxkIGVsZW1lbnQgcGFyc2luZwogKgogKiBAcGFyYW0gIHtFbGVtZW50fSBub2RlIHRoZSB4bWwgbm9kZQogKi8KRWxlbWVudEhhbmRsZXIucHJvdG90eXBlLmhhbmRsZUNoaWxkID0gZnVuY3Rpb24obm9kZSkgewogIHZhciBuYW1lTnMgPSBwYXJzZU5hbWVOcyhub2RlLmxvY2FsLCBub2RlLnByZWZpeCk7CgogIHZhciBwcm9wZXJ0eURlc2MsIHR5cGUsIGVsZW1lbnQsIGNoaWxkSGFuZGxlcjsKCiAgcHJvcGVydHlEZXNjID0gdGhpcy5nZXRQcm9wZXJ0eUZvckVsZW1lbnQobmFtZU5zKTsKICBlbGVtZW50ID0gdGhpcy5lbGVtZW50OwoKICB0eXBlID0gcHJvcGVydHlEZXNjLmVmZmVjdGl2ZVR5cGUgfHwgcHJvcGVydHlEZXNjLnR5cGU7CgogIGlmIChUeXBlcy5pc1NpbXBsZShwcm9wZXJ0eURlc2MudHlwZSkpIHsKICAgIHJldHVybiB0aGlzLnZhbHVlSGFuZGxlcihwcm9wZXJ0eURlc2MsIGVsZW1lbnQpOwogIH0KCiAgaWYgKHByb3BlcnR5RGVzYy5pc1JlZmVyZW5jZSkgewogICAgY2hpbGRIYW5kbGVyID0gdGhpcy5yZWZlcmVuY2VIYW5kbGVyKHByb3BlcnR5RGVzYykuaGFuZGxlTm9kZShub2RlKTsKICB9IGVsc2UgewogICAgY2hpbGRIYW5kbGVyID0gdGhpcy5oYW5kbGVyKHR5cGUpLmhhbmRsZU5vZGUobm9kZSk7CiAgfQoKICB2YXIgbmV3RWxlbWVudCA9IGNoaWxkSGFuZGxlci5nZXRFbGVtZW50KCk7CgogIC8vIGNoaWxkIGhhbmRsZXMgbWF5IGRlY2lkZSB0byBza2lwIGVsZW1lbnRzCiAgLy8gYnkgbm90IHJldHVybmluZyBhbnl0aGluZwogIGlmIChuZXdFbGVtZW50ICE9PSB1bmRlZmluZWQpIHsKCiAgICBpZiAocHJvcGVydHlEZXNjLmlzTWFueSkgewogICAgICBlbGVtZW50LmdldChwcm9wZXJ0eURlc2MubmFtZSkucHVzaChuZXdFbGVtZW50KTsKICAgIH0gZWxzZSB7CiAgICAgIGVsZW1lbnQuc2V0KHByb3BlcnR5RGVzYy5uYW1lLCBuZXdFbGVtZW50KTsKICAgIH0KCiAgICBpZiAocHJvcGVydHlEZXNjLmlzUmVmZXJlbmNlKSB7CiAgICAgIF8uZXh0ZW5kKG5ld0VsZW1lbnQsIHsKICAgICAgICBlbGVtZW50OiBlbGVtZW50CiAgICAgIH0pOwoKICAgICAgdGhpcy5jb250ZXh0LmFkZFJlZmVyZW5jZShuZXdFbGVtZW50KTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIGVzdGFibGlzaCBjaGlsZCAtPiBwYXJlbnQgcmVsYXRpb25zaGlwCiAgICAgIG5ld0VsZW1lbnQuJHBhcmVudCA9IGVsZW1lbnQ7CiAgICB9CiAgfQoKICByZXR1cm4gY2hpbGRIYW5kbGVyOwp9OwoKCmZ1bmN0aW9uIEdlbmVyaWNFbGVtZW50SGFuZGxlcihtb2RlbCwgdHlwZSwgY29udGV4dCkgewogIHRoaXMubW9kZWwgPSBtb2RlbDsKICB0aGlzLmNvbnRleHQgPSBjb250ZXh0Owp9CgpHZW5lcmljRWxlbWVudEhhbmRsZXIucHJvdG90eXBlID0gbmV3IEJhc2VFbGVtZW50SGFuZGxlcigpOwoKR2VuZXJpY0VsZW1lbnRIYW5kbGVyLnByb3RvdHlwZS5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24obm9kZSkgewoKICB2YXIgbmFtZSA9IG5vZGUubmFtZSwKICAgICAgcHJlZml4ID0gbm9kZS5wcmVmaXgsCiAgICAgIHVyaSA9IG5vZGUubnNbcHJlZml4XSwKICAgICAgYXR0cmlidXRlcyA9IG5vZGUuYXR0cmlidXRlczsKCiAgcmV0dXJuIHRoaXMubW9kZWwuY3JlYXRlQW55KG5hbWUsIHVyaSwgYXR0cmlidXRlcyk7Cn07CgpHZW5lcmljRWxlbWVudEhhbmRsZXIucHJvdG90eXBlLmhhbmRsZUNoaWxkID0gZnVuY3Rpb24obm9kZSkgewoKICB2YXIgaGFuZGxlciA9IG5ldyBHZW5lcmljRWxlbWVudEhhbmRsZXIodGhpcy5tb2RlbCwgJ0VsZW1lbnQnLCB0aGlzLmNvbnRleHQpLmhhbmRsZU5vZGUobm9kZSksCiAgICAgIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7CgogIHZhciBuZXdFbGVtZW50ID0gaGFuZGxlci5nZXRFbGVtZW50KCksCiAgICAgIGNoaWxkcmVuOwoKICBpZiAobmV3RWxlbWVudCAhPT0gdW5kZWZpbmVkKSB7CiAgICBjaGlsZHJlbiA9IGVsZW1lbnQuJGNoaWxkcmVuID0gZWxlbWVudC4kY2hpbGRyZW4gfHwgW107CiAgICBjaGlsZHJlbi5wdXNoKG5ld0VsZW1lbnQpOwoKICAgIC8vIGVzdGFibGlzaCBjaGlsZCAtPiBwYXJlbnQgcmVsYXRpb25zaGlwCiAgICBuZXdFbGVtZW50LiRwYXJlbnQgPSBlbGVtZW50OwogIH0KCiAgcmV0dXJuIGhhbmRsZXI7Cn07CgpHZW5lcmljRWxlbWVudEhhbmRsZXIucHJvdG90eXBlLmhhbmRsZVRleHQgPSBmdW5jdGlvbih0ZXh0KSB7CiAgdGhpcy5ib2R5ID0gdGhpcy5ib2R5IHx8ICcnICsgdGV4dDsKfTsKCkdlbmVyaWNFbGVtZW50SGFuZGxlci5wcm90b3R5cGUuaGFuZGxlRW5kID0gZnVuY3Rpb24oKSB7CiAgaWYgKHRoaXMuYm9keSkgewogICAgdGhpcy5lbGVtZW50LiRib2R5ID0gdGhpcy5ib2R5OwogIH0KfTsKCi8qKgogKiBBIHJlYWRlciBmb3IgYSBtZXRhLW1vZGVsCiAqCiAqIEBjbGFzcyBYTUxSZWFkZXIKICoKICogQHBhcmFtIHtNb2RlbH0gbW9kZWwgdXNlZCB0byByZWFkIHhtbCBmaWxlcwogKi8KZnVuY3Rpb24gWE1MUmVhZGVyKG1vZGVsKSB7CgogIGZ1bmN0aW9uIHJlc29sdmVSZWZlcmVuY2VzKGNvbnRleHQpIHsKCiAgICB2YXIgZWxlbWVudHNCeUlkID0gY29udGV4dC5lbGVtZW50c0J5SWQ7CiAgICB2YXIgcmVmZXJlbmNlcyA9IGNvbnRleHQucmVmZXJlbmNlczsKCiAgICBfLmZvckVhY2gocmVmZXJlbmNlcywgZnVuY3Rpb24ocikgewogICAgICB2YXIgZWxlbWVudCA9IHIuZWxlbWVudDsKICAgICAgdmFyIHJlZmVyZW5jZSA9IGVsZW1lbnRzQnlJZFtyLmlkXTsKICAgICAgdmFyIHByb3BlcnR5ID0gZWxlbWVudC4kZGVzY3JpcHRvci5wcm9wZXJ0aWVzQnlOYW1lW3IucHJvcGVydHldOwoKICAgICAgaWYgKCFyZWZlcmVuY2UpIHsKICAgICAgICBjb250ZXh0LmFkZFdhcm5pbmcoewogICAgICAgICAgbWVzc2FnZTogJ3VucmVzb2x2ZWQgcmVmZXJlbmNlIDwnICsgci5pZCArICc+JywKICAgICAgICAgIGVsZW1lbnQ6IHIuZWxlbWVudCwKICAgICAgICAgIHByb3BlcnR5OiByLnByb3BlcnR5LAogICAgICAgICAgdmFsdWU6IHIuaWQKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgaWYgKHByb3BlcnR5LmlzTWFueSkgewogICAgICAgIHZhciBjb2xsZWN0aW9uID0gZWxlbWVudC5nZXQocHJvcGVydHkubmFtZSksCiAgICAgICAgICAgIGlkeCA9IGNvbGxlY3Rpb24uaW5kZXhPZihyKTsKCiAgICAgICAgaWYgKCFyZWZlcmVuY2UpIHsKICAgICAgICAgIC8vIHJlbW92ZSB1bnJlc29sdmFibGUgcmVmZXJlbmNlCiAgICAgICAgICBjb2xsZWN0aW9uLnNwbGljZShpZHgsIDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyB1cGRhdGUgcmVmZXJlbmNlCiAgICAgICAgICBjb2xsZWN0aW9uW2lkeF0gPSByZWZlcmVuY2U7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGVsZW1lbnQuc2V0KHByb3BlcnR5Lm5hbWUsIHJlZmVyZW5jZSk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gZnJvbVhNTCh4bWwsIHJvb3RIYW5kbGVyLCBkb25lKSB7CgogICAgdmFyIGNvbnRleHQgPSBuZXcgQ29udGV4dChyb290SGFuZGxlcik7CgogICAgdmFyIHBhcnNlciA9IHNheC5wYXJzZXIodHJ1ZSwgeyB4bWxuczogdHJ1ZSwgdHJpbTogdHJ1ZSB9KSwKICAgICAgICBzdGFjayA9IG5ldyBTdGFjaygpOwoKICAgIHJvb3RIYW5kbGVyLmNvbnRleHQgPSBjb250ZXh0OwoKICAgIC8vIHB1c2ggcm9vdCBoYW5kbGVyCiAgICBzdGFjay5wdXNoKHJvb3RIYW5kbGVyKTsKCiAgICAvLyBlcnJvciBoYW5kbGluZwogICAgcGFyc2VyLm9uZXJyb3IgPSBmdW5jdGlvbiAoZSkgewogICAgICAvLyBqdXN0IHRocm93CiAgICAgIHRocm93IGU7CiAgICB9OwoKICAgIHBhcnNlci5vbm9wZW50YWcgPSBmdW5jdGlvbihub2RlKSB7CiAgICAgIHZhciBoYW5kbGVyID0gc3RhY2sucGVlaygpOwoKICAgICAgbm9ybWFsaXplTmFtZXNwYWNlcyhub2RlLCBtb2RlbCk7CgogICAgICB0cnkgewogICAgICAgIHN0YWNrLnB1c2goaGFuZGxlci5oYW5kbGVOb2RlKG5vZGUpKTsKICAgICAgfSBjYXRjaCAoZSkgewoKICAgICAgICB2YXIgbGluZSA9IHRoaXMubGluZSwKICAgICAgICAgICAgY29sdW1uID0gdGhpcy5jb2x1bW47CgogICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICd1bnBhcnNhYmxlIGNvbnRlbnQgPCcgKyBub2RlLm5hbWUgKyAnPiBkZXRlY3RlZFxuXHQnICsKICAgICAgICAgICAgJ2xpbmU6ICcgKyBsaW5lICsgJ1xuXHQnICsKICAgICAgICAgICAgJ2NvbHVtbjogJyArIGNvbHVtbiArICdcblx0JyArCiAgICAgICAgICAgICduZXN0ZWQgZXJyb3I6ICcgKyBlLm1lc3NhZ2UpOwogICAgICB9CiAgICB9OwoKICAgIHBhcnNlci5vbnRleHQgPSBwYXJzZXIub25jZGF0YSA9IGZ1bmN0aW9uKHRleHQpIHsKICAgICAgdmFyIGhhbmRsZXIgPSBzdGFjay5wZWVrKCk7CiAgICAgIGhhbmRsZXIuaGFuZGxlVGV4dCh0ZXh0KTsKICAgIH07CgogICAgcGFyc2VyLm9uY2xvc2V0YWcgPSBmdW5jdGlvbih0YWdOYW1lKSB7CiAgICAgIHZhciBvbGQgPSBzdGFjay5wb3AoKTsKICAgICAgb2xkLmhhbmRsZUVuZCgpOwogICAgfTsKCiAgICBwYXJzZXIub25lbmQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJlc29sdmVSZWZlcmVuY2VzKGNvbnRleHQpOwogICAgICBkb25lKG51bGwsIHJvb3RIYW5kbGVyLmdldEVsZW1lbnQoKSwgY29udGV4dCk7CiAgICB9OwoKICAgIHRyeSB7CiAgICAgIHBhcnNlci53cml0ZSh4bWwpLmNsb3NlKCk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIC8vIGhhbmRsZSBlcnJvcnMKICAgICAgZG9uZShlLCB1bmRlZmluZWQsIGNvbnRleHQpOwogICAgfQogIH0KCiAgcmV0dXJuIHsKICAgIGZyb21YTUw6IGZyb21YTUwsCgogICAgaGFuZGxlcjogZnVuY3Rpb24obmFtZSkgewogICAgICByZXR1cm4gbmV3IEVsZW1lbnRIYW5kbGVyKG1vZGVsLCBuYW1lKTsKICAgIH0KICB9Owp9Cgptb2R1bGUuZXhwb3J0cyA9IFhNTFJlYWRlcjsKbW9kdWxlLmV4cG9ydHMuRWxlbWVudEhhbmRsZXIgPSBFbGVtZW50SGFuZGxlcjsKfSx7Ii4vY29tbW9uIjoxNywibW9kZGxlIjoxOCwidGlueS1zdGFjayI6Mjd9XSwxNjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBfID0gKHdpbmRvdy5fKTsKCnZhciBUeXBlcyA9IF9kZXJlcV8oJ21vZGRsZScpLnR5cGVzLAogICAgY29tbW9uID0gX2RlcmVxXygnLi9jb21tb24nKSwKICAgIHBhcnNlTmFtZU5zID0gX2RlcmVxXygnbW9kZGxlJykubnMucGFyc2VOYW1lLAogICAgbmFtZVRvQWxpYXMgPSBjb21tb24ubmFtZVRvQWxpYXM7Cgp2YXIgWE1MX1BSRUFNQkxFID0gJzw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IlVURi04Ij8+XG4nOwoKdmFyIENEQVRBX0VTQ0FQRSA9IC9bPD4iJl0rLzsKCnZhciBERUZBVUxUX05TX01BUCA9IGNvbW1vbi5ERUZBVUxUX05TX01BUDsKCgpmdW5jdGlvbiBuc05hbWUobnMpIHsKICBpZiAoXy5pc1N0cmluZyhucykpIHsKICAgIHJldHVybiBuczsKICB9IGVsc2UgewogICAgcmV0dXJuIChucy5wcmVmaXggPyBucy5wcmVmaXggKyAnOicgOiAnJykgKyBucy5sb2NhbE5hbWU7CiAgfQp9CgpmdW5jdGlvbiBnZXRFbGVtZW50TnMobnMsIGRlc2NyaXB0b3IpIHsKICBpZiAoZGVzY3JpcHRvci5pc0dlbmVyaWMpIHsKICAgIHJldHVybiBkZXNjcmlwdG9yLm5hbWU7CiAgfSBlbHNlIHsKICAgIHJldHVybiBfLmV4dGVuZCh7IGxvY2FsTmFtZTogbmFtZVRvQWxpYXMoZGVzY3JpcHRvci5ucy5sb2NhbE5hbWUsIGRlc2NyaXB0b3IuJHBrZykgfSwgbnMpOwogIH0KfQoKZnVuY3Rpb24gZ2V0UHJvcGVydHlOcyhucywgZGVzY3JpcHRvcikgewogIHJldHVybiBfLmV4dGVuZCh7IGxvY2FsTmFtZTogZGVzY3JpcHRvci5ucy5sb2NhbE5hbWUgfSwgbnMpOwp9CgpmdW5jdGlvbiBnZXRTZXJpYWxpemFibGVQcm9wZXJ0aWVzKGVsZW1lbnQpIHsKICB2YXIgZGVzY3JpcHRvciA9IGVsZW1lbnQuJGRlc2NyaXB0b3I7CgogIHJldHVybiBfLmZpbHRlcihkZXNjcmlwdG9yLnByb3BlcnRpZXMsIGZ1bmN0aW9uKHApIHsKICAgIHZhciBuYW1lID0gcC5uYW1lOwoKICAgIC8vIGRvIG5vdCBzZXJpYWxpemUgZGVmYXVsdHMKICAgIGlmICghZWxlbWVudC5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgdmFyIHZhbHVlID0gZWxlbWVudFtuYW1lXTsKCiAgICAvLyBkbyBub3Qgc2VyaWFsaXplIGRlZmF1bHQgZXF1YWxzCiAgICBpZiAodmFsdWUgPT09IHAuZGVmYXVsdCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmV0dXJuIHAuaXNNYW55ID8gdmFsdWUubGVuZ3RoIDogdHJ1ZTsKICB9KTsKfQoKLyoqCiAqIEVzY2FwZSBhIHN0cmluZyBhdHRyaWJ1dGUgdG8gbm90IGNvbnRhaW4gYW55IGJhZCB2YWx1ZXMgKGxpbmUgYnJlYWtzLCAnIicsIC4uLikKICoKICogQHBhcmFtIHtTdHJpbmd9IHN0ciB0aGUgc3RyaW5nIHRvIGVzY2FwZQogKiBAcmV0dXJuIHtTdHJpbmd9IHRoZSBlc2NhcGVkIHN0cmluZwogKi8KZnVuY3Rpb24gZXNjYXBlQXR0cihzdHIpIHsKICB2YXIgZXNjYXBlTWFwID0gewogICAgJ1xuJzogJyYjMTA7JywKICAgICdcblxyJzogJyYjMTA7JywKICAgICciJzogJyZxdW90OycKICB9OwoKICAvLyBlbnN1cmUgd2UgYXJlIGhhbmRsaW5nIHN0cmluZ3MgaGVyZQogIHN0ciA9IF8uaXNTdHJpbmcoc3RyKSA/IHN0ciA6ICcnICsgc3RyOwoKICByZXR1cm4gc3RyLnJlcGxhY2UoLyhcbnxcblxyfCIpL2csIGZ1bmN0aW9uKHN0cikgewogICAgcmV0dXJuIGVzY2FwZU1hcFtzdHJdOwogIH0pOwp9CgpmdW5jdGlvbiBmaWx0ZXJBdHRyaWJ1dGVzKHByb3BzKSB7CiAgcmV0dXJuIF8uZmlsdGVyKHByb3BzLCBmdW5jdGlvbihwKSB7IHJldHVybiBwLmlzQXR0cjsgfSk7Cn0KCmZ1bmN0aW9uIGZpbHRlckNvbnRhaW5lZChwcm9wcykgewogIHJldHVybiBfLmZpbHRlcihwcm9wcywgZnVuY3Rpb24ocCkgeyByZXR1cm4gIXAuaXNBdHRyOyB9KTsKfQoKCmZ1bmN0aW9uIFJlZmVyZW5jZVNlcmlhbGl6ZXIocGFyZW50LCBucykgewogIHRoaXMubnMgPSBuczsKfQoKUmVmZXJlbmNlU2VyaWFsaXplci5wcm90b3R5cGUuYnVpbGQgPSBmdW5jdGlvbihlbGVtZW50KSB7CiAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDsKICByZXR1cm4gdGhpczsKfTsKClJlZmVyZW5jZVNlcmlhbGl6ZXIucHJvdG90eXBlLnNlcmlhbGl6ZVRvID0gZnVuY3Rpb24od3JpdGVyKSB7CiAgd3JpdGVyCiAgICAuYXBwZW5kSW5kZW50KCkKICAgIC5hcHBlbmQoJzwnICsgbnNOYW1lKHRoaXMubnMpICsgJz4nICsgdGhpcy5lbGVtZW50LmlkICsgJzwvJyArIG5zTmFtZSh0aGlzLm5zKSArICc+JykKICAgIC5hcHBlbmROZXdMaW5lKCk7Cn07CgpmdW5jdGlvbiBCb2R5U2VyaWFsaXplcigpIHt9CgpCb2R5U2VyaWFsaXplci5wcm90b3R5cGUuc2VyaWFsaXplVmFsdWUgPSBCb2R5U2VyaWFsaXplci5wcm90b3R5cGUuc2VyaWFsaXplVG8gPSBmdW5jdGlvbih3cml0ZXIpIHsKICB2YXIgdmFsdWUgPSB0aGlzLnZhbHVlLAogICAgICBlc2NhcGUgPSB0aGlzLmVzY2FwZTsKCiAgaWYgKGVzY2FwZSkgewogICAgd3JpdGVyLmFwcGVuZCgnPCFbQ0RBVEFbJyk7CiAgfQoKICB3cml0ZXIuYXBwZW5kKHRoaXMudmFsdWUpOwoKICBpZiAoZXNjYXBlKSB7CiAgICB3cml0ZXIuYXBwZW5kKCddXT4nKTsKICB9Cn07CgpCb2R5U2VyaWFsaXplci5wcm90b3R5cGUuYnVpbGQgPSBmdW5jdGlvbihwcm9wLCB2YWx1ZSkgewogIHRoaXMudmFsdWUgPSB2YWx1ZTsKCiAgaWYgKHByb3AudHlwZSA9PT0gJ1N0cmluZycgJiYgQ0RBVEFfRVNDQVBFLnRlc3QodmFsdWUpKSB7CiAgICB0aGlzLmVzY2FwZSA9IHRydWU7CiAgfQoKICByZXR1cm4gdGhpczsKfTsKCmZ1bmN0aW9uIFZhbHVlU2VyaWFsaXplcihucykgewogIHRoaXMubnMgPSBuczsKfQoKVmFsdWVTZXJpYWxpemVyLnByb3RvdHlwZSA9IG5ldyBCb2R5U2VyaWFsaXplcigpOwoKVmFsdWVTZXJpYWxpemVyLnByb3RvdHlwZS5zZXJpYWxpemVUbyA9IGZ1bmN0aW9uKHdyaXRlcikgewoKICB3cml0ZXIKICAgIC5hcHBlbmRJbmRlbnQoKQogICAgLmFwcGVuZCgnPCcgKyBuc05hbWUodGhpcy5ucykgKyAnPicpOwoKICB0aGlzLnNlcmlhbGl6ZVZhbHVlKHdyaXRlcik7CgogIHdyaXRlcgogICAgLmFwcGVuZCggJzwvJyArIG5zTmFtZSh0aGlzLm5zKSArICc+JykKICAgIC5hcHBlbmROZXdMaW5lKCk7Cn07CgpmdW5jdGlvbiBFbGVtZW50U2VyaWFsaXplcihwYXJlbnQsIG5zKSB7CiAgdGhpcy5ib2R5ID0gW107CiAgdGhpcy5hdHRycyA9IFtdOwoKICB0aGlzLnBhcmVudCA9IHBhcmVudDsKICB0aGlzLm5zID0gbnM7Cn0KCkVsZW1lbnRTZXJpYWxpemVyLnByb3RvdHlwZS5idWlsZCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50OwoKICB2YXIgb3RoZXJBdHRycyA9IHRoaXMucGFyc2VOc0F0dHJpYnV0ZXMoZWxlbWVudCk7CgogIGlmICghdGhpcy5ucykgewogICAgdGhpcy5ucyA9IHRoaXMubnNUYWdOYW1lKGVsZW1lbnQuJGRlc2NyaXB0b3IpOwogIH0KCiAgaWYgKGVsZW1lbnQuJGRlc2NyaXB0b3IuaXNHZW5lcmljKSB7CiAgICB0aGlzLnBhcnNlR2VuZXJpYyhlbGVtZW50KTsKICB9IGVsc2UgewogICAgdmFyIHByb3BlcnRpZXMgPSBnZXRTZXJpYWxpemFibGVQcm9wZXJ0aWVzKGVsZW1lbnQpOwoKICAgIHRoaXMucGFyc2VBdHRyaWJ1dGVzKGZpbHRlckF0dHJpYnV0ZXMocHJvcGVydGllcykpOwogICAgdGhpcy5wYXJzZUNvbnRhaW5tZW50cyhmaWx0ZXJDb250YWluZWQocHJvcGVydGllcykpOwoKICAgIHRoaXMucGFyc2VHZW5lcmljQXR0cmlidXRlcyhlbGVtZW50LCBvdGhlckF0dHJzKTsKICB9CgogIHJldHVybiB0aGlzOwp9OwoKRWxlbWVudFNlcmlhbGl6ZXIucHJvdG90eXBlLm5zVGFnTmFtZSA9IGZ1bmN0aW9uKGRlc2NyaXB0b3IpIHsKICB2YXIgZWZmZWN0aXZlTnMgPSB0aGlzLmxvZ05hbWVzcGFjZVVzZWQoZGVzY3JpcHRvci5ucyk7CiAgcmV0dXJuIGdldEVsZW1lbnROcyhlZmZlY3RpdmVOcywgZGVzY3JpcHRvcik7Cn07CgpFbGVtZW50U2VyaWFsaXplci5wcm90b3R5cGUubnNQcm9wZXJ0eVRhZ05hbWUgPSBmdW5jdGlvbihkZXNjcmlwdG9yKSB7CiAgdmFyIGVmZmVjdGl2ZU5zID0gdGhpcy5sb2dOYW1lc3BhY2VVc2VkKGRlc2NyaXB0b3IubnMpOwogIHJldHVybiBnZXRQcm9wZXJ0eU5zKGVmZmVjdGl2ZU5zLCBkZXNjcmlwdG9yKTsKfTsKCkVsZW1lbnRTZXJpYWxpemVyLnByb3RvdHlwZS5pc0xvY2FsTnMgPSBmdW5jdGlvbihucykgewogIHJldHVybiBucy51cmkgPT09IHRoaXMubnMudXJpOwp9OwoKRWxlbWVudFNlcmlhbGl6ZXIucHJvdG90eXBlLm5zQXR0cmlidXRlTmFtZSA9IGZ1bmN0aW9uKGVsZW1lbnQpIHsKCiAgdmFyIG5zOwoKICBpZiAoXy5pc1N0cmluZyhlbGVtZW50KSkgewogICAgbnMgPSBwYXJzZU5hbWVOcyhlbGVtZW50KTsKICB9IGVsc2UKICBpZiAoZWxlbWVudC5ucykgewogICAgbnMgPSBlbGVtZW50Lm5zOwogIH0KCiAgdmFyIGVmZmVjdGl2ZU5zID0gdGhpcy5sb2dOYW1lc3BhY2VVc2VkKG5zKTsKCiAgLy8gc3RyaXAgcHJlZml4IGlmIHNhbWUgbmFtZXNwYWNlIGxpa2UgcGFyZW50CiAgaWYgKHRoaXMuaXNMb2NhbE5zKGVmZmVjdGl2ZU5zKSkgewogICAgcmV0dXJuIHsgbG9jYWxOYW1lOiBucy5sb2NhbE5hbWUgfTsKICB9IGVsc2UgewogICAgcmV0dXJuIF8uZXh0ZW5kKHsgbG9jYWxOYW1lOiBucy5sb2NhbE5hbWUgfSwgZWZmZWN0aXZlTnMpOwogIH0KfTsKCkVsZW1lbnRTZXJpYWxpemVyLnByb3RvdHlwZS5wYXJzZUdlbmVyaWMgPSBmdW5jdGlvbihlbGVtZW50KSB7CgogIHZhciBzZWxmID0gdGhpcywKICAgICAgYm9keSA9IHRoaXMuYm9keSwKICAgICAgYXR0cnMgPSB0aGlzLmF0dHJzOwoKICBfLmZvckVhY2goZWxlbWVudCwgZnVuY3Rpb24odmFsLCBrZXkpIHsKCiAgICBpZiAoa2V5ID09PSAnJGJvZHknKSB7CiAgICAgIGJvZHkucHVzaChuZXcgQm9keVNlcmlhbGl6ZXIoKS5idWlsZCh7IHR5cGU6ICdTdHJpbmcnIH0sIHZhbCkpOwogICAgfSBlbHNlCiAgICBpZiAoa2V5ID09PSAnJGNoaWxkcmVuJykgewogICAgICBfLmZvckVhY2godmFsLCBmdW5jdGlvbihjaGlsZCkgewogICAgICAgIGJvZHkucHVzaChuZXcgRWxlbWVudFNlcmlhbGl6ZXIoc2VsZikuYnVpbGQoY2hpbGQpKTsKICAgICAgfSk7CiAgICB9IGVsc2UKICAgIGlmIChrZXkuaW5kZXhPZignJCcpICE9PSAwKSB7CiAgICAgIGF0dHJzLnB1c2goeyBuYW1lOiBrZXksIHZhbHVlOiBlc2NhcGVBdHRyKHZhbCkgfSk7CiAgICB9CiAgfSk7Cn07CgovKioKICogUGFyc2UgbmFtZXNwYWNlcyBhbmQgcmV0dXJuIGEgbGlzdCBvZiBsZWZ0IG92ZXIgZ2VuZXJpYyBhdHRyaWJ1dGVzCiAqCiAqIEBwYXJhbSAge09iamVjdH0gZWxlbWVudAogKiBAcmV0dXJuIHtBcnJheTxPYmplY3Q+fQogKi8KRWxlbWVudFNlcmlhbGl6ZXIucHJvdG90eXBlLnBhcnNlTnNBdHRyaWJ1dGVzID0gZnVuY3Rpb24oZWxlbWVudCkgewogIHZhciBzZWxmID0gdGhpczsKCiAgdmFyIGdlbmVyaWNBdHRycyA9IGVsZW1lbnQuJGF0dHJzOwoKICB2YXIgYXR0cmlidXRlcyA9IFtdOwoKICAvLyBwYXJzZSBuYW1lc3BhY2UgYXR0cmlidXRlcyBmaXJzdAogIC8vIGFuZCBsb2cgdGhlbS4gcHVzaCBub24gbmFtZXNwYWNlIGF0dHJpYnV0ZXMgdG8gYSBsaXN0CiAgLy8gYW5kIHByb2Nlc3MgdGhlbSBsYXRlcgogIF8uZm9yRWFjaChnZW5lcmljQXR0cnMsIGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7CiAgICB2YXIgbmFtZU5zID0gcGFyc2VOYW1lTnMobmFtZSk7CgogICAgaWYgKG5hbWVOcy5wcmVmaXggPT09ICd4bWxucycpIHsKICAgICAgc2VsZi5sb2dOYW1lc3BhY2UoeyBwcmVmaXg6IG5hbWVOcy5sb2NhbE5hbWUsIHVyaTogdmFsdWUgfSk7CiAgICB9IGVsc2UKICAgIGlmICghbmFtZU5zLnByZWZpeCAmJiBuYW1lTnMubG9jYWxOYW1lID09PSAneG1sbnMnKSB7CiAgICAgIHNlbGYubG9nTmFtZXNwYWNlKHsgdXJpOiB2YWx1ZSB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGF0dHJpYnV0ZXMucHVzaCh7IG5hbWU6IG5hbWUsIHZhbHVlOiB2YWx1ZSB9KTsKICAgIH0KICB9KTsKCiAgcmV0dXJuIGF0dHJpYnV0ZXM7Cn07CgpFbGVtZW50U2VyaWFsaXplci5wcm90b3R5cGUucGFyc2VHZW5lcmljQXR0cmlidXRlcyA9IGZ1bmN0aW9uKGVsZW1lbnQsIGF0dHJpYnV0ZXMpIHsKCiAgdmFyIHNlbGYgPSB0aGlzOwoKICBfLmZvckVhY2goYXR0cmlidXRlcywgZnVuY3Rpb24oYXR0cikgewogICAgdHJ5IHsKICAgICAgc2VsZi5hZGRBdHRyaWJ1dGUoc2VsZi5uc0F0dHJpYnV0ZU5hbWUoYXR0ci5uYW1lKSwgYXR0ci52YWx1ZSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGNvbnNvbGUud2FybignW3dyaXRlcl0gbWlzc2luZyBuYW1lc3BhY2UgaW5mb3JtYXRpb24gZm9yICcsIGF0dHIubmFtZSwgJz0nLCBhdHRyLnZhbHVlLCAnb24nLCBlbGVtZW50LCBlKTsKICAgIH0KICB9KTsKfTsKCkVsZW1lbnRTZXJpYWxpemVyLnByb3RvdHlwZS5wYXJzZUNvbnRhaW5tZW50cyA9IGZ1bmN0aW9uKHByb3BlcnRpZXMpIHsKCiAgdmFyIHNlbGYgPSB0aGlzLAogICAgICBib2R5ID0gdGhpcy5ib2R5LAogICAgICBlbGVtZW50ID0gdGhpcy5lbGVtZW50LAogICAgICB0eXBlRGVzYyA9IGVsZW1lbnQuJGRlc2NyaXB0b3I7CgogIF8uZm9yRWFjaChwcm9wZXJ0aWVzLCBmdW5jdGlvbihwKSB7CiAgICB2YXIgdmFsdWUgPSBlbGVtZW50LmdldChwLm5hbWUpLAogICAgICAgIGlzUmVmZXJlbmNlID0gcC5pc1JlZmVyZW5jZSwKICAgICAgICBpc01hbnkgPSBwLmlzTWFueTsKCiAgICB2YXIgbnMgPSBzZWxmLm5zUHJvcGVydHlUYWdOYW1lKHApOwoKICAgIGlmICghaXNNYW55KSB7CiAgICAgIHZhbHVlID0gWyB2YWx1ZSBdOwogICAgfQoKICAgIGlmIChwLmlzQm9keSkgewogICAgICBib2R5LnB1c2gobmV3IEJvZHlTZXJpYWxpemVyKCkuYnVpbGQocCwgdmFsdWVbMF0pKTsKICAgIH0gZWxzZQogICAgaWYgKFR5cGVzLmlzU2ltcGxlKHAudHlwZSkpIHsKICAgICAgXy5mb3JFYWNoKHZhbHVlLCBmdW5jdGlvbih2KSB7CiAgICAgICAgYm9keS5wdXNoKG5ldyBWYWx1ZVNlcmlhbGl6ZXIobnMpLmJ1aWxkKHAsIHYpKTsKICAgICAgfSk7CiAgICB9IGVsc2UKICAgIGlmIChpc1JlZmVyZW5jZSkgewogICAgICBfLmZvckVhY2godmFsdWUsIGZ1bmN0aW9uKHYpIHsKICAgICAgICBib2R5LnB1c2gobmV3IFJlZmVyZW5jZVNlcmlhbGl6ZXIoc2VsZiwgbnMpLmJ1aWxkKHYpKTsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAvLyBhbGxvdyBzZXJpYWxpemF0aW9uIHZpYSB0eXBlCiAgICAgIC8vIHJhdGhlciB0aGFuIGVsZW1lbnQgbmFtZQogICAgICB2YXIgYXNUeXBlID0gcC5zZXJpYWxpemUgPT09ICd4c2k6dHlwZSc7CgogICAgICBfLmZvckVhY2godmFsdWUsIGZ1bmN0aW9uKHYpIHsKICAgICAgICB2YXIgc2VyaWFsaXplcjsKCiAgICAgICAgaWYgKGFzVHlwZSkgewogICAgICAgICAgc2VyaWFsaXplciA9IG5ldyBUeXBlU2VyaWFsaXplcihzZWxmLCBucyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNlcmlhbGl6ZXIgPSBuZXcgRWxlbWVudFNlcmlhbGl6ZXIoc2VsZik7CiAgICAgICAgfQoKICAgICAgICBib2R5LnB1c2goc2VyaWFsaXplci5idWlsZCh2KSk7CiAgICAgIH0pOwogICAgfQogIH0pOwp9OwoKRWxlbWVudFNlcmlhbGl6ZXIucHJvdG90eXBlLmdldE5hbWVzcGFjZXMgPSBmdW5jdGlvbigpIHsKICBpZiAoIXRoaXMucGFyZW50KSB7CiAgICBpZiAoIXRoaXMubmFtZXNwYWNlcykgewogICAgICB0aGlzLm5hbWVzcGFjZXMgPSB7CiAgICAgICAgcHJlZml4TWFwOiB7fSwKICAgICAgICB1cmlNYXA6IHt9LAogICAgICAgIHVzZWQ6IHt9CiAgICAgIH07CiAgICB9CiAgfSBlbHNlIHsKICAgIHRoaXMubmFtZXNwYWNlcyA9IHRoaXMucGFyZW50LmdldE5hbWVzcGFjZXMoKTsKICB9CgogIHJldHVybiB0aGlzLm5hbWVzcGFjZXM7Cn07CgpFbGVtZW50U2VyaWFsaXplci5wcm90b3R5cGUubG9nTmFtZXNwYWNlID0gZnVuY3Rpb24obnMpIHsKICB2YXIgbmFtZXNwYWNlcyA9IHRoaXMuZ2V0TmFtZXNwYWNlcygpOwoKICB2YXIgZXhpc3RpbmcgPSBuYW1lc3BhY2VzLnVyaU1hcFtucy51cmldOwoKICBpZiAoIWV4aXN0aW5nKSB7CiAgICBuYW1lc3BhY2VzLnVyaU1hcFtucy51cmldID0gbnM7CiAgfQoKICBuYW1lc3BhY2VzLnByZWZpeE1hcFtucy5wcmVmaXhdID0gbnMudXJpOwoKICByZXR1cm4gbnM7Cn07CgpFbGVtZW50U2VyaWFsaXplci5wcm90b3R5cGUubG9nTmFtZXNwYWNlVXNlZCA9IGZ1bmN0aW9uKG5zKSB7CiAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsCiAgICAgIG1vZGVsID0gZWxlbWVudC4kbW9kZWwsCiAgICAgIG5hbWVzcGFjZXMgPSB0aGlzLmdldE5hbWVzcGFjZXMoKTsKCiAgLy8gbnMgbWF5IGJlCiAgLy8KICAvLyAgICogcHJlZml4IG9ubHkKICAvLyAgICogcHJlZml4OnVyaQoKICB2YXIgcHJlZml4ID0gbnMucHJlZml4OwogIHZhciB1cmkgPSBucy51cmkgfHwgREVGQVVMVF9OU19NQVBbcHJlZml4XSB8fAogICAgICAgICAgICBuYW1lc3BhY2VzLnByZWZpeE1hcFtwcmVmaXhdIHx8IChtb2RlbCA/IChtb2RlbC5nZXRQYWNrYWdlKHByZWZpeCkgfHwge30pLnVyaSA6IG51bGwpOwoKICBpZiAoIXVyaSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdubyBuYW1lc3BhY2UgdXJpIGdpdmVuIGZvciBwcmVmaXggPCcgKyBucy5wcmVmaXggKyAnPicpOwogIH0KCiAgbnMgPSBuYW1lc3BhY2VzLnVyaU1hcFt1cmldOwoKICBpZiAoIW5zKSB7CiAgICBucyA9IHRoaXMubG9nTmFtZXNwYWNlKHsgcHJlZml4OiBwcmVmaXgsIHVyaTogdXJpIH0pOwogIH0KCiAgaWYgKCFuYW1lc3BhY2VzLnVzZWRbbnMudXJpXSkgewogICAgbmFtZXNwYWNlcy51c2VkW25zLnVyaV0gPSBuczsKICB9CgogIHJldHVybiBuczsKfTsKCkVsZW1lbnRTZXJpYWxpemVyLnByb3RvdHlwZS5wYXJzZUF0dHJpYnV0ZXMgPSBmdW5jdGlvbihwcm9wZXJ0aWVzKSB7CiAgdmFyIHNlbGYgPSB0aGlzLAogICAgICBlbGVtZW50ID0gdGhpcy5lbGVtZW50OwoKICBfLmZvckVhY2gocHJvcGVydGllcywgZnVuY3Rpb24ocCkgewogICAgc2VsZi5sb2dOYW1lc3BhY2VVc2VkKHAubnMpOwoKICAgIHZhciB2YWx1ZSA9IGVsZW1lbnQuZ2V0KHAubmFtZSk7CgogICAgaWYgKHAuaXNSZWZlcmVuY2UpIHsKICAgICAgdmFsdWUgPSB2YWx1ZS5pZDsKICAgIH0KCiAgICBzZWxmLmFkZEF0dHJpYnV0ZShzZWxmLm5zQXR0cmlidXRlTmFtZShwKSwgdmFsdWUpOwogIH0pOwp9OwoKRWxlbWVudFNlcmlhbGl6ZXIucHJvdG90eXBlLmFkZEF0dHJpYnV0ZSA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgdmFyIGF0dHJzID0gdGhpcy5hdHRyczsKCiAgaWYgKF8uaXNTdHJpbmcodmFsdWUpKSB7CiAgICB2YWx1ZSA9IGVzY2FwZUF0dHIodmFsdWUpOwogIH0KCiAgYXR0cnMucHVzaCh7IG5hbWU6IG5hbWUsIHZhbHVlOiB2YWx1ZSB9KTsKfTsKCkVsZW1lbnRTZXJpYWxpemVyLnByb3RvdHlwZS5zZXJpYWxpemVBdHRyaWJ1dGVzID0gZnVuY3Rpb24od3JpdGVyKSB7CiAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsCiAgICAgIGF0dHJzID0gdGhpcy5hdHRycywKICAgICAgcm9vdCA9ICF0aGlzLnBhcmVudCwKICAgICAgbmFtZXNwYWNlcyA9IHRoaXMubmFtZXNwYWNlczsKCiAgZnVuY3Rpb24gY29sbGVjdE5zQXR0cnMoKSB7CiAgICByZXR1cm4gXy5jb2xsZWN0KG5hbWVzcGFjZXMudXNlZCwgZnVuY3Rpb24obnMpIHsKICAgICAgdmFyIG5hbWUgPSAneG1sbnMnICsgKG5zLnByZWZpeCA/ICc6JyArIG5zLnByZWZpeCA6ICcnKTsKICAgICAgcmV0dXJuIHsgbmFtZTogbmFtZSwgdmFsdWU6IG5zLnVyaSB9OwogICAgfSk7CiAgfQoKICBpZiAocm9vdCkgewogICAgYXR0cnMgPSBjb2xsZWN0TnNBdHRycygpLmNvbmNhdChhdHRycyk7CiAgfQoKICBfLmZvckVhY2goYXR0cnMsIGZ1bmN0aW9uKGEpIHsKICAgIHdyaXRlcgogICAgICAuYXBwZW5kKCcgJykKICAgICAgLmFwcGVuZChuc05hbWUoYS5uYW1lKSkuYXBwZW5kKCc9IicpLmFwcGVuZChhLnZhbHVlKS5hcHBlbmQoJyInKTsKICB9KTsKfTsKCkVsZW1lbnRTZXJpYWxpemVyLnByb3RvdHlwZS5zZXJpYWxpemVUbyA9IGZ1bmN0aW9uKHdyaXRlcikgewogIHZhciBoYXNCb2R5ID0gdGhpcy5ib2R5Lmxlbmd0aDsKCiAgd3JpdGVyCiAgICAuYXBwZW5kSW5kZW50KCkKICAgIC5hcHBlbmQoJzwnICsgbnNOYW1lKHRoaXMubnMpKTsKCiAgdGhpcy5zZXJpYWxpemVBdHRyaWJ1dGVzKHdyaXRlcik7CgogIHdyaXRlcgogICAgLmFwcGVuZChoYXNCb2R5ID8gJz4nIDogJyAvPicpCiAgICAuYXBwZW5kTmV3TGluZSgpOwoKICB3cml0ZXIuaW5kZW50KCk7CgogIF8uZm9yRWFjaCh0aGlzLmJvZHksIGZ1bmN0aW9uKGIpIHsKICAgIGIuc2VyaWFsaXplVG8od3JpdGVyKTsKICB9KTsKCiAgd3JpdGVyLnVuaW5kZW50KCk7CgogIGlmIChoYXNCb2R5KSB7CiAgICB3cml0ZXIKICAgICAgLmFwcGVuZEluZGVudCgpCiAgICAgIC5hcHBlbmQoJzwvJyArIG5zTmFtZSh0aGlzLm5zKSArICc+JykKICAgICAgLmFwcGVuZE5ld0xpbmUoKTsKICB9Cn07CgovKioKICogQSBzZXJpYWxpemVyIGZvciB0eXBlcyB0aGF0IGhhbmRsZXMgc2VyaWFsaXphdGlvbiBvZiBkYXRhIHR5cGVzCiAqLwpmdW5jdGlvbiBUeXBlU2VyaWFsaXplcihwYXJlbnQsIG5zKSB7CiAgRWxlbWVudFNlcmlhbGl6ZXIuY2FsbCh0aGlzLCBwYXJlbnQsIG5zKTsKfQoKVHlwZVNlcmlhbGl6ZXIucHJvdG90eXBlID0gbmV3IEVsZW1lbnRTZXJpYWxpemVyKCk7CgpUeXBlU2VyaWFsaXplci5wcm90b3R5cGUuYnVpbGQgPSBmdW5jdGlvbihlbGVtZW50KSB7CiAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDsKICB0aGlzLnR5cGVOcyA9IHRoaXMubnNUYWdOYW1lKGVsZW1lbnQuJGRlc2NyaXB0b3IpOwoKICByZXR1cm4gRWxlbWVudFNlcmlhbGl6ZXIucHJvdG90eXBlLmJ1aWxkLmNhbGwodGhpcywgZWxlbWVudCk7Cn07CgpUeXBlU2VyaWFsaXplci5wcm90b3R5cGUuaXNMb2NhbE5zID0gZnVuY3Rpb24obnMpIHsKICByZXR1cm4gbnMudXJpID09PSB0aGlzLnR5cGVOcy51cmk7Cn07CgpmdW5jdGlvbiBTYXZpbmdXcml0ZXIoKSB7CiAgdGhpcy52YWx1ZSA9ICcnOwoKICB0aGlzLndyaXRlID0gZnVuY3Rpb24oc3RyKSB7CiAgICB0aGlzLnZhbHVlICs9IHN0cjsKICB9Owp9CgpmdW5jdGlvbiBGb3JtYXRpbmdXcml0ZXIob3V0LCBmb3JtYXQpIHsKCiAgdmFyIGluZGVudCA9IFsnJ107CgogIHRoaXMuYXBwZW5kID0gZnVuY3Rpb24oc3RyKSB7CiAgICBvdXQud3JpdGUoc3RyKTsKCiAgICByZXR1cm4gdGhpczsKICB9OwoKICB0aGlzLmFwcGVuZE5ld0xpbmUgPSBmdW5jdGlvbigpIHsKICAgIGlmIChmb3JtYXQpIHsKICAgICAgb3V0LndyaXRlKCdcbicpOwogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH07CgogIHRoaXMuYXBwZW5kSW5kZW50ID0gZnVuY3Rpb24oKSB7CiAgICBpZiAoZm9ybWF0KSB7CiAgICAgIG91dC53cml0ZShpbmRlbnQuam9pbignICAnKSk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgdGhpcy5pbmRlbnQgPSBmdW5jdGlvbigpIHsKICAgIGluZGVudC5wdXNoKCcnKTsKICAgIHJldHVybiB0aGlzOwogIH07CgogIHRoaXMudW5pbmRlbnQgPSBmdW5jdGlvbigpIHsKICAgIGluZGVudC5wb3AoKTsKICAgIHJldHVybiB0aGlzOwogIH07Cn0KCi8qKgogKiBBIHdyaXRlciBmb3IgbWV0YS1tb2RlbCBiYWNrZWQgZG9jdW1lbnQgdHJlZXMKICoKICogQGNsYXNzIFhNTFdyaXRlcgogKi8KZnVuY3Rpb24gWE1MV3JpdGVyKG9wdGlvbnMpIHsKCiAgb3B0aW9ucyA9IF8uZXh0ZW5kKHsgZm9ybWF0OiBmYWxzZSwgcHJlYW1ibGU6IHRydWUgfSwgb3B0aW9ucyB8fCB7fSk7CgogIGZ1bmN0aW9uIHRvWE1MKHRyZWUsIHdyaXRlcikgewogICAgdmFyIGludGVybmFsV3JpdGVyID0gd3JpdGVyIHx8IG5ldyBTYXZpbmdXcml0ZXIoKTsKICAgIHZhciBmb3JtYXRpbmdXcml0ZXIgPSBuZXcgRm9ybWF0aW5nV3JpdGVyKGludGVybmFsV3JpdGVyLCBvcHRpb25zLmZvcm1hdCk7CgogICAgaWYgKG9wdGlvbnMucHJlYW1ibGUpIHsKICAgICAgZm9ybWF0aW5nV3JpdGVyLmFwcGVuZChYTUxfUFJFQU1CTEUpOwogICAgfQoKICAgIG5ldyBFbGVtZW50U2VyaWFsaXplcigpLmJ1aWxkKHRyZWUpLnNlcmlhbGl6ZVRvKGZvcm1hdGluZ1dyaXRlcik7CgogICAgaWYgKCF3cml0ZXIpIHsKICAgICAgcmV0dXJuIGludGVybmFsV3JpdGVyLnZhbHVlOwogICAgfQogIH0KCiAgcmV0dXJuIHsKICAgIHRvWE1MOiB0b1hNTAogIH07Cn0KCm1vZHVsZS5leHBvcnRzID0gWE1MV3JpdGVyOwp9LHsiLi9jb21tb24iOjE3LCJtb2RkbGUiOjE4fV0sMTc6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgoKZnVuY3Rpb24gY2FwaXRhbGl6ZShzdHJpbmcpIHsKICByZXR1cm4gc3RyaW5nLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgc3RyaW5nLnNsaWNlKDEpOwp9CgpmdW5jdGlvbiBsb3dlcihzdHJpbmcpIHsKICByZXR1cm4gc3RyaW5nLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICsgc3RyaW5nLnNsaWNlKDEpOwp9CgpmdW5jdGlvbiBoYXNMb3dlckNhc2VBbGlhcyhwa2cpIHsKICByZXR1cm4gcGtnLnhtbCAmJiBwa2cueG1sLmFsaWFzID09PSAnbG93ZXJDYXNlJzsKfQoKCm1vZHVsZS5leHBvcnRzLmFsaWFzVG9OYW1lID0gZnVuY3Rpb24oYWxpYXMsIHBrZykgewogIGlmIChoYXNMb3dlckNhc2VBbGlhcyhwa2cpKSB7CiAgICByZXR1cm4gY2FwaXRhbGl6ZShhbGlhcyk7CiAgfSBlbHNlIHsKICAgIHJldHVybiBhbGlhczsKICB9Cn07Cgptb2R1bGUuZXhwb3J0cy5uYW1lVG9BbGlhcyA9IGZ1bmN0aW9uKG5hbWUsIHBrZykgewogIGlmIChoYXNMb3dlckNhc2VBbGlhcyhwa2cpKSB7CiAgICByZXR1cm4gbG93ZXIobmFtZSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiBuYW1lOwogIH0KfTsKCm1vZHVsZS5leHBvcnRzLkRFRkFVTFRfTlNfTUFQID0gewogICd4c2knOiAnaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UnCn07Cn0se31dLDE4OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKbW9kdWxlLmV4cG9ydHMgPSBfZGVyZXFfKCcuL2xpYi9tb2RkbGUnKTsKCm1vZHVsZS5leHBvcnRzLnR5cGVzID0gX2RlcmVxXygnLi9saWIvdHlwZXMnKTsKCm1vZHVsZS5leHBvcnRzLm5zID0gX2RlcmVxXygnLi9saWIvbnMnKTsKfSx7Ii4vbGliL21vZGRsZSI6MjIsIi4vbGliL25zIjoyMywiLi9saWIvdHlwZXMiOjI2fV0sMTk6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgpmdW5jdGlvbiBCYXNlKCkgeyB9CgpCYXNlLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihuYW1lKSB7CiAgcmV0dXJuIHRoaXMuJG1vZGVsLnByb3BlcnRpZXMuZ2V0KHRoaXMsIG5hbWUpOwp9OwoKQmFzZS5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKICB0aGlzLiRtb2RlbC5wcm9wZXJ0aWVzLnNldCh0aGlzLCBuYW1lLCB2YWx1ZSk7Cn07CgoKbW9kdWxlLmV4cG9ydHMgPSBCYXNlOwp9LHt9XSwyMDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBfID0gKHdpbmRvdy5fKTsKCnZhciBwYXJzZU5hbWVOcyA9IF9kZXJlcV8oJy4vbnMnKS5wYXJzZU5hbWU7CgoKZnVuY3Rpb24gRGVzY3JpcHRvckJ1aWxkZXIobmFtZU5zKSB7CiAgdGhpcy5ucyA9IG5hbWVOczsKICB0aGlzLm5hbWUgPSBuYW1lTnMubmFtZTsKICB0aGlzLmFsbFR5cGVzID0gW107CiAgdGhpcy5wcm9wZXJ0aWVzID0gW107CiAgdGhpcy5wcm9wZXJ0aWVzQnlOYW1lID0ge307Cn0KCm1vZHVsZS5leHBvcnRzID0gRGVzY3JpcHRvckJ1aWxkZXI7CgoKRGVzY3JpcHRvckJ1aWxkZXIucHJvdG90eXBlLmJ1aWxkID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIF8ucGljayh0aGlzLCBbICducycsICduYW1lJywgJ2FsbFR5cGVzJywgJ3Byb3BlcnRpZXMnLCAncHJvcGVydGllc0J5TmFtZScsICdib2R5UHJvcGVydHknIF0pOwp9OwoKRGVzY3JpcHRvckJ1aWxkZXIucHJvdG90eXBlLmFkZFByb3BlcnR5ID0gZnVuY3Rpb24ocCwgaWR4KSB7CiAgdGhpcy5hZGROYW1lZFByb3BlcnR5KHAsIHRydWUpOwoKICB2YXIgcHJvcGVydGllcyA9IHRoaXMucHJvcGVydGllczsKCiAgaWYgKGlkeCAhPT0gdW5kZWZpbmVkKSB7CiAgICBwcm9wZXJ0aWVzLnNwbGljZShpZHgsIDAsIHApOwogIH0gZWxzZSB7CiAgICBwcm9wZXJ0aWVzLnB1c2gocCk7CiAgfQp9OwoKCkRlc2NyaXB0b3JCdWlsZGVyLnByb3RvdHlwZS5yZXBsYWNlUHJvcGVydHkgPSBmdW5jdGlvbihvbGRQcm9wZXJ0eSwgbmV3UHJvcGVydHkpIHsKICB2YXIgb2xkTmFtZU5zID0gb2xkUHJvcGVydHkubnM7CgogIHZhciBwcm9wcyA9IHRoaXMucHJvcGVydGllcywKICAgICAgcHJvcGVydGllc0J5TmFtZSA9IHRoaXMucHJvcGVydGllc0J5TmFtZTsKCiAgaWYgKG9sZFByb3BlcnR5LmlzQm9keSkgewoKICAgIGlmICghbmV3UHJvcGVydHkuaXNCb2R5KSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAncHJvcGVydHkgPCcgKyBuZXdQcm9wZXJ0eS5ucy5uYW1lICsgJz4gbXVzdCBiZSBib2R5IHByb3BlcnR5ICcgKwogICAgICAgICd0byByZWZpbmUgPCcgKyBvbGRQcm9wZXJ0eS5ucy5uYW1lICsgJz4nKTsKICAgIH0KCiAgICAvLyBUT0RPOiBDaGVjayBjb21wYXRpYmlsaXR5CiAgICB0aGlzLnNldEJvZHlQcm9wZXJ0eShuZXdQcm9wZXJ0eSwgZmFsc2UpOwogIH0KCiAgdGhpcy5hZGROYW1lZFByb3BlcnR5KG5ld1Byb3BlcnR5LCB0cnVlKTsKCiAgLy8gcmVwbGFjZSBvbGQgcHJvcGVydHkgYXQgaW5kZXggd2l0aCBuZXcgb25lCiAgdmFyIGlkeCA9IHByb3BzLmluZGV4T2Yob2xkUHJvcGVydHkpOwogIGlmIChpZHggPT09IC0xKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb3BlcnR5IDwnICsgb2xkTmFtZU5zLm5hbWUgKyAnPiBub3QgZm91bmQgaW4gcHJvcGVydHkgbGlzdCcpOwogIH0KCiAgcHJvcHNbaWR4XSA9IG5ld1Byb3BlcnR5OwoKICAvLyByZXBsYWNlIHByb3BlcnRpZXNCeU5hbWUgZW50cnkgd2l0aCBuZXcgcHJvcGVydHkKICBwcm9wZXJ0aWVzQnlOYW1lW29sZE5hbWVOcy5uYW1lXSA9IHByb3BlcnRpZXNCeU5hbWVbb2xkTmFtZU5zLmxvY2FsTmFtZV0gPSBuZXdQcm9wZXJ0eTsKfTsKCgpEZXNjcmlwdG9yQnVpbGRlci5wcm90b3R5cGUucmVkZWZpbmVQcm9wZXJ0eSA9IGZ1bmN0aW9uKHApIHsKCiAgdmFyIG5zUHJlZml4ID0gcC5ucy5wcmVmaXg7CiAgdmFyIHBhcnRzID0gcC5yZWRlZmluZXMuc3BsaXQoJyMnKTsKCiAgdmFyIG5hbWUgPSBwYXJzZU5hbWVOcyhwYXJ0c1swXSwgbnNQcmVmaXgpOwogIHZhciBhdHRyTmFtZSA9IHBhcnNlTmFtZU5zKHBhcnRzWzFdLCBuYW1lLnByZWZpeCkubmFtZTsKCiAgdmFyIHJlZGVmaW5lZFByb3BlcnR5ID0gdGhpcy5wcm9wZXJ0aWVzQnlOYW1lW2F0dHJOYW1lXTsKICBpZiAoIXJlZGVmaW5lZFByb3BlcnR5KSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ3JlZmluZWQgcHJvcGVydHkgPCcgKyBhdHRyTmFtZSArICc+IG5vdCBmb3VuZCcpOwogIH0gZWxzZSB7CiAgICB0aGlzLnJlcGxhY2VQcm9wZXJ0eShyZWRlZmluZWRQcm9wZXJ0eSwgcCk7CiAgfQoKICBkZWxldGUgcC5yZWRlZmluZXM7Cn07CgpEZXNjcmlwdG9yQnVpbGRlci5wcm90b3R5cGUuYWRkTmFtZWRQcm9wZXJ0eSA9IGZ1bmN0aW9uKHAsIHZhbGlkYXRlKSB7CiAgdmFyIG5zID0gcC5ucywKICAgICAgcHJvcHNCeU5hbWUgPSB0aGlzLnByb3BlcnRpZXNCeU5hbWU7CgogIGlmICh2YWxpZGF0ZSkgewogICAgdGhpcy5hc3NlcnROb3REZWZpbmVkKHAsIG5zLm5hbWUpOwogICAgdGhpcy5hc3NlcnROb3REZWZpbmVkKHAsIG5zLmxvY2FsTmFtZSk7CiAgfQoKICBwcm9wc0J5TmFtZVtucy5uYW1lXSA9IHByb3BzQnlOYW1lW25zLmxvY2FsTmFtZV0gPSBwOwp9OwoKRGVzY3JpcHRvckJ1aWxkZXIucHJvdG90eXBlLnJlbW92ZU5hbWVkUHJvcGVydHkgPSBmdW5jdGlvbihwKSB7CiAgdmFyIG5zID0gcC5ucywKICAgICAgcHJvcHNCeU5hbWUgPSB0aGlzLnByb3BlcnRpZXNCeU5hbWU7CgogIGRlbGV0ZSBwcm9wc0J5TmFtZVtucy5uYW1lXTsKICBkZWxldGUgcHJvcHNCeU5hbWVbbnMubG9jYWxOYW1lXTsKfTsKCkRlc2NyaXB0b3JCdWlsZGVyLnByb3RvdHlwZS5zZXRCb2R5UHJvcGVydHkgPSBmdW5jdGlvbihwLCB2YWxpZGF0ZSkgewoKICBpZiAodmFsaWRhdGUgJiYgdGhpcy5ib2R5UHJvcGVydHkpIHsKICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgJ2JvZHkgcHJvcGVydHkgZGVmaW5lZCBtdWx0aXBsZSB0aW1lcyAnICsKICAgICAgJyg8JyArIHRoaXMuYm9keVByb3BlcnR5Lm5zLm5hbWUgKyAnPiwgPCcgKyBwLm5zLm5hbWUgKyAnPiknKTsKICB9CgogIHRoaXMuYm9keVByb3BlcnR5ID0gcDsKfTsKCkRlc2NyaXB0b3JCdWlsZGVyLnByb3RvdHlwZS5hZGRJZFByb3BlcnR5ID0gZnVuY3Rpb24obmFtZSkgewogIHZhciBuYW1lTnMgPSBwYXJzZU5hbWVOcyhuYW1lLCB0aGlzLm5zLnByZWZpeCk7CgogIHZhciBwID0gewogICAgbmFtZTogbmFtZU5zLmxvY2FsTmFtZSwKICAgIHR5cGU6ICdTdHJpbmcnLAogICAgaXNBdHRyOiB0cnVlLAogICAgbnM6IG5hbWVOcwogIH07CgogIC8vIGVuc3VyZSB0aGF0IGlkIGlzIGFsd2F5cyB0aGUgZmlyc3QgYXR0cmlidXRlIChpZiBwcmVzZW50KQogIHRoaXMuYWRkUHJvcGVydHkocCwgMCk7Cn07CgpEZXNjcmlwdG9yQnVpbGRlci5wcm90b3R5cGUuYXNzZXJ0Tm90RGVmaW5lZCA9IGZ1bmN0aW9uKHAsIG5hbWUpIHsKICB2YXIgcHJvcGVydHlOYW1lID0gcC5uYW1lLAogICAgICBkZWZpbmVkUHJvcGVydHkgPSB0aGlzLnByb3BlcnRpZXNCeU5hbWVbcHJvcGVydHlOYW1lXTsKCiAgaWYgKGRlZmluZWRQcm9wZXJ0eSkgewogICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAncHJvcGVydHkgPCcgKyBwcm9wZXJ0eU5hbWUgKyAnPiBhbHJlYWR5IGRlZmluZWQ7ICcgKwogICAgICAnb3ZlcnJpZGUgb2YgPCcgKyBkZWZpbmVkUHJvcGVydHkuZGVmaW5lZEJ5Lm5zLm5hbWUgKyAnIycgKyBkZWZpbmVkUHJvcGVydHkubnMubmFtZSArICc+IGJ5ICcgKwogICAgICAnPCcgKyBwLmRlZmluZWRCeS5ucy5uYW1lICsgJyMnICsgcC5ucy5uYW1lICsgJz4gbm90IGFsbG93ZWQgd2l0aG91dCByZWRlZmluZXMnKTsKICB9Cn07CgpEZXNjcmlwdG9yQnVpbGRlci5wcm90b3R5cGUuaGFzUHJvcGVydHkgPSBmdW5jdGlvbihuYW1lKSB7CiAgcmV0dXJuIHRoaXMucHJvcGVydGllc0J5TmFtZVtuYW1lXTsKfTsKCkRlc2NyaXB0b3JCdWlsZGVyLnByb3RvdHlwZS5hZGRUcmFpdCA9IGZ1bmN0aW9uKHQpIHsKCiAgdmFyIGFsbFR5cGVzID0gdGhpcy5hbGxUeXBlczsKCiAgaWYgKGFsbFR5cGVzLmluZGV4T2YodCkgIT09IC0xKSB7CiAgICByZXR1cm47CiAgfQoKICBfLmZvckVhY2godC5wcm9wZXJ0aWVzLCBmdW5jdGlvbihwKSB7CgogICAgLy8gY2xvbmUgcHJvcGVydHkgdG8gYWxsb3cgZXh0ZW5zaW9ucwogICAgcCA9IF8uZXh0ZW5kKHt9LCBwLCB7CiAgICAgIG5hbWU6IHAubnMubG9jYWxOYW1lCiAgICB9KTsKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocCwgJ2RlZmluZWRCeScsIHsKICAgICAgdmFsdWU6IHQKICAgIH0pOwoKICAgIC8vIGFkZCByZWRlZmluZSBzdXBwb3J0CiAgICBpZiAocC5yZWRlZmluZXMpIHsKICAgICAgdGhpcy5yZWRlZmluZVByb3BlcnR5KHApOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHAuaXNCb2R5KSB7CiAgICAgICAgdGhpcy5zZXRCb2R5UHJvcGVydHkocCk7CiAgICAgIH0KICAgICAgdGhpcy5hZGRQcm9wZXJ0eShwKTsKICAgIH0KICB9LCB0aGlzKTsKCiAgYWxsVHlwZXMucHVzaCh0KTsKfTsKCn0seyIuL25zIjoyM31dLDIxOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF8gPSAod2luZG93Ll8pOwoKdmFyIEJhc2UgPSBfZGVyZXFfKCcuL2Jhc2UnKTsKCgpmdW5jdGlvbiBGYWN0b3J5KG1vZGVsLCBwcm9wZXJ0aWVzKSB7CiAgdGhpcy5tb2RlbCA9IG1vZGVsOwogIHRoaXMucHJvcGVydGllcyA9IHByb3BlcnRpZXM7Cn0KCm1vZHVsZS5leHBvcnRzID0gRmFjdG9yeTsKCgpGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGVUeXBlID0gZnVuY3Rpb24oZGVzY3JpcHRvcikgewoKICB2YXIgbW9kZWwgPSB0aGlzLm1vZGVsOwoKICB2YXIgcHJvcHMgPSB0aGlzLnByb3BlcnRpZXMsCiAgICAgIHByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQmFzZS5wcm90b3R5cGUpOwoKICAvLyBpbml0aWFsaXplIGRlZmF1bHQgdmFsdWVzCiAgXy5mb3JFYWNoKGRlc2NyaXB0b3IucHJvcGVydGllcywgZnVuY3Rpb24ocCkgewogICAgaWYgKCFwLmlzTWFueSAmJiBwLmRlZmF1bHQgIT09IHVuZGVmaW5lZCkgewogICAgICBwcm90b3R5cGVbcC5uYW1lXSA9IHAuZGVmYXVsdDsKICAgIH0KICB9KTsKCiAgcHJvcHMuZGVmaW5lTW9kZWwocHJvdG90eXBlLCBtb2RlbCk7CiAgcHJvcHMuZGVmaW5lRGVzY3JpcHRvcihwcm90b3R5cGUsIGRlc2NyaXB0b3IpOwoKICB2YXIgbmFtZSA9IGRlc2NyaXB0b3IubnMubmFtZTsKCiAgLyoqCiAgICogVGhlIG5ldyB0eXBlIGNvbnN0cnVjdG9yCiAgICovCiAgZnVuY3Rpb24gTW9kZGxlRWxlbWVudChhdHRycykgewogICAgcHJvcHMuZGVmaW5lKHRoaXMsICckdHlwZScsIHsgdmFsdWU6IG5hbWUsIGVudW1lcmFibGU6IHRydWUgfSk7CiAgICBwcm9wcy5kZWZpbmUodGhpcywgJyRhdHRycycsIHsgdmFsdWU6IHt9IH0pOwogICAgcHJvcHMuZGVmaW5lKHRoaXMsICckcGFyZW50JywgeyB3cml0YWJsZTogdHJ1ZSB9KTsKCiAgICBfLmZvckVhY2goYXR0cnMsIGZ1bmN0aW9uKHZhbCwga2V5KSB7CiAgICAgIHRoaXMuc2V0KGtleSwgdmFsKTsKICAgIH0sIHRoaXMpOwogIH0KCiAgTW9kZGxlRWxlbWVudC5wcm90b3R5cGUgPSBwcm90b3R5cGU7CgogIE1vZGRsZUVsZW1lbnQuaGFzVHlwZSA9IHByb3RvdHlwZS4kaW5zdGFuY2VPZiA9IHRoaXMubW9kZWwuaGFzVHlwZTsKCiAgLy8gc3RhdGljIGxpbmtzCiAgcHJvcHMuZGVmaW5lTW9kZWwoTW9kZGxlRWxlbWVudCwgbW9kZWwpOwogIHByb3BzLmRlZmluZURlc2NyaXB0b3IoTW9kZGxlRWxlbWVudCwgZGVzY3JpcHRvcik7CgogIHJldHVybiBNb2RkbGVFbGVtZW50Owp9Owp9LHsiLi9iYXNlIjoxOX1dLDIyOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF8gPSAod2luZG93Ll8pOwoKdmFyIFR5cGVzID0gX2RlcmVxXygnLi90eXBlcycpLAogICAgRmFjdG9yeSA9IF9kZXJlcV8oJy4vZmFjdG9yeScpLAogICAgUmVnaXN0cnkgPSBfZGVyZXFfKCcuL3JlZ2lzdHJ5JyksCiAgICBQcm9wZXJ0aWVzID0gX2RlcmVxXygnLi9wcm9wZXJ0aWVzJyk7Cgp2YXIgcGFyc2VOYW1lTnMgPSBfZGVyZXFfKCcuL25zJykucGFyc2VOYW1lOwoKCi8vLy8gTW9kZGxlIGltcGxlbWVudGF0aW9uIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCi8qKgogKiBAY2xhc3MgTW9kZGxlCiAqCiAqIEEgbW9kZWwgdGhhdCBjYW4gYmUgdXNlZCB0byBjcmVhdGUgZWxlbWVudHMgb2YgYSBzcGVjaWZpYyB0eXBlLgogKgogKiBAZXhhbXBsZQogKgogKiB2YXIgTW9kZGxlID0gcmVxdWlyZSgnbW9kZGxlJyk7CiAqCiAqIHZhciBwa2cgPSB7CiAqICAgbmFtZTogJ215cGFja2FnZScsCiAqICAgcHJlZml4OiAnbXknLAogKiAgIHR5cGVzOiBbCiAqICAgICB7IG5hbWU6ICdSb290JyB9CiAqICAgXQogKiB9OwogKgogKiB2YXIgbW9kZGxlID0gbmV3IE1vZGRsZShbcGtnXSk7CiAqCiAqIEBwYXJhbSB7QXJyYXk8UGFja2FnZT59IHBhY2thZ2VzICB0aGUgcGFja2FnZXMgdG8gY29udGFpbgogKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgYWRkaXRpb25hbCBvcHRpb25zIHRvIHBhc3MgdG8gdGhlIG1vZGVsCiAqLwpmdW5jdGlvbiBNb2RkbGUocGFja2FnZXMsIG9wdGlvbnMpIHsKCiAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogIHRoaXMucHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKHRoaXMpOwoKICB0aGlzLmZhY3RvcnkgPSBuZXcgRmFjdG9yeSh0aGlzLCB0aGlzLnByb3BlcnRpZXMpOwogIHRoaXMucmVnaXN0cnkgPSBuZXcgUmVnaXN0cnkocGFja2FnZXMsIHRoaXMucHJvcGVydGllcywgb3B0aW9ucyk7CgogIHRoaXMudHlwZUNhY2hlID0ge307Cn0KCm1vZHVsZS5leHBvcnRzID0gTW9kZGxlOwoKCi8qKgogKiBDcmVhdGUgYW4gaW5zdGFuY2Ugb2YgdGhlIHNwZWNpZmllZCB0eXBlLgogKgogKiBAbWV0aG9kIE1vZGRsZSNjcmVhdGUKICoKICogQGV4YW1wbGUKICoKICogdmFyIGZvbyA9IG1vZGRsZS5jcmVhdGUoJ215OkZvbycpOwogKiB2YXIgYmFyID0gbW9kZGxlLmNyZWF0ZSgnbXk6QmFyJywgeyBpZDogJ0JBUl8xJyB9KTsKICoKICogQHBhcmFtICB7U3RyaW5nfE9iamVjdH0gZGVzY3JpcHRvciB0aGUgdHlwZSBkZXNjcmlwdG9yIG9yIG5hbWUga25vdyB0byB0aGUgbW9kZWwKICogQHBhcmFtICB7T2JqZWN0fSBhdHRycyAgIGEgbnVtYmVyIG9mIGF0dHJpYnV0ZXMgdG8gaW5pdGlhbGl6ZSB0aGUgbW9kZWwgaW5zdGFuY2Ugd2l0aAogKiBAcmV0dXJuIHtPYmplY3R9ICAgICAgICAgbW9kZWwgaW5zdGFuY2UKICovCk1vZGRsZS5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24oZGVzY3JpcHRvciwgYXR0cnMpIHsKICB2YXIgVHlwZSA9IHRoaXMuZ2V0VHlwZShkZXNjcmlwdG9yKTsKCiAgaWYgKCFUeXBlKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ3Vua25vd24gdHlwZSA8JyArIGRlc2NyaXB0b3IgKyAnPicpOwogIH0KCiAgcmV0dXJuIG5ldyBUeXBlKGF0dHJzKTsKfTsKCgovKioKICogUmV0dXJucyB0aGUgdHlwZSByZXByZXNlbnRpbmcgYSBnaXZlbiBkZXNjcmlwdG9yCiAqCiAqIEBtZXRob2QgTW9kZGxlI2dldFR5cGUKICoKICogQGV4YW1wbGUKICoKICogdmFyIEZvbyA9IG1vZGRsZS5nZXRUeXBlKCdteTpGb28nKTsKICogdmFyIGZvbyA9IG5ldyBGb28oeyAnaWQnIDogJ0ZPT18xJyB9KTsKICoKICogQHBhcmFtICB7U3RyaW5nfE9iamVjdH0gZGVzY3JpcHRvciB0aGUgdHlwZSBkZXNjcmlwdG9yIG9yIG5hbWUga25vdyB0byB0aGUgbW9kZWwKICogQHJldHVybiB7T2JqZWN0fSAgICAgICAgIHRoZSB0eXBlIHJlcHJlc2VudGluZyB0aGUgZGVzY3JpcHRvcgogKi8KTW9kZGxlLnByb3RvdHlwZS5nZXRUeXBlID0gZnVuY3Rpb24oZGVzY3JpcHRvcikgewoKICB2YXIgY2FjaGUgPSB0aGlzLnR5cGVDYWNoZTsKCiAgdmFyIG5hbWUgPSBfLmlzU3RyaW5nKGRlc2NyaXB0b3IpID8gZGVzY3JpcHRvciA6IGRlc2NyaXB0b3IubnMubmFtZTsKCiAgdmFyIHR5cGUgPSBjYWNoZVtuYW1lXTsKCiAgaWYgKCF0eXBlKSB7CiAgICBkZXNjcmlwdG9yID0gdGhpcy5yZWdpc3RyeS5nZXRFZmZlY3RpdmVEZXNjcmlwdG9yKG5hbWUpOwogICAgdHlwZSA9IGNhY2hlW2Rlc2NyaXB0b3IubmFtZV0gPSB0aGlzLmZhY3RvcnkuY3JlYXRlVHlwZShkZXNjcmlwdG9yKTsKICB9CgogIHJldHVybiB0eXBlOwp9OwoKCi8qKgogKiBDcmVhdGVzIGFuIGFueS1lbGVtZW50IHR5cGUgdG8gYmUgdXNlZCB3aXRoaW4gbW9kZWwgaW5zdGFuY2VzLgogKgogKiBUaGlzIGNhbiBiZSB1c2VkIHRvIGNyZWF0ZSBjdXN0b20gZWxlbWVudHMgdGhhdCBsaWUgb3V0c2lkZSB0aGUgbWV0YS1tb2RlbC4KICogVGhlIGNyZWF0ZWQgZWxlbWVudCBjb250YWlucyBhbGwgdGhlIG1ldGEtZGF0YSByZXF1aXJlZCB0byBzZXJpYWxpemUgaXQKICogYXMgcGFydCBvZiBtZXRhLW1vZGVsIGVsZW1lbnRzLgogKgogKiBAbWV0aG9kIE1vZGRsZSNjcmVhdGVBbnkKICoKICogQGV4YW1wbGUKICoKICogdmFyIGZvbyA9IG1vZGRsZS5jcmVhdGVBbnkoJ3ZlbmRvcjpGb28nLCAnaHR0cDovL3ZlbmRvcicsIHsKICogICB2YWx1ZTogJ2JhcicKICogfSk7CiAqCiAqIHZhciBjb250YWluZXIgPSBtb2RkbGUuY3JlYXRlKCdteTpDb250YWluZXInLCAnaHR0cDovL215JywgewogKiAgIGFueTogWyBmb28gXQogKiB9KTsKICoKICogLy8gZ28gYWhlYWQgYW5kIHNlcmlhbGl6ZSB0aGUgc3R1ZmYKICoKICoKICogQHBhcmFtICB7U3RyaW5nfSBuYW1lICB0aGUgbmFtZSBvZiB0aGUgZWxlbWVudAogKiBAcGFyYW0gIHtTdHJpbmd9IG5zVXJpIHRoZSBuYW1lc3BhY2UgdXJpIG9mIHRoZSBlbGVtZW50CiAqIEBwYXJhbSAge09iamVjdH0gW3Byb3BlcnRpZXNdIGEgbWFwIG9mIHByb3BlcnRpZXMgdG8gaW5pdGlhbGl6ZSB0aGUgaW5zdGFuY2Ugd2l0aAogKiBAcmV0dXJuIHtPYmplY3R9IHRoZSBhbnkgdHlwZSBpbnN0YW5jZQogKi8KTW9kZGxlLnByb3RvdHlwZS5jcmVhdGVBbnkgPSBmdW5jdGlvbihuYW1lLCBuc1VyaSwgcHJvcGVydGllcykgewoKICB2YXIgbmFtZU5zID0gcGFyc2VOYW1lTnMobmFtZSk7CgogIHZhciBlbGVtZW50ID0gewogICAgJHR5cGU6IG5hbWUKICB9OwoKICB2YXIgZGVzY3JpcHRvciA9IHsKICAgIG5hbWU6IG5hbWUsCiAgICBpc0dlbmVyaWM6IHRydWUsCiAgICBuczogewogICAgICBwcmVmaXg6IG5hbWVOcy5wcmVmaXgsCiAgICAgIGxvY2FsTmFtZTogbmFtZU5zLmxvY2FsTmFtZSwKICAgICAgdXJpOiBuc1VyaQogICAgfQogIH07CgogIHRoaXMucHJvcGVydGllcy5kZWZpbmVEZXNjcmlwdG9yKGVsZW1lbnQsIGRlc2NyaXB0b3IpOwogIHRoaXMucHJvcGVydGllcy5kZWZpbmVNb2RlbChlbGVtZW50LCB0aGlzKTsKICB0aGlzLnByb3BlcnRpZXMuZGVmaW5lKGVsZW1lbnQsICckcGFyZW50JywgeyBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUgfSk7CgogIF8uZm9yRWFjaChwcm9wZXJ0aWVzLCBmdW5jdGlvbihhLCBrZXkpIHsKICAgIGlmIChfLmlzT2JqZWN0KGEpICYmIGEudmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICBlbGVtZW50W2EubmFtZV0gPSBhLnZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgZWxlbWVudFtrZXldID0gYTsKICAgIH0KICB9KTsKCiAgcmV0dXJuIGVsZW1lbnQ7Cn07CgovKioKICogUmV0dXJucyBhIHJlZ2lzdGVyZWQgcGFja2FnZSBieSB1cmkgb3IgcHJlZml4CiAqCiAqIEByZXR1cm4ge09iamVjdH0gdGhlIHBhY2thZ2UKICovCk1vZGRsZS5wcm90b3R5cGUuZ2V0UGFja2FnZSA9IGZ1bmN0aW9uKHVyaU9yUHJlZml4KSB7CiAgcmV0dXJuIHRoaXMucmVnaXN0cnkuZ2V0UGFja2FnZSh1cmlPclByZWZpeCk7Cn07CgovKioKICogUmV0dXJucyBhIHNuYXBzaG90IG9mIGFsbCBrbm93biBwYWNrYWdlcwogKgogKiBAcmV0dXJuIHtPYmplY3R9IHRoZSBwYWNrYWdlCiAqLwpNb2RkbGUucHJvdG90eXBlLmdldFBhY2thZ2VzID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMucmVnaXN0cnkuZ2V0UGFja2FnZXMoKTsKfTsKCi8qKgogKiBSZXR1cm5zIHRoZSBkZXNjcmlwdG9yIGZvciBhbiBlbGVtZW50CiAqLwpNb2RkbGUucHJvdG90eXBlLmdldEVsZW1lbnREZXNjcmlwdG9yID0gZnVuY3Rpb24oZWxlbWVudCkgewogIHJldHVybiBlbGVtZW50LiRkZXNjcmlwdG9yOwp9OwoKLyoqCiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gZGVzY3JpcHRvciBvciBpbnN0YW5jZQogKiByZXByZXNlbnRzIHRoZSBnaXZlbiB0eXBlLgogKgogKiBNYXkgYmUgYXBwbGllZCB0byB0aGlzLCBpZiBlbGVtZW50IGlzIG9taXR0ZWQuCiAqLwpNb2RkbGUucHJvdG90eXBlLmhhc1R5cGUgPSBmdW5jdGlvbihlbGVtZW50LCB0eXBlKSB7CiAgaWYgKHR5cGUgPT09IHVuZGVmaW5lZCkgewogICAgdHlwZSA9IGVsZW1lbnQ7CiAgICBlbGVtZW50ID0gdGhpczsKICB9CgogIHZhciBkZXNjcmlwdG9yID0gZWxlbWVudC4kbW9kZWwuZ2V0RWxlbWVudERlc2NyaXB0b3IoZWxlbWVudCk7CgogIHJldHVybiAhIV8uZmluZChkZXNjcmlwdG9yLmFsbFR5cGVzLCBmdW5jdGlvbih0KSB7CiAgICByZXR1cm4gdC5uYW1lID09PSB0eXBlOwogIH0pOwp9OwoKCi8qKgogKiBSZXR1cm5zIHRoZSBkZXNjcmlwdG9yIG9mIGFuIGVsZW1lbnRzIG5hbWVkIHByb3BlcnR5CiAqLwpNb2RkbGUucHJvdG90eXBlLmdldFByb3BlcnR5RGVzY3JpcHRvciA9IGZ1bmN0aW9uKGVsZW1lbnQsIHByb3BlcnR5KSB7CiAgcmV0dXJuIHRoaXMuZ2V0RWxlbWVudERlc2NyaXB0b3IoZWxlbWVudCkucHJvcGVydGllc0J5TmFtZVtwcm9wZXJ0eV07Cn07Cgp9LHsiLi9mYWN0b3J5IjoyMSwiLi9ucyI6MjMsIi4vcHJvcGVydGllcyI6MjQsIi4vcmVnaXN0cnkiOjI1LCIuL3R5cGVzIjoyNn1dLDIzOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKLyoqCiAqIFBhcnNlcyBhIG5hbWVzcGFjZWQgYXR0cmlidXRlIG5hbWUgb2YgdGhlIGZvcm0gKG5zOilsb2NhbE5hbWUgdG8gYW4gb2JqZWN0LAogKiBnaXZlbiBhIGRlZmF1bHQgcHJlZml4IHRvIGFzc3VtZSBpbiBjYXNlIG5vIGV4cGxpY2l0IG5hbWVzcGFjZSBpcyBnaXZlbi4KICoKICogQHBhcmFtIHtTdHJpbmd9IG5hbWUKICogQHBhcmFtIHtTdHJpbmd9IFtkZWZhdWx0UHJlZml4XSB0aGUgZGVmYXVsdCBwcmVmaXggdG8gdGFrZSwgaWYgbm9uZSBpcyBwcmVzZW50LgogKgogKiBAcmV0dXJuIHtPYmplY3R9IHRoZSBwYXJzZWQgbmFtZQogKi8KbW9kdWxlLmV4cG9ydHMucGFyc2VOYW1lID0gZnVuY3Rpb24obmFtZSwgZGVmYXVsdFByZWZpeCkgewogIHZhciBwYXJ0cyA9IG5hbWUuc3BsaXQoLzovKSwKICAgICAgbG9jYWxOYW1lLCBwcmVmaXg7CgogIC8vIG5vIHByZWZpeCAoaS5lLiBvbmx5IGxvY2FsIG5hbWUpCiAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMSkgewogICAgbG9jYWxOYW1lID0gbmFtZTsKICAgIHByZWZpeCA9IGRlZmF1bHRQcmVmaXg7CiAgfSBlbHNlCiAgLy8gcHJlZml4ICsgbG9jYWwgbmFtZQogIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgIGxvY2FsTmFtZSA9IHBhcnRzWzFdOwogICAgcHJlZml4ID0gcGFydHNbMF07CiAgfSBlbHNlIHsKICAgIHRocm93IG5ldyBFcnJvcignZXhwZWN0ZWQgPHByZWZpeDpsb2NhbE5hbWU+IG9yIDxsb2NhbE5hbWU+LCBnb3QgJyArIG5hbWUpOwogIH0KCiAgbmFtZSA9IChwcmVmaXggPyBwcmVmaXggKyAnOicgOiAnJykgKyBsb2NhbE5hbWU7CgogIHJldHVybiB7CiAgICBuYW1lOiBuYW1lLAogICAgcHJlZml4OiBwcmVmaXgsCiAgICBsb2NhbE5hbWU6IGxvY2FsTmFtZQogIH07Cn07Cn0se31dLDI0OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKCi8qKgogKiBBIHV0aWxpdHkgdGhhdCBnZXRzIGFuZCBzZXRzIHByb3BlcnRpZXMgb2YgbW9kZWwgZWxlbWVudHMuCiAqCiAqIEBwYXJhbSB7TW9kZWx9IG1vZGVsCiAqLwpmdW5jdGlvbiBQcm9wZXJ0aWVzKG1vZGVsKSB7CiAgdGhpcy5tb2RlbCA9IG1vZGVsOwp9Cgptb2R1bGUuZXhwb3J0cyA9IFByb3BlcnRpZXM7CgoKLyoqCiAqIFNldHMgYSBuYW1lZCBwcm9wZXJ0eSBvbiB0aGUgdGFyZ2V0IGVsZW1lbnQKICoKICogQHBhcmFtIHtPYmplY3R9IHRhcmdldAogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogKiBAcGFyYW0ge09iamVjdH0gdmFsdWUKICovClByb3BlcnRpZXMucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKHRhcmdldCwgbmFtZSwgdmFsdWUpIHsKCiAgdmFyIHByb3BlcnR5ID0gdGhpcy5tb2RlbC5nZXRQcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBuYW1lKTsKCiAgaWYgKCFwcm9wZXJ0eSkgewogICAgdGFyZ2V0LiRhdHRyc1tuYW1lXSA9IHZhbHVlOwogIH0gZWxzZSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBwcm9wZXJ0eS5uYW1lLCB7CiAgICAgIGVudW1lcmFibGU6ICFwcm9wZXJ0eS5pc1JlZmVyZW5jZSwKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiB2YWx1ZQogICAgfSk7CiAgfQp9OwoKLyoqCiAqIFJldHVybnMgdGhlIG5hbWVkIHByb3BlcnR5IG9mIHRoZSBnaXZlbiBlbGVtZW50CiAqCiAqIEBwYXJhbSAge09iamVjdH0gdGFyZ2V0CiAqIEBwYXJhbSAge1N0cmluZ30gbmFtZQogKgogKiBAcmV0dXJuIHtPYmplY3R9CiAqLwpQcm9wZXJ0aWVzLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbih0YXJnZXQsIG5hbWUpIHsKCiAgdmFyIHByb3BlcnR5ID0gdGhpcy5tb2RlbC5nZXRQcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBuYW1lKSwKICAgICAgcHJvcGVydHlOYW1lID0gcHJvcGVydHkubmFtZTsKCiAgaWYgKCFwcm9wZXJ0eSkgewogICAgcmV0dXJuIHRhcmdldFtuYW1lXTsKICB9CgogIC8vIGNoZWNrIGlmIGFjY2VzcyB0byBjb2xsZWN0aW9uIHByb3BlcnR5IGFuZCBsYXppbHkgaW5pdGlhbGl6ZSBpdAogIGlmICghdGFyZ2V0W3Byb3BlcnR5TmFtZV0gJiYgcHJvcGVydHkuaXNNYW55KSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBwcm9wZXJ0eU5hbWUsIHsKICAgICAgZW51bWVyYWJsZTogIXByb3BlcnR5LmlzUmVmZXJlbmNlLAogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgdmFsdWU6IFtdCiAgICB9KTsKICB9CgogIHJldHVybiB0YXJnZXRbcHJvcGVydHlOYW1lXTsKfTsKCgovKioKICogRGVmaW5lIGEgcHJvcGVydHkgb24gdGhlIHRhcmdldCBlbGVtZW50CiAqCiAqIEBwYXJhbSAge09iamVjdH0gdGFyZ2V0CiAqIEBwYXJhbSAge1N0cmluZ30gbmFtZQogKiBAcGFyYW0gIHtPYmplY3R9IG9wdGlvbnMKICovClByb3BlcnRpZXMucHJvdG90eXBlLmRlZmluZSA9IGZ1bmN0aW9uKHRhcmdldCwgbmFtZSwgb3B0aW9ucykgewogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIG5hbWUsIG9wdGlvbnMpOwp9OwoKCi8qKgogKiBEZWZpbmUgdGhlIGRlc2NyaXB0b3IgZm9yIGFuIGVsZW1lbnQKICovClByb3BlcnRpZXMucHJvdG90eXBlLmRlZmluZURlc2NyaXB0b3IgPSBmdW5jdGlvbih0YXJnZXQsIGRlc2NyaXB0b3IpIHsKICB0aGlzLmRlZmluZSh0YXJnZXQsICckZGVzY3JpcHRvcicsIHsgdmFsdWU6IGRlc2NyaXB0b3IgfSk7Cn07CgovKioKICogRGVmaW5lIHRoZSBtb2RlbCBmb3IgYW4gZWxlbWVudAogKi8KUHJvcGVydGllcy5wcm90b3R5cGUuZGVmaW5lTW9kZWwgPSBmdW5jdGlvbih0YXJnZXQsIG1vZGVsKSB7CiAgdGhpcy5kZWZpbmUodGFyZ2V0LCAnJG1vZGVsJywgeyB2YWx1ZTogbW9kZWwgfSk7Cn07Cn0se31dLDI1OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF8gPSAod2luZG93Ll8pOwoKdmFyIFR5cGVzID0gX2RlcmVxXygnLi90eXBlcycpLAogICAgRGVzY3JpcHRvckJ1aWxkZXIgPSBfZGVyZXFfKCcuL2Rlc2NyaXB0b3ItYnVpbGRlcicpOwoKdmFyIHBhcnNlTmFtZU5zID0gX2RlcmVxXygnLi9ucycpLnBhcnNlTmFtZTsKCgpmdW5jdGlvbiBSZWdpc3RyeShwYWNrYWdlcywgcHJvcGVydGllcywgb3B0aW9ucykgewogIHRoaXMub3B0aW9ucyA9IF8uZXh0ZW5kKHsgZ2VuZXJhdGVJZDogJ2lkJyB9LCBvcHRpb25zIHx8IHt9KTsKCiAgdGhpcy5wYWNrYWdlTWFwID0ge307CiAgdGhpcy50eXBlTWFwID0ge307CgogIHRoaXMucGFja2FnZXMgPSBbXTsKCiAgdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllczsKCiAgXy5mb3JFYWNoKHBhY2thZ2VzLCB0aGlzLnJlZ2lzdGVyUGFja2FnZSwgdGhpcyk7Cn0KCm1vZHVsZS5leHBvcnRzID0gUmVnaXN0cnk7CgoKUmVnaXN0cnkucHJvdG90eXBlLmdldFBhY2thZ2UgPSBmdW5jdGlvbih1cmlPclByZWZpeCkgewogIHJldHVybiB0aGlzLnBhY2thZ2VNYXBbdXJpT3JQcmVmaXhdOwp9OwoKUmVnaXN0cnkucHJvdG90eXBlLmdldFBhY2thZ2VzID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMucGFja2FnZXM7Cn07CgoKUmVnaXN0cnkucHJvdG90eXBlLnJlZ2lzdGVyUGFja2FnZSA9IGZ1bmN0aW9uKHBrZykgewoKICAvLyByZWdpc3RlciB0eXBlcwogIF8uZm9yRWFjaChwa2cudHlwZXMsIGZ1bmN0aW9uKGRlc2NyaXB0b3IpIHsKICAgIHRoaXMucmVnaXN0ZXJUeXBlKGRlc2NyaXB0b3IsIHBrZyk7CiAgfSwgdGhpcyk7CgogIHRoaXMucGFja2FnZU1hcFtwa2cudXJpXSA9IHRoaXMucGFja2FnZU1hcFtwa2cucHJlZml4XSA9IHBrZzsKICB0aGlzLnBhY2thZ2VzLnB1c2gocGtnKTsKfTsKCgovKioKICogUmVnaXN0ZXIgYSB0eXBlIGZyb20gYSBzcGVjaWZpYyBwYWNrYWdlIHdpdGggdXMKICovClJlZ2lzdHJ5LnByb3RvdHlwZS5yZWdpc3RlclR5cGUgPSBmdW5jdGlvbih0eXBlLCBwa2cpIHsKCiAgdmFyIG5zID0gcGFyc2VOYW1lTnModHlwZS5uYW1lLCBwa2cucHJlZml4KSwKICAgICAgbmFtZSA9IG5zLm5hbWUsCiAgICAgIHByb3BlcnRpZXNCeU5hbWUgPSB7fTsKCiAgLy8gcGFyc2UgcHJvcGVydGllcwogIF8uZm9yRWFjaCh0eXBlLnByb3BlcnRpZXMsIGZ1bmN0aW9uKHApIHsKCiAgICAvLyBuYW1lc3BhY2UgcHJvcGVydHkgbmFtZXMKICAgIHZhciBwcm9wZXJ0eU5zID0gcGFyc2VOYW1lTnMocC5uYW1lLCBucy5wcmVmaXgpLAogICAgICAgIHByb3BlcnR5TmFtZSA9IHByb3BlcnR5TnMubmFtZTsKCiAgICAvLyBuYW1lc3BhY2UgcHJvcGVydHkgdHlwZXMKICAgIGlmICghVHlwZXMuaXNCdWlsdEluKHAudHlwZSkpIHsKICAgICAgcC50eXBlID0gcGFyc2VOYW1lTnMocC50eXBlLCBwcm9wZXJ0eU5zLnByZWZpeCkubmFtZTsKICAgIH0KCiAgICBfLmV4dGVuZChwLCB7CiAgICAgIG5zOiBwcm9wZXJ0eU5zLAogICAgICBuYW1lOiBwcm9wZXJ0eU5hbWUKICAgIH0pOwoKICAgIHByb3BlcnRpZXNCeU5hbWVbcHJvcGVydHlOYW1lXSA9IHA7CiAgfSk7CgogIC8vIHVwZGF0ZSBucyArIG5hbWUKICBfLmV4dGVuZCh0eXBlLCB7CiAgICBuczogbnMsCiAgICBuYW1lOiBuYW1lLAogICAgcHJvcGVydGllc0J5TmFtZTogcHJvcGVydGllc0J5TmFtZQogIH0pOwoKICAvLyBsaW5rIHRvIHBhY2thZ2UKICB0aGlzLmRlZmluZVBhY2thZ2UodHlwZSwgcGtnKTsKCiAgLy8gcmVnaXN0ZXIKICB0aGlzLnR5cGVNYXBbbmFtZV0gPSB0eXBlOwp9OwoKCi8qKgogKiBUcmF2ZXJzZSB0aGUgdHlwZSBoaWVyYXJjaHkgZnJvbSBib3R0b20gdG8gdG9wLgogKi8KUmVnaXN0cnkucHJvdG90eXBlLm1hcFR5cGVzID0gZnVuY3Rpb24obnNOYW1lLCBpdGVyYXRvcikgewoKICB2YXIgdHlwZSA9IHRoaXMudHlwZU1hcFtuc05hbWUubmFtZV07CgogIGlmICghdHlwZSkgewogICAgdGhyb3cgbmV3IEVycm9yKCd1bmtub3duIHR5cGUgPCcgKyBuc05hbWUubmFtZSArICc+Jyk7CiAgfQoKICBfLmZvckVhY2godHlwZS5zdXBlckNsYXNzLCBmdW5jdGlvbihjbHMpIHsKICAgIHZhciBwYXJlbnROcyA9IHBhcnNlTmFtZU5zKGNscywgbnNOYW1lLnByZWZpeCk7CiAgICB0aGlzLm1hcFR5cGVzKHBhcmVudE5zLCBpdGVyYXRvcik7CiAgfSwgdGhpcyk7CgogIGl0ZXJhdG9yKHR5cGUpOwp9OwoKCi8qKgogKiBSZXR1cm5zIHRoZSBlZmZlY3RpdmUgZGVzY3JpcHRvciBmb3IgYSB0eXBlLgogKgogKiBAcGFyYW0gIHtTdHJpbmd9IHR5cGUgdGhlIG5hbWVzcGFjZWQgbmFtZSAobnM6bG9jYWxOYW1lKSBvZiB0aGUgdHlwZQogKgogKiBAcmV0dXJuIHtEZXNjcmlwdG9yfSB0aGUgcmVzdWx0aW5nIGVmZmVjdGl2ZSBkZXNjcmlwdG9yCiAqLwpSZWdpc3RyeS5wcm90b3R5cGUuZ2V0RWZmZWN0aXZlRGVzY3JpcHRvciA9IGZ1bmN0aW9uKG5hbWUpIHsKCiAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCiAgICAgIG5zTmFtZSA9IHBhcnNlTmFtZU5zKG5hbWUpOwoKICB2YXIgYnVpbGRlciA9IG5ldyBEZXNjcmlwdG9yQnVpbGRlcihuc05hbWUpOwoKICB0aGlzLm1hcFR5cGVzKG5zTmFtZSwgZnVuY3Rpb24odHlwZSkgewogICAgYnVpbGRlci5hZGRUcmFpdCh0eXBlKTsKICB9KTsKCiAgLy8gY2hlY2sgd2UgaGF2ZSBhbiBpZCBhc3NpZ25lZAogIHZhciBpZCA9IHRoaXMub3B0aW9ucy5nZW5lcmF0ZUlkOwogIGlmIChpZCAmJiAhYnVpbGRlci5oYXNQcm9wZXJ0eShpZCkpIHsKICAgIGJ1aWxkZXIuYWRkSWRQcm9wZXJ0eShpZCk7CiAgfQoKICB2YXIgZGVzY3JpcHRvciA9IGJ1aWxkZXIuYnVpbGQoKTsKCiAgLy8gZGVmaW5lIHBhY2thZ2UgbGluawogIHRoaXMuZGVmaW5lUGFja2FnZShkZXNjcmlwdG9yLCBkZXNjcmlwdG9yLmFsbFR5cGVzW2Rlc2NyaXB0b3IuYWxsVHlwZXMubGVuZ3RoIC0gMV0uJHBrZyk7CgogIHJldHVybiBkZXNjcmlwdG9yOwp9OwoKClJlZ2lzdHJ5LnByb3RvdHlwZS5kZWZpbmVQYWNrYWdlID0gZnVuY3Rpb24odGFyZ2V0LCBwa2cpIHsKICB0aGlzLnByb3BlcnRpZXMuZGVmaW5lKHRhcmdldCwgJyRwa2cnLCB7IHZhbHVlOiBwa2cgfSk7Cn07Cn0seyIuL2Rlc2NyaXB0b3ItYnVpbGRlciI6MjAsIi4vbnMiOjIzLCIuL3R5cGVzIjoyNn1dLDI2OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKLyoqCiAqIEJ1aWx0LWluIG1vZGRsZSB0eXBlcwogKi8KdmFyIEJVSUxUSU5TID0gewogIFN0cmluZzogdHJ1ZSwKICBCb29sZWFuOiB0cnVlLAogIEludGVnZXI6IHRydWUsCiAgUmVhbDogdHJ1ZSwKICBFbGVtZW50OiB0cnVlLAp9OwoKLyoqCiAqIENvbnZlcnRlcnMgZm9yIGJ1aWx0IGluIHR5cGVzIGZyb20gc3RyaW5nIHJlcHJlc2VudGF0aW9ucwogKi8KdmFyIFRZUEVfQ09OVkVSVEVSUyA9IHsKICBTdHJpbmc6IGZ1bmN0aW9uKHMpIHsgcmV0dXJuIHM7IH0sCiAgQm9vbGVhbjogZnVuY3Rpb24ocykgeyByZXR1cm4gcyA9PT0gJ3RydWUnOyB9LAogIEludGVnZXI6IGZ1bmN0aW9uKHMpIHsgcmV0dXJuIHBhcnNlSW50KHMsIDEwKTsgfSwKICBSZWFsOiBmdW5jdGlvbihzKSB7IHJldHVybiBwYXJzZUZsb2F0KHMsIDEwKTsgfQp9OwoKLyoqCiAqIENvbnZlcnQgYSB0eXBlIHRvIGl0cyByZWFsIHJlcHJlc2VudGF0aW9uCiAqLwptb2R1bGUuZXhwb3J0cy5jb2VyY2VUeXBlID0gZnVuY3Rpb24odHlwZSwgdmFsdWUpIHsKCiAgdmFyIGNvbnZlcnRlciA9IFRZUEVfQ09OVkVSVEVSU1t0eXBlXTsKCiAgaWYgKGNvbnZlcnRlcikgewogICAgcmV0dXJuIGNvbnZlcnRlcih2YWx1ZSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiB2YWx1ZTsKICB9Cn07CgovKioKICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIHR5cGUgaXMgYnVpbHQtaW4KICovCm1vZHVsZS5leHBvcnRzLmlzQnVpbHRJbiA9IGZ1bmN0aW9uKHR5cGUpIHsKICByZXR1cm4gISFCVUlMVElOU1t0eXBlXTsKfTsKCi8qKgogKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4gdHlwZSBpcyBzaW1wbGUKICovCm1vZHVsZS5leHBvcnRzLmlzU2ltcGxlID0gZnVuY3Rpb24odHlwZSkgewogIHJldHVybiAhIVRZUEVfQ09OVkVSVEVSU1t0eXBlXTsKfTsKfSx7fV0sMjc6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovKioKICogVGlueSBzdGFjayBmb3IgYnJvd3NlciBvciBzZXJ2ZXIKICoKICogQGF1dGhvciBKYXNvbiBNdWxsaWdhbiA8amFzb24ubXVsbGlnYW5AYXZvaWR3b3JrLmNvbT4KICogQGNvcHlyaWdodCAyMDE0IEphc29uIE11bGxpZ2FuCiAqIEBsaWNlbnNlIEJTRC0zIDxodHRwczovL3Jhdy5naXRodWIuY29tL2F2b2lkd29yay90aW55LXN0YWNrL21hc3Rlci9MSUNFTlNFPgogKiBAbGluayBodHRwOi8vYXZvaWR3b3JrLmdpdGh1Yi5pby90aW55LXN0YWNrCiAqIEBtb2R1bGUgdGlueS1zdGFjawogKiBAdmVyc2lvbiAwLjEuMAogKi8KCiggZnVuY3Rpb24gKCBnbG9iYWwgKSB7CgoidXNlIHN0cmljdCI7CgovKioKICogVGlueVN0YWNrCiAqCiAqIEBjb25zdHJ1Y3RvcgogKi8KZnVuY3Rpb24gVGlueVN0YWNrICgpIHsKCXRoaXMuZGF0YSA9IFtudWxsXTsKCXRoaXMudG9wICA9IDA7Cn0KCi8qKgogKiBDbGVhcnMgdGhlIHN0YWNrCiAqCiAqIEBtZXRob2QgY2xlYXIKICogQG1lbWJlck9mIFRpbnlTdGFjawogKiBAcmV0dXJuIHtPYmplY3R9IHtAbGluayBUaW55U3RhY2t9CiAqLwpUaW55U3RhY2sucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gY2xlYXIgKCkgewoJdGhpcy5kYXRhID0gW251bGxdOwoJdGhpcy50b3AgID0gMDsKCglyZXR1cm4gdGhpczsKfTsKCi8qKgogKiBHZXRzIHRoZSBzaXplIG9mIHRoZSBzdGFjawogKgogKiBAbWV0aG9kIGxlbmd0aAogKiBAbWVtYmVyT2YgVGlueVN0YWNrCiAqIEByZXR1cm4ge051bWJlcn0gU2l6ZSBvZiBzdGFjawogKi8KVGlueVN0YWNrLnByb3RvdHlwZS5sZW5ndGggPSBmdW5jdGlvbiBsZW5ndGggKCkgewoJcmV0dXJuIHRoaXMudG9wOwp9OwoKLyoqCiAqIEdldHMgdGhlIGl0ZW0gYXQgdGhlIHRvcCBvZiB0aGUgc3RhY2sKICoKICogQG1ldGhvZCBwZWVrCiAqIEBtZW1iZXJPZiBUaW55U3RhY2sKICogQHJldHVybiB7TWl4ZWR9IEl0ZW0gYXQgdGhlIHRvcCBvZiB0aGUgc3RhY2sKICovClRpbnlTdGFjay5wcm90b3R5cGUucGVlayA9IGZ1bmN0aW9uIHBlZWsgKCkgewoJcmV0dXJuIHRoaXMuZGF0YVt0aGlzLnRvcF07Cn07CgovKioKICogR2V0cyAmIHJlbW92ZXMgdGhlIGl0ZW0gYXQgdGhlIHRvcCBvZiB0aGUgc3RhY2sKICoKICogQG1ldGhvZCBwb3AKICogQG1lbWJlck9mIFRpbnlTdGFjawogKiBAcmV0dXJuIHtNaXhlZH0gSXRlbSBhdCB0aGUgdG9wIG9mIHRoZSBzdGFjawogKi8KVGlueVN0YWNrLnByb3RvdHlwZS5wb3AgPSBmdW5jdGlvbiBwb3AgKCkgewoJaWYgKCB0aGlzLnRvcCA+IDAgKSB7CgkJdGhpcy50b3AtLTsKCgkJcmV0dXJuIHRoaXMuZGF0YS5wb3AoKTsKCX0KCWVsc2UgewoJCXJldHVybiB1bmRlZmluZWQ7Cgl9Cn07CgovKioKICogUHVzaGVzIGFuIGl0ZW0gb250byB0aGUgc3RhY2sKICoKICogQG1ldGhvZCBwdXNoCiAqIEBtZW1iZXJPZiBUaW55U3RhY2sKICogQHJldHVybiB7T2JqZWN0fSB7QGxpbmsgVGlueVN0YWNrfQogKi8KVGlueVN0YWNrLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gcHVzaCAoIGFyZyApIHsKCXRoaXMuZGF0YVsrK3RoaXMudG9wXSA9IGFyZzsKCglyZXR1cm4gdGhpczsKfTsKCi8qKgogKiBUaW55U3RhY2sgZmFjdG9yeQogKgogKiBAbWV0aG9kIGZhY3RvcnkKICogQHJldHVybiB7T2JqZWN0fSB7QGxpbmsgVGlueVN0YWNrfQogKi8KZnVuY3Rpb24gZmFjdG9yeSAoKSB7CglyZXR1cm4gbmV3IFRpbnlTdGFjaygpOwp9CgovLyBOb2RlLCBBTUQgJiB3aW5kb3cgc3VwcG9ydGVkCmlmICggdHlwZW9mIGV4cG9ydHMgIT0gInVuZGVmaW5lZCIgKSB7Cgltb2R1bGUuZXhwb3J0cyA9IGZhY3Rvcnk7Cn0KZWxzZSBpZiAoIHR5cGVvZiBkZWZpbmUgPT0gImZ1bmN0aW9uIiApIHsKCWRlZmluZSggZnVuY3Rpb24gKCkgewoJCXJldHVybiBmYWN0b3J5OwoJfSApOwp9CmVsc2UgewoJZ2xvYmFsLnN0YWNrID0gZmFjdG9yeTsKfQp9ICkoIHRoaXMgKTsKCn0se31dLDI4OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHM9X2RlcmVxXygxOCkKfSx7Ii4vbGliL21vZGRsZSI6MzIsIi4vbGliL25zIjozMywiLi9saWIvdHlwZXMiOjM2fV0sMjk6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cz1fZGVyZXFfKDE5KQp9LHt9XSwzMDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzPV9kZXJlcV8oMjApCn0seyIuL25zIjozM31dLDMxOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHM9X2RlcmVxXygyMSkKfSx7Ii4vYmFzZSI6Mjl9XSwzMjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzPV9kZXJlcV8oMjIpCn0seyIuL2ZhY3RvcnkiOjMxLCIuL25zIjozMywiLi9wcm9wZXJ0aWVzIjozNCwiLi9yZWdpc3RyeSI6MzUsIi4vdHlwZXMiOjM2fV0sMzM6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cz1fZGVyZXFfKDIzKQp9LHt9XSwzNDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzPV9kZXJlcV8oMjQpCn0se31dLDM1OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHM9X2RlcmVxXygyNSkKfSx7Ii4vZGVzY3JpcHRvci1idWlsZGVyIjozMCwiLi9ucyI6MzMsIi4vdHlwZXMiOjM2fV0sMzY6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cz1fZGVyZXFfKDI2KQp9LHt9XSwzNzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzPXsKICAibmFtZSI6ICJCUE1OMjAiLAogICJ1cmkiOiAiaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvQlBNTi8yMDEwMDUyNC9NT0RFTCIsCiAgImFzc29jaWF0aW9ucyI6IFtdLAogICJ0eXBlcyI6IFsKICAgIHsKICAgICAgIm5hbWUiOiAiSW50ZXJmYWNlIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIlJvb3RFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAib3BlcmF0aW9ucyIsCiAgICAgICAgICAidHlwZSI6ICJPcGVyYXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfb3BlcmF0aW9uc19pbnRlcmZhY2UiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImltcGxlbWVudGF0aW9uUmVmIiwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiT3BlcmF0aW9uIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkJhc2VFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaW5NZXNzYWdlUmVmIiwKICAgICAgICAgICJ0eXBlIjogIk1lc3NhZ2UiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfaW5NZXNzYWdlUmVmX29wZXJhdGlvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm91dE1lc3NhZ2VSZWYiLAogICAgICAgICAgInR5cGUiOiAiTWVzc2FnZSIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9vdXRNZXNzYWdlUmVmX29wZXJhdGlvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImVycm9yUmVmcyIsCiAgICAgICAgICAidHlwZSI6ICJFcnJvciIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9lcnJvclJlZnNfb3BlcmF0aW9uIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaW1wbGVtZW50YXRpb25SZWYiLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJFbmRQb2ludCIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJSb290RWxlbWVudCIKICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiQXVkaXRpbmciLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkdsb2JhbFRhc2siLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQ2FsbGFibGVFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJyZXNvdXJjZXMiLAogICAgICAgICAgInR5cGUiOiAiUmVzb3VyY2VSb2xlIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3Jlc291cmNlc19nbG9iYWxUYXNrIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJNb25pdG9yaW5nIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkJhc2VFbGVtZW50IgogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJQZXJmb3JtZXIiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiUmVzb3VyY2VSb2xlIgogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJQcm9jZXNzIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkZsb3dFbGVtZW50c0NvbnRhaW5lciIsCiAgICAgICAgIkNhbGxhYmxlRWxlbWVudCIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicHJvY2Vzc1R5cGUiLAogICAgICAgICAgInR5cGUiOiAiUHJvY2Vzc1R5cGUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImlzQ2xvc2VkIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiQm9vbGVhbiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImF1ZGl0aW5nIiwKICAgICAgICAgICJ0eXBlIjogIkF1ZGl0aW5nIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2F1ZGl0aW5nX3Byb2Nlc3MiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJtb25pdG9yaW5nIiwKICAgICAgICAgICJ0eXBlIjogIk1vbml0b3JpbmciLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfbW9uaXRvcmluZ19wcm9jZXNzIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicHJvcGVydGllcyIsCiAgICAgICAgICAidHlwZSI6ICJQcm9wZXJ0eSIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9wcm9wZXJ0aWVzX3Byb2Nlc3MiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInN1cHBvcnRzIiwKICAgICAgICAgICJ0eXBlIjogIlByb2Nlc3MiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfc3VwcG9ydHNfcHJvY2VzcyIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImRlZmluaXRpb25hbENvbGxhYm9yYXRpb25SZWYiLAogICAgICAgICAgInR5cGUiOiAiQ29sbGFib3JhdGlvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9kZWZpbml0aW9uYWxDb2xsYWJvcmF0aW9uUmVmX3Byb2Nlc3MiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpc0V4ZWN1dGFibGUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJCb29sZWFuIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicmVzb3VyY2VzIiwKICAgICAgICAgICJ0eXBlIjogIlJlc291cmNlUm9sZSIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9yZXNvdXJjZXNfcHJvY2VzcyIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiYXJ0aWZhY3RzIiwKICAgICAgICAgICJ0eXBlIjogIkFydGlmYWN0IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2FydGlmYWN0c19wcm9jZXNzIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjb3JyZWxhdGlvblN1YnNjcmlwdGlvbnMiLAogICAgICAgICAgInR5cGUiOiAiQ29ycmVsYXRpb25TdWJzY3JpcHRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfY29ycmVsYXRpb25TdWJzY3JpcHRpb25zX3Byb2Nlc3MiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkxhbmVTZXQiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImxhbmVzIiwKICAgICAgICAgICJ0eXBlIjogIkxhbmUiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfbGFuZXNfbGFuZVNldCIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibmFtZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkxhbmUiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm5hbWUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjaGlsZExhbmVTZXQiLAogICAgICAgICAgInR5cGUiOiAiTGFuZVNldCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9jaGlsZExhbmVTZXRfcGFyZW50TGFuZSIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInBhcnRpdGlvbkVsZW1lbnRSZWYiLAogICAgICAgICAgInR5cGUiOiAiQmFzZUVsZW1lbnQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfcGFydGl0aW9uRWxlbWVudFJlZl9sYW5lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZmxvd05vZGVSZWYiLAogICAgICAgICAgInR5cGUiOiAiRmxvd05vZGUiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfZmxvd05vZGVSZWZzX2xhbmVzIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicGFydGl0aW9uRWxlbWVudCIsCiAgICAgICAgICAidHlwZSI6ICJCYXNlRWxlbWVudCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9wYXJ0aXRpb25FbGVtZW50X2xhbmUiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJHbG9iYWxNYW51YWxUYXNrIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkdsb2JhbFRhc2siCiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIk1hbnVhbFRhc2siLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiVGFzayIKICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiVXNlclRhc2siLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiVGFzayIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicmVuZGVyaW5ncyIsCiAgICAgICAgICAidHlwZSI6ICJSZW5kZXJpbmciLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfcmVuZGVyaW5nc191c2VydGFzayIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaW1wbGVtZW50YXRpb24iLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJSZW5kZXJpbmciLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkh1bWFuUGVyZm9ybWVyIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIlBlcmZvcm1lciIKICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiUG90ZW50aWFsT3duZXIiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiSHVtYW5QZXJmb3JtZXIiCiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkdsb2JhbFVzZXJUYXNrIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkdsb2JhbFRhc2siCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImltcGxlbWVudGF0aW9uIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicmVuZGVyaW5ncyIsCiAgICAgICAgICAidHlwZSI6ICJSZW5kZXJpbmciLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfcmVuZGVyaW5nc19nbG9iYWxVc2VyVGFzayIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiR2F0ZXdheSIsCiAgICAgICJpc0Fic3RyYWN0IjogdHJ1ZSwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkZsb3dOb2RlIgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJnYXRld2F5RGlyZWN0aW9uIiwKICAgICAgICAgICJ0eXBlIjogIkdhdGV3YXlEaXJlY3Rpb24iLAogICAgICAgICAgImRlZmF1bHQiOiAidW5zcGVjaWZpZWQiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkV2ZW50QmFzZWRHYXRld2F5IiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkdhdGV3YXkiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImluc3RhbnRpYXRlIiwKICAgICAgICAgICJkZWZhdWx0IjogZmFsc2UsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIkJvb2xlYW4iCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJldmVudEdhdGV3YXlUeXBlIiwKICAgICAgICAgICJ0eXBlIjogIkV2ZW50QmFzZWRHYXRld2F5VHlwZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiQ29tcGxleEdhdGV3YXkiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiR2F0ZXdheSIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiYWN0aXZhdGlvbkNvbmRpdGlvbiIsCiAgICAgICAgICAidHlwZSI6ICJFeHByZXNzaW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2FjdGl2YXRpb25Db25kaXRpb25fY29tcGxleEdhdGV3YXkiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJkZWZhdWx0IiwKICAgICAgICAgICJ0eXBlIjogIlNlcXVlbmNlRmxvdyIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9kZWZhdWx0X2NvbXBsZXhHYXRld2F5IiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiRXhjbHVzaXZlR2F0ZXdheSIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJHYXRld2F5IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJkZWZhdWx0IiwKICAgICAgICAgICJ0eXBlIjogIlNlcXVlbmNlRmxvdyIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9kZWZhdWx0X2V4Y2x1c2l2ZUdhdGV3YXkiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJJbmNsdXNpdmVHYXRld2F5IiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkdhdGV3YXkiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImRlZmF1bHQiLAogICAgICAgICAgInR5cGUiOiAiU2VxdWVuY2VGbG93IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2RlZmF1bHRfaW5jbHVzaXZlR2F0ZXdheSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIlBhcmFsbGVsR2F0ZXdheSIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJHYXRld2F5IgogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJSb290RWxlbWVudCIsCiAgICAgICJpc0Fic3RyYWN0IjogdHJ1ZSwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkJhc2VFbGVtZW50IgogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJSZWxhdGlvbnNoaXAiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInR5cGUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJkaXJlY3Rpb24iLAogICAgICAgICAgInR5cGUiOiAiUmVsYXRpb25zaGlwRGlyZWN0aW9uIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJzb3VyY2VzIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3NvdXJjZXNfcmVsYXRpb25zaGlwIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIkVsZW1lbnQiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0YXJnZXRzIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3RhcmdldHNfcmVsYXRpb25zaGlwIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIkVsZW1lbnQiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJCYXNlRWxlbWVudCIsCiAgICAgICJpc0Fic3RyYWN0IjogdHJ1ZSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaWQiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJleHRlbnNpb25EZWZpbml0aW9ucyIsCiAgICAgICAgICAidHlwZSI6ICJFeHRlbnNpb25EZWZpbml0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2V4dGVuc2lvbkRlZmluaXRpb25zX2Jhc2VFbGVtZW50IiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZXh0ZW5zaW9uRWxlbWVudHMiLAogICAgICAgICAgInR5cGUiOiAiRXh0ZW5zaW9uRWxlbWVudHMiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfZXh0ZW5zaW9uRWxlbWVudHNfYmFzZUVsZW1lbnQiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJkb2N1bWVudGF0aW9uIiwKICAgICAgICAgICJ0eXBlIjogIkRvY3VtZW50YXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfZG9jdW1lbnRhdGlvbl9iYXNlRWxlbWVudCIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiRXh0ZW5zaW9uIiwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibXVzdFVuZGVyc3RhbmQiLAogICAgICAgICAgImRlZmF1bHQiOiBmYWxzZSwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiQm9vbGVhbiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImRlZmluaXRpb24iLAogICAgICAgICAgInR5cGUiOiAiRXh0ZW5zaW9uRGVmaW5pdGlvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9kZWZpbml0aW9uX2V4dGVuc2lvbiIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkV4dGVuc2lvbkRlZmluaXRpb24iLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZXh0ZW5zaW9uQXR0cmlidXRlRGVmaW5pdGlvbnMiLAogICAgICAgICAgInR5cGUiOiAiRXh0ZW5zaW9uQXR0cmlidXRlRGVmaW5pdGlvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9leHRlbnNpb25BdHRyaWJ1dGVEZWZpbml0aW9uc19leHRlbnNpb25EZWZpbml0aW9uIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJFeHRlbnNpb25BdHRyaWJ1dGVEZWZpbml0aW9uIiwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibmFtZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInR5cGUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpc1JlZmVyZW5jZSIsCiAgICAgICAgICAiZGVmYXVsdCI6IGZhbHNlLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJCb29sZWFuIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZXh0ZW5zaW9uRGVmaW5pdGlvbiIsCiAgICAgICAgICAidHlwZSI6ICJFeHRlbnNpb25EZWZpbml0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2V4dGVuc2lvbkF0dHJpYnV0ZURlZmluaXRpb25zX2V4dGVuc2lvbkRlZmluaXRpb24iLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJFeHRlbnNpb25FbGVtZW50cyIsCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInZhbHVlUmVmIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3ZhbHVlUmVmX2V4dGVuc2lvbkVsZW1lbnRzIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIkVsZW1lbnQiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ2YWx1ZXMiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfdmFsdWVfZXh0ZW5zaW9uRWxlbWVudHMiLAogICAgICAgICAgInR5cGUiOiAiRWxlbWVudCIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZXh0ZW5zaW9uQXR0cmlidXRlRGVmaW5pdGlvbiIsCiAgICAgICAgICAidHlwZSI6ICJFeHRlbnNpb25BdHRyaWJ1dGVEZWZpbml0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2V4dGVuc2lvbkF0dHJpYnV0ZURlZmluaXRpb25fZXh0ZW5zaW9uRWxlbWVudHMiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJEb2N1bWVudGF0aW9uIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkJhc2VFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0ZXh0IiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIiwKICAgICAgICAgICJpc0JvZHkiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0ZXh0Rm9ybWF0IiwKICAgICAgICAgICJkZWZhdWx0IjogInRleHQvcGxhaW4iLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJFdmVudCIsCiAgICAgICJpc0Fic3RyYWN0IjogdHJ1ZSwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkZsb3dOb2RlIiwKICAgICAgICAiSW50ZXJhY3Rpb25Ob2RlIgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJwcm9wZXJ0aWVzIiwKICAgICAgICAgICJ0eXBlIjogIlByb3BlcnR5IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3Byb3BlcnRpZXNfZXZlbnQiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkludGVybWVkaWF0ZUNhdGNoRXZlbnQiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQ2F0Y2hFdmVudCIKICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiSW50ZXJtZWRpYXRlVGhyb3dFdmVudCIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJUaHJvd0V2ZW50IgogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJFbmRFdmVudCIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJUaHJvd0V2ZW50IgogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJTdGFydEV2ZW50IiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkNhdGNoRXZlbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImlzSW50ZXJydXB0aW5nIiwKICAgICAgICAgICJkZWZhdWx0IjogdHJ1ZSwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiQm9vbGVhbiIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIlRocm93RXZlbnQiLAogICAgICAiaXNBYnN0cmFjdCI6IHRydWUsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJFdmVudCIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaW5wdXRTZXQiLAogICAgICAgICAgInR5cGUiOiAiSW5wdXRTZXQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfaW5wdXRTZXRfdGhyb3dFdmVudCIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImV2ZW50RGVmaW5pdGlvblJlZnMiLAogICAgICAgICAgInR5cGUiOiAiRXZlbnREZWZpbml0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2V2ZW50RGVmaW5pdGlvblJlZnNfdGhyb3dFdmVudCIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImRhdGFJbnB1dEFzc29jaWF0aW9uIiwKICAgICAgICAgICJ0eXBlIjogIkRhdGFJbnB1dEFzc29jaWF0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2RhdGFJbnB1dEFzc29jaWF0aW9uX3Rocm93RXZlbnQiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImRhdGFJbnB1dHMiLAogICAgICAgICAgInR5cGUiOiAiRGF0YUlucHV0IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2RhdGFJbnB1dHNfdGhyb3dFdmVudCIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZXZlbnREZWZpbml0aW9ucyIsCiAgICAgICAgICAidHlwZSI6ICJFdmVudERlZmluaXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfZXZlbnREZWZpbml0aW9uc190aHJvd0V2ZW50IiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJDYXRjaEV2ZW50IiwKICAgICAgImlzQWJzdHJhY3QiOiB0cnVlLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiRXZlbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInBhcmFsbGVsTXVsdGlwbGUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJCb29sZWFuIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAib3V0cHV0U2V0IiwKICAgICAgICAgICJ0eXBlIjogIk91dHB1dFNldCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9vdXRwdXRTZXRfY2F0Y2hFdmVudCIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImV2ZW50RGVmaW5pdGlvblJlZnMiLAogICAgICAgICAgInR5cGUiOiAiRXZlbnREZWZpbml0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2V2ZW50RGVmaW5pdGlvblJlZnNfY2F0Y2hFdmVudCIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImRhdGFPdXRwdXRBc3NvY2lhdGlvbiIsCiAgICAgICAgICAidHlwZSI6ICJEYXRhT3V0cHV0QXNzb2NpYXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfZGF0YU91dHB1dEFzc29jaWF0aW9uX2NhdGNoRXZlbnQiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImRhdGFPdXRwdXRzIiwKICAgICAgICAgICJ0eXBlIjogIkRhdGFPdXRwdXQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfZGF0YU91dHB1dHNfY2F0Y2hFdmVudCIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZXZlbnREZWZpbml0aW9ucyIsCiAgICAgICAgICAidHlwZSI6ICJFdmVudERlZmluaXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfZXZlbnREZWZpbml0aW9uc19jYXRjaEV2ZW50IiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJCb3VuZGFyeUV2ZW50IiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkNhdGNoRXZlbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImNhbmNlbEFjdGl2aXR5IiwKICAgICAgICAgICJkZWZhdWx0IjogdHJ1ZSwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiQm9vbGVhbiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImF0dGFjaGVkVG9SZWYiLAogICAgICAgICAgInR5cGUiOiAiQWN0aXZpdHkiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfYm91bmRhcnlFdmVudFJlZnNfYXR0YWNoZWRUb1JlZiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkV2ZW50RGVmaW5pdGlvbiIsCiAgICAgICJpc0Fic3RyYWN0IjogdHJ1ZSwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIlJvb3RFbGVtZW50IgogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJDYW5jZWxFdmVudERlZmluaXRpb24iLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiRXZlbnREZWZpbml0aW9uIgogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJFcnJvckV2ZW50RGVmaW5pdGlvbiIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJFdmVudERlZmluaXRpb24iCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImVycm9yUmVmIiwKICAgICAgICAgICJ0eXBlIjogIkVycm9yIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2Vycm9yUmVmX2Vycm9yRXZlbnREZWZpbml0aW9uIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiVGVybWluYXRlRXZlbnREZWZpbml0aW9uIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkV2ZW50RGVmaW5pdGlvbiIKICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiRXNjYWxhdGlvbkV2ZW50RGVmaW5pdGlvbiIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJFdmVudERlZmluaXRpb24iCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImVzY2FsYXRpb25SZWYiLAogICAgICAgICAgInR5cGUiOiAiRXNjYWxhdGlvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9lc2NhbGF0aW9uUmVmX2VzY2FsYXRpb25FdmVudERlZmluaXRpb24iLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJFc2NhbGF0aW9uIiwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAic3RydWN0dXJlUmVmIiwKICAgICAgICAgICJ0eXBlIjogIkl0ZW1EZWZpbml0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3N0cnVjdHVyZVJlZl9lc2NhbGF0aW9uIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibmFtZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImVzY2FsYXRpb25Db2RlIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0KICAgICAgXSwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIlJvb3RFbGVtZW50IgogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJDb21wZW5zYXRlRXZlbnREZWZpbml0aW9uIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkV2ZW50RGVmaW5pdGlvbiIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAid2FpdEZvckNvbXBsZXRpb24iLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJCb29sZWFuIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiYWN0aXZpdHlSZWYiLAogICAgICAgICAgInR5cGUiOiAiQWN0aXZpdHkiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfYWN0aXZpdHlSZWZfY29tcGVuc2F0ZUV2ZW50RGVmaW5pdGlvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIlRpbWVyRXZlbnREZWZpbml0aW9uIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkV2ZW50RGVmaW5pdGlvbiIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAidGltZURhdGUiLAogICAgICAgICAgInR5cGUiOiAiRXhwcmVzc2lvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV90aW1lRGF0ZV90aW1lckV2ZW50RGVmaW5pdGlvbiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInRpbWVDeWNsZSIsCiAgICAgICAgICAidHlwZSI6ICJFeHByZXNzaW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3RpbWVDeWNsZV90aW1lckV2ZW50RGVmaW5pdGlvbiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInRpbWVEdXJhdGlvbiIsCiAgICAgICAgICAidHlwZSI6ICJFeHByZXNzaW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3RpbWVEdXJhdGlvbl90aW1lckV2ZW50RGVmaW5pdGlvbiIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkxpbmtFdmVudERlZmluaXRpb24iLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiRXZlbnREZWZpbml0aW9uIgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAidGFyZ2V0IiwKICAgICAgICAgICJ0eXBlIjogIkxpbmtFdmVudERlZmluaXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfdGFyZ2V0X3NvdXJjZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInNvdXJjZSIsCiAgICAgICAgICAidHlwZSI6ICJMaW5rRXZlbnREZWZpbml0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3RhcmdldF9zb3VyY2UiLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJNZXNzYWdlRXZlbnREZWZpbml0aW9uIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkV2ZW50RGVmaW5pdGlvbiIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibWVzc2FnZVJlZiIsCiAgICAgICAgICAidHlwZSI6ICJNZXNzYWdlIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX21lc3NhZ2VSZWZfbWVzc2FnZUV2ZW50RGVmaW5pdGlvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm9wZXJhdGlvblJlZiIsCiAgICAgICAgICAidHlwZSI6ICJPcGVyYXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfb3BlcmF0aW9uUmVmX21lc3NhZ2VFdmVudERlZmluaXRpb24iLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJDb25kaXRpb25hbEV2ZW50RGVmaW5pdGlvbiIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJFdmVudERlZmluaXRpb24iCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImNvbmRpdGlvbiIsCiAgICAgICAgICAidHlwZSI6ICJFeHByZXNzaW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2NvbmRpdGlvbl9jb25kaXRpb25hbEV2ZW50RGVmaW5pdGlvbiIsCiAgICAgICAgICAic2VyaWFsaXplIjogInhzaTp0eXBlIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiU2lnbmFsRXZlbnREZWZpbml0aW9uIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkV2ZW50RGVmaW5pdGlvbiIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAic2lnbmFsUmVmIiwKICAgICAgICAgICJ0eXBlIjogIlNpZ25hbCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9zaWduYWxSZWZfc2lnbmFsRXZlbnREZWZpbml0aW9uIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiU2lnbmFsIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIlJvb3RFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJzdHJ1Y3R1cmVSZWYiLAogICAgICAgICAgInR5cGUiOiAiSXRlbURlZmluaXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfc3RydWN0dXJlUmVmX3NpZ25hbCIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm5hbWUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJJbXBsaWNpdFRocm93RXZlbnQiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiVGhyb3dFdmVudCIKICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiRGF0YVN0YXRlIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkJhc2VFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiSXRlbUF3YXJlRWxlbWVudCIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJCYXNlRWxlbWVudCIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaXRlbVN1YmplY3RSZWYiLAogICAgICAgICAgInR5cGUiOiAiSXRlbURlZmluaXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfaXRlbVN1YmplY3RSZWZfaXRlbUF3YXJlRWxlbWVudCIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImRhdGFTdGF0ZSIsCiAgICAgICAgICAidHlwZSI6ICJEYXRhU3RhdGUiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfZGF0YVN0YXRlX2l0ZW1Bd2FyZUVsZW1lbnQiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJEYXRhQXNzb2NpYXRpb24iLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInRyYW5zZm9ybWF0aW9uIiwKICAgICAgICAgICJ0eXBlIjogIkZvcm1hbEV4cHJlc3Npb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfdHJhbnNmb3JtYXRpb25fZGF0YUFzc29jaWF0aW9uIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiYXNzaWdubWVudCIsCiAgICAgICAgICAidHlwZSI6ICJBc3NpZ25tZW50IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2Fzc2lnbm1lbnRfZGF0YUFzc29jaWF0aW9uIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJzb3VyY2VSZWYiLAogICAgICAgICAgInR5cGUiOiAiSXRlbUF3YXJlRWxlbWVudCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9zb3VyY2VSZWZfZGF0YUFzc29jaWF0aW9uIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAidGFyZ2V0UmVmIiwKICAgICAgICAgICJ0eXBlIjogIkl0ZW1Bd2FyZUVsZW1lbnQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfdGFyZ2V0UmVmX2RhdGFBc3NvY2lhdGlvbiIsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJEYXRhSW5wdXQiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiSXRlbUF3YXJlRWxlbWVudCIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibmFtZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImlzQ29sbGVjdGlvbiIsCiAgICAgICAgICAiZGVmYXVsdCI6IGZhbHNlLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJCb29sZWFuIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaW5wdXRTZXRSZWZzIiwKICAgICAgICAgICJ0eXBlIjogIklucHV0U2V0IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2RhdGFJbnB1dFJlZnNfaW5wdXRTZXRSZWZzIiwKICAgICAgICAgICJpc1ZpcnR1YWwiOiB0cnVlLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbnB1dFNldFdpdGhPcHRpb25hbCIsCiAgICAgICAgICAidHlwZSI6ICJJbnB1dFNldCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9vcHRpb25hbElucHV0UmVmc19pbnB1dFNldFdpdGhPcHRpb25hbCIsCiAgICAgICAgICAiaXNWaXJ0dWFsIjogdHJ1ZSwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaW5wdXRTZXRXaXRoV2hpbGVFeGVjdXRpbmciLAogICAgICAgICAgInR5cGUiOiAiSW5wdXRTZXQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfd2hpbGVFeGVjdXRpbmdJbnB1dFJlZnNfaW5wdXRTZXRXaXRoV2hpbGVFeGVjdXRpbmciLAogICAgICAgICAgImlzVmlydHVhbCI6IHRydWUsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkRhdGFPdXRwdXQiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiSXRlbUF3YXJlRWxlbWVudCIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibmFtZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImlzQ29sbGVjdGlvbiIsCiAgICAgICAgICAiZGVmYXVsdCI6IGZhbHNlLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJCb29sZWFuIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAib3V0cHV0U2V0UmVmcyIsCiAgICAgICAgICAidHlwZSI6ICJPdXRwdXRTZXQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfZGF0YU91dHB1dFJlZnNfb3V0cHV0U2V0UmVmcyIsCiAgICAgICAgICAiaXNWaXJ0dWFsIjogdHJ1ZSwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAib3V0cHV0U2V0V2l0aE9wdGlvbmFsIiwKICAgICAgICAgICJ0eXBlIjogIk91dHB1dFNldCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9vdXRwdXRTZXRXaXRoT3B0aW9uYWxfb3B0aW9uYWxPdXRwdXRSZWZzIiwKICAgICAgICAgICJpc1ZpcnR1YWwiOiB0cnVlLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJvdXRwdXRTZXRXaXRoV2hpbGVFeGVjdXRpbmciLAogICAgICAgICAgInR5cGUiOiAiT3V0cHV0U2V0IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX291dHB1dFNldFdpdGhXaGlsZUV4ZWN1dGluZ193aGlsZUV4ZWN1dGluZ091dHB1dFJlZnMiLAogICAgICAgICAgImlzVmlydHVhbCI6IHRydWUsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIklucHV0U2V0IiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkJhc2VFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZGF0YUlucHV0UmVmcyIsCiAgICAgICAgICAidHlwZSI6ICJEYXRhSW5wdXQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfZGF0YUlucHV0UmVmc19pbnB1dFNldFJlZnMiLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJvcHRpb25hbElucHV0UmVmcyIsCiAgICAgICAgICAidHlwZSI6ICJEYXRhSW5wdXQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfb3B0aW9uYWxJbnB1dFJlZnNfaW5wdXRTZXRXaXRoT3B0aW9uYWwiLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ3aGlsZUV4ZWN1dGluZ0lucHV0UmVmcyIsCiAgICAgICAgICAidHlwZSI6ICJEYXRhSW5wdXQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfd2hpbGVFeGVjdXRpbmdJbnB1dFJlZnNfaW5wdXRTZXRXaXRoV2hpbGVFeGVjdXRpbmciLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJvdXRwdXRTZXRSZWZzIiwKICAgICAgICAgICJ0eXBlIjogIk91dHB1dFNldCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9pbnB1dFNldFJlZnNfb3V0cHV0U2V0UmVmcyIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIk91dHB1dFNldCIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJCYXNlRWxlbWVudCIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZGF0YU91dHB1dFJlZnMiLAogICAgICAgICAgInR5cGUiOiAiRGF0YU91dHB1dCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9kYXRhT3V0cHV0UmVmc19vdXRwdXRTZXRSZWZzIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibmFtZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImlucHV0U2V0UmVmcyIsCiAgICAgICAgICAidHlwZSI6ICJJbnB1dFNldCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9pbnB1dFNldFJlZnNfb3V0cHV0U2V0UmVmcyIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm9wdGlvbmFsT3V0cHV0UmVmcyIsCiAgICAgICAgICAidHlwZSI6ICJEYXRhT3V0cHV0IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX291dHB1dFNldFdpdGhPcHRpb25hbF9vcHRpb25hbE91dHB1dFJlZnMiLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ3aGlsZUV4ZWN1dGluZ091dHB1dFJlZnMiLAogICAgICAgICAgInR5cGUiOiAiRGF0YU91dHB1dCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9vdXRwdXRTZXRXaXRoV2hpbGVFeGVjdXRpbmdfd2hpbGVFeGVjdXRpbmdPdXRwdXRSZWZzIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiUHJvcGVydHkiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiSXRlbUF3YXJlRWxlbWVudCIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibmFtZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkRhdGFJbnB1dEFzc29jaWF0aW9uIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkRhdGFBc3NvY2lhdGlvbiIKICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiRGF0YU91dHB1dEFzc29jaWF0aW9uIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkRhdGFBc3NvY2lhdGlvbiIKICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiSW5wdXRPdXRwdXRTcGVjaWZpY2F0aW9uIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkJhc2VFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbnB1dFNldHMiLAogICAgICAgICAgInR5cGUiOiAiSW5wdXRTZXQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfaW5wdXRTZXRzX2lucHV0T3V0cHV0U3BlY2lmaWNhdGlvbiIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAib3V0cHV0U2V0cyIsCiAgICAgICAgICAidHlwZSI6ICJPdXRwdXRTZXQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfb3V0cHV0U2V0c19pbnB1dE91dHB1dFNwZWNpZmljYXRpb24iLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImRhdGFJbnB1dHMiLAogICAgICAgICAgInR5cGUiOiAiRGF0YUlucHV0IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2RhdGFJbnB1dHNfaW5wdXRPdXRwdXRTcGVjaWZpY2F0aW9uIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJkYXRhT3V0cHV0cyIsCiAgICAgICAgICAidHlwZSI6ICJEYXRhT3V0cHV0IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2RhdGFPdXRwdXRzX2lucHV0T3V0cHV0U3BlY2lmaWNhdGlvbiIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiRGF0YU9iamVjdCIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJGbG93RWxlbWVudCIsCiAgICAgICAgIkl0ZW1Bd2FyZUVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImlzQ29sbGVjdGlvbiIsCiAgICAgICAgICAiZGVmYXVsdCI6IGZhbHNlLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJCb29sZWFuIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiSW5wdXRPdXRwdXRCaW5kaW5nIiwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaW5wdXREYXRhUmVmIiwKICAgICAgICAgICJ0eXBlIjogIklucHV0U2V0IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2lucHV0RGF0YVJlZl9pbnB1dE91dHB1dEJpbmRpbmciLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJvdXRwdXREYXRhUmVmIiwKICAgICAgICAgICJ0eXBlIjogIk91dHB1dFNldCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9vdXRwdXREYXRhUmVmX2lucHV0T3V0cHV0QmluZGluZyIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm9wZXJhdGlvblJlZiIsCiAgICAgICAgICAidHlwZSI6ICJPcGVyYXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfb3BlcmF0aW9uUmVmX2lvQmluZGluZyIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkFzc2lnbm1lbnQiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImZyb20iLAogICAgICAgICAgInR5cGUiOiAiRXhwcmVzc2lvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9mcm9tX2Fzc2lnbm1lbnQiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0byIsCiAgICAgICAgICAidHlwZSI6ICJFeHByZXNzaW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3RvX2Fzc2lnbm1lbnQiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJEYXRhU3RvcmUiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiUm9vdEVsZW1lbnQiLAogICAgICAgICJJdGVtQXdhcmVFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiY2FwYWNpdHkiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJJbnRlZ2VyIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaXNVbmxpbWl0ZWQiLAogICAgICAgICAgImRlZmF1bHQiOiB0cnVlLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJCb29sZWFuIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiRGF0YVN0b3JlUmVmZXJlbmNlIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkl0ZW1Bd2FyZUVsZW1lbnQiLAogICAgICAgICJGbG93RWxlbWVudCIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZGF0YVN0b3JlUmVmIiwKICAgICAgICAgICJ0eXBlIjogIkRhdGFTdG9yZSIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9kYXRhU3RvcmVSZWZfZGF0YVN0b3JlUmVmZXJlbmNlIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiRGF0YU9iamVjdFJlZmVyZW5jZSIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJJdGVtQXdhcmVFbGVtZW50IiwKICAgICAgICAiRmxvd0VsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImRhdGFPYmplY3RSZWYiLAogICAgICAgICAgInR5cGUiOiAiRGF0YU9iamVjdCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9kYXRhT2JqZWN0UmVmX2RhdGFPYmplY3QiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJDb252ZXJzYXRpb25MaW5rIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkJhc2VFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJzb3VyY2VSZWYiLAogICAgICAgICAgInR5cGUiOiAiSW50ZXJhY3Rpb25Ob2RlIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3NvdXJjZVJlZl9vdXRnb2luZ0NvbnZlcnNhdGlvbkxpbmtzIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAidGFyZ2V0UmVmIiwKICAgICAgICAgICJ0eXBlIjogIkludGVyYWN0aW9uTm9kZSIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV90YXJnZXRSZWZfaW5jb21pbmdDb252ZXJzYXRpb25MaW5rcyIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm5hbWUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJDb252ZXJzYXRpb25Bc3NvY2lhdGlvbiIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJCYXNlRWxlbWVudCIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaW5uZXJDb252ZXJzYXRpb25Ob2RlUmVmIiwKICAgICAgICAgICJ0eXBlIjogIkNvbnZlcnNhdGlvbk5vZGUiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfaW5uZXJDb252ZXJzYXRpb25Ob2RlUmVmX2NvbnZlcnNhdGlvbkFzc29jaWF0aW9uIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAib3V0ZXJDb252ZXJzYXRpb25Ob2RlUmVmIiwKICAgICAgICAgICJ0eXBlIjogIkNvbnZlcnNhdGlvbk5vZGUiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfb3V0ZXJDb252ZXJzYXRpb25Ob2RlUmVmX2NvbnZlcnNhdGlvbkFzc29jaWF0aW9uIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiQ2FsbENvbnZlcnNhdGlvbiIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJDb252ZXJzYXRpb25Ob2RlIgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjYWxsZWRDb2xsYWJvcmF0aW9uUmVmIiwKICAgICAgICAgICJ0eXBlIjogIkNvbGxhYm9yYXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfY2FsbGVkQ29sbGFib3JhdGlvblJlZl9jYWxsQ29udmVyc2F0aW9uIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicGFydGljaXBhbnRBc3NvY2lhdGlvbnMiLAogICAgICAgICAgInR5cGUiOiAiUGFydGljaXBhbnRBc3NvY2lhdGlvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9wYXJ0aWNpcGFudEFzc29jaWF0aW9uc19jYWxsQ29udmVyc2F0aW9uIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJDb252ZXJzYXRpb24iLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQ29udmVyc2F0aW9uTm9kZSIKICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiU3ViQ29udmVyc2F0aW9uIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkNvbnZlcnNhdGlvbk5vZGUiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImNvbnZlcnNhdGlvbk5vZGVzIiwKICAgICAgICAgICJ0eXBlIjogIkNvbnZlcnNhdGlvbk5vZGUiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfY29udmVyc2F0aW9uTm9kZXNfc3ViQ29udmVyc2F0aW9uIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJDb252ZXJzYXRpb25Ob2RlIiwKICAgICAgImlzQWJzdHJhY3QiOiB0cnVlLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiSW50ZXJhY3Rpb25Ob2RlIiwKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm5hbWUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJwYXJ0aWNpcGFudFJlZnMiLAogICAgICAgICAgInR5cGUiOiAiUGFydGljaXBhbnQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfcGFydGljaXBhbnRSZWZzX2NvbnZlcnNhdGlvbk5vZGUiLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJtZXNzYWdlRmxvd1JlZnMiLAogICAgICAgICAgInR5cGUiOiAiTWVzc2FnZUZsb3ciLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfbWVzc2FnZUZsb3dSZWZzX2NvbW11bmljYXRpb24iLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjb3JyZWxhdGlvbktleXMiLAogICAgICAgICAgInR5cGUiOiAiQ29ycmVsYXRpb25LZXkiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfY29ycmVsYXRpb25LZXlzX2NvbnZlcnNhdGlvbk5vZGUiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkdsb2JhbENvbnZlcnNhdGlvbiIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJDb2xsYWJvcmF0aW9uIgogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJQYXJ0bmVyRW50aXR5IiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIlJvb3RFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicGFydGljaXBhbnRSZWYiLAogICAgICAgICAgInR5cGUiOiAiUGFydGljaXBhbnQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfcGFydG5lckVudGl0eVJlZl9wYXJ0aWNpcGFudFJlZiIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIlBhcnRuZXJSb2xlIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIlJvb3RFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicGFydGljaXBhbnRSZWYiLAogICAgICAgICAgInR5cGUiOiAiUGFydGljaXBhbnQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfcGFydG5lclJvbGVSZWZfcGFydGljaXBhbnRSZWYiLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJDb3JyZWxhdGlvblByb3BlcnR5IiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIlJvb3RFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjb3JyZWxhdGlvblByb3BlcnR5UmV0cmlldmFsRXhwcmVzc2lvbiIsCiAgICAgICAgICAidHlwZSI6ICJDb3JyZWxhdGlvblByb3BlcnR5UmV0cmlldmFsRXhwcmVzc2lvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9jb3JyZWxhdGlvblByb3BlcnR5UmV0cmlldmFsRXhwcmVzc2lvbl9jb3JyZWxhdGlvbnByb3BlcnR5IiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAidHlwZSIsCiAgICAgICAgICAidHlwZSI6ICJJdGVtRGVmaW5pdGlvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV90eXBlX2NvcnJlbGF0aW9uUHJvcGVydHkiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJFcnJvciIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJSb290RWxlbWVudCIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAic3RydWN0dXJlUmVmIiwKICAgICAgICAgICJ0eXBlIjogIkl0ZW1EZWZpbml0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3N0cnVjdHVyZVJlZl9lcnJvciIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm5hbWUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJlcnJvckNvZGUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJDb3JyZWxhdGlvbktleSIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJCYXNlRWxlbWVudCIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiY29ycmVsYXRpb25Qcm9wZXJ0eVJlZiIsCiAgICAgICAgICAidHlwZSI6ICJDb3JyZWxhdGlvblByb3BlcnR5IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2NvcnJlbGF0aW9uUHJvcGVydHlSZWZfY29ycmVsYXRpb25LZXkiLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiRXhwcmVzc2lvbiIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJCYXNlRWxlbWVudCIKICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiRm9ybWFsRXhwcmVzc2lvbiIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJFeHByZXNzaW9uIgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJsYW5ndWFnZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImJvZHkiLAogICAgICAgICAgInR5cGUiOiAiRWxlbWVudCIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImV2YWx1YXRlc1RvVHlwZVJlZiIsCiAgICAgICAgICAidHlwZSI6ICJJdGVtRGVmaW5pdGlvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9ldmFsdWF0ZXNUb1R5cGVSZWZfZm9ybWFsRXhwcmVzc2lvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIk1lc3NhZ2UiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiUm9vdEVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm5hbWUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpdGVtUmVmIiwKICAgICAgICAgICJ0eXBlIjogIkl0ZW1EZWZpbml0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2l0ZW1SZWZfbWVzc2FnZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkl0ZW1EZWZpbml0aW9uIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIlJvb3RFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpdGVtS2luZCIsCiAgICAgICAgICAidHlwZSI6ICJJdGVtS2luZCIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAic3RydWN0dXJlUmVmIiwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaXNDb2xsZWN0aW9uIiwKICAgICAgICAgICJkZWZhdWx0IjogZmFsc2UsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIkJvb2xlYW4iCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbXBvcnQiLAogICAgICAgICAgInR5cGUiOiAiSW1wb3J0IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2ltcG9ydF9pdGVtRGVmaW5pdGlvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkZsb3dFbGVtZW50IiwKICAgICAgImlzQWJzdHJhY3QiOiB0cnVlLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm5hbWUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJhdWRpdGluZyIsCiAgICAgICAgICAidHlwZSI6ICJBdWRpdGluZyIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9hdWRpdGluZ19mbG93RWxlbWVudCIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm1vbml0b3JpbmciLAogICAgICAgICAgInR5cGUiOiAiTW9uaXRvcmluZyIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9tb25pdG9yaW5nX2Zsb3dFbGVtZW50IgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiY2F0ZWdvcnlWYWx1ZVJlZiIsCiAgICAgICAgICAidHlwZSI6ICJDYXRlZ29yeVZhbHVlIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2NhdGVnb3JpemVkRmxvd0VsZW1lbnRzX2NhdGVnb3J5VmFsdWVSZWYiLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJTZXF1ZW5jZUZsb3ciLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiRmxvd0VsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImlzSW1tZWRpYXRlIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiQm9vbGVhbiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImNvbmRpdGlvbkV4cHJlc3Npb24iLAogICAgICAgICAgInR5cGUiOiAiRXhwcmVzc2lvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9jb25kaXRpb25FeHByZXNzaW9uX3NlcXVlbmNlRmxvdyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInNvdXJjZVJlZiIsCiAgICAgICAgICAidHlwZSI6ICJGbG93Tm9kZSIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9zb3VyY2VSZWZfb3V0Z29pbmdfZmxvdyIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInRhcmdldFJlZiIsCiAgICAgICAgICAidHlwZSI6ICJGbG93Tm9kZSIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV90YXJnZXRSZWZfaW5jb21pbmdfZmxvdyIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkZsb3dFbGVtZW50c0NvbnRhaW5lciIsCiAgICAgICJpc0Fic3RyYWN0IjogdHJ1ZSwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkJhc2VFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJsYW5lU2V0cyIsCiAgICAgICAgICAidHlwZSI6ICJMYW5lU2V0IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2xhbmVTZXRzX2Zsb3dFbGVtZW50c0NvbnRhaW5lciIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZmxvd0VsZW1lbnRzIiwKICAgICAgICAgICJ0eXBlIjogIkZsb3dFbGVtZW50IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2Zsb3dFbGVtZW50c19jb250YWluZXIiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkNhbGxhYmxlRWxlbWVudCIsCiAgICAgICJpc0Fic3RyYWN0IjogdHJ1ZSwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIlJvb3RFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaW9TcGVjaWZpY2F0aW9uIiwKICAgICAgICAgICJ0eXBlIjogIklucHV0T3V0cHV0U3BlY2lmaWNhdGlvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9pb1NwZWNpZmljYXRpb25fY2FsbGFibGVFbGVtZW50IgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAic3VwcG9ydGVkSW50ZXJmYWNlUmVmcyIsCiAgICAgICAgICAidHlwZSI6ICJJbnRlcmZhY2UiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfc3VwcG9ydGVkSW50ZXJmYWNlUmVmc19jYWxsYWJsZUVsZW1lbnRzIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaW9CaW5kaW5nIiwKICAgICAgICAgICJ0eXBlIjogIklucHV0T3V0cHV0QmluZGluZyIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9pb0JpbmRpbmdfY2FsbGFibGVFbGVtZW50IiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJGbG93Tm9kZSIsCiAgICAgICJpc0Fic3RyYWN0IjogdHJ1ZSwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkZsb3dFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbmNvbWluZyIsCiAgICAgICAgICAidHlwZSI6ICJTZXF1ZW5jZUZsb3ciLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfdGFyZ2V0UmVmX2luY29taW5nX2Zsb3ciLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJvdXRnb2luZyIsCiAgICAgICAgICAidHlwZSI6ICJTZXF1ZW5jZUZsb3ciLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfc291cmNlUmVmX291dGdvaW5nX2Zsb3ciLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJsYW5lcyIsCiAgICAgICAgICAidHlwZSI6ICJMYW5lIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2Zsb3dOb2RlUmVmc19sYW5lcyIsCiAgICAgICAgICAiaXNWaXJ0dWFsIjogdHJ1ZSwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiQ29ycmVsYXRpb25Qcm9wZXJ0eVJldHJpZXZhbEV4cHJlc3Npb24iLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm1lc3NhZ2VQYXRoIiwKICAgICAgICAgICJ0eXBlIjogIkZvcm1hbEV4cHJlc3Npb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfbWVzc2FnZVBhdGhfY29ycmVsYXRpb25zZXQiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJtZXNzYWdlUmVmIiwKICAgICAgICAgICJ0eXBlIjogIk1lc3NhZ2UiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfbWVzc2FnZVJlZl9jb3JyZWxhdGlvblByb3BlcnR5UmV0cmlldmFsRXhwcmVzc2lvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkNvcnJlbGF0aW9uUHJvcGVydHlCaW5kaW5nIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkJhc2VFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJkYXRhUGF0aCIsCiAgICAgICAgICAidHlwZSI6ICJGb3JtYWxFeHByZXNzaW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2RhdGFQYXRoX2NvcnJlbGF0aW9uUHJvcGVydHlCaW5kaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiY29ycmVsYXRpb25Qcm9wZXJ0eVJlZiIsCiAgICAgICAgICAidHlwZSI6ICJDb3JyZWxhdGlvblByb3BlcnR5IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2NvcnJlbGF0aW9uUHJvcGVydHlSZWZfY29ycmVsYXRpb25Qcm9wZXJ0eUJpbmRpbmciLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJSZXNvdXJjZSIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJSb290RWxlbWVudCIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibmFtZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInJlc291cmNlUGFyYW1ldGVycyIsCiAgICAgICAgICAidHlwZSI6ICJSZXNvdXJjZVBhcmFtZXRlciIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9yZXNvdXJjZVBhcmFtZXRlcnNfcmVzb3VyY2UiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIlJlc291cmNlUGFyYW1ldGVyIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkJhc2VFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaXNSZXF1aXJlZCIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIkJvb2xlYW4iCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0eXBlIiwKICAgICAgICAgICJ0eXBlIjogIkl0ZW1EZWZpbml0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3R5cGVfcmVzb3VyY2VQYXJhbWV0ZXIiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJDb3JyZWxhdGlvblN1YnNjcmlwdGlvbiIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJCYXNlRWxlbWVudCIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiY29ycmVsYXRpb25LZXlSZWYiLAogICAgICAgICAgInR5cGUiOiAiQ29ycmVsYXRpb25LZXkiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfY29ycmVsYXRpb25LZXlSZWZfY29ycmVsYXRpb25TdWJzY3JpcHRpb24iLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjb3JyZWxhdGlvblByb3BlcnR5QmluZGluZyIsCiAgICAgICAgICAidHlwZSI6ICJDb3JyZWxhdGlvblByb3BlcnR5QmluZGluZyIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9jb3JyZWxhdGlvblByb3BlcnR5QmluZGluZ19jb3JyZWxhdGlvblN1YnNjcmlwdGlvbiIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiTWVzc2FnZUZsb3ciLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm5hbWUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJzb3VyY2VSZWYiLAogICAgICAgICAgInR5cGUiOiAiSW50ZXJhY3Rpb25Ob2RlIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3NvdXJjZVJlZl9tZXNzYWdlRmxvdyIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInRhcmdldFJlZiIsCiAgICAgICAgICAidHlwZSI6ICJJbnRlcmFjdGlvbk5vZGUiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfdGFyZ2V0UmVmX21lc3NhZ2VGbG93IiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibWVzc2FnZVJlZiIsCiAgICAgICAgICAidHlwZSI6ICJNZXNzYWdlIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX21lc3NhZ2VSZWZfbWVzc2FnZUZsb3ciLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJNZXNzYWdlRmxvd0Fzc29jaWF0aW9uIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkJhc2VFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbm5lck1lc3NhZ2VGbG93UmVmIiwKICAgICAgICAgICJ0eXBlIjogIk1lc3NhZ2VGbG93IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2lubmVyTWVzc2FnZUZsb3dSZWZfbWVzc2FnZUZsb3dBc3NvY2lhdGlvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm91dGVyTWVzc2FnZUZsb3dSZWYiLAogICAgICAgICAgInR5cGUiOiAiTWVzc2FnZUZsb3ciLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfb3V0ZXJNZXNzYWdlRmxvd1JlZl9tZXNzYWdlRmxvd0Fzc29jaWF0aW9uIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiSW50ZXJhY3Rpb25Ob2RlIiwKICAgICAgImlzQWJzdHJhY3QiOiB0cnVlLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbmNvbWluZ0NvbnZlcnNhdGlvbkxpbmtzIiwKICAgICAgICAgICJ0eXBlIjogIkNvbnZlcnNhdGlvbkxpbmsiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfdGFyZ2V0UmVmX2luY29taW5nQ29udmVyc2F0aW9uTGlua3MiLAogICAgICAgICAgImlzVmlydHVhbCI6IHRydWUsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm91dGdvaW5nQ29udmVyc2F0aW9uTGlua3MiLAogICAgICAgICAgInR5cGUiOiAiQ29udmVyc2F0aW9uTGluayIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9zb3VyY2VSZWZfb3V0Z29pbmdDb252ZXJzYXRpb25MaW5rcyIsCiAgICAgICAgICAiaXNWaXJ0dWFsIjogdHJ1ZSwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiUGFydGljaXBhbnQiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiSW50ZXJhY3Rpb25Ob2RlIiwKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm5hbWUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbnRlcmZhY2VSZWZzIiwKICAgICAgICAgICJ0eXBlIjogIkludGVyZmFjZSIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9pbnRlcmZhY2VSZWZzX3BhcnRpY2lwYW50IiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicGFydGljaXBhbnRNdWx0aXBsaWNpdHkiLAogICAgICAgICAgInR5cGUiOiAiUGFydGljaXBhbnRNdWx0aXBsaWNpdHkiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfcGFydGljaXBhbnRNdWx0aXBsaWNpdHlfcGFydGljaXBhbnQiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJlbmRQb2ludFJlZnMiLAogICAgICAgICAgInR5cGUiOiAiRW5kUG9pbnQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfZW5kUG9pbnRSZWZzX3BhcnRpY2lwYW50IiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicHJvY2Vzc1JlZiIsCiAgICAgICAgICAidHlwZSI6ICJQcm9jZXNzIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3Byb2Nlc3NSZWZfcGFydGljaXBhbnQiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJQYXJ0aWNpcGFudEFzc29jaWF0aW9uIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkJhc2VFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbm5lclBhcnRpY2lwYW50UmVmIiwKICAgICAgICAgICJ0eXBlIjogIlBhcnRpY2lwYW50IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2lubmVyUGFydGljaXBhbnRSZWZfcGFydGljaXBhbnRBc3NvY2lhdGlvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm91dGVyUGFydGljaXBhbnRSZWYiLAogICAgICAgICAgInR5cGUiOiAiUGFydGljaXBhbnQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfb3V0ZXJQYXJ0aWNpcGFudFJlZl9wYXJ0aWNpcGFudEFzc29jaWF0aW9uIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiUGFydGljaXBhbnRNdWx0aXBsaWNpdHkiLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJtaW5pbXVtIiwKICAgICAgICAgICJkZWZhdWx0IjogIjAiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJJbnRlZ2VyIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibWF4aW11bSIsCiAgICAgICAgICAiZGVmYXVsdCI6ICIxIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiSW50ZWdlciIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkNvbGxhYm9yYXRpb24iLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiUm9vdEVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm5hbWUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpc0Nsb3NlZCIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIkJvb2xlYW4iCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjaG9yZW9ncmFwaHlSZWYiLAogICAgICAgICAgInR5cGUiOiAiQ2hvcmVvZ3JhcGh5IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2Nob3Jlb2dyYXBoeVJlZl9jb2xsYWJvcmF0aW9uIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiYXJ0aWZhY3RzIiwKICAgICAgICAgICJ0eXBlIjogIkFydGlmYWN0IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2FydGlmYWN0c19jb2xsYWJvcmF0aW9uIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJwYXJ0aWNpcGFudEFzc29jaWF0aW9ucyIsCiAgICAgICAgICAidHlwZSI6ICJQYXJ0aWNpcGFudEFzc29jaWF0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3BhcnRpY2lwYW50QXNzb2NpYXRpb25zX2NvbGxhYm9yYXRpb24iLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm1lc3NhZ2VGbG93QXNzb2NpYXRpb25zIiwKICAgICAgICAgICJ0eXBlIjogIk1lc3NhZ2VGbG93QXNzb2NpYXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfbWVzc2FnZUZsb3dBc3NvY2lhdGlvbnNfY29sbGFib3JhdGlvbiIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiY29udmVyc2F0aW9uQXNzb2NpYXRpb25zIiwKICAgICAgICAgICJ0eXBlIjogIkNvbnZlcnNhdGlvbkFzc29jaWF0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2NvbnZlcnNhdGlvbkFzc29jaWF0aW9uc19jb252ZXJzdGFpb25Bc3NvY2lhdGlvbnMiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJwYXJ0aWNpcGFudHMiLAogICAgICAgICAgInR5cGUiOiAiUGFydGljaXBhbnQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfcGFydGljaXBhbnRzX2NvbGxhYm9yYXRpb24iLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm1lc3NhZ2VGbG93cyIsCiAgICAgICAgICAidHlwZSI6ICJNZXNzYWdlRmxvdyIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9tZXNzYWdlRmxvd3NfY29sbGFib3JhdGlvbiIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiY29ycmVsYXRpb25LZXlzIiwKICAgICAgICAgICJ0eXBlIjogIkNvcnJlbGF0aW9uS2V5IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2NvcnJlbGF0aW9uS2V5c19jb2xsYWJvcmF0aW9uIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjb252ZXJzYXRpb25zIiwKICAgICAgICAgICJ0eXBlIjogIkNvbnZlcnNhdGlvbk5vZGUiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfY29udmVyc2F0aW9uc19jb2xsYWJvcmF0aW9uIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjb252ZXJzYXRpb25MaW5rcyIsCiAgICAgICAgICAidHlwZSI6ICJDb252ZXJzYXRpb25MaW5rIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2NvbnZlcnNhdGlvbkxpbmtzX2NvbGxhYm9yYXRpb24iLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkNob3Jlb2dyYXBoeUFjdGl2aXR5IiwKICAgICAgImlzQWJzdHJhY3QiOiB0cnVlLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiRmxvd05vZGUiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInBhcnRpY2lwYW50UmVmcyIsCiAgICAgICAgICAidHlwZSI6ICJQYXJ0aWNpcGFudCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9wYXJ0aWNpcGFudFJlZnNfY2hvcmVvZ3JhcGh5QWN0aXZpdHkiLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbml0aWF0aW5nUGFydGljaXBhbnRSZWYiLAogICAgICAgICAgInR5cGUiOiAiUGFydGljaXBhbnQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfaW5pdGlhdGluZ1BhcnRpY2lwYW50UmVmX2Nob3Jlb2dyYXBoeUFjdGl2aXR5IiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiY29ycmVsYXRpb25LZXlzIiwKICAgICAgICAgICJ0eXBlIjogIkNvcnJlbGF0aW9uS2V5IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2NvcnJlbGF0aW9uS2V5c19jaG9yZW9ncmFwaHlBY3Rpdml0eSIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibG9vcFR5cGUiLAogICAgICAgICAgInR5cGUiOiAiQ2hvcmVvZ3JhcGh5TG9vcFR5cGUiLAogICAgICAgICAgImRlZmF1bHQiOiAiTm9uZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiQ2FsbENob3Jlb2dyYXBoeSIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJDaG9yZW9ncmFwaHlBY3Rpdml0eSIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiY2FsbGVkQ2hvcmVvZ3JhcGh5UmVmIiwKICAgICAgICAgICJ0eXBlIjogIkNob3Jlb2dyYXBoeSIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9jYWxsZWRDaG9yZW9ncmFwaHlSZWZfY2FsbENob3Jlb2dyYXBoeUFjdGl2aXR5IiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicGFydGljaXBhbnRBc3NvY2lhdGlvbnMiLAogICAgICAgICAgInR5cGUiOiAiUGFydGljaXBhbnRBc3NvY2lhdGlvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9wYXJ0aWNpcGFudEFzc29jaWF0aW9uc19jYWxsQ2hvcmVvZ3JhcGh5QWN0aXZpdHkiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIlN1YkNob3Jlb2dyYXBoeSIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJDaG9yZW9ncmFwaHlBY3Rpdml0eSIsCiAgICAgICAgIkZsb3dFbGVtZW50c0NvbnRhaW5lciIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiYXJ0aWZhY3RzIiwKICAgICAgICAgICJ0eXBlIjogIkFydGlmYWN0IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2FydGlmYWN0c19zdWJDaG9yZW9ncmFwaHkiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkNob3Jlb2dyYXBoeVRhc2siLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQ2hvcmVvZ3JhcGh5QWN0aXZpdHkiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm1lc3NhZ2VGbG93UmVmIiwKICAgICAgICAgICJ0eXBlIjogIk1lc3NhZ2VGbG93IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX21lc3NhZ2VGbG93UmVmX2Nob3Jlb2dyYXBoeVRhc2siLAogICAgICAgICAgImlzTWFueSI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJDaG9yZW9ncmFwaHkiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiRmxvd0VsZW1lbnRzQ29udGFpbmVyIiwKICAgICAgICAiQ29sbGFib3JhdGlvbiIKICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiR2xvYmFsQ2hvcmVvZ3JhcGh5VGFzayIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJDaG9yZW9ncmFwaHkiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImluaXRpYXRpbmdQYXJ0aWNpcGFudFJlZiIsCiAgICAgICAgICAidHlwZSI6ICJQYXJ0aWNpcGFudCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9pbml0aWF0aW5nUGFydGljaXBhbnRSZWZfZ2xvYmFsQ2hvcmVvZ3JhcGh5VGFzayIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIlRleHRBbm5vdGF0aW9uIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkFydGlmYWN0IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0ZXh0IiwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInRleHRGb3JtYXQiLAogICAgICAgICAgImRlZmF1bHQiOiAidGV4dC9wbGFpbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkdyb3VwIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkFydGlmYWN0IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjYXRlZ29yeVZhbHVlUmVmIiwKICAgICAgICAgICJ0eXBlIjogIkNhdGVnb3J5VmFsdWUiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfY2F0ZWdvcnlWYWx1ZVJlZl9jYXRlZ29yeVZhbHVlUmVmIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiQXNzb2NpYXRpb24iLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQXJ0aWZhY3QiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImFzc29jaWF0aW9uRGlyZWN0aW9uIiwKICAgICAgICAgICJ0eXBlIjogIkFzc29jaWF0aW9uRGlyZWN0aW9uIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJzb3VyY2VSZWYiLAogICAgICAgICAgInR5cGUiOiAiQmFzZUVsZW1lbnQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfc291cmNlUmVmX291dGdvaW5nX2Fzc29jaWF0aW9uIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAidGFyZ2V0UmVmIiwKICAgICAgICAgICJ0eXBlIjogIkJhc2VFbGVtZW50IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3RhcmdldFJlZl9pbmNvbWluZ19hc3NvY2lhdGlvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkNhdGVnb3J5IiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIlJvb3RFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjYXRlZ29yeVZhbHVlIiwKICAgICAgICAgICJ0eXBlIjogIkNhdGVnb3J5VmFsdWUiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfY2F0ZWdvcnlWYWx1ZV9jYXRlZ29yeSIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibmFtZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkFydGlmYWN0IiwKICAgICAgImlzQWJzdHJhY3QiOiB0cnVlLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkNhdGVnb3J5VmFsdWUiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImNhdGVnb3JpemVkRmxvd0VsZW1lbnRzIiwKICAgICAgICAgICJ0eXBlIjogIkZsb3dFbGVtZW50IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2NhdGVnb3JpemVkRmxvd0VsZW1lbnRzX2NhdGVnb3J5VmFsdWVSZWYiLAogICAgICAgICAgImlzVmlydHVhbCI6IHRydWUsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInZhbHVlIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiQWN0aXZpdHkiLAogICAgICAiaXNBYnN0cmFjdCI6IHRydWUsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJGbG93Tm9kZSIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaXNGb3JDb21wZW5zYXRpb24iLAogICAgICAgICAgImRlZmF1bHQiOiBmYWxzZSwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiQm9vbGVhbiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImxvb3BDaGFyYWN0ZXJpc3RpY3MiLAogICAgICAgICAgInR5cGUiOiAiTG9vcENoYXJhY3RlcmlzdGljcyIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9sb29wQ2hhcmFjdGVyaXN0aWNzX2FjdGl2aXR5IgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicmVzb3VyY2VzIiwKICAgICAgICAgICJ0eXBlIjogIlJlc291cmNlUm9sZSIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9yZXNvdXJjZXNfYWN0aXZpdHkiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImRlZmF1bHQiLAogICAgICAgICAgInR5cGUiOiAiU2VxdWVuY2VGbG93IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2RlZmF1bHRfYWN0aXZpdHkiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJwcm9wZXJ0aWVzIiwKICAgICAgICAgICJ0eXBlIjogIlByb3BlcnR5IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3Byb3BlcnRpZXNfYWN0aXZpdHkiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImlvU3BlY2lmaWNhdGlvbiIsCiAgICAgICAgICAidHlwZSI6ICJJbnB1dE91dHB1dFNwZWNpZmljYXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfaW9TcGVjaWZpY2F0aW9uX2FjdGl2aXR5IgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiYm91bmRhcnlFdmVudFJlZnMiLAogICAgICAgICAgInR5cGUiOiAiQm91bmRhcnlFdmVudCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9ib3VuZGFyeUV2ZW50UmVmc19hdHRhY2hlZFRvUmVmIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZGF0YUlucHV0QXNzb2NpYXRpb25zIiwKICAgICAgICAgICJ0eXBlIjogIkRhdGFJbnB1dEFzc29jaWF0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2RhdGFJbnB1dEFzc29jaWF0aW9uc19hY3Rpdml0eSIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZGF0YU91dHB1dEFzc29jaWF0aW9ucyIsCiAgICAgICAgICAidHlwZSI6ICJEYXRhT3V0cHV0QXNzb2NpYXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfZGF0YU91dHB1dEFzc29jaWF0aW9uc19hY3Rpdml0eSIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAic3RhcnRRdWFudGl0eSIsCiAgICAgICAgICAiZGVmYXVsdCI6ICIxIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiSW50ZWdlciIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImNvbXBsZXRpb25RdWFudGl0eSIsCiAgICAgICAgICAiZGVmYXVsdCI6ICIxIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiSW50ZWdlciIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIlNlcnZpY2VUYXNrIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIlRhc2siCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImltcGxlbWVudGF0aW9uIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAib3BlcmF0aW9uUmVmIiwKICAgICAgICAgICJ0eXBlIjogIk9wZXJhdGlvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9vcGVyYXRpb25SZWZfc2VydmljZVRhc2siLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJTdWJQcm9jZXNzIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkFjdGl2aXR5IiwKICAgICAgICAiRmxvd0VsZW1lbnRzQ29udGFpbmVyIgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0cmlnZ2VyZWRCeUV2ZW50IiwKICAgICAgICAgICJkZWZhdWx0IjogZmFsc2UsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIkJvb2xlYW4iCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJhcnRpZmFjdHMiLAogICAgICAgICAgInR5cGUiOiAiQXJ0aWZhY3QiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfYXJ0aWZhY3RzX3N1YlByb2Nlc3MiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkxvb3BDaGFyYWN0ZXJpc3RpY3MiLAogICAgICAiaXNBYnN0cmFjdCI6IHRydWUsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJCYXNlRWxlbWVudCIKICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiTXVsdGlJbnN0YW5jZUxvb3BDaGFyYWN0ZXJpc3RpY3MiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiTG9vcENoYXJhY3RlcmlzdGljcyIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaXNTZXF1ZW50aWFsIiwKICAgICAgICAgICJkZWZhdWx0IjogZmFsc2UsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIkJvb2xlYW4iCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJiZWhhdmlvciIsCiAgICAgICAgICAidHlwZSI6ICJNdWx0aUluc3RhbmNlQmVoYXZpb3IiLAogICAgICAgICAgImRlZmF1bHQiOiAiQWxsIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJsb29wQ2FyZGluYWxpdHkiLAogICAgICAgICAgInR5cGUiOiAiRXhwcmVzc2lvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9sb29wQ2FyZGluYWxpdHlfbXVsdGlJbnN0YW5jZUxvb3BDaGFyYWN0ZXJpc3RpY3MiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJsb29wRGF0YUlucHV0UmVmIiwKICAgICAgICAgICJ0eXBlIjogIkl0ZW1Bd2FyZUVsZW1lbnQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfbG9vcERhdGFJbnB1dFJlZl9tdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljcyIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImxvb3BEYXRhT3V0cHV0UmVmIiwKICAgICAgICAgICJ0eXBlIjogIkl0ZW1Bd2FyZUVsZW1lbnQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfbG9vcERhdGFPdXRwdXRSZWZfbXVsdGlJbnN0YW5jZUxvb3BDaGFyYWN0ZXJpc3RpY3MiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbnB1dERhdGFJdGVtIiwKICAgICAgICAgICJ0eXBlIjogIkRhdGFJbnB1dCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9pbnB1dERhdGFJdGVtX211bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWNzIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAib3V0cHV0RGF0YUl0ZW0iLAogICAgICAgICAgInR5cGUiOiAiRGF0YU91dHB1dCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9vdXRwdXREYXRhSXRlbV9tdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljcyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImNvbXBsZXRpb25Db25kaXRpb24iLAogICAgICAgICAgInR5cGUiOiAiRXhwcmVzc2lvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9jb21wbGV0aW9uQ29uZGl0aW9uX211bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWNzIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiY29tcGxleEJlaGF2aW9yRGVmaW5pdGlvbiIsCiAgICAgICAgICAidHlwZSI6ICJDb21wbGV4QmVoYXZpb3JEZWZpbml0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2NvbXBsZXhCZWhhdmlvckRlZmluaXRpb25fbXVsdGlJbnN0YW5jZUxvb3BDaGFyYWN0ZXJpc3RpY3MiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm9uZUJlaGF2aW9yRXZlbnRSZWYiLAogICAgICAgICAgInR5cGUiOiAiRXZlbnREZWZpbml0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX29uZUJlaGF2aW9yRXZlbnRSZWZfbXVsdGlJbnN0YW5jZUxvb3BDaGFyYWN0ZXJpc3RpY3MiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJub25lQmVoYXZpb3JFdmVudFJlZiIsCiAgICAgICAgICAidHlwZSI6ICJFdmVudERlZmluaXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfbm9uZUJlaGF2aW9yRXZlbnRSZWZfbXVsdGlJbnN0YW5jZUxvb3BDaGFyYWN0ZXJpc3RpY3MiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJTdGFuZGFyZExvb3BDaGFyYWN0ZXJpc3RpY3MiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiTG9vcENoYXJhY3RlcmlzdGljcyIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAidGVzdEJlZm9yZSIsCiAgICAgICAgICAiZGVmYXVsdCI6IGZhbHNlLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJCb29sZWFuIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibG9vcENvbmRpdGlvbiIsCiAgICAgICAgICAidHlwZSI6ICJFeHByZXNzaW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2xvb3BDb25kaXRpb25fc3RhbmRhcmRMb29wQ2hhcmFjdGVyaXN0aWNzIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibG9vcE1heGltdW0iLAogICAgICAgICAgInR5cGUiOiAiRXhwcmVzc2lvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9sb29wTWF4aW11bV9zdGFuZGFyZExvb3BDaGFyYWN0ZXJpc3RpY3MiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJDYWxsQWN0aXZpdHkiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQWN0aXZpdHkiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImNhbGxlZEVsZW1lbnQiLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2NhbGxlZEVsZW1lbnRSZWZfY2FsbEFjdGl2aXR5IiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJUYXNrIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkFjdGl2aXR5IiwKICAgICAgICAiSW50ZXJhY3Rpb25Ob2RlIgogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJTZW5kVGFzayIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJUYXNrIgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbXBsZW1lbnRhdGlvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm9wZXJhdGlvblJlZiIsCiAgICAgICAgICAidHlwZSI6ICJPcGVyYXRpb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfb3BlcmF0aW9uUmVmX3NlbmRUYXNrIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibWVzc2FnZVJlZiIsCiAgICAgICAgICAidHlwZSI6ICJNZXNzYWdlIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX21lc3NhZ2VSZWZfc2VuZFRhc2siLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJSZWNlaXZlVGFzayIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJUYXNrIgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbXBsZW1lbnRhdGlvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImluc3RhbnRpYXRlIiwKICAgICAgICAgICJkZWZhdWx0IjogZmFsc2UsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIkJvb2xlYW4iCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJvcGVyYXRpb25SZWYiLAogICAgICAgICAgInR5cGUiOiAiT3BlcmF0aW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX29wZXJhdGlvblJlZl9yZWNlaXZlVGFzayIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm1lc3NhZ2VSZWYiLAogICAgICAgICAgInR5cGUiOiAiTWVzc2FnZSIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9tZXNzYWdlUmVmX3JlY2VpdmVUYXNrIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiU2NyaXB0VGFzayIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJUYXNrIgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJzY3JpcHRGb3JtYXQiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJzY3JpcHQiLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiQnVzaW5lc3NSdWxlVGFzayIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJUYXNrIgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbXBsZW1lbnRhdGlvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkFkSG9jU3ViUHJvY2VzcyIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJTdWJQcm9jZXNzIgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjb21wbGV0aW9uQ29uZGl0aW9uIiwKICAgICAgICAgICJ0eXBlIjogIkV4cHJlc3Npb24iLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfY29tcGxldGlvbkNvbmRpdGlvbl9hZEhvY1N1YlByb2Nlc3MiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJvcmRlcmluZyIsCiAgICAgICAgICAidHlwZSI6ICJBZEhvY09yZGVyaW5nIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjYW5jZWxSZW1haW5pbmdJbnN0YW5jZXMiLAogICAgICAgICAgImRlZmF1bHQiOiB0cnVlLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJCb29sZWFuIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiVHJhbnNhY3Rpb24iLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiU3ViUHJvY2VzcyIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicHJvdG9jb2wiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJtZXRob2QiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJHbG9iYWxTY3JpcHRUYXNrIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkdsb2JhbFRhc2siCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInNjcmlwdExhbmd1YWdlIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAic2NyaXB0IiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiR2xvYmFsQnVzaW5lc3NSdWxlVGFzayIsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJHbG9iYWxUYXNrIgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbXBsZW1lbnRhdGlvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkNvbXBsZXhCZWhhdmlvckRlZmluaXRpb24iLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImNvbmRpdGlvbiIsCiAgICAgICAgICAidHlwZSI6ICJGb3JtYWxFeHByZXNzaW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2NvbmRpdGlvbl9jb21wbGV4QmVoYXZpb3JEZWZpbml0aW9uIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZXZlbnQiLAogICAgICAgICAgInR5cGUiOiAiSW1wbGljaXRUaHJvd0V2ZW50IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2V2ZW50X2NvbXBsZXhCZWhhdmlvckRlZmluaXRpb24iCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJSZXNvdXJjZVJvbGUiLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiQmFzZUVsZW1lbnQiCiAgICAgIF0sCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInJlc291cmNlUmVmIiwKICAgICAgICAgICJ0eXBlIjogIlJlc291cmNlIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3Jlc291cmNlUmVmX2FjdGl2aXR5UmVzb3VyY2UiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJyZXNvdXJjZVBhcmFtZXRlckJpbmRpbmdzIiwKICAgICAgICAgICJ0eXBlIjogIlJlc291cmNlUGFyYW1ldGVyQmluZGluZyIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9yZXNvdXJjZVBhcmFtZXRlckJpbmRpbmdzX2FjdGl2aXR5UmVzb3VyY2UiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInJlc291cmNlQXNzaWdubWVudEV4cHJlc3Npb24iLAogICAgICAgICAgInR5cGUiOiAiUmVzb3VyY2VBc3NpZ25tZW50RXhwcmVzc2lvbiIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9yZXNvdXJjZUFzc2lnbm1lbnRFeHByZXNzaW9uX2FjdGl2aXR5UmVzb3VyY2UiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiUmVzb3VyY2VQYXJhbWV0ZXJCaW5kaW5nIiwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZXhwcmVzc2lvbiIsCiAgICAgICAgICAidHlwZSI6ICJFeHByZXNzaW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2V4cHJlc3Npb25fcmVzb3VyY2VQYXJhbWV0ZXJCaW5kaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicGFyYW1ldGVyUmVmIiwKICAgICAgICAgICJ0eXBlIjogIlJlc291cmNlUGFyYW1ldGVyIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3BhcmFtZXRlclJlZl9yZXNvdXJjZVBhcmFtZXRlckJpbmRpbmciLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJSZXNvdXJjZUFzc2lnbm1lbnRFeHByZXNzaW9uIiwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZXhwcmVzc2lvbiIsCiAgICAgICAgICAidHlwZSI6ICJFeHByZXNzaW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2V4cHJlc3Npb25fcmVzb3VyY2VBc3NpZ25tZW50RXhwcmVzc2lvbiIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkltcG9ydCIsCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImltcG9ydFR5cGUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJsb2NhdGlvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm5hbWVzcGFjZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkRlZmluaXRpb25zIiwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgIkJhc2VFbGVtZW50IgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAidGFyZ2V0TmFtZXNwYWNlIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZXhwcmVzc2lvbkxhbmd1YWdlIiwKICAgICAgICAgICJkZWZhdWx0IjogImh0dHA6Ly93d3cudzMub3JnLzE5OTkvWFBhdGgiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0eXBlTGFuZ3VhZ2UiLAogICAgICAgICAgImRlZmF1bHQiOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJTdHJpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbXBvcnRzIiwKICAgICAgICAgICJ0eXBlIjogIkltcG9ydCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9pbXBvcnRzX2RlZmluaXRpb24iLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImV4dGVuc2lvbnMiLAogICAgICAgICAgInR5cGUiOiAiRXh0ZW5zaW9uIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2V4dGVuc2lvbnNfZGVmaW5pdGlvbnMiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInJlbGF0aW9uc2hpcHMiLAogICAgICAgICAgInR5cGUiOiAiUmVsYXRpb25zaGlwIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3JlbGF0aW9uc2hpcHNfZGVmaW5pdGlvbiIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicm9vdEVsZW1lbnRzIiwKICAgICAgICAgICJ0eXBlIjogIlJvb3RFbGVtZW50IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3Jvb3RFbGVtZW50c19kZWZpbml0aW9uIiwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJkaWFncmFtcyIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9kaWFncmFtc19kZWZpbml0aW9ucyIsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogImJwbW5kaTpCUE1ORGlhZ3JhbSIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImV4cG9ydGVyIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZXhwb3J0ZXJWZXJzaW9uIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0KICAgICAgXQogICAgfQogIF0sCiAgImVtdW1lcmF0aW9ucyI6IFsKICAgIHsKICAgICAgIm5hbWUiOiAiUHJvY2Vzc1R5cGUiLAogICAgICAibGl0ZXJhbFZhbHVlcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJOb25lIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiUHVibGljIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiUHJpdmF0ZSIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkdhdGV3YXlEaXJlY3Rpb24iLAogICAgICAibGl0ZXJhbFZhbHVlcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJVbnNwZWNpZmllZCIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIkNvbnZlcmdpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJEaXZlcmdpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJNaXhlZCIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkV2ZW50QmFzZWRHYXRld2F5VHlwZSIsCiAgICAgICJsaXRlcmFsVmFsdWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIlBhcmFsbGVsIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiRXhjbHVzaXZlIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiUmVsYXRpb25zaGlwRGlyZWN0aW9uIiwKICAgICAgImxpdGVyYWxWYWx1ZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiTm9uZSIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIkZvcndhcmQiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJCYWNrd2FyZCIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIkJvdGgiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJJdGVtS2luZCIsCiAgICAgICJsaXRlcmFsVmFsdWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIlBoeXNpY2FsIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiSW5mb3JtYXRpb24iCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJDaG9yZW9ncmFwaHlMb29wVHlwZSIsCiAgICAgICJsaXRlcmFsVmFsdWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIk5vbmUiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJTdGFuZGFyZCIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIk11bHRpSW5zdGFuY2VTZXF1ZW50aWFsIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiTXVsdGlJbnN0YW5jZVBhcmFsbGVsIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiQXNzb2NpYXRpb25EaXJlY3Rpb24iLAogICAgICAibGl0ZXJhbFZhbHVlcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJOb25lIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiT25lIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiQm90aCIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIk11bHRpSW5zdGFuY2VCZWhhdmlvciIsCiAgICAgICJsaXRlcmFsVmFsdWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIk5vbmUiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJPbmUiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJBbGwiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJDb21wbGV4IgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiQWRIb2NPcmRlcmluZyIsCiAgICAgICJsaXRlcmFsVmFsdWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIlBhcmFsbGVsIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiU2VxdWVudGlhbCIKICAgICAgICB9CiAgICAgIF0KICAgIH0KICBdLAogICJwcmVmaXgiOiAiYnBtbiIsCiAgInhtbCI6IHsKICAgICJhbGlhcyI6ICJsb3dlckNhc2UiCiAgfQp9Cn0se31dLDM4OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHM9ewogICJuYW1lIjogIkJQTU5ESSIsCiAgInVyaSI6ICJodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9CUE1OLzIwMTAwNTI0L0RJIiwKICAidHlwZXMiOiBbCiAgICB7CiAgICAgICJuYW1lIjogIkJQTU5EaWFncmFtIiwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicGxhbmUiLAogICAgICAgICAgInR5cGUiOiAiQlBNTlBsYW5lIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3BsYW5lX2RpYWdyYW0iLAogICAgICAgICAgInJlZGVmaW5lcyI6ICJkaTpEaWFncmFtI3Jvb3RFbGVtZW50IgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibGFiZWxTdHlsZSIsCiAgICAgICAgICAidHlwZSI6ICJCUE1OTGFiZWxTdHlsZSIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9sYWJlbFN0eWxlX2RpYWdyYW0iLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9CiAgICAgIF0sCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJkaTpEaWFncmFtIgogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJCUE1OUGxhbmUiLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJicG1uRWxlbWVudCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9icG1uRWxlbWVudF9wbGFuZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJicG1uOkJhc2VFbGVtZW50IiwKICAgICAgICAgICJyZWRlZmluZXMiOiAiZGk6RGlhZ3JhbUVsZW1lbnQjbW9kZWxFbGVtZW50IgogICAgICAgIH0KICAgICAgXSwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgImRpOlBsYW5lIgogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJCUE1OU2hhcGUiLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJicG1uRWxlbWVudCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9icG1uRWxlbWVudF9zaGFwZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJicG1uOkJhc2VFbGVtZW50IiwKICAgICAgICAgICJyZWRlZmluZXMiOiAiZGk6RGlhZ3JhbUVsZW1lbnQjbW9kZWxFbGVtZW50IgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaXNIb3Jpem9udGFsIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiQm9vbGVhbiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImlzRXhwYW5kZWQiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJCb29sZWFuIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaXNNYXJrZXJWaXNpYmxlIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiQm9vbGVhbiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImxhYmVsIiwKICAgICAgICAgICJ0eXBlIjogIkJQTU5MYWJlbCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9sYWJlbF9zaGFwZSIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImlzTWVzc2FnZVZpc2libGUiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJCb29sZWFuIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicGFydGljaXBhbnRCYW5kS2luZCIsCiAgICAgICAgICAidHlwZSI6ICJQYXJ0aWNpcGFudEJhbmRLaW5kIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjaG9yZW9ncmFwaHlBY3Rpdml0eVNoYXBlIiwKICAgICAgICAgICJ0eXBlIjogIkJQTU5TaGFwZSIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9jaG9yZW9ncmFwaHlBY3Rpdml0eVNoYXBlX3BhcnRpY2lwYW50QmFuZFNoYXBlIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXSwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgImRpOkxhYmVsZWRTaGFwZSIKICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiQlBNTkVkZ2UiLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJsYWJlbCIsCiAgICAgICAgICAidHlwZSI6ICJCUE1OTGFiZWwiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfbGFiZWxfZWRnZSIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImJwbW5FbGVtZW50IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2JwbW5FbGVtZW50X2VkZ2UiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiYnBtbjpCYXNlRWxlbWVudCIsCiAgICAgICAgICAicmVkZWZpbmVzIjogImRpOkRpYWdyYW1FbGVtZW50I21vZGVsRWxlbWVudCIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInNvdXJjZUVsZW1lbnQiLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfc291cmNlRWxlbWVudF9zb3VyY2VFZGdlIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogImRpOkRpYWdyYW1FbGVtZW50IiwKICAgICAgICAgICJyZWRlZmluZXMiOiAiZGk6RWRnZSNzb3VyY2UiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0YXJnZXRFbGVtZW50IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3RhcmdldEVsZW1lbnRfdGFyZ2V0RWRnZSIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJkaTpEaWFncmFtRWxlbWVudCIsCiAgICAgICAgICAicmVkZWZpbmVzIjogImRpOkVkZ2UjdGFyZ2V0IgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibWVzc2FnZVZpc2libGVLaW5kIiwKICAgICAgICAgICJ0eXBlIjogIk1lc3NhZ2VWaXNpYmxlS2luZCIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZQogICAgICAgIH0KICAgICAgXSwKICAgICAgInN1cGVyQ2xhc3MiOiBbCiAgICAgICAgImRpOkxhYmVsZWRFZGdlIgogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJCUE1OTGFiZWwiLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJsYWJlbFN0eWxlIiwKICAgICAgICAgICJ0eXBlIjogIkJQTU5MYWJlbFN0eWxlIiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX2xhYmVsU3R5bGVfbGFiZWwiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlLAogICAgICAgICAgInJlZGVmaW5lcyI6ICJkaTpEaWFncmFtRWxlbWVudCNzdHlsZSIKICAgICAgICB9CiAgICAgIF0sCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJkaTpMYWJlbCIKICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiQlBNTkxhYmVsU3R5bGUiLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJmb250IiwKICAgICAgICAgICJ0eXBlIjogImRjOkZvbnQiCiAgICAgICAgfQogICAgICBdLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiZGk6U3R5bGUiCiAgICAgIF0KICAgIH0KICBdLAogICJlbXVtZXJhdGlvbnMiOiBbCiAgICB7CiAgICAgICJuYW1lIjogIlBhcnRpY2lwYW50QmFuZEtpbmQiLAogICAgICAibGl0ZXJhbFZhbHVlcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0b3BfaW5pdGlhdGluZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm1pZGRsZV9pbml0aWF0aW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiYm90dG9tX2luaXRpYXRpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0b3Bfbm9uX2luaXRpYXRpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJtaWRkbGVfbm9uX2luaXRpYXRpbmciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJib3R0b21fbm9uX2luaXRpYXRpbmciCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJNZXNzYWdlVmlzaWJsZUtpbmQiLAogICAgICAibGl0ZXJhbFZhbHVlcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpbml0aWF0aW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAibm9uX2luaXRpYXRpbmciCiAgICAgICAgfQogICAgICBdCiAgICB9CiAgXSwKICAiYXNzb2NpYXRpb25zIjogW10sCiAgInByZWZpeCI6ICJicG1uZGkiCn0KfSx7fV0sMzk6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cz17CiAgIm5hbWUiOiAiREMiLAogICJ1cmkiOiAiaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvREQvMjAxMDA1MjQvREMiLAogICJ0eXBlcyI6IFsKICAgIHsKICAgICAgIm5hbWUiOiAiQm9vbGVhbiIKICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkludGVnZXIiCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJSZWFsIgogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiU3RyaW5nIgogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiRm9udCIsCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm5hbWUiLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJzaXplIiwKICAgICAgICAgICJ0eXBlIjogIlJlYWwiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImlzQm9sZCIsCiAgICAgICAgICAidHlwZSI6ICJCb29sZWFuIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpc0l0YWxpYyIsCiAgICAgICAgICAidHlwZSI6ICJCb29sZWFuIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpc1VuZGVybGluZSIsCiAgICAgICAgICAidHlwZSI6ICJCb29sZWFuIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJpc1N0cmlrZVRocm91Z2giLAogICAgICAgICAgInR5cGUiOiAiQm9vbGVhbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiUG9pbnQiLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ4IiwKICAgICAgICAgICJ0eXBlIjogIlJlYWwiLAogICAgICAgICAgImRlZmF1bHQiOiAiMCIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAieSIsCiAgICAgICAgICAidHlwZSI6ICJSZWFsIiwKICAgICAgICAgICJkZWZhdWx0IjogIjAiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkJvdW5kcyIsCiAgICAgICJwcm9wZXJ0aWVzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIngiLAogICAgICAgICAgInR5cGUiOiAiUmVhbCIsCiAgICAgICAgICAiZGVmYXVsdCI6ICIwIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ5IiwKICAgICAgICAgICJ0eXBlIjogIlJlYWwiLAogICAgICAgICAgImRlZmF1bHQiOiAiMCIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAid2lkdGgiLAogICAgICAgICAgInR5cGUiOiAiUmVhbCIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaGVpZ2h0IiwKICAgICAgICAgICJ0eXBlIjogIlJlYWwiLAogICAgICAgICAgImlzQXR0ciI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0KICBdLAogICJwcmVmaXgiOiAiZGMiLAogICJhc3NvY2lhdGlvbnMiOiBbXQp9Cn0se31dLDQwOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHM9ewogICJuYW1lIjogIkRJIiwKICAidXJpIjogImh0dHA6Ly93d3cub21nLm9yZy9zcGVjL0RELzIwMTAwNTI0L0RJIiwKICAidHlwZXMiOiBbCiAgICB7CiAgICAgICJuYW1lIjogIkRpYWdyYW1FbGVtZW50IiwKICAgICAgImlzQWJzdHJhY3QiOiB0cnVlLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJvd25pbmdEaWFncmFtIiwKICAgICAgICAgICJ0eXBlIjogIkRpYWdyYW0iLAogICAgICAgICAgImlzUmVhZE9ubHkiOiB0cnVlLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfcm9vdEVsZW1lbnRfb3duaW5nRGlhZ3JhbSIsCiAgICAgICAgICAiaXNWaXJ0dWFsIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm93bmluZ0VsZW1lbnQiLAogICAgICAgICAgInR5cGUiOiAiRGlhZ3JhbUVsZW1lbnQiLAogICAgICAgICAgImlzUmVhZE9ubHkiOiB0cnVlLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfb3duZWRFbGVtZW50X293bmluZ0VsZW1lbnQiLAogICAgICAgICAgImlzVmlydHVhbCI6IHRydWUsCiAgICAgICAgICAiaXNSZWZlcmVuY2UiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJtb2RlbEVsZW1lbnQiLAogICAgICAgICAgImlzUmVhZE9ubHkiOiB0cnVlLAogICAgICAgICAgImFzc29jaWF0aW9uIjogIkFfbW9kZWxFbGVtZW50X2RpYWdyYW1FbGVtZW50IiwKICAgICAgICAgICJpc1ZpcnR1YWwiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIkVsZW1lbnQiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJzdHlsZSIsCiAgICAgICAgICAidHlwZSI6ICJTdHlsZSIsCiAgICAgICAgICAiaXNSZWFkT25seSI6IHRydWUsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9zdHlsZV9kaWFncmFtRWxlbWVudCIsCiAgICAgICAgICAiaXNWaXJ0dWFsIjogdHJ1ZSwKICAgICAgICAgICJpc1JlZmVyZW5jZSI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm93bmVkRWxlbWVudCIsCiAgICAgICAgICAidHlwZSI6ICJEaWFncmFtRWxlbWVudCIsCiAgICAgICAgICAiaXNSZWFkT25seSI6IHRydWUsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9vd25lZEVsZW1lbnRfb3duaW5nRWxlbWVudCIsCiAgICAgICAgICAiaXNWaXJ0dWFsIjogdHJ1ZSwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJOb2RlIiwKICAgICAgImlzQWJzdHJhY3QiOiB0cnVlLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiRGlhZ3JhbUVsZW1lbnQiCiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkVkZ2UiLAogICAgICAiaXNBYnN0cmFjdCI6IHRydWUsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJEaWFncmFtRWxlbWVudCIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAic291cmNlIiwKICAgICAgICAgICJ0eXBlIjogIkRpYWdyYW1FbGVtZW50IiwKICAgICAgICAgICJpc1JlYWRPbmx5IjogdHJ1ZSwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3NvdXJjZV9zb3VyY2VFZGdlIiwKICAgICAgICAgICJpc1ZpcnR1YWwiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAidGFyZ2V0IiwKICAgICAgICAgICJ0eXBlIjogIkRpYWdyYW1FbGVtZW50IiwKICAgICAgICAgICJpc1JlYWRPbmx5IjogdHJ1ZSwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX3RhcmdldF90YXJnZXRFZGdlIiwKICAgICAgICAgICJpc1ZpcnR1YWwiOiB0cnVlLAogICAgICAgICAgImlzUmVmZXJlbmNlIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAid2F5cG9pbnQiLAogICAgICAgICAgImlzVW5pcXVlIjogZmFsc2UsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogImRjOlBvaW50IiwKICAgICAgICAgICJzZXJpYWxpemUiOiAieHNpOnR5cGUiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJEaWFncmFtIiwKICAgICAgImlzQWJzdHJhY3QiOiB0cnVlLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJyb290RWxlbWVudCIsCiAgICAgICAgICAidHlwZSI6ICJEaWFncmFtRWxlbWVudCIsCiAgICAgICAgICAiaXNSZWFkT25seSI6IHRydWUsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9yb290RWxlbWVudF9vd25pbmdEaWFncmFtIiwKICAgICAgICAgICJpc1ZpcnR1YWwiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICJpc0F0dHIiOiB0cnVlLAogICAgICAgICAgInR5cGUiOiAiU3RyaW5nIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZG9jdW1lbnRhdGlvbiIsCiAgICAgICAgICAiaXNBdHRyIjogdHJ1ZSwKICAgICAgICAgICJ0eXBlIjogIlN0cmluZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInJlc29sdXRpb24iLAogICAgICAgICAgImlzQXR0ciI6IHRydWUsCiAgICAgICAgICAidHlwZSI6ICJSZWFsIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAib3duZWRTdHlsZSIsCiAgICAgICAgICAidHlwZSI6ICJTdHlsZSIsCiAgICAgICAgICAiaXNSZWFkT25seSI6IHRydWUsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9vd25lZFN0eWxlX293bmluZ0RpYWdyYW0iLAogICAgICAgICAgImlzVmlydHVhbCI6IHRydWUsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiU2hhcGUiLAogICAgICAiaXNBYnN0cmFjdCI6IHRydWUsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJOb2RlIgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJib3VuZHMiLAogICAgICAgICAgInR5cGUiOiAiZGM6Qm91bmRzIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiUGxhbmUiLAogICAgICAiaXNBYnN0cmFjdCI6IHRydWUsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJOb2RlIgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJwbGFuZUVsZW1lbnQiLAogICAgICAgICAgInR5cGUiOiAiRGlhZ3JhbUVsZW1lbnQiLAogICAgICAgICAgInN1YnNldHRlZFByb3BlcnR5IjogIkRpYWdyYW1FbGVtZW50LW93bmVkRWxlbWVudCIsCiAgICAgICAgICAiYXNzb2NpYXRpb24iOiAiQV9wbGFuZUVsZW1lbnRfcGxhbmUiLAogICAgICAgICAgImlzTWFueSI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkxhYmVsZWRFZGdlIiwKICAgICAgImlzQWJzdHJhY3QiOiB0cnVlLAogICAgICAic3VwZXJDbGFzcyI6IFsKICAgICAgICAiRWRnZSIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAib3duZWRMYWJlbCIsCiAgICAgICAgICAidHlwZSI6ICJMYWJlbCIsCiAgICAgICAgICAiaXNSZWFkT25seSI6IHRydWUsCiAgICAgICAgICAic3Vic2V0dGVkUHJvcGVydHkiOiAiRGlhZ3JhbUVsZW1lbnQtb3duZWRFbGVtZW50IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX293bmVkTGFiZWxfb3duaW5nRWRnZSIsCiAgICAgICAgICAiaXNWaXJ0dWFsIjogdHJ1ZSwKICAgICAgICAgICJpc01hbnkiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJMYWJlbGVkU2hhcGUiLAogICAgICAiaXNBYnN0cmFjdCI6IHRydWUsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJTaGFwZSIKICAgICAgXSwKICAgICAgInByb3BlcnRpZXMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAib3duZWRMYWJlbCIsCiAgICAgICAgICAidHlwZSI6ICJMYWJlbCIsCiAgICAgICAgICAiaXNSZWFkT25seSI6IHRydWUsCiAgICAgICAgICAic3Vic2V0dGVkUHJvcGVydHkiOiAiRGlhZ3JhbUVsZW1lbnQtb3duZWRFbGVtZW50IiwKICAgICAgICAgICJhc3NvY2lhdGlvbiI6ICJBX293bmVkTGFiZWxfb3duaW5nU2hhcGUiLAogICAgICAgICAgImlzVmlydHVhbCI6IHRydWUsCiAgICAgICAgICAiaXNNYW55IjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiTGFiZWwiLAogICAgICAiaXNBYnN0cmFjdCI6IHRydWUsCiAgICAgICJzdXBlckNsYXNzIjogWwogICAgICAgICJOb2RlIgogICAgICBdLAogICAgICAicHJvcGVydGllcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJib3VuZHMiLAogICAgICAgICAgInR5cGUiOiAiZGM6Qm91bmRzIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiU3R5bGUiLAogICAgICAiaXNBYnN0cmFjdCI6IHRydWUKICAgIH0KICBdLAogICJhc3NvY2lhdGlvbnMiOiBbXSwKICAicHJlZml4IjogImRpIgp9Cn0se31dLDQxOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBfZGVyZXFfKCcuL2xpYi9EaWFncmFtJyk7Cn0seyIuL2xpYi9EaWFncmFtIjo0Mn1dLDQyOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIGRpID0gX2RlcmVxXygnZGlkaScpOwoKLyoqCiAqIEBuYW1lc3BhY2UgZGpzCiAqLwoKLyoqCiAqIEJvb3RzdHJhcCBhbiBpbmplY3RvciBmcm9tIGEgbGlzdCBvZiBtb2R1bGVzLCBpbnN0YW50aWF0aW5nIGEgbnVtYmVyIG9mIGRlZmF1bHQgY29tcG9uZW50cwogKgogKiBAaWdub3JlCiAqIEBwYXJhbSB7QXJyYXk8ZGlkaS5Nb2R1bGU+fSBib290c3RyYXBNb2R1bGVzCiAqCiAqIEByZXR1cm4ge2RpZGkuSW5qZWN0b3J9IGEgaW5qZWN0b3IgdG8gdXNlIHRvIGFjY2VzcyB0aGUgY29tcG9uZW50cwogKi8KZnVuY3Rpb24gYm9vdHN0cmFwKGJvb3RzdHJhcE1vZHVsZXMpIHsKCiAgdmFyIG1vZHVsZXMgPSBbXTsKICB2YXIgY29tcG9uZW50cyA9IFtdOwoKICBmdW5jdGlvbiBoYXNNb2R1bGUobSkgewogICAgcmV0dXJuIG1vZHVsZXMuaW5kZXhPZihtKSA+PSAwOwogIH0KCiAgZnVuY3Rpb24gYWRkTW9kdWxlKG0pIHsKICAgIG1vZHVsZXMucHVzaChtKTsKICB9CgogIGZ1bmN0aW9uIHZpc2l0KG0pIHsKICAgIGlmIChoYXNNb2R1bGUobSkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIChtLl9fZGVwZW5kc19fIHx8IFtdKS5mb3JFYWNoKHZpc2l0KTsKCiAgICBpZiAoaGFzTW9kdWxlKG0pKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBhZGRNb2R1bGUobSk7CgogICAgKG0uX19pbml0X18gfHwgW10pLmZvckVhY2goZnVuY3Rpb24oYykgewogICAgICBjb21wb25lbnRzLnB1c2goYyk7CiAgICB9KTsKICB9CgogIGJvb3RzdHJhcE1vZHVsZXMuZm9yRWFjaCh2aXNpdCk7CgogIHZhciBpbmplY3RvciA9IG5ldyBkaS5JbmplY3Rvcihtb2R1bGVzKTsKCiAgY29tcG9uZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGMpIHsKICAgIC8vIGVhZ2VybHkgcmVzb2x2ZSBtYWluIGNvbXBvbmVudHMKICAgIGluamVjdG9yLmdldChjKTsKICB9KTsKCiAgcmV0dXJuIGluamVjdG9yOwp9CgovKioKICogQ3JlYXRlcyBhbiBpbmplY3RvciBmcm9tIHBhc3NlZCBvcHRpb25zLgogKgogKiBAaWdub3JlCiAqIEBwYXJhbSAge09iamVjdH0gb3B0aW9ucwogKiBAcmV0dXJuIHtkaWRpLkluamVjdG9yfQogKi8KZnVuY3Rpb24gY3JlYXRlSW5qZWN0b3Iob3B0aW9ucykgewoKICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCiAgdmFyIGNvbmZpZ01vZHVsZSA9IHsKICAgICdjb25maWcnOiBbJ3ZhbHVlJywgb3B0aW9uc10KICB9OwoKICB2YXIgY29yZU1vZHVsZSA9IF9kZXJlcV8oJy4vY29yZScpOwoKICB2YXIgbW9kdWxlcyA9IFsgY29uZmlnTW9kdWxlLCBjb3JlTW9kdWxlIF0uY29uY2F0KG9wdGlvbnMubW9kdWxlcyB8fCBbXSk7CgogIHJldHVybiBib290c3RyYXAobW9kdWxlcyk7Cn0KCgovKioKICogVGhlIG1haW4gZGlhZ3JhbS1qcyBlbnRyeSBwb2ludCB0aGF0IGJvb3RzdHJhcHMgdGhlIGRpYWdyYW0gd2l0aCB0aGUgZ2l2ZW4KICogY29uZmlndXJhdGlvbi4gVG8gcmVnaXN0ZXIgZXh0ZW5zaW9ucyB3aXRoIHRoZSBkaWFncmFtLCBwYXNzIHRoZW0gYXMgQXJyYXk8ZGlkaS5Nb2R1bGU+IHRvIHRoZSBjb25zdHJ1Y3Rvci4KICoKICogQGNsYXNzIGRqcy5EaWFncmFtCiAqIEBtZW1iZXJPZiBkanMKICogQGNvbnN0cnVjdG9yCiAqCiAqIEBleGFtcGxlCiAqCiAqIDxjYXB0aW9uPkNyZWF0aW5nIGEgcGx1Zy1pbiB0aGF0IGxvZ3Mgd2hlbmV2ZXIgYSBzaGFwZSBpcyBhZGRlZCB0byB0aGUgY2FudmFzLjwvY2FwdGlvbj4KICoKICogLy8gcGx1Zy1pbiBpbXBsZW1lbmVudGF0aW9uCiAqIGZ1bmN0aW9uIE15TG9nZ2luZ1BsdWdpbihldmVudEJ1cykgewogKiAgIGV2ZW50QnVzLm9uKCdzaGFwZS5hZGRlZCcsIGZ1bmN0aW9uKGV2ZW50KSB7CiAqICAgICBjb25zb2xlLmxvZygnc2hhcGUgJywgZXZlbnQuc2hhcGUsICcgd2FzIGFkZGVkIHRvIHRoZSBkaWFncmFtJyk7CiAqICAgfSk7CiAqIH0KICoKICogLy8gZXhwb3J0IGFzIG1vZHVsZQogKiBtb2R1bGUuZXhwb3J0cyA9IHsKICogICBfX2luaXRfXzogWyAnbXlMb2dnaW5nUGx1Z2luJyBdLAogKiAgICAgbXlMb2dnaW5nUGx1Z2luOiBbICd0eXBlJywgTXlMb2dnaW5nUGx1Z2luIF0KICogfTsKICoKICoKICogLy8gaW5zdGFudGlhdGUgdGhlIGRpYWdyYW0gd2l0aCB0aGUgbmV3IHBsdWctaW4KICoKICogdmFyIGRpYWdyYW0gPSBuZXcgRGlhZ3JhbSh7IG1vZHVsZXM6IFsgcmVxdWlyZSgncGF0aC10by1teS1sb2dnaW5nLXBsdWdpbicpIF0gfSk7CiAqCiAqIGRpYWdyYW0uaW52b2tlKFsgJ2NhbnZhcycsIGZ1bmN0aW9uKGNhbnZhcykgewogKiAgIC8vIGFkZCBzaGFwZSB0byBkcmF3aW5nIGNhbnZhcwogKiAgIGNhbnZhcy5hZGRTaGFwZSh7IHg6IDEwLCB5OiAxMCB9KTsKICogfSk7CiAqCiAqIC8vICdzaGFwZSAuLi4gd2FzIGFkZGVkIHRvIHRoZSBkaWFncmFtJyBsb2dnZWQgdG8gY29uc29sZQogKgogKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogKiBAcGFyYW0ge0FycmF5PGRpZGkuTW9kdWxlPn0gW29wdGlvbnMubW9kdWxlc10gZXh0ZXJuYWwgbW9kdWxlcyB0byBpbnN0YW50aWF0ZSB3aXRoIHRoZSBkaWFncmFtCiAqIEBwYXJhbSB7ZGlkaS5JbmplY3Rvcn0gW2luamVjdG9yXSBhbiAob3B0aW9uYWwpIGluamVjdG9yIHRvIGJvb3RzdHJhcCB0aGUgZGlhZ3JhbSB3aXRoCiAqLwpmdW5jdGlvbiBEaWFncmFtKG9wdGlvbnMsIGluamVjdG9yKSB7CgogIC8vIGNyZWF0ZSBpbmplY3RvciB1bmxlc3MgZXhwbGljaXRseSBzcGVjaWZpZWQKICB0aGlzLmluamVjdG9yID0gaW5qZWN0b3IgPSBpbmplY3RvciB8fCBjcmVhdGVJbmplY3RvcihvcHRpb25zKTsKCiAgLy8gQVBJCgogIC8qKgogICAqIFJlc29sdmVzIGEgZGlhZ3JhbSBzZXJ2aWNlCiAgICoKICAgKiBAbWV0aG9kIERpYWdyYW0jZ2V0CiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSB0aGUgbmFtZSBvZiB0aGUgZGlhZ3JhbSBzZXJ2aWNlIHRvIGJlIHJldHJpZXZlZAogICAqIEBwYXJhbSB7T2JqZWN0fSBbbG9jYWxzXSBhIG51bWJlciBvZiBsb2NhbHMgdG8gdXNlIHRvIHJlc29sdmUgY2VydGFpbiBkZXBlbmRlbmNpZXMKICAgKi8KICB0aGlzLmdldCA9IGluamVjdG9yLmdldDsKCiAgLyoqCiAgICogRXhlY3V0ZXMgYSBmdW5jdGlvbiBpbnRvIHdoaWNoIGRpYWdyYW0gc2VydmljZXMgYXJlIGluamVjdGVkCiAgICoKICAgKiBAbWV0aG9kIERpYWdyYW0jaW52b2tlCiAgICoKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdFtdfSBmbiB0aGUgZnVuY3Rpb24gdG8gcmVzb2x2ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBsb2NhbHMgYSBudW1iZXIgb2YgbG9jYWxzIHRvIHVzZSB0byByZXNvbHZlIGNlcnRhaW4gZGVwZW5kZW5jaWVzCiAgICovCiAgdGhpcy5pbnZva2UgPSBpbmplY3Rvci5pbnZva2U7CgogIC8vIGluaXQKCiAgLy8gaW5kaWNhdGUgdmlhIGV2ZW50CgoKICAvKioKICAgKiBBbiBldmVudCBpbmRpY2F0aW5nIHRoYXQgYWxsIHBsdWctaW5zIGFyZSBsb2FkZWQuCiAgICoKICAgKiBVc2UgdGhpcyBldmVudCB0byBmaXJlIG90aGVyIGV2ZW50cyB0byBpbnRlcmVzdGVkIHBsdWctaW5zCiAgICoKICAgKiBAbWVtYmVyT2YgRGlhZ3JhbQogICAqCiAgICogQGV2ZW50IGRpYWdyYW0uaW5pdAogICAqCiAgICogQGV4YW1wbGUKICAgKgogICAqIGV2ZW50cy5vbignZGlhZ3JhbS5pbml0JywgZnVuY3Rpb24oKSB7CiAgICogICBldmVudHMuZmlyZSgnbXktY3VzdG9tLWV2ZW50JywgeyBmb286ICdCQVInIH0pOwogICAqIH0pOwogICAqCiAgICogQHR5cGUge09iamVjdH0KICAgKi8KICB0aGlzLmdldCgnZXZlbnRCdXMnKS5maXJlKCdkaWFncmFtLmluaXQnKTsKfQoKbW9kdWxlLmV4cG9ydHMgPSBEaWFncmFtOwoKCi8qKgogKiBEZXN0cm95cyB0aGUgZGlhZ3JhbQogKgogKiBAbWV0aG9kICBEaWFncmFtI2Rlc3Ryb3kKICovCkRpYWdyYW0ucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICB0aGlzLmdldCgnZXZlbnRCdXMnKS5maXJlKCdkaWFncmFtLmRlc3Ryb3knKTsKfTsKfSx7Ii4vY29yZSI6NDgsImRpZGkiOjY5fV0sNDM6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgoKdmFyIF8gPSAod2luZG93Ll8pOwoKdmFyIHJlbW92ZSA9IF9kZXJlcV8oJy4uL3V0aWwvQ29sbGVjdGlvbnMnKS5yZW1vdmU7CgoKZnVuY3Rpb24gcm91bmQobnVtYmVyLCByZXNvbHV0aW9uKSB7CiAgcmV0dXJuIE1hdGgucm91bmQobnVtYmVyICogcmVzb2x1dGlvbikgLyByZXNvbHV0aW9uOwp9CgpmdW5jdGlvbiBlbnN1cmVQeChudW1iZXIpIHsKICByZXR1cm4gXy5pc051bWJlcihudW1iZXIpID8gbnVtYmVyICsgJ3B4JyA6IG51bWJlcjsKfQoKLyoqCiAqIENyZWF0ZXMgYSBIVE1MIGNvbnRhaW5lciBlbGVtZW50IGZvciBhIFNWRyBlbGVtZW50IHdpdGgKICogdGhlIGdpdmVuIGNvbmZpZ3VyYXRpb24KICoKICogQHBhcmFtICB7T2JqZWN0fSBvcHRpb25zCiAqIEByZXR1cm4ge0hUTUxFbGVtZW50fSB0aGUgY29udGFpbmVyIGVsZW1lbnQKICovCmZ1bmN0aW9uIGNyZWF0ZUNvbnRhaW5lcihvcHRpb25zKSB7CgogIG9wdGlvbnMgPSBfLmV4dGVuZCh7fSwgeyB3aWR0aDogJzEwMCUnLCBoZWlnaHQ6ICcxMDAlJyB9LCBvcHRpb25zKTsKCiAgdmFyIGNvbnRhaW5lciA9IG9wdGlvbnMuY29udGFpbmVyIHx8IGRvY3VtZW50LmJvZHk7CgogIC8vIGNyZWF0ZSBhIDxkaXY+IGFyb3VuZCB0aGUgc3ZnIGVsZW1lbnQgd2l0aCB0aGUgcmVzcGVjdGl2ZSBzaXplCiAgLy8gdGhpcyB3YXkgd2UgY2FuIGFsd2F5cyBnZXQgdGhlIGNvcnJlY3QgY29udGFpbmVyIHNpemUKICAvLyAodGhpcyBpcyBpbXBvc3NpYmxlIGZvciA8c3ZnPiBlbGVtZW50cyBhdCB0aGUgbW9tZW50KQogIHZhciBwYXJlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICBwYXJlbnQuc2V0QXR0cmlidXRlKCdjbGFzcycsICdkanMtY29udGFpbmVyJyk7CgogIF8uZXh0ZW5kKHBhcmVudC5zdHlsZSwgewogICAgcG9zaXRpb246ICdyZWxhdGl2ZScsCiAgICB3aWR0aDogZW5zdXJlUHgob3B0aW9ucy53aWR0aCksCiAgICBoZWlnaHQ6IGVuc3VyZVB4KG9wdGlvbnMuaGVpZ2h0KQogIH0pOwoKICBjb250YWluZXIuYXBwZW5kQ2hpbGQocGFyZW50KTsKCiAgcmV0dXJuIHBhcmVudDsKfQoKCi8qKgogKiBUaGUgbWFpbiBkcmF3aW5nIGNhbnZhcy4KICoKICogQGNsYXNzCiAqIEBjb25zdHJ1Y3RvcgogKgogKiBAZW1pdHMgQ2FudmFzI2NhbnZhcy5pbml0CiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcKICogQHBhcmFtIHtFdmVudEJ1c30gZXZlbnRCdXMKICogQHBhcmFtIHtHcmFwaGljc0ZhY3Rvcnl9IGdyYXBoaWNzRmFjdG9yeQogKiBAcGFyYW0ge0VsZW1lbnRSZWdpc3RyeX0gZWxlbWVudFJlZ2lzdHJ5CiAqLwpmdW5jdGlvbiBDYW52YXMoY29uZmlnLCBldmVudEJ1cywgZ3JhcGhpY3NGYWN0b3J5LCBlbGVtZW50UmVnaXN0cnksIHNuYXApIHsKCiAgdmFyIG9wdGlvbnMgPSBfLmV4dGVuZChjb25maWcuY2FudmFzIHx8IHt9KTsKCiAgdGhpcy5fc25hcCA9IHNuYXA7CiAgdGhpcy5fZXZlbnRCdXMgPSBldmVudEJ1czsKICB0aGlzLl9lbGVtZW50UmVnaXN0cnkgPSBlbGVtZW50UmVnaXN0cnk7CiAgdGhpcy5fZ3JhcGhpY3NGYWN0b3J5ID0gZ3JhcGhpY3NGYWN0b3J5OwoKICAvLyBDcmVhdGVzIGEgPHN2Zz4gZWxlbWVudCB0aGF0IGlzIHdyYXBwZWQgaW50byBhIDxkaXY+LgogIC8vIFRoaXMgd2F5IHdlIGFyZSBhbHdheXMgYWJsZSB0byBjb3JyZWN0bHkgZmlndXJlIG91dCB0aGUgc2l6ZSBvZiB0aGUgc3ZnIGVsZW1lbnQKICAvLyBieSBxdWVyeWluZyB0aGUgcGFyZW50IG5vZGUuCiAgLy8KICAvLyAoSXQgaXMgbm90IHBvc3NpYmxlIHRvIGdldCB0aGUgc2l6ZSBvZiBhIHN2ZyBlbGVtZW50IGNyb3NzIGJyb3dzZXIgQCAyMDE0LTA0LTAxKQogIC8vCiAgLy8gPGRpdiBjbGFzcz0iZGpzLWNvbnRhaW5lciIgc3R5bGU9IndpZHRoOiB7ZGVzaXJlZC13aWR0aH0sIGhlaWdodDoge2Rlc2lyZWQtaGVpZ2h0fSI+CiAgLy8gICA8c3ZnIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPgogIC8vICAgIC4uLgogIC8vICAgPC9zdmc+CiAgLy8gPC9kaXY+CgogIHZhciBjb250YWluZXIgPSB0aGlzLl9jb250YWluZXIgPSBjcmVhdGVDb250YWluZXIob3B0aW9ucyk7CgogIC8vIHN2ZyByb290CiAgdmFyIHBhcGVyID0gdGhpcy5fcGFwZXIgPSBjcmVhdGVQYXBlcihjb250YWluZXIpOwoKICAvLyBkcmF3aW5nIHJvb3QKICB2YXIgcm9vdCA9IHRoaXMuX3Jvb3QgPSBwYXBlci5ncm91cCgpLmF0dHIoeyAnY2xhc3MnIDogJ3ZpZXdwb3J0JyB9KTsKCgogIGZ1bmN0aW9uIGNyZWF0ZVBhcGVyKGNvbnRhaW5lcikgewogICAgcmV0dXJuIGdyYXBoaWNzRmFjdG9yeS5jcmVhdGVQYXBlcih7IGNvbnRhaW5lcjogY29udGFpbmVyLCB3aWR0aDogJzEwMCUnLCBoZWlnaHQ6ICcxMDAlJyB9KTsKICB9CgogIC8qKgogICAqIFNlbmRzIGEgc2hhcGUgdG8gdGhlIGZyb250LgogICAqCiAgICogVGhpcyBtZXRob2QgdGFrZXMgcGFyZW50IC8gY2hpbGQgcmVsYXRpb25zaGlwcyBiZXR3ZWVuIHNoYXBlcyBpbnRvIGFjY291bnQKICAgKiBhbmQgbWFrZXMgc3VyZSB0aGF0IGNoaWxkcmVuIGFyZSBwcm9wZXJseSBoYW5kbGVkLCB0b28uCiAgICoKICAgKiBAbWV0aG9kIENhbnZhcyNzZW5kVG9Gcm9udAogICAqCiAgICogQHBhcmFtIHtkanMuRWxlbWVudERlc2NyaXB0b3J9IHNoYXBlIGRlc2NyaXB0b3Igb2YgdGhlIHNoYXBlIHRvIGJlIHNlbnQgdG8gZnJvbnQKICAgKiBAcGFyYW0ge2Jvb2xlYW59IGJ1YmJsZT10cnVlIHdoZXRoZXIgdG8gc2VuZCBwYXJlbnQgc2hhcGVzIHRvIGZyb250LCB0b28KICAgKi8KICBmdW5jdGlvbiBzZW5kVG9Gcm9udChzaGFwZSwgYnViYmxlKSB7CgogICAgaWYgKGJ1YmJsZSAhPT0gZmFsc2UpIHsKICAgICAgYnViYmxlID0gdHJ1ZTsKICAgIH0KCiAgICBpZiAoYnViYmxlICYmIHNoYXBlLnBhcmVudCkgewogICAgICBzZW5kVG9Gcm9udChzaGFwZS5wYXJlbnQpOwogICAgfQoKICAgIGlmIChzaGFwZS5jaGlsZHJlbikgewogICAgICBzaGFwZS5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGNoaWxkKSB7CiAgICAgICAgc2VuZFRvRnJvbnQoY2hpbGQsIGZhbHNlKTsKICAgICAgfSk7CiAgICB9CgogICAgdmFyIGdmeCA9IGdldEdyYXBoaWNzKHNoYXBlKSwKICAgICAgICBnZnhQYXJlbnQgPSBnZngucGFyZW50KCk7CgogICAgZ2Z4LnJlbW92ZSgpLmFwcGVuZFRvKGdmeFBhcmVudCk7CiAgfQoKICAvKioKICAgKiBSZXR1cm4gdGhlIGdyYXBoaWNhbCBvYmplY3QgdW5kZXJsYXlpbmcgYSBjZXJ0YWluIGRpYWdyYW0gZWxlbWVudAogICAqCiAgICogQG1ldGhvZCBDYW52YXMjZ2V0R3JhcGhpY3MKICAgKgogICAqIEBwYXJhbSB7ZGpzLkVsZW1lbnREZXNjcmlwdG9yfSBlbGVtZW50IGRlc2NyaXB0b3Igb2YgdGhlIGVsZW1lbnQKICAgKi8KICBmdW5jdGlvbiBnZXRHcmFwaGljcyhlbGVtZW50KSB7CiAgICByZXR1cm4gZWxlbWVudFJlZ2lzdHJ5LmdldEdyYXBoaWNzQnlFbGVtZW50KGVsZW1lbnQpOwogIH0KCiAgZXZlbnRCdXMub24oJ2RpYWdyYW0uaW5pdCcsIGZ1bmN0aW9uKGV2ZW50KSB7CgogICAgLyoqCiAgICAgKiBBbiBldmVudCBpbmRpY2F0aW5nIHRoYXQgdGhlIGNhbnZhcyBpcyByZWFkeSB0byBiZSBkcmF3biBvbi4KICAgICAqCiAgICAgKiBAbWVtYmVyT2YgQ2FudmFzCiAgICAgKgogICAgICogQGV2ZW50IGNhbnZhcy5pbml0CiAgICAgKgogICAgICogQHR5cGUge09iamVjdH0KICAgICAqIEBwcm9wZXJ0eSB7c25hcHN2Zy5QYXBlcn0gcGFwZXIgdGhlIGluaXRpYWxpemVkIGRyYXdpbmcgcGFwZXIKICAgICAqLwogICAgZXZlbnRCdXMuZmlyZSgnY2FudmFzLmluaXQnLCB7IHJvb3Q6IHJvb3QsIHBhcGVyOiBwYXBlciB9KTsKICB9KTsKCiAgZXZlbnRCdXMub24oJ2RpYWdyYW0uZGVzdHJveScsIGZ1bmN0aW9uKCkgewoKICAgIGlmIChjb250YWluZXIpIHsKICAgICAgdmFyIHBhcmVudCA9IGNvbnRhaW5lci5wYXJlbnROb2RlOwogICAgICBwYXJlbnQucmVtb3ZlQ2hpbGQoY29udGFpbmVyKTsKICAgIH0KCiAgICBjb250YWluZXIgPSB0aGlzLl9jb250YWluZXIgPSBudWxsOwogICAgcGFwZXIgPSB0aGlzLl9wYXBlciA9IG51bGw7CiAgICByb290ID0gdGhpcy5fcm9vdCA9IG51bGw7CiAgfSk7CgogIHRoaXMuZ2V0R3JhcGhpY3MgPSBnZXRHcmFwaGljczsKCiAgdGhpcy5zZW5kVG9Gcm9udCA9IHNlbmRUb0Zyb250Owp9CgovKioKICogRW5zdXJlIHRoYXQgYW4gZWxlbWVudCBoYXMgYSB2YWxpZCwgdW5pcXVlIGlkCiAqCiAqIEBwYXJhbSB7ZGpzLm1vZGVsLkJhc2V9IGVsZW1lbnQKICovCkNhbnZhcy5wcm90b3R5cGUuX2Vuc3VyZVZhbGlkSWQgPSBmdW5jdGlvbihlbGVtZW50KSB7CiAgaWYgKCFlbGVtZW50LmlkKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ2VsZW1lbnQgbXVzdCBoYXZlIGFuIGlkJyk7CiAgfQoKICBpZiAodGhpcy5fZWxlbWVudFJlZ2lzdHJ5LmdldEJ5SWQoZWxlbWVudC5pZCkpIHsKICAgIHRocm93IG5ldyBFcnJvcignZWxlbWVudCB3aXRoIGlkICcgKyBlbGVtZW50LmlkICsgJyBhbHJlYWR5IGV4aXN0cycpOwogIH0KfTsKCi8qKgogKiBSZXR1cm5zIHRoZSByb290IHJlbmRlcmluZyBjb250ZXh0IG9uIHdoaWNoCiAqIGFsbCBlbGVtZW50cyBhcmUgZHJhd24uCiAqCiAqIEByZXR1cm5zIHtzbmFwc3ZnLkdyb3VwfQogKi8KQ2FudmFzLnByb3RvdHlwZS5nZXRSb290ID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMuX3Jvb3Q7Cn07CgovKioKICogUmV0dXJucyB0aGUgaHRtbCBlbGVtZW50IHRoYXQgZW5jbG9zZXMgdGhlCiAqIGRyYXdpbmcgY2FudmFzLgogKgogKiBAcmV0dXJuIHtET01Ob2RlfQogKi8KQ2FudmFzLnByb3RvdHlwZS5nZXRDb250YWluZXIgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5fY29udGFpbmVyOwp9OwoKLyoqCiAqIEFkZHMgYSBzaGFwZSB0byB0aGUgY2FudmFzCiAqCiAqIEBwYXJhbSB7T2JqZWN0fGRqcy5tb2RlbC5TaGFwZX0gc2hhcGUgdG8gYWRkIHRvIHRoZSBkaWFncmFtCiAqCiAqIEByZXR1cm4ge2Rqcy5tb2RlbC5TaGFwZX0gdGhlIGFkZGVkIHNoYXBlCiAqLwpDYW52YXMucHJvdG90eXBlLmFkZFNoYXBlID0gZnVuY3Rpb24oc2hhcGUsIHBhcmVudCkgewoKICB0aGlzLl9lbnN1cmVWYWxpZElkKHNoYXBlKTsKCiAgaWYgKHBhcmVudCkgewogICAgc2hhcGUucGFyZW50ID0gcGFyZW50OwogICAgcGFyZW50LmNoaWxkcmVuLnB1c2goc2hhcGUpOwogIH0KCiAgLy8gY3JlYXRlIHNoYXBlIGdmeAogIHZhciBnZnggPSB0aGlzLl9ncmFwaGljc0ZhY3RvcnkuY3JlYXRlU2hhcGUodGhpcy5fcm9vdCwgc2hhcGUpOwoKICAvKioKICAgKiBBbiBldmVudCBpbmRpY2F0aW5nIHRoYXQgYSBuZXcgc2hhcGUgaXMgYmVpbmcgYWRkZWQgdG8gdGhlIGNhbnZhcy4KICAgKgogICAqIEBtZW1iZXJPZiBDYW52YXMKICAgKgogICAqIEBldmVudCBzaGFwZS5hZGQKICAgKiBAdHlwZSB7T2JqZWN0fQogICAqIEBwcm9wZXJ0eSB7ZGpzLm1vZGVsLlNoYXBlfSBlbGVtZW50IHRoZSBzaGFwZQogICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBnZnggdGhlIGdyYXBoaWNhbCByZXByZXNlbnRhdGlvbiBvZiB0aGUgc2hhcGUKICAgKi8KICB0aGlzLl9ldmVudEJ1cy5maXJlKCdzaGFwZS5hZGQnLCB7IGVsZW1lbnQ6IHNoYXBlLCBnZng6IGdmeCB9KTsKCiAgLy8gdXBkYXRlIGl0cyB2aXN1YWwKICB0aGlzLl9ncmFwaGljc0ZhY3RvcnkudXBkYXRlU2hhcGUoc2hhcGUsIGdmeCk7CgogIC8qKgogICAqIEFuIGV2ZW50IGluZGljYXRpbmcgdGhhdCBhIG5ldyBzaGFwZSBoYXMgYmVlbiBhZGRlZCB0byB0aGUgY2FudmFzLgogICAqCiAgICogQG1lbWJlck9mIENhbnZhcwogICAqCiAgICogQGV2ZW50IHNoYXBlLmFkZGVkCiAgICogQHR5cGUge09iamVjdH0KICAgKiBAcHJvcGVydHkge2Rqcy5tb2RlbC5TaGFwZX0gZWxlbWVudCB0aGUgc2hhcGUKICAgKiBAcHJvcGVydHkge09iamVjdH0gZ2Z4IHRoZSBncmFwaGljYWwgcmVwcmVzZW50YXRpb24gb2YgdGhlIHNoYXBlCiAgICovCiAgdGhpcy5fZXZlbnRCdXMuZmlyZSgnc2hhcGUuYWRkZWQnLCB7IGVsZW1lbnQ6IHNoYXBlLCBnZng6IGdmeCB9KTsKCiAgcmV0dXJuIHNoYXBlOwp9OwoKLyoqCiAqIEFkZHMgYSBjb25uZWN0aW9uIHRvIHRoZSBjYW52YXMKICoKICogQHBhcmFtIHtkanMubW9kZWwuQ29ubmVjdGlvbn0gY29ubmVjdGlvbiB0byBhZGQgdG8gdGhlIGRpYWdyYW0KICoKICogQHJldHVybiB7ZGpzLm1vZGVsLkNvbm5lY3Rpb259IHRoZSBhZGRlZCBjb25uZWN0aW9uCiAqLwpDYW52YXMucHJvdG90eXBlLmFkZENvbm5lY3Rpb24gPSBmdW5jdGlvbihjb25uZWN0aW9uLCBwYXJlbnQpIHsKCiAgdGhpcy5fZW5zdXJlVmFsaWRJZChjb25uZWN0aW9uKTsKCiAgaWYgKHBhcmVudCkgewogICAgY29ubmVjdGlvbi5wYXJlbnQgPSBwYXJlbnQ7CiAgICBwYXJlbnQuY2hpbGRyZW4ucHVzaChjb25uZWN0aW9uKTsKICB9CgogIC8vIGNyZWF0ZSBjb25uZWN0aW9uIGdmeAogIHZhciBnZnggPSB0aGlzLl9ncmFwaGljc0ZhY3RvcnkuY3JlYXRlQ29ubmVjdGlvbih0aGlzLl9yb290LCBjb25uZWN0aW9uKTsKCiAgLyoqCiAgICogQW4gZXZlbnQgaW5kaWNhdGluZyB0aGF0IGEgbmV3IGNvbm5lY3Rpb24gaXMgYmVpbmcgYWRkZWQgdG8gdGhlIGNhbnZhcy4KICAgKgogICAqIEBtZW1iZXJPZiBDYW52YXMKICAgKgogICAqIEBldmVudCBjb25uZWN0aW9uLmFkZAogICAqIEB0eXBlIHtPYmplY3R9CiAgICogQHByb3BlcnR5IHtkanMubW9kZWwuQ29ubmVjdGlvbn0gZWxlbWVudCB0aGUgY29ubmVjdGlvbgogICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBnZnggdGhlIGdyYXBoaWNhbCByZXByZXNlbnRhdGlvbiBvZiB0aGUgY29ubmVjdGlvbgogICAqLwogIHRoaXMuX2V2ZW50QnVzLmZpcmUoJ2Nvbm5lY3Rpb24uYWRkJywgeyBlbGVtZW50OiBjb25uZWN0aW9uLCBnZng6IGdmeCB9KTsKCiAgLy8gdXBkYXRlIGl0cyB2aXN1YWwKICB0aGlzLl9ncmFwaGljc0ZhY3RvcnkudXBkYXRlQ29ubmVjdGlvbihjb25uZWN0aW9uLCBnZngpOwoKICAvKioKICAgKiBBbiBldmVudCBpbmRpY2F0aW5nIHRoYXQgYSBuZXcgY29ubmVjdGlvbiBoYXMgYmVlbiBhZGRlZCB0byB0aGUgY2FudmFzLgogICAqCiAgICogQG1lbWJlck9mIENhbnZhcwogICAqCiAgICogQGV2ZW50IGNvbm5lY3Rpb24uYWRkZWQKICAgKiBAdHlwZSB7T2JqZWN0fQogICAqIEBwcm9wZXJ0eSB7ZGpzLm1vZGVsLkNvbm5lY3Rpb259IGVsZW1lbnQgdGhlIGNvbm5lY3Rpb24KICAgKiBAcHJvcGVydHkge09iamVjdH0gZ2Z4IHRoZSBncmFwaGljYWwgcmVwcmVzZW50YXRpb24gb2YgdGhlIGNvbm5lY3Rpb24KICAgKi8KICB0aGlzLl9ldmVudEJ1cy5maXJlKCdjb25uZWN0aW9uLmFkZGVkJywgeyBlbGVtZW50OiBjb25uZWN0aW9uLCBnZng6IGdmeCB9KTsKCiAgcmV0dXJuIGNvbm5lY3Rpb247Cn07CgoKLyoqCiAqIEludGVybmFsIHJlbW92ZSBlbGVtZW50CiAqLwpDYW52YXMucHJvdG90eXBlLl9yZW1vdmVFbGVtZW50ID0gZnVuY3Rpb24oZWxlbWVudCwgdHlwZSkgewoKICBpZiAoXy5pc1N0cmluZyhlbGVtZW50KSkgewogICAgZWxlbWVudCA9IHRoaXMuX2VsZW1lbnRSZWdpc3RyeS5nZXRCeUlkKGVsZW1lbnQpOwogIH0KCiAgdmFyIGdmeCA9IHRoaXMuX2VsZW1lbnRSZWdpc3RyeS5nZXRHcmFwaGljc0J5RWxlbWVudChlbGVtZW50KTsKCiAgdGhpcy5fZXZlbnRCdXMuZmlyZSh0eXBlICsgJy5yZW1vdmUnLCB7IGVsZW1lbnQ6IGVsZW1lbnQsIGdmeDogZ2Z4IH0pOwoKICBpZiAoZ2Z4KSB7CiAgICBnZngucmVtb3ZlKCk7CiAgfQoKICAvLyB1bnNldCBwYXJlbnQgPC0+IGNoaWxkIHJlbGF0aW9uc2hpcAogIHJlbW92ZShlbGVtZW50LnBhcmVudCAmJiBlbGVtZW50LnBhcmVudC5jaGlsZHJlbiwgZWxlbWVudCk7CiAgZWxlbWVudC5wYXJlbnQgPSBudWxsOwoKICB0aGlzLl9ldmVudEJ1cy5maXJlKHR5cGUgKyAnLnJlbW92ZWQnLCB7IGVsZW1lbnQ6IGVsZW1lbnQsIGdmeDogZ2Z4IH0pOwoKICByZXR1cm4gZWxlbWVudDsKfTsKCi8qKgogKiBSZW1vdmVzIGEgc2hhcGUgZnJvbSB0aGUgY2FudmFzCiAqCiAqIEBwYXJhbSB7U3RyaW5nfGRqcy5tb2RlbC5TaGFwZX0gc2hhcGUgb3Igc2hhcGUgaWQgdG8gYmUgcmVtb3ZlZAogKgogKiBAcmV0dXJuIHtkanMubW9kZWwuU2hhcGV9IHRoZSByZW1vdmVkIHNoYXBlCiAqLwpDYW52YXMucHJvdG90eXBlLnJlbW92ZVNoYXBlID0gZnVuY3Rpb24oc2hhcGUpIHsKCiAgLyoqCiAgICogQW4gZXZlbnQgaW5kaWNhdGluZyB0aGF0IGEgc2hhcGUgaXMgYWJvdXQgdG8gYmUgcmVtb3ZlZCBmcm9tIHRoZSBjYW52YXMuCiAgICoKICAgKiBAbWVtYmVyT2YgQ2FudmFzCiAgICoKICAgKiBAZXZlbnQgc2hhcGUucmVtb3ZlCiAgICogQHR5cGUge09iamVjdH0KICAgKiBAcHJvcGVydHkge2Rqcy5tb2RlbC5TaGFwZX0gZWxlbWVudCB0aGUgc2hhcGUgZGVzY3JpcHRvcgogICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBnZnggdGhlIGdyYXBoaWNhbCByZXByZXNlbnRhdGlvbiBvZiB0aGUgc2hhcGUKICAgKi8KCiAgLyoqCiAgICogQW4gZXZlbnQgaW5kaWNhdGluZyB0aGF0IGEgc2hhcGUgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSBjYW52YXMuCiAgICoKICAgKiBAbWVtYmVyT2YgQ2FudmFzCiAgICoKICAgKiBAZXZlbnQgc2hhcGUucmVtb3ZlZAogICAqIEB0eXBlIHtPYmplY3R9CiAgICogQHByb3BlcnR5IHtkanMubW9kZWwuU2hhcGV9IGVsZW1lbnQgdGhlIHNoYXBlIGRlc2NyaXB0b3IKICAgKiBAcHJvcGVydHkge09iamVjdH0gZ2Z4IHRoZSBncmFwaGljYWwgcmVwcmVzZW50YXRpb24gb2YgdGhlIHNoYXBlCiAgICovCiAgcmV0dXJuIHRoaXMuX3JlbW92ZUVsZW1lbnQoc2hhcGUsICdzaGFwZScpOwp9OwoKLyoqCiAqIFJlbW92ZXMgYSBjb25uZWN0aW9uIGZyb20gdGhlIGNhbnZhcwogKgogKiBAcGFyYW0ge1N0cmluZ3xkanMubW9kZWwuQ29ubmVjdGlvbn0gY29ubmVjdGlvbiBvciBjb25uZWN0aW9uIGlkIHRvIGJlIHJlbW92ZWQKICoKICogQHJldHVybiB7ZGpzLm1vZGVsLkNvbm5lY3Rpb259IHRoZSByZW1vdmVkIGNvbm5lY3Rpb24KICovCkNhbnZhcy5wcm90b3R5cGUucmVtb3ZlQ29ubmVjdGlvbiA9IGZ1bmN0aW9uKGNvbm5lY3Rpb24pIHsKCiAgLyoqCiAgICogQW4gZXZlbnQgaW5kaWNhdGluZyB0aGF0IGEgY29ubmVjdGlvbiBpcyBhYm91dCB0byBiZSByZW1vdmVkIGZyb20gdGhlIGNhbnZhcy4KICAgKgogICAqIEBtZW1iZXJPZiBDYW52YXMKICAgKgogICAqIEBldmVudCBjb25uZWN0aW9uLnJlbW92ZQogICAqIEB0eXBlIHtPYmplY3R9CiAgICogQHByb3BlcnR5IHtkanMubW9kZWwuQ29ubmVjdGlvbn0gZWxlbWVudCB0aGUgY29ubmVjdGlvbiBkZXNjcmlwdG9yCiAgICogQHByb3BlcnR5IHtPYmplY3R9IGdmeCB0aGUgZ3JhcGhpY2FsIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBjb25uZWN0aW9uCiAgICovCgogIC8qKgogICAqIEFuIGV2ZW50IGluZGljYXRpbmcgdGhhdCBhIGNvbm5lY3Rpb24gaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSBjYW52YXMuCiAgICoKICAgKiBAbWVtYmVyT2YgQ2FudmFzCiAgICoKICAgKiBAZXZlbnQgY29ubmVjdGlvbi5yZW1vdmVkCiAgICogQHR5cGUge09iamVjdH0KICAgKiBAcHJvcGVydHkge2Rqcy5tb2RlbC5Db25uZWN0aW9ufSBlbGVtZW50IHRoZSBjb25uZWN0aW9uIGRlc2NyaXB0b3IKICAgKiBAcHJvcGVydHkge09iamVjdH0gZ2Z4IHRoZSBncmFwaGljYWwgcmVwcmVzZW50YXRpb24gb2YgdGhlIGNvbm5lY3Rpb24KICAgKi8KICByZXR1cm4gdGhpcy5fcmVtb3ZlRWxlbWVudChjb25uZWN0aW9uLCAnY29ubmVjdGlvbicpOwp9OwoKCkNhbnZhcy5wcm90b3R5cGUuX2ZpcmVWaWV3Ym94Q2hhbmdlID0gZnVuY3Rpb24odmlld2JveCkgewogIHRoaXMuX2V2ZW50QnVzLmZpcmUoJ2NhbnZhcy52aWV3Ym94LmNoYW5nZWQnLCB7IHZpZXdib3g6IHZpZXdib3ggfHwgdGhpcy52aWV3Ym94KCkgfSk7Cn07CgovKioKICogR2V0cyBvciBzZXRzIHRoZSB2aWV3IGJveCBvZiB0aGUgY2FudmFzLCBpLmUuIHRoZSBhcmVhIHRoYXQgaXMgY3VycmVudGx5IGRpc3BsYXllZAogKgogKiBAcGFyYW0gIHtPYmplY3R9IFtib3hdIHRoZSBuZXcgdmlldyBib3ggdG8gc2V0CiAqIEBwYXJhbSAge051bWJlcn0gYm94LnggdGhlIHRvcCBsZWZ0IFggY29vcmRpbmF0ZSBvZiB0aGUgY2FudmFzIHZpc2libGUgaW4gdmlldyBib3gKICogQHBhcmFtICB7TnVtYmVyfSBib3gueSB0aGUgdG9wIGxlZnQgWSBjb29yZGluYXRlIG9mIHRoZSBjYW52YXMgdmlzaWJsZSBpbiB2aWV3IGJveAogKiBAcGFyYW0gIHtOdW1iZXJ9IGJveC53aWR0aCB0aGUgdmlzaWJsZSB3aWR0aAogKiBAcGFyYW0gIHtOdW1iZXJ9IGJveC5oZWlnaHQKICoKICogQGV4YW1wbGUKICoKICogY2FudmFzLnZpZXdib3goeyB4OiAxMDAsIHk6IDEwMCwgd2lkdGg6IDUwMCwgaGVpZ2h0OiA1MDAgfSkKICoKICogLy8gc2V0cyB0aGUgdmlzaWJsZSBhcmVhIG9mIHRoZSBkaWFncmFtIHRvICgxMDB8MTAwKSAtPiAoNjAwfDEwMCkKICogLy8gYW5kIGFuZCBzY2FsZXMgaXQgYWNjb3JkaW5nIHRvIHRoZSBkaWFncmFtIHdpZHRoCiAqCiAqIEByZXR1cm4ge09iamVjdH0gdGhlIGN1cnJlbnQgdmlldyBib3gKICovCkNhbnZhcy5wcm90b3R5cGUudmlld2JveCA9IGZ1bmN0aW9uKGJveCkgewoKICB2YXIgcm9vdCA9IHRoaXMuX3Jvb3Q7CgogIHZhciBpbm5lckJveCwKICAgICAgb3V0ZXJCb3ggPSB0aGlzLmdldFNpemUoKSwKICAgICAgbWF0cml4LAogICAgICBzY2FsZSwKICAgICAgeCwgeTsKCiAgaWYgKCFib3gpIHsKICAgIGlubmVyQm94ID0gcm9vdC5nZXRCQm94KHRydWUpOwoKICAgIG1hdHJpeCA9IHJvb3QudHJhbnNmb3JtKCkubG9jYWxNYXRyaXg7CiAgICBzY2FsZSA9IHJvdW5kKG1hdHJpeC5hLCAxMDAwKTsKCiAgICB4ID0gcm91bmQoLW1hdHJpeC5lIHx8IDAsIDEwMDApOwogICAgeSA9IHJvdW5kKC1tYXRyaXguZiB8fCAwLCAxMDAwKTsKCiAgICByZXR1cm4gewogICAgICB4OiB4ID8geCAvIHNjYWxlIDogMCwKICAgICAgeTogeSA/IHkgLyBzY2FsZSA6IDAsCiAgICAgIHdpZHRoOiBvdXRlckJveC53aWR0aCAvIHNjYWxlLAogICAgICBoZWlnaHQ6IG91dGVyQm94LmhlaWdodCAvIHNjYWxlLAogICAgICBzY2FsZTogc2NhbGUsCiAgICAgIGlubmVyOiB7CiAgICAgICAgd2lkdGg6IGlubmVyQm94LndpZHRoLAogICAgICAgIGhlaWdodDogaW5uZXJCb3guaGVpZ2h0CiAgICAgIH0sCiAgICAgIG91dGVyOiBvdXRlckJveAogICAgfTsKICB9IGVsc2UgewogICAgc2NhbGUgPSBNYXRoLm1heChvdXRlckJveC53aWR0aCAvIGJveC53aWR0aCwgb3V0ZXJCb3guaGVpZ2h0IC8gYm94LmhlaWdodCk7CgogICAgbWF0cml4ID0gbmV3IHRoaXMuX3NuYXAuTWF0cml4KCkuc2NhbGUoc2NhbGUpLnRyYW5zbGF0ZSgtYm94LngsIC1ib3gueSk7CiAgICByb290LnRyYW5zZm9ybShtYXRyaXgpOwoKICAgIHRoaXMuX2ZpcmVWaWV3Ym94Q2hhbmdlKCk7CiAgfQoKICByZXR1cm4gYm94Owp9OwoKCi8qKgogKiBHZXRzIG9yIHNldHMgdGhlIHNjcm9sbCBvZiB0aGUgY2FudmFzLgogKgogKiBAcGFyYW0ge09iamVjdH0gW2RlbHRhXSB0aGUgbmV3IHNjcm9sbCB0byBhcHBseS4KICoKICogQHBhcmFtIHtOdW1iZXJ9IFtkZWx0YS5keF0KICogQHBhcmFtIHtOdW1iZXJ9IFtkZWx0YS5keV0KICovCkNhbnZhcy5wcm90b3R5cGUuc2Nyb2xsID0gZnVuY3Rpb24oZGVsdGEpIHsKCiAgdmFyIG5vZGUgPSB0aGlzLl9yb290Lm5vZGU7CiAgdmFyIG1hdHJpeCA9IG5vZGUuZ2V0Q1RNKCk7CgogIGlmIChkZWx0YSkgewogICAgZGVsdGEgPSBfLmV4dGVuZCh7IGR4OiAwLCBkeTogMCB9LCBkZWx0YSB8fCB7fSk7CgogICAgbWF0cml4ID0gdGhpcy5fcGFwZXIubm9kZS5jcmVhdGVTVkdNYXRyaXgoKS50cmFuc2xhdGUoZGVsdGEuZHgsIGRlbHRhLmR5KS5tdWx0aXBseShtYXRyaXgpOwoKICAgIHNldENUTShub2RlLCBtYXRyaXgpOwoKICAgIHRoaXMuX2ZpcmVWaWV3Ym94Q2hhbmdlKCk7CiAgfQoKICByZXR1cm4geyB4OiBtYXRyaXguZSwgeTogbWF0cml4LmYgfTsKfTsKCgovKioKICogR2V0cyBvciBzZXRzIHRoZSBjdXJyZW50IHpvb20gb2YgdGhlIGNhbnZhcywgb3B0aW9uYWxseSB6b29taW5nIHRvIHRoZSBzcGVjaWZpZWQgcG9zaXRpb24uCiAqCiAqIEBwYXJhbSB7U3RyaW5nfE51bWJlcn0gW25ld1NjYWxlXSB0aGUgbmV3IHpvb20gbGV2ZWwsIGVpdGhlciBhIG51bWJlciwgaS5lLiAwLjksCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBgZml0LXZpZXdwb3J0YCB0byBhZGp1c3QgdGhlIHNpemUgdG8gZml0IHRoZSBjdXJyZW50IHZpZXdwb3J0CiAqIEBwYXJhbSB7U3RyaW5nfFBvaW50fSBbY2VudGVyXSB0aGUgcmVmZXJlbmNlIHBvaW50IHsgeDogLi4sIHk6IC4ufSB0byB6b29tIHRvLCAnYXV0bycgdG8gem9vbSBpbnRvIG1pZCBvciBudWxsCiAqCiAqIEByZXR1cm4ge051bWJlcn0gdGhlIGN1cnJlbnQgc2NhbGUKICovCkNhbnZhcy5wcm90b3R5cGUuem9vbSA9IGZ1bmN0aW9uKG5ld1NjYWxlLCBjZW50ZXIpIHsKCiAgdmFyIHZib3ggPSB0aGlzLnZpZXdib3goKTsKCiAgaWYgKG5ld1NjYWxlID09PSB1bmRlZmluZWQpIHsKICAgIHJldHVybiB2Ym94LnNjYWxlOwogIH0KCiAgdmFyIG91dGVyID0gdmJveC5vdXRlcjsKCiAgaWYgKG5ld1NjYWxlID09PSAnZml0LXZpZXdwb3J0JykgewogICAgbmV3U2NhbGUgPSBNYXRoLm1pbigxLCBvdXRlci53aWR0aCAvIHZib3guaW5uZXIud2lkdGgpOwogIH0KCiAgaWYgKGNlbnRlciA9PT0gJ2F1dG8nKSB7CiAgICBjZW50ZXIgPSB7CiAgICAgIHg6IG91dGVyLndpZHRoIC8gMiwKICAgICAgeTogb3V0ZXIuaGVpZ2h0IC8gMgogICAgfTsKICB9CgogIHZhciBtYXRyaXggPSB0aGlzLl9zZXRab29tKG5ld1NjYWxlLCBjZW50ZXIpOwoKICB0aGlzLl9maXJlVmlld2JveENoYW5nZSgpOwoKICByZXR1cm4gcm91bmQobWF0cml4LmEsIDEwMDApOwp9OwoKZnVuY3Rpb24gc2V0Q1RNKG5vZGUsIG0pIHsKICB2YXIgbXN0ciA9ICdtYXRyaXgoJyArIG0uYSArICcsJyArIG0uYiArICcsJyArIG0uYyArICcsJyArIG0uZCArICcsJyArIG0uZSArICcsJyArIG0uZiArICcpJzsKICBub2RlLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJywgbXN0cik7Cn0KCkNhbnZhcy5wcm90b3R5cGUuX3NldFpvb20gPSBmdW5jdGlvbihzY2FsZSwgY2VudGVyKSB7CgogIHZhciBzdmcgPSB0aGlzLl9wYXBlci5ub2RlLAogICAgICB2aWV3cG9ydCA9IHRoaXMuX3Jvb3Qubm9kZTsKCiAgdmFyIG1hdHJpeCA9IHN2Zy5jcmVhdGVTVkdNYXRyaXgoKTsKICB2YXIgcG9pbnQgPSBzdmcuY3JlYXRlU1ZHUG9pbnQoKTsKCiAgdmFyIGNlbnRlclBvaW50LAogICAgICBvcmlnaW5hbFBvaW50LAogICAgICBjdXJyZW50TWF0cml4LAogICAgICBzY2FsZU1hdHJpeCwKICAgICAgbmV3TWF0cml4OwoKICBjdXJyZW50TWF0cml4ID0gdmlld3BvcnQuZ2V0Q1RNKCk7CgoKICB2YXIgY3VycmVudFNjYWxlID0gY3VycmVudE1hdHJpeC5hOwoKICBpZiAoY2VudGVyKSB7CiAgICBjZW50ZXJQb2ludCA9IF8uZXh0ZW5kKHBvaW50LCBjZW50ZXIpOwoKICAgIC8vIHJldmVydCBhcHBsaWVkIHZpZXdwb3J0IHRyYW5zZm9ybWF0aW9ucwogICAgb3JpZ2luYWxQb2ludCA9IGNlbnRlclBvaW50Lm1hdHJpeFRyYW5zZm9ybShjdXJyZW50TWF0cml4LmludmVyc2UoKSk7CgogICAgLy8gY3JlYXRlIHNjYWxlIG1hdHJpeAogICAgc2NhbGVNYXRyaXggPSBtYXRyaXgKICAgICAgICAgICAgICAgICAgICAudHJhbnNsYXRlKG9yaWdpbmFsUG9pbnQueCwgb3JpZ2luYWxQb2ludC55KQogICAgICAgICAgICAgICAgICAgIC5zY2FsZSgxIC8gY3VycmVudFNjYWxlICogc2NhbGUpCiAgICAgICAgICAgICAgICAgICAgLnRyYW5zbGF0ZSgtb3JpZ2luYWxQb2ludC54LCAtb3JpZ2luYWxQb2ludC55KTsKCiAgICBuZXdNYXRyaXggPSBjdXJyZW50TWF0cml4Lm11bHRpcGx5KHNjYWxlTWF0cml4KTsKICB9IGVsc2UgewogICAgbmV3TWF0cml4ID0gbWF0cml4LnNjYWxlKHNjYWxlKTsKICB9CgogIHNldENUTSh0aGlzLl9yb290Lm5vZGUsIG5ld01hdHJpeCk7CgogIHJldHVybiBuZXdNYXRyaXg7Cn07CgoKLyoqCiAqIFJldHVybnMgdGhlIHNpemUgb2YgdGhlIGNhbnZhcwogKgogKiBAcmV0dXJuIHtEaW1lbnNpb25zfQogKi8KQ2FudmFzLnByb3RvdHlwZS5nZXRTaXplID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB7CiAgICB3aWR0aDogdGhpcy5fY29udGFpbmVyLmNsaWVudFdpZHRoLAogICAgaGVpZ2h0OiB0aGlzLl9jb250YWluZXIuY2xpZW50SGVpZ2h0CiAgfTsKfTsKCgovKioKICogUmV0dXJuIHRoZSBhYnNvbHV0ZSBib3VuZGluZyBib3ggZm9yIHRoZSBnaXZlbiBlbGVtZW50CiAqCiAqIFRoZSBhYnNvbHV0ZSBib3VuZGluZyBib3ggbWF5IGJlIHVzZWQgdG8gZGlzcGxheSBvdmVybGF5cyBpbiB0aGUKICogY2FsbGVycyAoYnJvd3NlcikgY29vcmRpbmF0ZSBzeXN0ZW0gcmF0aGVyIHRoYW4gdGhlIHpvb21lZCBpbi9vdXQKICogY2FudmFzIGNvb3JkaW5hdGVzLgogKgogKiBAcGFyYW0gIHtFbGVtZW50RGVzY3JpcHRvcn0gZWxlbWVudAogKiBAcmV0dXJuIHtCb3VuZHN9IHRoZSBhYnNvbHV0ZSBib3VuZGluZyBib3gKICovCkNhbnZhcy5wcm90b3R5cGUuZ2V0QWJzb2x1dGVCQm94ID0gZnVuY3Rpb24oZWxlbWVudCkgewogIHZhciB2Ym94ID0gdGhpcy52aWV3Ym94KCk7CgogIHZhciBnZnggPSB0aGlzLmdldEdyYXBoaWNzKGVsZW1lbnQpOwoKICB2YXIgdHJhbnNmb3JtQkJveCA9IGdmeC5nZXRCQm94KHRydWUpOwogIHZhciBiYm94ID0gZ2Z4LmdldEJCb3goKTsKCiAgdmFyIHggPSAoYmJveC54IC0gdHJhbnNmb3JtQkJveC54KSAqIHZib3guc2NhbGUgLSB2Ym94LnggKiB2Ym94LnNjYWxlOwogIHZhciB5ID0gKGJib3gueSAtIHRyYW5zZm9ybUJCb3gueSkgKiB2Ym94LnNjYWxlIC0gdmJveC55ICogdmJveC5zY2FsZTsKCiAgdmFyIHdpZHRoID0gKGJib3gud2lkdGggKyAyICogdHJhbnNmb3JtQkJveC54KSAqIHZib3guc2NhbGU7CiAgdmFyIGhlaWdodCA9IChiYm94LmhlaWdodCArIDIgKiB0cmFuc2Zvcm1CQm94LnkpICogdmJveC5zY2FsZTsKCiAgcmV0dXJuIHsKICAgIHg6IHgsCiAgICB5OiB5LAogICAgd2lkdGg6IHdpZHRoLAogICAgaGVpZ2h0OiBoZWlnaHQKICB9Owp9OwoKQ2FudmFzLiRpbmplY3QgPSBbCiAgJ2NvbmZpZycsCiAgJ2V2ZW50QnVzJywKICAnZ3JhcGhpY3NGYWN0b3J5JywKICAnZWxlbWVudFJlZ2lzdHJ5JywKICAnc25hcCcgXTsKCm1vZHVsZS5leHBvcnRzID0gQ2FudmFzOwp9LHsiLi4vdXRpbC9Db2xsZWN0aW9ucyI6NjR9XSw0NDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBfID0gKHdpbmRvdy5fKTsKCgp2YXIgTW9kZWwgPSBfZGVyZXFfKCcuLi9tb2RlbCcpOwoKCi8qKgogKiBBIGZhY3RvcnkgZm9yIGRpYWdyYW0tanMgc2hhcGVzCiAqLwpmdW5jdGlvbiBFbGVtZW50RmFjdG9yeSgpIHsKICB0aGlzLl91aWQgPSAxMjsKfQoKbW9kdWxlLmV4cG9ydHMgPSBFbGVtZW50RmFjdG9yeTsKCgpFbGVtZW50RmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlUm9vdCA9IGZ1bmN0aW9uKGF0dHJzKSB7CiAgcmV0dXJuIHRoaXMuY3JlYXRlKCdyb290JywgYXR0cnMpOwp9OwoKRWxlbWVudEZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZUxhYmVsID0gZnVuY3Rpb24oYXR0cnMpIHsKICByZXR1cm4gdGhpcy5jcmVhdGUoJ2xhYmVsJywgYXR0cnMpOwp9OwoKRWxlbWVudEZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZVNoYXBlID0gZnVuY3Rpb24oYXR0cnMpIHsKICByZXR1cm4gdGhpcy5jcmVhdGUoJ3NoYXBlJywgYXR0cnMpOwp9OwoKRWxlbWVudEZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZUNvbm5lY3Rpb24gPSBmdW5jdGlvbihhdHRycykgewogIHJldHVybiB0aGlzLmNyZWF0ZSgnY29ubmVjdGlvbicsIGF0dHJzKTsKfTsKCi8qKgogKiBDcmVhdGUgYSBtb2RlbCBlbGVtZW50IHdpdGggdGhlIGdpdmVuIHR5cGUgYW5kCiAqIGEgbnVtYmVyIG9mIHByZS1zZXQgYXR0cmlidXRlcy4KICoKICogQHBhcmFtICB7U3RyaW5nfSB0eXBlCiAqIEBwYXJhbSAge09iamVjdH0gYXR0cnMKICogQHJldHVybiB7ZGpzLm1vZGVsLkJhc2V9IHRoZSBuZXdseSBjcmVhdGVkIG1vZGVsIGluc3RhbmNlCiAqLwpFbGVtZW50RmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24odHlwZSwgYXR0cnMpIHsKCiAgYXR0cnMgPSBhdHRycyB8fCB7fTsKCiAgaWYgKCFhdHRycy5pZCkgewogICAgYXR0cnMuaWQgPSB0eXBlICsgJ18nICsgKHRoaXMuX3VpZCsrKTsKICB9CgogIHJldHVybiBNb2RlbC5jcmVhdGUodHlwZSwgYXR0cnMpOwp9Owp9LHsiLi4vbW9kZWwiOjYzfV0sNDU6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgXyA9ICh3aW5kb3cuXyk7CgoKLyoqCiAqIEBjbGFzcwogKgogKiBBIHJlZ2lzdHJ5IHRoYXQga2VlcHMgdHJhY2sgb2YgYWxsIHNoYXBlcyBpbiB0aGUgZGlhZ3JhbS4KICoKICogQHBhcmFtIHtFdmVudEJ1c30gZXZlbnRCdXMgdGhlIGV2ZW50IGJ1cwogKi8KZnVuY3Rpb24gRWxlbWVudFJlZ2lzdHJ5KGV2ZW50QnVzKSB7CgogIC8vIG1hcHBpbmcgZWxlbWVudC5pZCAtPiBjb250YWluZXIKICB0aGlzLl9lbGVtZW50TWFwID0ge307CgogIC8vIG1hcHBpbmcgZ2Z4LmlkIC0+IGNvbnRhaW5lcgogIHRoaXMuX2dyYXBoaWNzTWFwID0ge307CgoKICB2YXIgc2VsZiA9IHRoaXM7CgogIF8uZm9yRWFjaChbICdzaGFwZScsICdjb25uZWN0aW9uJyBdLCBmdW5jdGlvbih0eXBlKSB7CiAgICBldmVudEJ1cy5vbih0eXBlICsgJy5hZGQnLCBmdW5jdGlvbihldmVudCkgewogICAgICBzZWxmLmFkZChldmVudC5lbGVtZW50LCBldmVudC5nZngpOwogICAgfSk7CgogICAgZXZlbnRCdXMub24odHlwZSArICcucmVtb3ZlZCcsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIHNlbGYucmVtb3ZlKGV2ZW50LmVsZW1lbnQsIGV2ZW50LmdmeCk7CiAgICB9KTsKICB9KTsKCiAgZXZlbnRCdXMub24oJ2RpYWdyYW0uZGVzdHJveScsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICBzZWxmLl9lbGVtZW50TWFwID0gbnVsbDsKICAgIHNlbGYuZ3JhcGhpY3NNYXAgPSBudWxsOwogIH0pOwp9CgpFbGVtZW50UmVnaXN0cnkuJGluamVjdCA9IFsgJ2V2ZW50QnVzJyBdOwoKbW9kdWxlLmV4cG9ydHMgPSBFbGVtZW50UmVnaXN0cnk7CgoKRWxlbWVudFJlZ2lzdHJ5LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihlbGVtZW50LCBnZngpIHsKICBpZiAoIWVsZW1lbnQuaWQpIHsKICAgIHRocm93IG5ldyBFcnJvcignZWxlbWVudCBoYXMgbm8gaWQnKTsKICB9CgogIGlmICghZ2Z4LmlkKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ2dyYXBoaWNzIGhhcyBubyBpZCcpOwogIH0KCiAgaWYgKHRoaXMuX2dyYXBoaWNzTWFwW2dmeC5pZF0pIHsKICAgIHRocm93IG5ldyBFcnJvcignZ3JhcGhpY3Mgd2l0aCBpZCAnICsgZ2Z4LmlkICsgJyBhbHJlYWR5IHJlZ2lzdGVyZWQnKTsKICB9CgogIGlmICh0aGlzLl9lbGVtZW50TWFwW2VsZW1lbnQuaWRdKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ2VsZW1lbnQgd2l0aCBpZCAnICsgZWxlbWVudC5pZCArICcgYWxyZWFkeSBhZGRlZCcpOwogIH0KCiAgdGhpcy5fZWxlbWVudE1hcFtlbGVtZW50LmlkXSA9IHRoaXMuX2dyYXBoaWNzTWFwW2dmeC5pZF0gPSB7IGVsZW1lbnQ6IGVsZW1lbnQsIGdmeDogZ2Z4IH07Cn07CgpFbGVtZW50UmVnaXN0cnkucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICB2YXIgZ2Z4ID0gdGhpcy5nZXRHcmFwaGljc0J5RWxlbWVudChlbGVtZW50KTsKCiAgZGVsZXRlIHRoaXMuX2VsZW1lbnRNYXBbZWxlbWVudC5pZF07CiAgZGVsZXRlIHRoaXMuX2dyYXBoaWNzTWFwW2dmeC5pZF07Cn07CgoKLyoqCiAqIEBtZXRob2QgRWxlbWVudFJlZ2lzdHJ5I2dldEJ5R3JhcGhpY3MKICovCkVsZW1lbnRSZWdpc3RyeS5wcm90b3R5cGUuZ2V0QnlHcmFwaGljcyA9IGZ1bmN0aW9uKGdmeCkgewogIHZhciBpZCA9IF8uaXNTdHJpbmcoZ2Z4KSA/IGdmeCA6IGdmeC5pZDsKCiAgdmFyIGNvbnRhaW5lciA9IHRoaXMuX2dyYXBoaWNzTWFwW2lkXTsKICByZXR1cm4gY29udGFpbmVyICYmIGNvbnRhaW5lci5lbGVtZW50Owp9OwoKCi8qKgogKiBAbWV0aG9kIEVsZW1lbnRSZWdpc3RyeSNnZXRCeUlkCiAqLwpFbGVtZW50UmVnaXN0cnkucHJvdG90eXBlLmdldEJ5SWQgPSBmdW5jdGlvbihpZCkgewogIHZhciBjb250YWluZXIgPSB0aGlzLl9lbGVtZW50TWFwW2lkXTsKICByZXR1cm4gY29udGFpbmVyICYmIGNvbnRhaW5lci5lbGVtZW50Owp9OwoKLyoqCiAqIEBtZXRob2QgRWxlbWVudFJlZ2lzdHJ5I2dldEdyYXBoaWNzQnlFbGVtZW50CiAqLwpFbGVtZW50UmVnaXN0cnkucHJvdG90eXBlLmdldEdyYXBoaWNzQnlFbGVtZW50ID0gZnVuY3Rpb24oZWxlbWVudCkgewogIHZhciBpZCA9IF8uaXNTdHJpbmcoZWxlbWVudCkgPyBlbGVtZW50IDogZWxlbWVudC5pZDsKCiAgdmFyIGNvbnRhaW5lciA9IHRoaXMuX2VsZW1lbnRNYXBbaWRdOwogIHJldHVybiBjb250YWluZXIgJiYgY29udGFpbmVyLmdmeDsKfTsKfSx7fV0sNDY6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgXyA9ICh3aW5kb3cuXyk7CgovKioKICogQGdsb2JhbAogKiBAdHlwZSB7T2JqZWN0fQogKiBAc3RhdGljCiAqLwp2YXIgRXZlbnRQcmlvcml0eSA9IHsKICBzdGFuZGFyZDogMTAwMCwKICBvdmVyd3JpdGU6IDEwMDAwCn07CgovKioKICogQGNsYXNzCiAqCiAqIEEgZ2VuZXJhbCBwdXJwb3NlIGV2ZW50IGJ1cwogKi8KZnVuY3Rpb24gRXZlbnRCdXMoKSB7CiAgdmFyIGxpc3RlbmVyTWFwID0ge307CgogIGZ1bmN0aW9uIGdldExpc3RlbmVycyhuYW1lKSB7CiAgICB2YXIgbGlzdGVuZXJzID0gbGlzdGVuZXJNYXBbbmFtZV07CgogICAgaWYgKCFsaXN0ZW5lcnMpIHsKICAgICAgbGlzdGVuZXJzID0gbGlzdGVuZXJNYXBbbmFtZV0gPSBbXTsKICAgIH0KCiAgICByZXR1cm4gbGlzdGVuZXJzOwogIH0KCiAgZnVuY3Rpb24gZXh0ZW5kRXZlbnQoZXZlbnQsIHR5cGUpIHsKCiAgICB2YXIgcHJvcGFnYXRpb25TdG9wcGVkLAogICAgICAgIGRlZmF1bHRQcmV2ZW50ZWQ7CgogICAgXy5leHRlbmQoZXZlbnQsIHsKICAgICAgdHlwZTogdHlwZSwKCiAgICAgIHN0b3BQcm9wYWdhdGlvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5wcm9wYWdhdGlvblN0b3BwZWQgPSB0cnVlOwogICAgICB9LAogICAgICBwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5kZWZhdWx0UHJldmVudGVkID0gdHJ1ZTsKICAgICAgfSwKCiAgICAgIGlzUHJvcGFnYXRpb25TdG9wcGVkOiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gISF0aGlzLnByb3BhZ2F0aW9uU3RvcHBlZDsKICAgICAgfSwKCiAgICAgIGlzRGVmYXVsdFByZXZlbnRlZDogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuICEhdGhpcy5kZWZhdWx0UHJldmVudGVkOwogICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gZXZlbnQ7CiAgfQoKICAvKioKICAgKiBSZWdpc3RlciBhbiBldmVudCBsaXN0ZW5lciBmb3IgZXZlbnRzIHdpdGggdGhlIGdpdmVuIG5hbWUuCiAgICoKICAgKiBUaGUgY2FsbGJhY2sgd2lsbCBiZSBpbnZva2VkIHdpdGggYGV2ZW50LCAuLi5hZGRpdGlvbmFsQXJndW1lbnRzYAogICAqIHRoYXQgaGF2ZSBiZWVuIHBhc3NlZCB0byB0aGUgZXZlbnRlZCBlbGVtZW50LgogICAqCiAgICogQG1ldGhvZCBFdmVudEJ1cyNvbgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXk8U3RyaW5nPn0gZXZlbnRzCiAgICogQHBhcmFtIHtOdW1iZXJ9IFtwcmlvcml0eV0gdGhlIHByaW9yaXR5IGluIHdoaWNoIHRoaXMgbGlzdGVuZXIgaXMgY2FsbGVkLAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRzIHRvIDEwMDAgYnV0IG1heSBiZSBjaGFuZ2VkIHRvIG92ZXJyaWRlIGV4ZWN1dGlvbiBvcmRlciBvZiBjYWxsYmFja3MKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPiB7QGxpbmsgRXZlbnRQcmlvcml0eSNvdmVyd3JpdGV9KQogICAqCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgKi8KICBmdW5jdGlvbiBvbihldmVudHMsIHByaW9yaXR5LCBjYWxsYmFjaykgewoKICAgIGV2ZW50cyA9IF8uaXNBcnJheShldmVudHMpID8gZXZlbnRzIDogWyBldmVudHMgXTsKCiAgICBpZiAoXy5pc0Z1bmN0aW9uKHByaW9yaXR5KSkgewogICAgICBjYWxsYmFjayA9IHByaW9yaXR5OwogICAgICBwcmlvcml0eSA9IEV2ZW50UHJpb3JpdHkuc3RhbmRhcmQ7CiAgICB9CgogICAgaWYgKCFfLmlzTnVtYmVyKHByaW9yaXR5KSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ3ByaW9yaXR5IG5lZWRzIHRvIGJlIGEgbnVtYmVyJyk7CiAgICB9CgogICAgXy5mb3JFYWNoKGV2ZW50cywgZnVuY3Rpb24oZSkgewogICAgICB2YXIgbGlzdGVuZXJzID0gZ2V0TGlzdGVuZXJzKGUpOwogICAgICBhZGRFdmVudFRvQXJyYXkobGlzdGVuZXJzLCBjYWxsYmFjaywgcHJpb3JpdHkpOwogICAgfSk7CiAgfQoKICAvKioKICAgKiBSZWdpc3RlciBhbiBldmVudCBsaXN0ZW5lciB0aGF0IGlzIGV4ZWN1dGVkIG9ubHkgb25jZS4KICAgKgogICAqIEBtZXRob2QgRXZlbnRCdXMjb25jZQogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50IHRoZSBldmVudCBuYW1lIHRvIHJlZ2lzdGVyIGZvcgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIHRoZSBjYWxsYmFjayB0byBleGVjdXRlCiAgICoKICAgKiBAc2VlIEV2ZW50QnVzI29uCiAgICovCiAgZnVuY3Rpb24gb25jZShldmVudCwgY2FsbGJhY2spIHsKCiAgICAvKiBqc2hpbnQgLVcwNDAgKi8KCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgd3JhcHBlZENhbGxiYWNrID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBldmVudFR5cGUgPSBhcmd1bWVudHNbMF0udHlwZTsKICAgICAgY2FsbGJhY2suYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgc2VsZi5vZmYoZXZlbnRUeXBlLCB3cmFwcGVkQ2FsbGJhY2spOwogICAgfTsKCiAgICB0aGlzLm9uKGV2ZW50LCB3cmFwcGVkQ2FsbGJhY2spOwogIH0KCiAgLyoqCiAgICogUmVtb3ZlcyBldmVudCBsaXN0ZW5lcnMgYnkgZXZlbnQgYW5kIGNhbGxiYWNrLgogICAqCiAgICogSWYgbm8gY2FsbGJhY2sgaXMgZ2l2ZW4sIGFsbCBsaXN0ZW5lcnMgZm9yIGEgZ2l2ZW4gZXZlbnQgbmFtZSBhcmUgYmVpbmcgcmVtb3ZlZC4KICAgKgogICAqIEBtZXRob2QgRXZlbnRCdXMjb2ZmCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gZXZlbnQKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2FsbGJhY2tdCiAgICovCiAgZnVuY3Rpb24gb2ZmKGV2ZW50LCBjYWxsYmFjaykgewogICAgdmFyIGxpc3RlbmVycywgaWR4OwoKICAgIGxpc3RlbmVycyA9IGdldExpc3RlbmVycyhldmVudCk7CiAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgXy5mb3JFYWNoKGxpc3RlbmVycywgZnVuY3Rpb24obGlzdGVuZXIpIHsKICAgICAgICBpZihsaXN0ZW5lci5jYWxsYmFjayA9PT0gY2FsbGJhY2spIHsKICAgICAgICAgIGlkeCA9IGxpc3RlbmVycy5pbmRleE9mKGxpc3RlbmVyKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICBsaXN0ZW5lcnMuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGxpc3RlbmVycy5sZW5ndGggPSAwOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaGFuZGxlRXJyb3IoZXJyb3IpIHsKICAgIHJldHVybiAhZmlyZSgnZXJyb3InLCB7IGVycm9yOiBlcnJvciB9KTsKICB9CgogIC8qKgogICAqIEZpcmVzIGEgbmFtZWQgZXZlbnQuCiAgICoKICAgKiBAbWV0aG9kIEV2ZW50QnVzI2ZpcmUKICAgKgogICAqIEBleGFtcGxlCiAgICoKICAgKiAvLyBmaXJlIGV2ZW50IGJ5IG5hbWUKICAgKiBldmVudHMuZmlyZSgnZm9vJyk7CiAgICoKICAgKiAvLyBmaXJlIGV2ZW50IG9iamVjdCB3aXRoIG5lc3RlZCB0eXBlCiAgICogdmFyIGV2ZW50ID0geyB0eXBlOiAnZm9vJyB9OwogICAqIGV2ZW50cy5maXJlKGV2ZW50KTsKICAgKgogICAqIC8vIGZpcmUgZXZlbnQgd2l0aCBleHBsaWNpdCB0eXBlCiAgICogdmFyIGV2ZW50ID0geyB4OiAxMCwgeTogMjAgfTsKICAgKiBldmVudHMuZmlyZSgnZWxlbWVudC5tb3ZlZCcsIGV2ZW50KTsKICAgKgogICAqIC8vIHBhc3MgYWRkaXRpb25hbCBhcmd1bWVudHMgdG8gdGhlIGV2ZW50CiAgICogZXZlbnRzLm9uKCdmb28nLCBmdW5jdGlvbihldmVudCwgYmFyKSB7CiAgICogICBhbGVydChiYXIpOwogICAqIH0pOwogICAqCiAgICogZXZlbnRzLmZpcmUoeyB0eXBlOiAnZm9vJyB9LCAnSSBhbSBiYXIhJyk7CiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gW25hbWVdIHRoZSBvcHRpb25hbCBldmVudCBuYW1lCiAgICogQHBhcmFtIHtPYmplY3R9IFtldmVudF0gdGhlIGV2ZW50IG9iamVjdAogICAqIEBwYXJhbSB7Li4uT2JqZWN0fSBhZGRpdGlvbmFsIGFyZ3VtZW50cyB0byBiZSBwYXNzZWQgdG8gdGhlIGNhbGxiYWNrIGZ1bmN0aW9ucwogICAqCiAgICogQHJldHVybiB7Qm9vbGVhbn0gZmFsc2UgaWYgZGVmYXVsdCB3YXMgcHJldmVudGVkCiAgICovCiAgZnVuY3Rpb24gZmlyZSgpIHsKCiAgICAvKiBqc2hpbnQgLVcwNDAgKi8KCiAgICB2YXIgZXZlbnQsIGV2ZW50VHlwZSwKICAgICAgICBsaXN0ZW5lcnMsIGksIGwsCiAgICAgICAgYXJnczsKCiAgICBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTsKCiAgICBldmVudFR5cGUgPSBhcmdzWzBdOwoKICAgIGlmIChfLmlzT2JqZWN0KGV2ZW50VHlwZSkpIHsKICAgICAgZXZlbnQgPSBldmVudFR5cGU7CgogICAgICAvLyBwYXJzZSB0eXBlIGZyb20gZXZlbnQKICAgICAgZXZlbnRUeXBlID0gZXZlbnQudHlwZTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIHJlbW92ZSBuYW1lIHBhcmFtZXRlcgogICAgICBhcmdzLnNoaWZ0KCk7CgogICAgICBldmVudCA9IGFyZ3NbMF0gfHwge307CiAgICAgIGV2ZW50LnR5cGUgPSBldmVudFR5cGU7CiAgICAgIGlmKGFyZ3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgYXJncy5wdXNoKGV2ZW50KTsKICAgICAgfQogICAgfQoKICAgIGxpc3RlbmVycyA9IGdldExpc3RlbmVycyhldmVudFR5cGUpOwogICAgZXZlbnQgPSBleHRlbmRFdmVudChldmVudCwgZXZlbnRUeXBlKTsKCiAgICBmb3IgKGkgPSAwLCBsOyAhIShsID0gbGlzdGVuZXJzW2ldKTsgaSsrKSB7CiAgICAgIGlmIChldmVudC5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHRyeSB7CiAgICAgICAgbC5jYWxsYmFjay5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICghaGFuZGxlRXJyb3IoZSkpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3VuaGFuZGxlZCBlcnJvciBpbiBldmVudCBsaXN0ZW5lcicsIGUpOwogICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gIWV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpOwogIH0KCiAgZnVuY3Rpb24gYWRkRXZlbnRUb0FycmF5KGFycmF5LCBjYWxsYmFjaywgcHJpb3JpdHkpIHsKCiAgICBhcnJheS5wdXNoKHsKICAgICAgcHJpb3JpdHk6IHByaW9yaXR5LAogICAgICBjYWxsYmFjazogY2FsbGJhY2sKICAgIH0pOwoKICAgIGFycmF5LnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICBpZiAoYS5wcmlvcml0eSA8IGIucHJpb3JpdHkpIHsKICAgICAgICByZXR1cm4gMTsKICAgICAgfSBlbHNlIGlmIChhLnByaW9yaXR5ID4gYi5wcmlvcml0eSkgewogICAgICAgIHJldHVybiAtMTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gMDsKICAgICAgfQogICAgfSk7CiAgfQoKICB0aGlzLm9uID0gb247CiAgdGhpcy5vbmNlID0gb25jZTsKICB0aGlzLm9mZiA9IG9mZjsKICB0aGlzLmZpcmUgPSBmaXJlOwp9CgoKbW9kdWxlLmV4cG9ydHMgPSBFdmVudEJ1czsKfSx7fV0sNDc6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgovKioKICogQ3JlYXRlcyBhIGdmeCBjb250YWluZXIgZm9yIHNoYXBlcyBhbmQgY29ubmVjdGlvbnMKICoKICogVGhlIGxheW91dCBpcyBhcyBmb2xsb3dzOgogKgogKiA8ZyBkYXRhLWVsZW1lbnQtaWQ9ImVsZW1lbnQtMSIgY2xhc3M9ImRqcy1ncm91cCBkanMtKHR5cGU9c2hhcGV8Y29ubmVjdGlvbikiPgogKiAgIDxnIGNsYXNzPSJkanMtdmlzdWFsIj4KICogICAgIDwhLS0gdGhlIHJlbmRlcmVyIGRyYXdzIGluIGhlcmUgLS0+CiAqICAgPC9nPgogKgogKiAgIDwhLS0gZXh0ZW5zaW9ucyAob3ZlcmxheXMsIGNsaWNrIGJveCwgLi4uKSBnb2VzIGhlcmUKICogPC9nPgogKgogKiBAcGFyYW0ge09iamVjdH0gcm9vdAogKiBAcGFyYW0ge1N0cmluZ30gdHlwZSB0aGUgdHlwZSBvZiB0aGUgZWxlbWVudCwgaS5lLiBzaGFwZSB8IGNvbm5lY3Rpb24KICovCmZ1bmN0aW9uIGNyZWF0ZUNvbnRhaW5lcihyb290LCB0eXBlKSB7CiAgdmFyIGdmeENvbnRhaW5lciA9IHJvb3QuZ3JvdXAoKTsKCiAgZ2Z4Q29udGFpbmVyCiAgICAuYWRkQ2xhc3MoJ2Rqcy1ncm91cCcpCiAgICAuYWRkQ2xhc3MoJ2Rqcy0nICsgdHlwZSk7CgogIHZhciBnZnhHcm91cCA9IGdmeENvbnRhaW5lci5ncm91cCgpLmFkZENsYXNzKCdkanMtdmlzdWFsJyk7CgogIHJldHVybiBnZnhDb250YWluZXI7Cn0KCi8qKgogKiBDbGVhcnMgdGhlIGdyYXBoaWNhbCByZXByZXNlbnRhdGlvbiBvZiB0aGUgZWxlbWVudCBhbmQgcmV0dXJucyB0aGUKICogY2xlYXJlZCByZXN1bHQgKHRoZSA8ZyBjbGFzcz0iZGpzLXZpc3VhbCIgLz4gZWxlbWVudCkuCiAqLwpmdW5jdGlvbiBjbGVhclZpc3VhbChnZngpIHsKCiAgdmFyIG9sZFZpc3VhbCA9IGdmeC5zZWxlY3QoJy5kanMtdmlzdWFsJyk7CgogIHZhciBuZXdWaXN1YWwgPSBnZnguZ3JvdXAoKS5hZGRDbGFzcygnZGpzLXZpc3VhbCcpLmJlZm9yZShvbGRWaXN1YWwpOwoKICBvbGRWaXN1YWwucmVtb3ZlKCk7CgogIHJldHVybiBuZXdWaXN1YWw7Cn0KCgpmdW5jdGlvbiBjcmVhdGVDb250YWluZXJGYWN0b3J5KHR5cGUpIHsKICByZXR1cm4gZnVuY3Rpb24ocm9vdCwgZGF0YSkgewogICAgcmV0dXJuIGNyZWF0ZUNvbnRhaW5lcihyb290LCB0eXBlKS5hdHRyKCdkYXRhLWVsZW1lbnQtaWQnLCBkYXRhLmlkKTsKICB9Owp9CgoKLyoqCiAqIEEgZmFjdG9yeSB0aGF0IGNyZWF0ZXMgZ3JhcGhpY2FsIGVsZW1lbnRzCiAqCiAqIEBwYXJhbSB7UmVuZGVyZXJ9IHJlbmRlcmVyCiAqIEBwYXJhbSB7U25hcH0gc25hcAogKi8KZnVuY3Rpb24gR3JhcGhpY3NGYWN0b3J5KHJlbmRlcmVyLCBzbmFwKSB7CiAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjsKICB0aGlzLl9zbmFwID0gc25hcDsKfQoKR3JhcGhpY3NGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGVTaGFwZSA9IGNyZWF0ZUNvbnRhaW5lckZhY3RvcnkoJ3NoYXBlJyk7CgpHcmFwaGljc0ZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZUNvbm5lY3Rpb24gPSBjcmVhdGVDb250YWluZXJGYWN0b3J5KCdjb25uZWN0aW9uJyk7CgpHcmFwaGljc0ZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZVBhcGVyID0gZnVuY3Rpb24ob3B0aW9ucykgewogIHJldHVybiB0aGlzLl9zbmFwLmNyZWF0ZVNuYXBBdChvcHRpb25zLndpZHRoLCBvcHRpb25zLmhlaWdodCwgb3B0aW9ucy5jb250YWluZXIpOwp9OwoKCkdyYXBoaWNzRmFjdG9yeS5wcm90b3R5cGUudXBkYXRlU2hhcGUgPSBmdW5jdGlvbihlbGVtZW50LCBnZngpIHsKCiAgLy8gY2xlYXIgdmlzdWFsCiAgdmFyIGdmeEdyb3VwID0gY2xlYXJWaXN1YWwoZ2Z4KTsKCiAgLy8gcmVkcmF3CiAgdGhpcy5fcmVuZGVyZXIuZHJhd1NoYXBlKGdmeEdyb3VwLCBlbGVtZW50KTsKCiAgLy8gdXBkYXRlIHBvc2l0aW9uaW5nCiAgZ2Z4LnRyYW5zbGF0ZShlbGVtZW50LngsIGVsZW1lbnQueSk7CgogIGlmIChlbGVtZW50LmhpZGRlbikgewogICAgZ2Z4LmF0dHIoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7CiAgfQp9OwoKCkdyYXBoaWNzRmFjdG9yeS5wcm90b3R5cGUudXBkYXRlQ29ubmVjdGlvbiA9IGZ1bmN0aW9uKGVsZW1lbnQsIGdmeCkgewoKICAvLyBjbGVhciB2aXN1YWwKICB2YXIgZ2Z4R3JvdXAgPSBjbGVhclZpc3VhbChnZngpOwogIHRoaXMuX3JlbmRlcmVyLmRyYXdDb25uZWN0aW9uKGdmeEdyb3VwLCBlbGVtZW50KTsKCiAgaWYgKGVsZW1lbnQuaGlkZGVuKSB7CiAgICBnZnguYXR0cigndmlzaWJpbGl0eScsICdoaWRkZW4nKTsKICB9Cn07CgoKR3JhcGhpY3NGYWN0b3J5LiRpbmplY3QgPSBbICdyZW5kZXJlcicsICdzbmFwJyBdOwoKbW9kdWxlLmV4cG9ydHMgPSBHcmFwaGljc0ZhY3Rvcnk7Cn0se31dLDQ4OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7CiAgX19kZXBlbmRzX186IFsgX2RlcmVxXygnLi4vZHJhdycpIF0sCiAgX19pbml0X186IFsgJ2NhbnZhcycgXSwKICBjYW52YXM6IFsgJ3R5cGUnLCBfZGVyZXFfKCcuL0NhbnZhcycpIF0sCiAgZWxlbWVudFJlZ2lzdHJ5OiBbICd0eXBlJywgX2RlcmVxXygnLi9FbGVtZW50UmVnaXN0cnknKSBdLAogIGVsZW1lbnRGYWN0b3J5OiBbICd0eXBlJywgX2RlcmVxXygnLi9FbGVtZW50RmFjdG9yeScpIF0sCiAgZXZlbnRCdXM6IFsgJ3R5cGUnLCBfZGVyZXFfKCcuL0V2ZW50QnVzJykgXSwKICBncmFwaGljc0ZhY3Rvcnk6IFsgJ3R5cGUnLCBfZGVyZXFfKCcuL0dyYXBoaWNzRmFjdG9yeScpIF0KfTsKfSx7Ii4uL2RyYXciOjUyLCIuL0NhbnZhcyI6NDMsIi4vRWxlbWVudEZhY3RvcnkiOjQ0LCIuL0VsZW1lbnRSZWdpc3RyeSI6NDUsIi4vRXZlbnRCdXMiOjQ2LCIuL0dyYXBoaWNzRmFjdG9yeSI6NDd9XSw0OTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCi8vIHJlcXVpcmVkIGNvbXBvbmVudHMKCmZ1bmN0aW9uIGZsYXR0ZW5Qb2ludHMocG9pbnRzKSB7CiAgdmFyIHJlc3VsdCA9IFtdOwoKICBmb3IgKHZhciBpID0gMCwgcDsgISEocCA9IHBvaW50c1tpXSk7IGkrKykgewogICAgcmVzdWx0LnB1c2gocC54KTsKICAgIHJlc3VsdC5wdXNoKHAueSk7CiAgfQoKICByZXR1cm4gcmVzdWx0Owp9CgoKLyoqCiAqIEBjbGFzcyBSZW5kZXJlcgogKgogKiBUaGUgZGVmYXVsdCByZW5kZXJlciB1c2VkIGZvciBzaGFwZXMgYW5kIGNvbm5lY3Rpb25zLgogKgogKiBAcGFyYW0ge1N0eWxlc30gc3R5bGVzCiAqLwpmdW5jdGlvbiBSZW5kZXJlcihzdHlsZXMpIHsKICB0aGlzLkNPTk5FQ1RJT05fU1RZTEUgPSBzdHlsZXMuc3R5bGUoWyAnbm8tZmlsbCcgXSwgeyBzdHJva2VXaWR0aDogNSwgc3Ryb2tlOiAnZnVjaHNpYScgfSk7CiAgdGhpcy5TSEFQRV9TVFlMRSA9IHN0eWxlcy5zdHlsZSh7IGZpbGw6ICd3aGl0ZScsIHN0cm9rZTogJ2Z1Y2hzaWEnLCBzdHJva2VXaWR0aDogMiB9KTsKfQoKUmVuZGVyZXIucHJvdG90eXBlLmRyYXdTaGFwZSA9IGZ1bmN0aW9uIGRyYXdTaGFwZShnZnhHcm91cCwgZGF0YSkgewogIGlmIChkYXRhLndpZHRoID09PSB1bmRlZmluZWQgfHwKICAgICAgZGF0YS5oZWlnaHQgPT09IHVuZGVmaW5lZCkgewoKICAgIHRocm93IG5ldyBFcnJvcignbXVzdCBzcGVjaWZ5IHdpZHRoIGFuZCBoZWlnaHQgcHJvcGVydGllcyBmb3IgbmV3IHNoYXBlJyk7CiAgfQoKICByZXR1cm4gZ2Z4R3JvdXAucmVjdCgwLCAwLCBkYXRhLndpZHRoLCBkYXRhLmhlaWdodCwgMTAsIDEwKS5hdHRyKHRoaXMuU0hBUEVfU1RZTEUpOwp9OwoKUmVuZGVyZXIucHJvdG90eXBlLmRyYXdDb25uZWN0aW9uID0gZnVuY3Rpb24gZHJhd0Nvbm5lY3Rpb24oZ2Z4R3JvdXAsIGRhdGEpIHsKICB2YXIgcG9pbnRzID0gZmxhdHRlblBvaW50cyhkYXRhLndheXBvaW50cyk7CiAgcmV0dXJuIGdmeEdyb3VwLnBvbHlsaW5lKHBvaW50cykuYXR0cih0aGlzLkNPTk5FQ1RJT05fU1RZTEUpOwp9OwoKClJlbmRlcmVyLiRpbmplY3QgPSBbJ3N0eWxlcyddOwoKCm1vZHVsZS5leHBvcnRzID0gUmVuZGVyZXI7Cm1vZHVsZS5leHBvcnRzLmZsYXR0ZW5Qb2ludHMgPSBmbGF0dGVuUG9pbnRzOwp9LHt9XSw1MDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBzbmFwc3ZnID0gKHdpbmRvdy5TbmFwKTsKCi8vIHJlcXVpcmUgc25hcHN2ZyBleHRlbnNpb25zCl9kZXJlcV8oJy4vc25hcHN2Zy1leHRlbnNpb25zJyk7Cgptb2R1bGUuZXhwb3J0cyA9IHNuYXBzdmc7Cn0seyIuL3NuYXBzdmctZXh0ZW5zaW9ucyI6NTN9XSw1MTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBfID0gKHdpbmRvdy5fKTsKCgovKioKICogQSBjb21wb25lbnQgdGhhdCBtYW5hZ2VzIHNoYXBlIHN0eWxlcwogKi8KZnVuY3Rpb24gU3R5bGVzKCkgewoKICB2YXIgZGVmYXVsdFRyYWl0cyA9IHsKCiAgICAnbm8tZmlsbCc6IHsKICAgICAgZmlsbDogJ25vbmUnCiAgICB9LAogICAgJ25vLWJvcmRlcic6IHsKICAgICAgc3Ryb2tlT3BhY2l0eTogMC4wCiAgICB9LAogICAgJ25vLWV2ZW50cyc6IHsKICAgICAgcG9pbnRlckV2ZW50czogJ25vbmUnCiAgICB9CiAgfTsKCiAgLyoqCiAgICogQnVpbGRzIGEgc3R5bGUgZGVmaW5pdGlvbiBmcm9tIGEgY2xhc3NOYW1lLCBhIGxpc3Qgb2YgdHJhaXRzIGFuZCBhbiBvYmplY3Qgb2YgYWRkaXRpb25hbCBhdHRyaWJ1dGVzLgogICAqCiAgICogQHBhcmFtICB7U3RyaW5nfSBjbGFzc05hbWUKICAgKiBAcGFyYW0gIHtBcnJheTxTdHJpbmc+fSB0cmFpdHMKICAgKiBAcGFyYW0gIHtPYmplY3R9IGFkZGl0aW9uYWxBdHRycwogICAqCiAgICogQHJldHVybiB7T2JqZWN0fSB0aGUgc3R5bGUgZGVmaW50aW9uCiAgICovCiAgdGhpcy5jbHMgPSBmdW5jdGlvbihjbGFzc05hbWUsIHRyYWl0cywgYWRkaXRpb25hbEF0dHJzKSB7CiAgICB2YXIgYXR0cnMgPSB0aGlzLnN0eWxlKHRyYWl0cywgYWRkaXRpb25hbEF0dHJzKTsKCiAgICByZXR1cm4gXy5leHRlbmQoYXR0cnMsIHsgJ2NsYXNzJzogY2xhc3NOYW1lIH0pOwogIH07CgogIC8qKgogICAqIEJ1aWxkcyBhIHN0eWxlIGRlZmluaXRpb24gZnJvbSBhIGxpc3Qgb2YgdHJhaXRzIGFuZCBhbiBvYmplY3Qgb2YgYWRkaXRpb25hbCBhdHRyaWJ1dGVzLgogICAqCiAgICogQHBhcmFtICB7QXJyYXk8U3RyaW5nPn0gdHJhaXRzCiAgICogQHBhcmFtICB7T2JqZWN0fSBhZGRpdGlvbmFsQXR0cnMKICAgKgogICAqIEByZXR1cm4ge09iamVjdH0gdGhlIHN0eWxlIGRlZmludGlvbgogICAqLwogIHRoaXMuc3R5bGUgPSBmdW5jdGlvbih0cmFpdHMsIGFkZGl0aW9uYWxBdHRycykgewoKICAgIGlmICghXy5pc0FycmF5KHRyYWl0cykgJiYgIWFkZGl0aW9uYWxBdHRycykgewogICAgICBhZGRpdGlvbmFsQXR0cnMgPSB0cmFpdHM7CiAgICAgIHRyYWl0cyA9IFtdOwogICAgfQoKICAgIHZhciBhdHRycyA9IF8uaW5qZWN0KHRyYWl0cywgZnVuY3Rpb24oYXR0cnMsIHQpIHsKICAgICAgcmV0dXJuIF8uZXh0ZW5kKGF0dHJzLCBkZWZhdWx0VHJhaXRzW3RdIHx8IHt9KTsKICAgIH0sIHt9KTsKCiAgICByZXR1cm4gYWRkaXRpb25hbEF0dHJzID8gXy5leHRlbmQoYXR0cnMsIGFkZGl0aW9uYWxBdHRycykgOiBhdHRyczsKICB9Owp9Cgptb2R1bGUuZXhwb3J0cyA9IFN0eWxlczsKfSx7fV0sNTI6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgptb2R1bGUuZXhwb3J0cyA9IHsKICByZW5kZXJlcjogWyAndHlwZScsIF9kZXJlcV8oJy4vUmVuZGVyZXInKSBdLAogIHNuYXA6IFsgJ3ZhbHVlJywgX2RlcmVxXygnLi9TbmFwJykgXSwKICBzdHlsZXM6IFsgJ3R5cGUnLCBfZGVyZXFfKCcuL1N0eWxlcycpIF0KfTsKfSx7Ii4vUmVuZGVyZXIiOjQ5LCIuL1NuYXAiOjUwLCIuL1N0eWxlcyI6NTF9XSw1MzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBTbmFwID0gKHdpbmRvdy5TbmFwKTsKCi8qKgogKiBAbW9kdWxlIHNuYXBzdmcvZXh0ZW5zaW9ucwogKi8KCi8qKgogKiBAbmFtZXNwYWNlIHNuYXBzdmcKICovCgovKioKICogQGNsYXNzIHNuYXBzdmcuRWxlbWVudAogKi8KCi8qKgogKiBAY2xhc3MgQ2xhc3NQbHVnaW4KICoKICogRXh0ZW5kcyBzbmFwc3ZnIHdpdGggbWV0aG9kcyB0byBhZGQgYW5kIHJlbW92ZSBjbGFzc2VzCiAqLwpTbmFwLnBsdWdpbihmdW5jdGlvbiAoU25hcCwgRWxlbWVudCwgUGFwZXIsIGdsb2JhbCkgewoKICBmdW5jdGlvbiBzcGxpdChzdHIpIHsKICAgIHJldHVybiBzdHIuc3BsaXQoL1xzKy8pOwogIH0KCiAgZnVuY3Rpb24gam9pbihhcnJheSkgewogICAgcmV0dXJuIGFycmF5LmpvaW4oJyAnKTsKICB9CgogIGZ1bmN0aW9uIGdldENsYXNzZXMoZSkgewogICAgcmV0dXJuIHNwbGl0KGUuYXR0cignY2xhc3MnKSB8fCAnJyk7CiAgfQoKICBmdW5jdGlvbiBzZXRDbGFzc2VzKGUsIGNsYXNzZXMpIHsKICAgIGUuYXR0cignY2xhc3MnLCBqb2luKGNsYXNzZXMpKTsKICB9CgogIC8qKgogICAqIEBtZXRob2Qgc25hcHN2Zy5FbGVtZW50I2FkZENsYXNzCiAgICoKICAgKiBAZXhhbXBsZQogICAqCiAgICogZS5hdHRyKCdjbGFzcycsICdzZWxlY3RvcicpOwogICAqCiAgICogZS5hZGRDbGFzcygnZm9vIGJhcicpOyAvLyBhZGRzIGNsYXNzZXMgZm9vIGFuZCBiYXIKICAgKiBlLmF0dHIoJ2NsYXNzJyk7IC8vIC0+ICdzZWxlY3RvciBmb28gYmFyJwogICAqCiAgICogZS5hZGRDbGFzcygnZm9vQmFyJyk7CiAgICogZS5hdHRyKCdjbGFzcycpOyAvLyAtPiAnc2VsZWN0b3IgZm9vIGJhciBmb29CYXInCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gY2xzIGNsYXNzZXMgdG8gYmUgYWRkZWQgdG8gdGhlIGVsZW1lbnQKICAgKgogICAqIEByZXR1cm4ge3NuYXBzdmcuRWxlbWVudH0gdGhlIGVsZW1lbnQgKHRoaXMpCiAgICovCiAgRWxlbWVudC5wcm90b3R5cGUuYWRkQ2xhc3MgPSBmdW5jdGlvbihjbHMpIHsKICAgIHZhciBjdXJyZW50ID0gZ2V0Q2xhc3Nlcyh0aGlzKSwKICAgICAgICBhZGQgPSBzcGxpdChjbHMpLAogICAgICAgIGksIGU7CgogICAgZm9yIChpID0gMCwgZTsgISEoZSA9IGFkZFtpXSk7IGkrKykgewogICAgICBpZiAoY3VycmVudC5pbmRleE9mKGUpID09PSAtMSkgewogICAgICAgIGN1cnJlbnQucHVzaChlKTsKICAgICAgfQogICAgfQoKICAgIHNldENsYXNzZXModGhpcywgY3VycmVudCk7CgogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLyoqCiAgICogQG1ldGhvZCBzbmFwc3ZnLkVsZW1lbnQjaGFzQ2xhc3MKICAgKgogICAqIEBwYXJhbSAge1N0cmluZ30gIGNscyB0aGUgY2xhc3MgdG8gcXVlcnkgZm9yCiAgICogQHJldHVybiB7Qm9vbGVhbn0gcmV0dXJucyB0cnVlIGlmIHRoZSBlbGVtZW50IGhhcyB0aGUgZ2l2ZW4gY2xhc3MKICAgKi8KICBFbGVtZW50LnByb3RvdHlwZS5oYXNDbGFzcyA9IGZ1bmN0aW9uKGNscykgewogICAgaWYgKCFjbHMpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdbc25hcHN2Z10gc3ludGF4OiBoYXNDbGFzcyhjbHNTdHIpJyk7CiAgICB9CgogICAgcmV0dXJuIGdldENsYXNzZXModGhpcykuaW5kZXhPZihjbHMpICE9PSAtMTsKICB9OwoKICAvKioKICAgKiBAbWV0aG9kIHNuYXBzdmcuRWxlbWVudCNyZW1vdmVDbGFzcwogICAqCiAgICogQGV4YW1wbGUKICAgKgogICAqIGUuYXR0cignY2xhc3MnLCAnZm9vIGJhcicpOwogICAqCiAgICogZS5yZW1vdmVDbGFzcygnZm9vJyk7CiAgICogZS5hdHRyKCdjbGFzcycpOyAvLyAtPiAnYmFyJwogICAqCiAgICogZS5yZW1vdmVDbGFzcygnZm9vIGJhcicpOyAvLyByZW1vdmVzIGNsYXNzZXMgZm9vIGFuZCBiYXIKICAgKiBlLmF0dHIoJ2NsYXNzJyk7IC8vIC0+ICcnCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gY2xzIGNsYXNzZXMgdG8gYmUgcmVtb3ZlZCBmcm9tIGVsZW1lbnQKICAgKgogICAqIEByZXR1cm4ge3NuYXBzdmcuRWxlbWVudH0gdGhlIGVsZW1lbnQgKHRoaXMpCiAgICovCiAgRWxlbWVudC5wcm90b3R5cGUucmVtb3ZlQ2xhc3MgPSBmdW5jdGlvbihjbHMpIHsKICAgIHZhciBjdXJyZW50ID0gZ2V0Q2xhc3Nlcyh0aGlzKSwKICAgICAgICByZW1vdmUgPSBzcGxpdChjbHMpLAogICAgICAgIGksIGUsIGlkeDsKCiAgICBmb3IgKGkgPSAwLCBlOyAhIShlID0gcmVtb3ZlW2ldKTsgaSsrKSB7CiAgICAgIGlkeCA9IGN1cnJlbnQuaW5kZXhPZihlKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgLy8gcmVtb3ZlIGVsZW1lbnQgZnJvbSBhcnJheQogICAgICAgIGN1cnJlbnQuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0KICAgIH0KCiAgICBzZXRDbGFzc2VzKHRoaXMsIGN1cnJlbnQpOwoKICAgIHJldHVybiB0aGlzOwogIH07Cgp9KTsKCi8qKgogKiBAY2xhc3MgVHJhbnNsYXRlUGx1Z2luCiAqCiAqIEV4dGVuZHMgc25hcHN2ZyB3aXRoIG1ldGhvZHMgdG8gdHJhbnNsYXRlIGVsZW1lbnRzCiAqLwpTbmFwLnBsdWdpbihmdW5jdGlvbiAoU25hcCwgRWxlbWVudCwgUGFwZXIsIGdsb2JhbCkgewoKICAvKgogICAqIEBtZXRob2Qgc25hcHN2Zy5FbGVtZW50I3RyYW5zbGF0ZQogICAqCiAgICogQGV4YW1wbGUKICAgKgogICAqIGUudHJhbnNsYXRlKDEwLCAyMCk7CiAgICoKICAgKiAvLyBzZXRzIHRyYW5zZm9ybSBtYXRyaXggdG8gdHJhbnNsYXRlKDEwLCAyMCkKICAgKgogICAqIEBwYXJhbSB7TnVtYmVyfSB4IHRyYW5zbGF0aW9uCiAgICogQHBhcmFtIHtOdW1iZXJ9IHkgdHJhbnNsYXRpb24KICAgKgogICAqIEByZXR1cm4ge3NuYXBzdmcuRWxlbWVudH0gdGhlIGVsZW1lbnQgKHRoaXMpCiAgICovCiAgRWxlbWVudC5wcm90b3R5cGUudHJhbnNsYXRlID0gZnVuY3Rpb24oeCwgeSkgewogICAgdmFyIG1hdHJpeCA9IG5ldyBTbmFwLk1hdHJpeCgpOwogICAgbWF0cml4LnRyYW5zbGF0ZSh4LCB5KTsKICAgIHJldHVybiB0aGlzLnRyYW5zZm9ybShtYXRyaXgpOwogIH07Cn0pOwoKLyoqCiAqIEBjbGFzcyBDcmVhdFNuYXBBdFBsdWdpbgogKgogKiBFeHRlbmRzIHNuYXAuc3ZnIHdpdGggYSBtZXRob2QgdG8gY3JlYXRlIGEgU1ZHIGVsZW1lbnQKICogYXQgYSBzcGVjaWZpYyBwb3NpdGlvbiBpbiB0aGUgRE9NLgogKi8KU25hcC5wbHVnaW4oZnVuY3Rpb24gKFNuYXAsIEVsZW1lbnQsIFBhcGVyLCBnbG9iYWwpIHsKCiAgLyoKICAgKiBAbWV0aG9kIHNuYXBzdmcuY3JlYXRlU25hcEF0CiAgICoKICAgKiBAZXhhbXBsZQogICAqCiAgICogc25hcHN2Zy5jcmVhdGVTbmFwQXQocGFyZW50Tm9kZSwgMjAwLCAyMDApOwogICAqCiAgICogQHBhcmFtIHtOdW1iZXJ9IHdpZHRoIG9mIHN2ZwogICAqIEBwYXJhbSB7TnVtYmVyfSBoZWlnaHQgb2Ygc3ZnCiAgICogQHBhcmFtIHtPYmplY3R9IHBhcmVudE5vZGUgc3ZnIEVsZW1lbnQgd2lsbCBiZSBjaGlsZCBvZiB0aGlzCiAgICoKICAgKiBAcmV0dXJuIHtzbmFwc3ZnLkVsZW1lbnR9IHRoZSBuZXdseSBjcmVhdGVkIHdyYXBwZWQgU1ZHIGVsZW1lbnQgaW5zdGFuY2UKICAgKi8KICBTbmFwLmNyZWF0ZVNuYXBBdCA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQsIHBhcmVudE5vZGUpIHsKCiAgICB2YXIgc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdzdmcnKTsKICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgd2lkdGgpOwogICAgc3ZnLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgaGVpZ2h0KTsKICAgIGlmICghcGFyZW50Tm9kZSkgewogICAgICBwYXJlbnROb2RlID0gZG9jdW1lbnQuYm9keTsKICAgIH0KICAgIHBhcmVudE5vZGUuYXBwZW5kQ2hpbGQoc3ZnKTsKCiAgICByZXR1cm4gbmV3IFNuYXAoc3ZnKTsKICB9Owp9KTsKfSx7fV0sNTQ6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgoKdmFyIF8gPSAod2luZG93Ll8pOwoKdmFyIEdyYXBoaWNzVXRpbCA9IF9kZXJlcV8oJy4uLy4uL3V0aWwvR3JhcGhpY3NVdGlsJyk7CgoKLyoqCiAqIEBjbGFzcwogKgogKiBBIHBsdWdpbiB0aGF0IHByb3ZpZGVzIGludGVyYWN0aXZpdHkgaW4gdGVybXMgb2YgZXZlbnRzIChtb3VzZSBvdmVyIGFuZCBzZWxlY3Rpb24gdG8gYSBkaWFncmFtKS4KICoKICogQHBhcmFtIHtFdmVudEJ1c30gZXZlbnRCdXMKICovCmZ1bmN0aW9uIEludGVyYWN0aW9uRXZlbnRzKGV2ZW50QnVzLCBzdHlsZXMpIHsKCiAgdmFyIEhJVF9TVFlMRSA9IHN0eWxlcy5jbHMoJ2Rqcy1oaXQnLCBbICduby1maWxsJywgJ25vLWJvcmRlcicgXSwgewogICAgcG9pbnRlckV2ZW50czogJ3N0cm9rZScsCiAgICBzdHJva2U6ICd3aGl0ZScsCiAgICBzdHJva2VXaWR0aDogMTAKICB9KTsKCiAgZnVuY3Rpb24gaXNDdHhTd2l0Y2goZSkgewogICAgcmV0dXJuICFlLnJlbGF0ZWRUYXJnZXQgfHwgZS50YXJnZXQucGFyZW50Tm9kZSAhPT0gZS5yZWxhdGVkVGFyZ2V0LnBhcmVudE5vZGU7CiAgfQoKICBmdW5jdGlvbiBmaXJlKGV2ZW50LCBiYXNlRXZlbnQsIGV2ZW50TmFtZSkgewogICAgdmFyIGUgPSBfLmV4dGVuZCh7fSwgYmFzZUV2ZW50LCBldmVudCk7CiAgICBldmVudEJ1cy5maXJlKGV2ZW50TmFtZSwgZSk7CiAgfQoKICBmdW5jdGlvbiBtYWtlU2VsZWN0YWJsZShlbGVtZW50LCBnZngsIG9wdGlvbnMpIHsKICAgIHZhciB0eXBlID0gb3B0aW9ucy50eXBlLAogICAgICAgIGJhc2VFdmVudCA9IHsgZWxlbWVudDogZWxlbWVudCwgZ2Z4OiBnZnggfSwKICAgICAgICB2aXN1YWwgPSBHcmFwaGljc1V0aWwuZ2V0VmlzdWFsKGdmeCksCiAgICAgICAgaGl0LAogICAgICAgIGJib3g7CgogICAgaWYgKHR5cGUgPT09ICdzaGFwZScpIHsKICAgICAgYmJveCA9IHZpc3VhbC5nZXRCQm94KCk7CiAgICAgIGhpdCA9IGdmeC5yZWN0KGJib3gueCwgYmJveC55LCBiYm94LndpZHRoLCBiYm94LmhlaWdodCk7CiAgICB9IGVsc2UgewogICAgICBoaXQgPSB2aXN1YWwuc2VsZWN0KCcqJykuY2xvbmUoKS5hdHRyKCdzdHlsZScsICcnKTsKICAgIH0KCiAgICBoaXQuYXR0cihISVRfU1RZTEUpLnByZXBlbmRUbyhnZngpOwoKICAgIGdmeC5ob3ZlcihmdW5jdGlvbihlKSB7CiAgICAgIGlmIChpc0N0eFN3aXRjaChlKSkgewogICAgICAgIC8qKgogICAgICAgICAqIEFuIGV2ZW50IGluZGljYXRpbmcgdGhhdCBzaGFwZXxjb25uZWN0aW9uIGhhcyBiZWVuIGhvdmVyZWQKICAgICAgICAgKgogICAgICAgICAqIHNoYXBlLmhvdmVyLCBjb25uZWN0aW9uLmhvdmVyCiAgICAgICAgICovCiAgICAgICAgZmlyZShlLCBiYXNlRXZlbnQsIHR5cGUgKyAnLmhvdmVyJyk7CiAgICAgIH0KICAgIH0sIGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKGlzQ3R4U3dpdGNoKGUpKSB7CiAgICAgICAgZmlyZShlLCBiYXNlRXZlbnQsIHR5cGUgKyAnLm91dCcpOwogICAgICB9CiAgICB9KTsKCiAgICB2aXN1YWwuY2xpY2soZnVuY3Rpb24oZSkgewogICAgICBmaXJlKGUsIGJhc2VFdmVudCwgdHlwZSArICcuY2xpY2snKTsKICAgIH0pOwoKICAgIHZpc3VhbC5kYmxjbGljayhmdW5jdGlvbihlKSB7CiAgICAgIGZpcmUoZSwgYmFzZUV2ZW50LCB0eXBlICsgJy5kYmxjbGljaycpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiByZWdpc3RlckV2ZW50cyhldmVudEJ1cykgewoKICAgIGV2ZW50QnVzLm9uKCdjYW52YXMuaW5pdCcsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIHZhciByb290ID0gZXZlbnQucm9vdDsKCiAgICAgIC8vIGltcGxlbWVudCBkaXJlY3QgY2FudmFzIGNsaWNrCiAgICAgIHJvb3QuY2xpY2soZnVuY3Rpb24oZXZlbnQpIHsKCiAgICAgICAgLyoqCiAgICAgICAgICogQW4gZXZlbnQgaW5kaWNhdGluZyB0aGF0IHRoZSBjYW52YXMgaGFzIGJlZW4gZGlyZWN0bHkgY2xpY2tlZAogICAgICAgICAqCiAgICAgICAgICogQG1lbWJlck9mIEludGVyYWN0aW9uRXZlbnRzCiAgICAgICAgICoKICAgICAgICAgKiBAZXZlbnQgY2FudmFzLmNsaWNrCiAgICAgICAgICoKICAgICAgICAgKiBAdHlwZSB7T2JqZWN0fQogICAgICAgICAqLwogICAgICAgIGV2ZW50QnVzLmZpcmUoJ2NhbnZhcy5jbGljaycsIF8uZXh0ZW5kKHt9LCBldmVudCwgeyByb290OiByb290IH0pKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBldmVudEJ1cy5vbignc2hhcGUuYWRkZWQnLCBmdW5jdGlvbihldmVudCkgewogICAgICBtYWtlU2VsZWN0YWJsZShldmVudC5lbGVtZW50LCBldmVudC5nZngsIHsgdHlwZTogJ3NoYXBlJyB9KTsKICAgIH0pOwoKICAgIGV2ZW50QnVzLm9uKCdjb25uZWN0aW9uLmFkZGVkJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgbWFrZVNlbGVjdGFibGUoZXZlbnQuZWxlbWVudCwgZXZlbnQuZ2Z4LCB7IHR5cGU6ICdjb25uZWN0aW9uJyB9KTsKICAgIH0pOwogIH0KCiAgcmVnaXN0ZXJFdmVudHMoZXZlbnRCdXMpOwp9CgoKSW50ZXJhY3Rpb25FdmVudHMuJGluamVjdCA9IFsgJ2V2ZW50QnVzJywgJ3N0eWxlcycgXTsKCm1vZHVsZS5leHBvcnRzID0gSW50ZXJhY3Rpb25FdmVudHM7Cn0seyIuLi8uLi91dGlsL0dyYXBoaWNzVXRpbCI6NjV9XSw1NTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gewogIF9faW5pdF9fOiBbICdpbnRlcmFjdGlvbkV2ZW50cycgXSwKICBpbnRlcmFjdGlvbkV2ZW50czogWyAndHlwZScsIF9kZXJlcV8oJy4vSW50ZXJhY3Rpb25FdmVudHMnKSBdCn07Cn0seyIuL0ludGVyYWN0aW9uRXZlbnRzIjo1NH1dLDU2OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKCnZhciBHcmFwaGljc1V0aWwgPSBfZGVyZXFfKCcuLi8uLi91dGlsL0dyYXBoaWNzVXRpbCcpOwoKCi8qKgogKiBAY2xhc3MKICoKICogQSBwbHVnaW4gdGhhdCBhZGRzIGFuIG91dGxpbmUgdG8gc2hhcGVzIGFuZCBjb25uZWN0aW9ucyB0aGF0IG1heSBiZSBhY3RpdmF0ZWQgYW5kIHN0eWxlZAogKiB2aWEgQ1NTIGNsYXNzZXMuCiAqCiAqIEBwYXJhbSB7RXZlbnRCdXN9IGV2ZW50cyB0aGUgZXZlbnQgYnVzCiAqLwpmdW5jdGlvbiBPdXRsaW5lKGV2ZW50cywgc3R5bGVzKSB7CgogIHZhciBPVVRMSU5FX09GRlNFVCA9IDU7CgogIHZhciBPVVRMSU5FX1NUWUxFID0gc3R5bGVzLmNscygnZGpzLW91dGxpbmUnLCBbICduby1maWxsJyBdKTsKCiAgZnVuY3Rpb24gY3JlYXRlT3V0bGluZShnZngpIHsKICAgIHJldHVybiBnZngucmVjdCgwLCAwLCAwLCAwKQogICAgICAgICAgICAuYXR0cihPVVRMSU5FX1NUWUxFKQogICAgICAgICAgICAucHJlcGVuZFRvKGdmeCk7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVPdXRsaW5lKG91dGxpbmUsIGJib3gpIHsKCiAgICBvdXRsaW5lLmF0dHIoewogICAgICB4OiBiYm94LnggLSBPVVRMSU5FX09GRlNFVCwKICAgICAgeTogYmJveC55IC0gT1VUTElORV9PRkZTRVQsCiAgICAgIHdpZHRoOiBiYm94LndpZHRoICsgT1VUTElORV9PRkZTRVQgKiAyLAogICAgICBoZWlnaHQ6IGJib3guaGVpZ2h0ICsgT1VUTElORV9PRkZTRVQgKiAyCiAgICB9KTsKICB9CgogIGV2ZW50cy5vbignc2hhcGUuYWRkZWQnLCBmdW5jdGlvbihldmVudCkgewogICAgdmFyIGVsZW1lbnQgPSBldmVudC5lbGVtZW50LAogICAgICAgIGdmeCA9IGV2ZW50LmdmeDsKCiAgICB2YXIgb3V0bGluZSA9IGNyZWF0ZU91dGxpbmUoZ2Z4KTsKCiAgICB1cGRhdGVPdXRsaW5lKG91dGxpbmUsIEdyYXBoaWNzVXRpbC5nZXRWaXN1YWwoZ2Z4KS5nZXRCQm94KCkpOwogIH0pOwoKICBldmVudHMub24oJ2Nvbm5lY3Rpb24uY2hhbmdlJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgIC8vIFRPRE86IHVwZGF0ZSBjb25uZWN0aW9uIG91dGxpbmUgYm94CiAgfSk7CgogIGV2ZW50cy5vbignc2hhcGUuY2hhbmdlJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgIC8vIFRPRE86IHVwZGF0ZSBzaGFwZSBvdXRsaW5lIGJveAogIH0pOwp9CgoKT3V0bGluZS4kaW5qZWN0ID0gWydldmVudEJ1cycsICdzdHlsZXMnXTsKCm1vZHVsZS5leHBvcnRzID0gT3V0bGluZTsKfSx7Ii4uLy4uL3V0aWwvR3JhcGhpY3NVdGlsIjo2NX1dLDU3OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKbW9kdWxlLmV4cG9ydHMgPSB7CiAgX19pbml0X186IFsgJ291dGxpbmUnIF0sCiAgb3V0bGluZTogWyAndHlwZScsIF9kZXJlcV8oJy4vT3V0bGluZScpIF0KfTsKfSx7Ii4vT3V0bGluZSI6NTZ9XSw1ODpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBfID0gKHdpbmRvdy5fKSwKICAgICQgPSBfZGVyZXFfKCdqcXVlcnknKTsKCi8vIGRvY3VtZW50IHdpZGUgdW5pcXVlIG92ZXJsYXkgaWRzCnZhciBpZHMgPSBuZXcgKF9kZXJlcV8oJy4uLy4uL3V0aWwvSWRHZW5lcmF0b3InKSkoJ292Jyk7CgoKLyoqCiAqIEEgcGx1Z2luIHRoYXQgYWxsb3dzIHVzZXJzIHRvIGF0dGFjaCBvdmVybGF5cyB0byBkaWFncmFtIGVsZW1lbnRzLgogKgogKiBUaGUgb3ZlcmxheSBzZXJ2aWNlIHdpbGwgdGFrZSBjYXJlIG9mIG92ZXJsYXkgcG9zaXRpb25pbmcgZHVyaW5nIHVwZGF0ZXMuCiAqCiAqIEBjbGFzcwogKgogKiBAZXhhbXBsZQogKgogKiAvLyBhZGQgYSBwaW5rIGJhZGdlIG9uIHRoZSB0b3AgbGVmdCBvZiB0aGUgc2hhcGUKICogb3ZlcmxheXMuYWRkKHNvbWVTaGFwZSwgewogKiAgIHBvc2l0aW9uOiB7CiAqICAgICB0b3A6IC01LAogKiAgICAgbGVmdDogLTUKICogICB9CiAqICAgaHRtbDogJzxkaXYgc3R5bGU9IndpZHRoOiAxMHB4OyBiYWNrZ3JvdW5kOiBmdWNoc2lhOyBjb2xvcjogd2hpdGU7Ij4wPC9kaXY+JwogKiB9KTsKICoKICogLy8gb3IgYWRkIHZpYSBzaGFwZSBpZAogKgogKiBvdmVybGF5cy5hZGQoJ3NvbWUtZWxlbWVudC1pZCcsIHsKICogICBwb3NpdGlvbjogewogKiAgICAgdG9wOiAtNSwKICogICAgIGxlZnQ6IC01CiAqICAgfQogKiAgIGh0bWw6ICc8ZGl2IHN0eWxlPSJ3aWR0aDogMTBweDsgYmFja2dyb3VuZDogZnVjaHNpYTsgY29sb3I6IHdoaXRlOyI+MDwvZGl2PicKICogfSk7CiAqCiAqIC8vIG9yIGFkZCB3aXRoIG9wdGlvbmFsIHR5cGUKICoKICogb3ZlcmxheXMuYWRkKHNvbWVTaGFwZSwgJ2JhZGdlJywgewogKiAgIHBvc2l0aW9uOiB7CiAqICAgICB0b3A6IC01LAogKiAgICAgbGVmdDogLTUKICogICB9CiAqICAgaHRtbDogJzxkaXYgc3R5bGU9IndpZHRoOiAxMHB4OyBiYWNrZ3JvdW5kOiBmdWNoc2lhOyBjb2xvcjogd2hpdGU7Ij4wPC9kaXY+JwogKiB9KTsKICoKICoKICogLy8gcmVtb3ZlIGFuIG92ZXJsYXkKICoKICogdmFyIGlkID0gb3ZlcmxheXMuYWRkKC4uLik7CiAqIG92ZXJsYXlzLnJlbW92ZShpZCk7CiAqCiAqIEBwYXJhbSB7RXZlbnRCdXN9IGV2ZW50QnVzCiAqIEBwYXJhbSB7Q2FudmFzfSBjYW52YXMKICogQHBhcmFtIHtFbGVtZW50UmVnaXN0cnl9IGVsZW1lbnRSZWdpc3RyeQogKi8KZnVuY3Rpb24gT3ZlcmxheXMoY29uZmlnLCBldmVudEJ1cywgY2FudmFzLCBlbGVtZW50UmVnaXN0cnkpIHsKCiAgdGhpcy5fZXZlbnRCdXMgPSBldmVudEJ1czsKICB0aGlzLl9jYW52YXMgPSBjYW52YXM7CiAgdGhpcy5fZWxlbWVudFJlZ2lzdHJ5ID0gZWxlbWVudFJlZ2lzdHJ5OwoKICB0aGlzLl9pZHMgPSBpZHM7CgogIHRoaXMuX292ZXJsYXlEZWZhdWx0cyA9IHsKICAgIHNob3c6IHsKICAgICAgdHJpZ2dlcjogJ2F1dG9tYXRpYycsCiAgICAgIG1pblpvb206IDAuNywKICAgICAgbWF4Wm9vbTogNS4wCiAgICB9CiAgfTsKCiAgLyoqCiAgICogTWFwcGluZyBvdmVybGF5LWlkID4gb3ZlcmxheQogICAqLwogIHRoaXMuX292ZXJsYXlzID0ge307CgogIC8qKgogICAqIE1hcHBpbmcgZWxlbWVudC1pZCA+IG92ZXJsYXkgY29udGFpbmVyCiAgICovCiAgdGhpcy5fb3ZlcmxheUNvbnRhaW5lcnMgPSB7fTsKCiAgLy8gcm9vdCBodG1sIGVsZW1lbnQgZm9yIGFsbCBvdmVybGF5cwogIHRoaXMuX292ZXJsYXlSb290ID0gJCgnPGRpdiBjbGFzcz0iZGpzLW92ZXJsYXktY29udGFpbmVyIiAvPicpCiAgICAgICAgICAgICAgICAgICAgICAgIC5jc3MoeyBwb3NpdGlvbjogJ2Fic29sdXRlJywgd2lkdGg6IDAsIGhlaWdodDogMCB9KQogICAgICAgICAgICAgICAgICAgICAgICAucHJlcGVuZFRvKGNhbnZhcy5nZXRDb250YWluZXIoKSk7CgogIHRoaXMuX2luaXQoY29uZmlnKTsKfQoKCk92ZXJsYXlzLiRpbmplY3QgPSBbICdjb25maWcub3ZlcmxheXMnLCAnZXZlbnRCdXMnLCAnY2FudmFzJywgJ2VsZW1lbnRSZWdpc3RyeScgXTsKCm1vZHVsZS5leHBvcnRzID0gT3ZlcmxheXM7CgoKLyoqCiAqIFJldHVybnMgdGhlIG92ZXJsYXkgd2l0aCB0aGUgc3BlY2lmaWVkIGlkIG9yIGEgbGlzdCBvZiBvdmVybGF5cwogKiBmb3IgYW4gZWxlbWVudCB3aXRoIGEgZ2l2ZW4gdHlwZS4KICoKICogQGV4YW1wbGUKICoKICogLy8gcmV0dXJuIHRoZSBzaW5nbGUgb3ZlcmxheSB3aXRoIHRoZSBnaXZlbiBpZAogKiBvdmVybGF5cy5nZXQoJ3NvbWUtaWQnKTsKICoKICogLy8gcmV0dXJuIGFsbCBvdmVybGF5cyBmb3IgdGhlIHNoYXBlCiAqIG92ZXJsYXlzLmdldCh7IGVsZW1lbnQ6IHNvbWVTaGFwZSB9KTsKICoKICogLy8gcmV0dXJuIGFsbCBvdmVybGF5cyBvbiBzaGFwZSB3aXRoIHR5cGUgJ2JhZGdlJwogKiBvdmVybGF5cy5nZXQoeyBlbGVtZW50OiBzb21lU2hhcGUsIHR5cGU6ICdiYWRnZScgfSk7CiAqCiAqIC8vIHNoYXBlIGNhbiBhbHNvIGJlIHNwZWNpZmllZCBhcyBpZAogKiBvdmVybGF5cy5nZXQoeyBlbGVtZW50OiAnZWxlbWVudC1pZCcsIHR5cGU6ICdiYWRnZScgfSk7CiAqCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBmaWx0ZXIKICogQHBhcmFtIHtTdHJpbmd9IFtmaWx0ZXIuaWRdCiAqIEBwYXJhbSB7U3RyaW5nfGRqcy5tb2RlbC5CYXNlfSBbZmlsdGVyLmVsZW1lbnRdCiAqIEBwYXJhbSB7U3RyaW5nfSBbZmlsdGVyLnR5cGVdCiAqCiAqIEByZXR1cm4ge09iamVjdHxBcnJheTxPYmplY3Q+fSB0aGUgb3ZlcmxheShzKQogKi8KT3ZlcmxheXMucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKGZpbHRlcikgewoKICBpZiAoXy5pc1N0cmluZyhmaWx0ZXIpKSB7CiAgICBmaWx0ZXIgPSB7IGlkOiBmaWx0ZXIgfTsKICB9CgogIGlmIChmaWx0ZXIuZWxlbWVudCkgewogICAgdmFyIGNvbnRhaW5lciA9IHRoaXMuX2dldE92ZXJsYXlDb250YWluZXIoZmlsdGVyLmVsZW1lbnQsIHRydWUpOwoKICAgIC8vIHJldHVybiBhIGxpc3Qgb2Ygb3ZlcmxheXMgd2hlbiBmaWx0ZXJpbmcgYnkgZWxlbWVudCAoK3R5cGUpCiAgICBpZiAoY29udGFpbmVyKSB7CiAgICAgIHJldHVybiBmaWx0ZXIudHlwZSA/IF8uZmlsdGVyKGNvbnRhaW5lci5vdmVybGF5cywgeyB0eXBlOiBmaWx0ZXIudHlwZSB9KSA6IF8uY2xvbmUoY29udGFpbmVyLm92ZXJsYXlzKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0KICB9IGVsc2UgewogICAgLy8gcmV0dXJuIHNpbmdsZSBlbGVtZW50IHdoZW4gZmlsdGVyaW5nIGJ5IGlkCiAgICByZXR1cm4gZmlsdGVyLmlkID8gdGhpcy5fb3ZlcmxheXNbZmlsdGVyLmlkXSA6IG51bGw7CiAgfQp9OwoKLyoqCiAqIEFkZHMgYSBIVE1MIG92ZXJsYXkgdG8gYW4gZWxlbWVudC4KICoKICogQHBhcmFtIHtTdHJpbmd8ZGpzLm1vZGVsLkJhc2V9ICAgZWxlbWVudCAgIGF0dGFjaCBvdmVybGF5IHRvIHRoaXMgc2hhcGUKICogQHBhcmFtIHtTdHJpbmd9ICAgICAgICAgICAgICAgICAgW3R5cGVdICAgIG9wdGlvbmFsIHR5cGUgdG8gYXNzaWduIHRvIHRoZSBvdmVybGF5CiAqIEBwYXJhbSB7T2JqZWN0fSAgICAgICAgICAgICAgICAgIG92ZXJsYXkgICB0aGUgb3ZlcmxheSBjb25maWd1cmF0aW9uCiAqCiAqIEBwYXJhbSB7U3RyaW5nfERPTUVsZW1lbnR9ICAgICAgIG92ZXJsYXkuaHRtbCAgICAgICAgICAgICAgICAgICAgICBodG1sIGVsZW1lbnQgdG8gdXNlIGFzIGFuIG92ZXJsYXkKICogQHBhcmFtIHtPYmplY3R9ICAgICAgICAgICAgICAgICAgW292ZXJsYXkuc2hvd10gICAgICAgICAgICAgICAgICAgIHNob3cgY29uZmlndXJhdGlvbgogKiBAcGFyYW0ge051bWJlcn0gICAgICAgICAgICAgICAgICBvdmVybGF5LnNob3cubWluWm9vbSAgICAgICAgICAgICAgbWluaW1hbCB6b29tIGxldmVsIHRvIHNob3cgdGhlIG92ZXJsYXkKICogQHBhcmFtIHtOdW1iZXJ9ICAgICAgICAgICAgICAgICAgb3ZlcmxheS5zaG93Lm1heFpvb20gICAgICAgICAgICAgIG1heGltdW0gem9vbSBsZXZlbCB0byBzaG93IHRoZSBvdmVybGF5CiAqIEBwYXJhbSB7U3RyaW5nfSAgICAgICAgICAgICAgICAgIFtvdmVybGF5LnNob3cudHJpZ2dlcj1hdXRvbWF0aWNdICBhdXRvbWF0aWMgb3IgbWFudWFsICh1c2VyIHRyaWdnZXJzIHNob3cpCiAqIEBwYXJhbSB7T2JqZWN0fSAgICAgICAgICAgICAgICAgIG92ZXJsYXkuc2hvdy5wb3NpdGlvbiAgICAgICAgICAgICB3aGVyZSB0byBhdHRhY2ggdGhlIG92ZXJsYXkKICogQHBhcmFtIHtOdW1iZXJ9ICAgICAgICAgICAgICAgICAgW292ZXJsYXkuc2hvdy5wb3NpdGlvbi5sZWZ0XSAgICAgIHJlbGF0aXZlIHRvIGVsZW1lbnQgYmJveCBsZWZ0IGF0dGFjaG1lbnQKICogQHBhcmFtIHtOdW1iZXJ9ICAgICAgICAgICAgICAgICAgW292ZXJsYXkuc2hvdy5wb3NpdGlvbi50b3BdICAgICAgIHJlbGF0aXZlIHRvIGVsZW1lbnQgYmJveCB0b3AgYXR0YWNobWVudAogKiBAcGFyYW0ge051bWJlcn0gICAgICAgICAgICAgICAgICBbb3ZlcmxheS5zaG93LnBvc2l0aW9uLmJvdHRvbV0gICAgcmVsYXRpdmUgdG8gZWxlbWVudCBiYm94IGJvdHRvbSBhdHRhY2htZW50CiAqIEBwYXJhbSB7TnVtYmVyfSAgICAgICAgICAgICAgICAgIFtvdmVybGF5LnNob3cucG9zaXRpb24ucmlnaHRdICAgICByZWxhdGl2ZSB0byBlbGVtZW50IGJib3ggcmlnaHQgYXR0YWNobWVudAogKgogKiBAcmV0dXJuIHtTdHJpbmd9ICAgICAgICAgICAgICAgICBpZCB0aGF0IG1heSBiZSB1c2VkIHRvIHJlZmVyZW5jZSB0aGUgb3ZlcmxheSBmb3IgdXBkYXRlIG9yIHJlbW92YWwKICovCk92ZXJsYXlzLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihlbGVtZW50LCB0eXBlLCBvdmVybGF5KSB7CgogIGlmIChfLmlzT2JqZWN0KHR5cGUpKSB7CiAgICBvdmVybGF5ID0gdHlwZTsKICAgIHR5cGUgPSBudWxsOwogIH0KCiAgaWYgKF8uaXNTdHJpbmcoZWxlbWVudCkpIHsKICAgIGVsZW1lbnQgPSB0aGlzLl9lbGVtZW50UmVnaXN0cnkuZ2V0QnlJZChlbGVtZW50KTsKICB9CgogIGlmICghb3ZlcmxheS5wb3NpdGlvbikgewogICAgdGhyb3cgbmV3IEVycm9yKCdtdXN0IHNwZWNpZml5IG92ZXJsYXkgcG9zaXRpb24nKTsKICB9CgogIGlmICghb3ZlcmxheS5odG1sKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ211c3Qgc3BlY2lmaXkgb3ZlcmxheSBodG1sJyk7CiAgfQoKICBpZiAoIWVsZW1lbnQpIHsKICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZCBlbGVtZW50IHNwZWNpZmllZCcpOwogIH0KCiAgdmFyIGlkID0gdGhpcy5faWRzLm5leHQoKTsKCiAgb3ZlcmxheSA9IF8uZXh0ZW5kKHt9LCB0aGlzLl9vdmVybGF5RGVmYXVsdHMsIG92ZXJsYXksIHsKICAgIGlkOiBpZCwKICAgIHR5cGU6IHR5cGUsCiAgICBlbGVtZW50OiBlbGVtZW50LAogICAgaHRtbDogJChvdmVybGF5Lmh0bWwpCiAgfSk7CgogIHRoaXMuX2FkZE92ZXJsYXkob3ZlcmxheSk7CgogIHJldHVybiBpZDsKfTsKCgovKioKICogUmVtb3ZlIGFuIG92ZXJsYXkgd2l0aCB0aGUgZ2l2ZW4gaWQKICoKICogQHBhcmFtICB7U3RyaW5nfSBpZAogKi8KT3ZlcmxheXMucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKGlkKSB7CgogIHZhciBvdmVybGF5ID0gdGhpcy5nZXQoaWQpLAogICAgICBjb250YWluZXIgPSBvdmVybGF5ICYmIHRoaXMuX2dldE92ZXJsYXlDb250YWluZXIob3ZlcmxheS5lbGVtZW50LCB0cnVlKTsKCiAgaWYgKG92ZXJsYXkpIHsKICAgIG92ZXJsYXkuaHRtbC5yZW1vdmUoKTsKICAgIG92ZXJsYXkuaHRtbENvbnRhaW5lci5yZW1vdmUoKTsKCiAgICBkZWxldGUgb3ZlcmxheS5odG1sQ29udGFpbmVyOwogICAgZGVsZXRlIG92ZXJsYXkuZWxlbWVudDsKCiAgICBkZWxldGUgdGhpcy5fb3ZlcmxheXNbaWRdOwogIH0KCiAgaWYgKGNvbnRhaW5lcikgewogICAgdmFyIGlkeCA9IGNvbnRhaW5lci5vdmVybGF5cy5pbmRleE9mKG92ZXJsYXkpOwogICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgY29udGFpbmVyLm92ZXJsYXlzLnNwbGljZShpZHgsIDEpOwogICAgfQogIH0KfTsKCgpPdmVybGF5cy5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uKCkgewogIHRoaXMuX292ZXJsYXlSb290LnNob3coKTsKfTsKCgpPdmVybGF5cy5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCkgewogIHRoaXMuX292ZXJsYXlSb290LmhpZGUoKTsKfTsKCgpPdmVybGF5cy5wcm90b3R5cGUuX3VwZGF0ZU92ZXJsYXlDb250YWluZXIgPSBmdW5jdGlvbihjb250YWluZXIpIHsKICB2YXIgZWxlbWVudCA9IGNvbnRhaW5lci5lbGVtZW50LAogICAgICBodG1sID0gY29udGFpbmVyLmh0bWw7CgogIC8vIHVwZGF0ZSBjb250YWluZXIgbGVmdCx0b3AgYWNjb3JkaW5nIHRvIHRoZSBlbGVtZW50cyB4LHkgY29vcmRpbmF0ZXMKICAvLyB0aGlzIGVuc3VyZXMgd2UgY2FuIGF0dGFjaCBjaGlsZCBlbGVtZW50cyByZWxhdGl2ZSB0byB0aGlzIGNvbnRhaW5lcgoKICAvLyBUT0RPKG5yZSk6IHVwZGF0ZSBhY2NvcmRpbmcgdG8gZWxlbWVudCBiYm94IChmb3IgY29ubmVjdGlvbnMpCiAgaHRtbC5jc3MoeyBsZWZ0OiBlbGVtZW50LngsIHRvcDogZWxlbWVudC55IH0pOwp9OwoKCk92ZXJsYXlzLnByb3RvdHlwZS5fdXBkYXRlT3ZlcmxheSA9IGZ1bmN0aW9uKG92ZXJsYXkpIHsKCiAgdmFyIHBvc2l0aW9uID0gb3ZlcmxheS5wb3NpdGlvbiwKICAgICAgaHRtbENvbnRhaW5lciA9IG92ZXJsYXkuaHRtbENvbnRhaW5lciwKICAgICAgZWxlbWVudCA9IG92ZXJsYXkuZWxlbWVudDsKCiAgLy8gdXBkYXRlIG92ZXJsYXkgaHRtbCByZWxhdGl2ZSB0byBzaGFwZSBiZWNhdXNlCiAgLy8gaXQgaXMgYWxyZWFkeSBwb3NpdGlvbmVkIG9uIHRoZSBlbGVtZW50CgogIC8vIHVwZGF0ZSByZWxhdGl2ZQogIHZhciBsZWZ0ID0gcG9zaXRpb24ubGVmdCwKICAgICAgdG9wID0gcG9zaXRpb24udG9wOwoKICBpZiAocG9zaXRpb24ucmlnaHQgIT09IHVuZGVmaW5lZCkgewogICAgbGVmdCA9IHBvc2l0aW9uLnJpZ2h0ICogLTEgKyBlbGVtZW50LndpZHRoOwogIH0KCiAgaWYgKHBvc2l0aW9uLmJvdHRvbSAhPT0gdW5kZWZpbmVkKSB7CiAgICB0b3AgPSBwb3NpdGlvbi5ib3R0b20gKiAtMSArIGVsZW1lbnQuaGVpZ2h0OwogIH0KCiAgaHRtbENvbnRhaW5lci5jc3MoeyBsZWZ0OiBsZWZ0IHx8IDAsIHRvcDogdG9wIHx8IDAgfSk7Cn07CgoKT3ZlcmxheXMucHJvdG90eXBlLl9jcmVhdGVPdmVybGF5Q29udGFpbmVyID0gZnVuY3Rpb24oZWxlbWVudCkgewogIHZhciBodG1sID0gJCgnPGRpdiAvPicpCiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2Rqcy1vdmVybGF5cycpCiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2Rqcy1vdmVybGF5cy0nICsgZWxlbWVudC5pZCkKICAgICAgICAgICAgICAgIC5jc3MoeyBwb3NpdGlvbjogJ2Fic29sdXRlJyB9KTsKCiAgaHRtbC5hcHBlbmRUbyh0aGlzLl9vdmVybGF5Um9vdCk7CgogIHZhciBjb250YWluZXIgPSB7CiAgICBodG1sOiBodG1sLAogICAgZWxlbWVudDogZWxlbWVudCwKICAgIG92ZXJsYXlzOiBbXQogIH07CgogIHRoaXMuX3VwZGF0ZU92ZXJsYXlDb250YWluZXIoY29udGFpbmVyKTsKCiAgcmV0dXJuIGNvbnRhaW5lcjsKfTsKCgpPdmVybGF5cy5wcm90b3R5cGUuX3VwZGF0ZVJvb3QgPSBmdW5jdGlvbih2aWV3Ym94KSB7CiAgdmFyIGEgPSB2aWV3Ym94LnNjYWxlIHx8IDE7CiAgdmFyIGQgPSB2aWV3Ym94LnNjYWxlIHx8IDE7CiAgdmFyIGUgPSB2aWV3Ym94LnggfHwgMDsKICB2YXIgZiA9IHZpZXdib3gueSB8fCAwOwoKICB2YXIgbWF0cml4ID0gJ21hdHJpeCgnICsgYSArICcsMCwwLCcgKyBkICsgJywnICsgKC0xICogdmlld2JveC54ICogYSkgKyAnLCcgKyAoLTEgKiB2aWV3Ym94LnkgKiBkKSArICcpJzsKCiAgdGhpcy5fb3ZlcmxheVJvb3QuY3NzKCd0cmFuc2Zvcm0nLCBtYXRyaXgpOwp9OwoKCk92ZXJsYXlzLnByb3RvdHlwZS5fZ2V0T3ZlcmxheUNvbnRhaW5lciA9IGZ1bmN0aW9uKGVsZW1lbnQsIHJhdykgewogIHZhciBpZCA9IChlbGVtZW50ICYmIGVsZW1lbnQuaWQpIHx8IGVsZW1lbnQ7CgogIHZhciBjb250YWluZXIgPSB0aGlzLl9vdmVybGF5Q29udGFpbmVyc1tpZF07CiAgaWYgKCFjb250YWluZXIgJiYgIXJhdykgewogICAgY29udGFpbmVyID0gdGhpcy5fb3ZlcmxheUNvbnRhaW5lcnNbaWRdID0gdGhpcy5fY3JlYXRlT3ZlcmxheUNvbnRhaW5lcihlbGVtZW50KTsKICB9CgogIHJldHVybiBjb250YWluZXI7Cn07CgoKT3ZlcmxheXMucHJvdG90eXBlLl9hZGRPdmVybGF5ID0gZnVuY3Rpb24ob3ZlcmxheSkgewoKICB2YXIgaWQgPSBvdmVybGF5LmlkLAogICAgICBlbGVtZW50ID0gb3ZlcmxheS5lbGVtZW50OwoKICB2YXIgY29udGFpbmVyID0gdGhpcy5fZ2V0T3ZlcmxheUNvbnRhaW5lcihlbGVtZW50KTsKCiAgdmFyIGh0bWxDb250YWluZXIgPSAkKCc8ZGl2PicsIHsKICAgIGlkOiBpZCwKICAgIGNsYXNzTmFtZTogJ2Rqcy1vdmVybGF5JwogIH0pLmNzcyh7IHBvc2l0aW9uOiAnYWJzb2x1dGUnIH0pLmFwcGVuZChvdmVybGF5Lmh0bWwpOwoKICBpZiAob3ZlcmxheS50eXBlKSB7CiAgICBodG1sQ29udGFpbmVyLmFkZENsYXNzKCdkanMtb3ZlcmxheS0nICsgb3ZlcmxheS50eXBlKTsKICB9CgogIG92ZXJsYXkuaHRtbENvbnRhaW5lciA9IGh0bWxDb250YWluZXI7CgogIGNvbnRhaW5lci5vdmVybGF5cy5wdXNoKG92ZXJsYXkpOwogIGNvbnRhaW5lci5odG1sLmFwcGVuZChodG1sQ29udGFpbmVyKTsKCiAgdGhpcy5fb3ZlcmxheXNbaWRdID0gb3ZlcmxheTsKCiAgdGhpcy5fdXBkYXRlT3ZlcmxheShvdmVybGF5KTsKfTsKCk92ZXJsYXlzLnByb3RvdHlwZS5fdXBkYXRlT3ZlcmxheVZpc2liaWx0eSA9IGZ1bmN0aW9uKHZpZXdib3gpIHsKCiAgXy5mb3JFYWNoKHRoaXMuX292ZXJsYXlzLCBmdW5jdGlvbihvdmVybGF5KSB7CiAgICBpZiAob3ZlcmxheS5zaG93KSB7CiAgICAgIGlmIChvdmVybGF5LnNob3cubWluWm9vbSA+IHZpZXdib3guc2NhbGUgfHwKICAgICAgICAgIG92ZXJsYXkuc2hvdy5tYXhab29tIDwgdmlld2JveC5zY2FsZSkgewogICAgICAgIG92ZXJsYXkuaHRtbENvbnRhaW5lci5oaWRlKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb3ZlcmxheS5odG1sQ29udGFpbmVyLnNob3coKTsKICAgICAgfQogICAgfQogIH0pOwp9OwoKT3ZlcmxheXMucHJvdG90eXBlLl9pbml0ID0gZnVuY3Rpb24oY29uZmlnKSB7CgogIHZhciBldmVudEJ1cyA9IHRoaXMuX2V2ZW50QnVzOwoKICB2YXIgc2VsZiA9IHRoaXM7CgoKICAvLyBzY3JvbGwvem9vbSBpbnRlZ3JhdGlvbgoKICB2YXIgdXBkYXRlVmlld2JveCA9IGZ1bmN0aW9uKHZpZXdib3gpIHsKICAgIHNlbGYuX3VwZGF0ZVJvb3Qodmlld2JveCk7CiAgICBzZWxmLl91cGRhdGVPdmVybGF5VmlzaWJpbHR5KHZpZXdib3gpOwoKICAgIHNlbGYuc2hvdygpOwogIH07CgogIGlmICghY29uZmlnIHx8IGNvbmZpZy5kZWZlclVwZGF0ZSAhPT0gZmFsc2UpIHsKICAgIHVwZGF0ZVZpZXdib3ggPSBfLmRlYm91bmNlKHVwZGF0ZVZpZXdib3gsIDMwMCk7CiAgfQoKICBldmVudEJ1cy5vbignY2FudmFzLnZpZXdib3guY2hhbmdlZCcsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICBzZWxmLmhpZGUoKTsKICAgIHVwZGF0ZVZpZXdib3goZXZlbnQudmlld2JveCk7CiAgfSk7CgoKICAvLyByZW1vdmUgaW50ZWdyYXRpb24KCiAgZXZlbnRCdXMub24oWyAnc2hhcGUucmVtb3ZlJywgJ2Nvbm5lY3Rpb24ucmVtb3ZlJyBdLCBmdW5jdGlvbihlKSB7CiAgICB2YXIgb3ZlcmxheXMgPSBzZWxmLmdldCh7IGVsZW1lbnQ6IGUuZWxlbWVudCB9KTsKCiAgICBfLmZvckVhY2gob3ZlcmxheXMsIGZ1bmN0aW9uKG8pIHsKICAgICAgc2VsZi5yZW1vdmUoby5pZCk7CiAgICB9KTsKICB9KTsKCgogIC8vIG1vdmUgaW50ZWdyYXRpb24KCiAgZXZlbnRCdXMub24oWwogICAgJ2NvbW1hbmRTdGFjay5zaGFwZS5tb3ZlLmV4ZWN1dGVkJywKICAgICdjb21tYW5kU3RhY2suc2hhcGUubW92ZS5yZXZlcnRlZCcKICBdLCBmdW5jdGlvbihlKSB7CiAgICB2YXIgZWxlbWVudCA9IGUuY29udGV4dC5zaGFwZTsKCiAgICB2YXIgY29udGFpbmVyID0gc2VsZi5fZ2V0T3ZlcmxheUNvbnRhaW5lcihlbGVtZW50LCB0cnVlKTsKICAgIGlmIChjb250YWluZXIpIHsKICAgICAgc2VsZi5fdXBkYXRlT3ZlcmxheUNvbnRhaW5lcihjb250YWluZXIpOwogICAgfQogIH0pOwp9Owp9LHsiLi4vLi4vdXRpbC9JZEdlbmVyYXRvciI6NjZ9XSw1OTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCm1vZHVsZS5leHBvcnRzID0gewogIF9faW5pdF9fOiBbICdvdmVybGF5cycgXSwKICBvdmVybGF5czogWyAndHlwZScsIF9kZXJlcV8oJy4vT3ZlcmxheXMnKSBdCn07Cn0seyIuL092ZXJsYXlzIjo1OH1dLDYwOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF8gPSAod2luZG93Ll8pOwoKCi8qKgogKiBBIHNlcnZpY2UgdGhhdCBvZmZlcnMgdGhlIGN1cnJlbnQgc2VsZWN0aW9uIGluIGEgZGlhZ3JhbS4KICogT2ZmZXJzIHRoZSBhcGkgdG8gY29udHJvbCB0aGUgc2VsZWN0aW9uLCB0b28uCiAqCiAqIEBjbGFzcwogKgogKiBAcGFyYW0ge0V2ZW50QnVzfSBldmVudEJ1cyB0aGUgZXZlbnQgYnVzCiAqLwpmdW5jdGlvbiBTZWxlY3Rpb24oZXZlbnRCdXMpIHsKCiAgdGhpcy5fZXZlbnRCdXMgPSBldmVudEJ1czsKCiAgdGhpcy5fc2VsZWN0ZWRFbGVtZW50cyA9IFtdOwoKICB2YXIgc2VsZiA9IHRoaXM7CgogIGV2ZW50QnVzLm9uKFsgJ3NoYXBlLnJlbW92ZScsICdjb25uZWN0aW9uLnJlbW92ZScgXSwgZnVuY3Rpb24oZSkgewogICAgdmFyIGVsZW1lbnQgPSBlLmVsZW1lbnQ7CiAgICBzZWxmLmRlc2VsZWN0KGVsZW1lbnQpOwogIH0pOwp9CgpTZWxlY3Rpb24uJGluamVjdCA9IFsgJ2V2ZW50QnVzJyBdOwoKbW9kdWxlLmV4cG9ydHMgPSBTZWxlY3Rpb247CgoKU2VsZWN0aW9uLnByb3RvdHlwZS5kZXNlbGVjdCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICB2YXIgc2VsZWN0ZWRFbGVtZW50cyA9IHRoaXMuX3NlbGVjdGVkRWxlbWVudHM7CgogIHZhciBpZHggPSBzZWxlY3RlZEVsZW1lbnRzLmluZGV4T2YoZWxlbWVudCk7CgogIGlmIChpZHggIT09IC0xKSB7CiAgICB2YXIgb2xkU2VsZWN0aW9uID0gc2VsZWN0ZWRFbGVtZW50cy5zbGljZSgpOwoKICAgIHNlbGVjdGVkRWxlbWVudHMuc3BsaWNlKGlkeCwgMSk7CgogICAgdGhpcy5fZXZlbnRCdXMuZmlyZSgnc2VsZWN0aW9uLmNoYW5nZWQnLCB7IG9sZFNlbGVjdGlvbjogb2xkU2VsZWN0aW9uLCBuZXdTZWxlY3Rpb246IHNlbGVjdGVkRWxlbWVudHMgfSk7CiAgfQp9OwoKClNlbGVjdGlvbi5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMuX3NlbGVjdGVkRWxlbWVudHM7Cn07CgpTZWxlY3Rpb24ucHJvdG90eXBlLmlzU2VsZWN0ZWQgPSBmdW5jdGlvbihlbGVtZW50KSB7CiAgcmV0dXJuIHRoaXMuX3NlbGVjdGVkRWxlbWVudHMuaW5kZXhPZihlbGVtZW50KSAhPT0gLTE7Cn07CgoKLyoqCiAqIFRoaXMgbWV0aG9kIHNlbGVjdHMgb25lIG9yIG1vcmUgZWxlbWVudHMgb24gdGhlIGRpYWdyYW0uCiAqCiAqIEJ5IHBhc3NpbmcgYW4gYWRkaXRpb25hbCBhZGQgcGFyYW1ldGVyIHlvdSBjYW4gZGVjaWRlIHdoZXRoZXIgb3Igbm90IHRoZSBlbGVtZW50KHMpCiAqIHNob3VsZCBiZSBhZGRlZCB0byB0aGUgYWxyZWFkeSBleGlzdGluZyBzZWxlY3Rpb24gb3Igbm90LgogKgogKiBAbWV0aG9kIFNlbGVjdGlvbiNzZWxlY3QKICoKICogQHBhcmFtICB7T2JqZWN0fE9iamVjdFtdfSBlbGVtZW50cyBlbGVtZW50IG9yIGFycmF5IG9mIGVsZW1lbnRzIHRvIGJlIHNlbGVjdGVkCiAqIEBwYXJhbSAge2Jvb2xlYW59IFthZGRdIHdoZXRoZXIgdGhlIGVsZW1lbnQocykgc2hvdWxkIGJlIGFwcGVuZGVkIHRvIHRoZSBjdXJyZW50IHNlbGVjdGlvbiwgZGVmYXVsdHMgdG8gZmFsc2UKICovClNlbGVjdGlvbi5wcm90b3R5cGUuc2VsZWN0ID0gZnVuY3Rpb24oZWxlbWVudHMsIGFkZCkgewogIHZhciBzZWxlY3RlZEVsZW1lbnRzID0gdGhpcy5fc2VsZWN0ZWRFbGVtZW50cywKICAgICAgb2xkU2VsZWN0aW9uID0gc2VsZWN0ZWRFbGVtZW50cy5zbGljZSgpOwoKICBpZiAoIV8uaXNBcnJheShlbGVtZW50cykpIHsKICAgIGVsZW1lbnRzID0gZWxlbWVudHMgPyBbIGVsZW1lbnRzIF0gOiBbXTsKICB9CgogIHZhciBzZWxmID0gdGhpczsKCiAgLy8gc2VsZWN0aW9uIG1heSBiZSBjbGVhcmVkIGJ5IHBhc3NpbmcgYW4gZW1wdHkgYXJyYXkgb3IgbnVsbAogIC8vIHRvIHRoZSBtZXRob2QKICBpZiAoZWxlbWVudHMubGVuZ3RoICYmIGFkZCkgewogICAgXy5mb3JFYWNoKGVsZW1lbnRzLCBmdW5jdGlvbihlbGVtZW50KSB7CiAgICAgIGlmIChzZWxlY3RlZEVsZW1lbnRzLmluZGV4T2YoZWxlbWVudCkgIT09IC0xKSB7CiAgICAgICAgLy8gYWxyZWFkeSBzZWxlY3RlZAogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWxlY3RlZEVsZW1lbnRzLnB1c2goZWxlbWVudCk7CiAgICAgIH0KICAgIH0pOwogIH0gZWxzZSB7CiAgICB0aGlzLl9zZWxlY3RlZEVsZW1lbnRzID0gc2VsZWN0ZWRFbGVtZW50cyA9IGVsZW1lbnRzLnNsaWNlKCk7CiAgfQoKICB0aGlzLl9ldmVudEJ1cy5maXJlKCdzZWxlY3Rpb24uY2hhbmdlZCcsIHsgb2xkU2VsZWN0aW9uOiBvbGRTZWxlY3Rpb24sIG5ld1NlbGVjdGlvbjogc2VsZWN0ZWRFbGVtZW50cyB9KTsKfTsKfSx7fV0sNjE6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgXyA9ICh3aW5kb3cuXyk7CgoKZnVuY3Rpb24gb3JpZ2luYWxFdmVudChlKSB7CiAgcmV0dXJuIGUuc3JjRXZlbnQgfHwgZTsKfQoKCi8qKgogKiBAY2xhc3MKICoKICogQSBwbHVnaW4gdGhhdCBhZGRzIGEgdmlzaWJsZSBzZWxlY3Rpb24gVUkgdG8gc2hhcGVzIGFuZCBjb25uZWN0aW9ucwogKiBieSBhcHBlbmRpbmcgdGhlIDxjb2RlPmhvdmVyPC9jb2RlPiBhbmQgPGNvZGU+c2VsZWN0ZWQ8L2NvZGU+IGNsYXNzZXMgdG8gdGhlbS4KICoKICogTWFrZXMgZWxlbWVudHMgc2VsZWN0YWJsZSwgdG9vLgogKgogKiBAcGFyYW0ge0V2ZW50QnVzfSBldmVudHMKICogQHBhcmFtIHtTZWxlY3Rpb25TZXJ2aWNlfSBzZWxlY3Rpb24KICogQHBhcmFtIHtFbGVtZW50UmVnaXN0cnl9IGVsZW1lbnRSZWdpc3RyeQogKi8KZnVuY3Rpb24gU2VsZWN0aW9uVmlzdWFscyhldmVudHMsIHNlbGVjdGlvbiwgZWxlbWVudFJlZ2lzdHJ5KSB7CgogIHZhciBIT1ZFUl9DTFMgPSAnaG92ZXInLAogICAgICBTRUxFQ1RFRF9DTFMgPSAnc2VsZWN0ZWQnOwoKICBmdW5jdGlvbiBhZGRNYXJrZXIoZ2Z4LCBjbHMpIHsKICAgIGlmIChnZngpIHsKICAgICAgZ2Z4LmFkZENsYXNzKGNscyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiByZW1vdmVNYXJrZXIoZ2Z4LCBjbHMpIHsKICAgIGlmIChnZngpIHsKICAgICAgZ2Z4LnJlbW92ZUNsYXNzKGNscyk7CiAgICB9CiAgfQoKICAvKioKICAgKiBXaXJlIGNsaWNrIG9uIHNoYXBlIHRvIHNlbGVjdCB0aGUgc2hhcGUKICAgKgogICAqIEBwYXJhbSAge09iamVjdH0gZXZlbnQgdGhlIGZpcmVkIGV2ZW50CiAgICovCiAgZXZlbnRzLm9uKCdzaGFwZS5jbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICB2YXIgYWRkID0gb3JpZ2luYWxFdmVudChldmVudCkuc2hpZnRLZXk7CiAgICBzZWxlY3Rpb24uc2VsZWN0KGV2ZW50LmVsZW1lbnQsIGFkZCk7CiAgfSk7CgogIGV2ZW50cy5vbignc2hhcGUuaG92ZXInLCBmdW5jdGlvbihldmVudCkgewogICAgYWRkTWFya2VyKGV2ZW50LmdmeCwgSE9WRVJfQ0xTKTsKICB9KTsKCiAgZXZlbnRzLm9uKCdzaGFwZS5vdXQnLCBmdW5jdGlvbihldmVudCkgewogICAgcmVtb3ZlTWFya2VyKGV2ZW50LmdmeCwgSE9WRVJfQ0xTKTsKICB9KTsKCiAgZXZlbnRzLm9uKCdzZWxlY3Rpb24uY2hhbmdlZCcsIGZ1bmN0aW9uKGV2ZW50KSB7CgogICAgZnVuY3Rpb24gZGVzZWxlY3QocykgewogICAgICByZW1vdmVNYXJrZXIoZWxlbWVudFJlZ2lzdHJ5LmdldEdyYXBoaWNzQnlFbGVtZW50KHMpLCBTRUxFQ1RFRF9DTFMpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNlbGVjdChzKSB7CiAgICAgIGFkZE1hcmtlcihlbGVtZW50UmVnaXN0cnkuZ2V0R3JhcGhpY3NCeUVsZW1lbnQocyksIFNFTEVDVEVEX0NMUyk7CiAgICB9CgogICAgdmFyIG9sZFNlbGVjdGlvbiA9IGV2ZW50Lm9sZFNlbGVjdGlvbiwKICAgICAgICBuZXdTZWxlY3Rpb24gPSBldmVudC5uZXdTZWxlY3Rpb247CgogICAgXy5mb3JFYWNoKG9sZFNlbGVjdGlvbiwgZnVuY3Rpb24oZSkgewogICAgICBpZiAobmV3U2VsZWN0aW9uLmluZGV4T2YoZSkgPT09IC0xKSB7CiAgICAgICAgZGVzZWxlY3QoZSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF8uZm9yRWFjaChuZXdTZWxlY3Rpb24sIGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKG9sZFNlbGVjdGlvbi5pbmRleE9mKGUpID09PSAtMSkgewogICAgICAgIHNlbGVjdChlKTsKICAgICAgfQogICAgfSk7CiAgfSk7CgogIC8vIGRlc2VsZWN0IGFsbCBzZWxlY3RlZCBzaGFwZXMgb24gY2FudmFzIGNsaWNrCiAgZXZlbnRzLm9uKCdjYW52YXMuY2xpY2snLCBmdW5jdGlvbihldmVudCkgewogICAgaWYgKG9yaWdpbmFsRXZlbnQoZXZlbnQpLnNyY0VsZW1lbnQgPT09IGV2ZW50LnJvb3QucGFwZXIubm9kZSkgewogICAgICBzZWxlY3Rpb24uc2VsZWN0KG51bGwpOwogICAgfQogIH0pOwp9CgpTZWxlY3Rpb25WaXN1YWxzLiRpbmplY3QgPSBbCiAgJ2V2ZW50QnVzJywKICAnc2VsZWN0aW9uJywKICAnZWxlbWVudFJlZ2lzdHJ5JwpdOwoKbW9kdWxlLmV4cG9ydHMgPSBTZWxlY3Rpb25WaXN1YWxzOwp9LHt9XSw2MjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCm1vZHVsZS5leHBvcnRzID0gewogIF9faW5pdF9fOiBbICdzZWxlY3Rpb25WaXN1YWxzJyBdLAogIF9fZGVwZW5kc19fOiBbCiAgICBfZGVyZXFfKCcuLi9pbnRlcmFjdGlvbi1ldmVudHMnKSwKICAgIF9kZXJlcV8oJy4uL291dGxpbmUnKQogIF0sCiAgc2VsZWN0aW9uOiBbICd0eXBlJywgX2RlcmVxXygnLi9TZWxlY3Rpb24nKSBdLAogIHNlbGVjdGlvblZpc3VhbHM6IFsgJ3R5cGUnLCBfZGVyZXFfKCcuL1NlbGVjdGlvblZpc3VhbHMnKSBdCn07Cn0seyIuLi9pbnRlcmFjdGlvbi1ldmVudHMiOjU1LCIuLi9vdXRsaW5lIjo1NywiLi9TZWxlY3Rpb24iOjYwLCIuL1NlbGVjdGlvblZpc3VhbHMiOjYxfV0sNjM6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgXyA9ICh3aW5kb3cuXyk7Cgp2YXIgUmVmcyA9IF9kZXJlcV8oJ29iamVjdC1yZWZzJyk7Cgp2YXIgcGFyZW50UmVmcyA9IG5ldyBSZWZzKHsgbmFtZTogJ2NoaWxkcmVuJywgZW51bWVyYWJsZTogdHJ1ZSwgY29sbGVjdGlvbjogdHJ1ZSB9LCB7IG5hbWU6ICdwYXJlbnQnIH0pLAogICAgbGFiZWxSZWZzID0gbmV3IFJlZnMoeyBuYW1lOiAnbGFiZWwnLCBlbnVtZXJhYmxlOiB0cnVlIH0sIHsgbmFtZTogJ2xhYmVsVGFyZ2V0JyB9KSwKICAgIG91dGdvaW5nUmVmcyA9IG5ldyBSZWZzKHsgbmFtZTogJ291dGdvaW5nJywgY29sbGVjdGlvbjogdHJ1ZSB9LCB7IG5hbWU6ICdzb3VyY2UnIH0pLAogICAgaW5jb21pbmdSZWZzID0gbmV3IFJlZnMoeyBuYW1lOiAnaW5jb21pbmcnLCBjb2xsZWN0aW9uOiB0cnVlIH0sIHsgbmFtZTogJ3RhcmdldCcgfSk7CgovKioKICogQG5hbWVzcGFjZSBkanMubW9kZWwKICovCgovKioKICogQG1lbWJlck9mIGRqcy5tb2RlbAogKi8KCi8qKgogKiBUaGUgYmFzaWMgZ3JhcGhpY2FsIHJlcHJlc2VudGF0aW9uCiAqCiAqIEBjbGFzcwogKgogKiBAYWJzdHJhY3QKICovCmZ1bmN0aW9uIEJhc2UoKSB7CgogIC8qKgogICAqIFRoZSBvYmplY3QgdGhhdCBiYWNrcyB1cCB0aGUgc2hhcGUKICAgKgogICAqIEBuYW1lIEJhc2UjYnVzaW5lc3NPYmplY3QKICAgKiBAdHlwZSBPYmplY3QKICAgKi8KICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ2J1c2luZXNzT2JqZWN0JywgewogICAgd3JpdGFibGU6IHRydWUKICB9KTsKCiAgLyoqCiAgICogVGhlIHBhcmVudCBzaGFwZQogICAqCiAgICogQG5hbWUgQmFzZSNwYXJlbnQKICAgKiBAdHlwZSBTaGFwZQogICAqLwogIHBhcmVudFJlZnMuYmluZCh0aGlzLCAncGFyZW50Jyk7CgogIC8qKgogICAqIEBuYW1lIEJhc2UjbGFiZWwKICAgKiBAdHlwZSBMYWJlbAogICAqLwogIGxhYmVsUmVmcy5iaW5kKHRoaXMsICdsYWJlbCcpOwoKICAvKioKICAgKiBUaGUgbGlzdCBvZiBvdXRnb2luZyBjb25uZWN0aW9ucwogICAqCiAgICogQG5hbWUgQmFzZSNvdXRnb2luZwogICAqIEB0eXBlIEFycmF5PENvbm5lY3Rpb24+CiAgICovCiAgb3V0Z29pbmdSZWZzLmJpbmQodGhpcywgJ291dGdvaW5nJyk7CgogIC8qKgogICAqIFRoZSBsaXN0IG9mIG91dGdvaW5nIGNvbm5lY3Rpb25zCiAgICoKICAgKiBAbmFtZSBCYXNlI2luY29taW5nCiAgICogQHR5cGUgQXJyYXk8Q29ubmVjdGlvbj4KICAgKi8KICBpbmNvbWluZ1JlZnMuYmluZCh0aGlzLCAnaW5jb21pbmcnKTsKfQoKCi8qKgogKiBBIGdyYXBoaWNhbCBvYmplY3QKICoKICogQGNsYXNzCiAqIEBjb25zdHJ1Y3RvcgogKgogKiBAZXh0ZW5kcyBCYXNlCiAqLwpmdW5jdGlvbiBTaGFwZSgpIHsKICBCYXNlLmNhbGwodGhpcyk7CgogIC8qKgogICAqIFRoZSBsaXN0IG9mIGNoaWxkcmVuCiAgICoKICAgKiBAbmFtZSBTaGFwZSNjaGlsZHJlbgogICAqIEB0eXBlIEFycmF5PEJhc2U+CiAgICovCiAgcGFyZW50UmVmcy5iaW5kKHRoaXMsICdjaGlsZHJlbicpOwp9CgpTaGFwZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEJhc2UucHJvdG90eXBlKTsKCgovKioKICogQSByb290IGdyYXBoaWNhbCBvYmplY3QKICoKICogQGNsYXNzCiAqIEBjb25zdHJ1Y3RvcgogKgogKiBAZXh0ZW5kcyBTaGFwZQogKi8KZnVuY3Rpb24gUm9vdCgpIHsKICBTaGFwZS5jYWxsKHRoaXMpOwp9CgpSb290LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU2hhcGUucHJvdG90eXBlKTsKCgovKioKICogQSBsYWJlbCBmb3IgYW4gZWxlbWVudAogKgogKiBAY2xhc3MKICogQGNvbnN0cnVjdG9yCiAqCiAqIEBleHRlbmRzIFNoYXBlCiAqLwpmdW5jdGlvbiBMYWJlbCgpIHsKICBTaGFwZS5jYWxsKHRoaXMpOwoKICAvKioKICAgKiBUaGUgbGFiZWxlZCBlbGVtZW50CiAgICoKICAgKiBAbmFtZSBMYWJlbCNsYWJlbFRhcmdldAogICAqIEB0eXBlIEJhc2UKICAgKi8KICBsYWJlbFJlZnMuYmluZCh0aGlzLCAnbGFiZWxUYXJnZXQnKTsKfQoKTGFiZWwucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTaGFwZS5wcm90b3R5cGUpOwoKCi8qKgogKiBBIGNvbm5lY3Rpb24gYmV0d2VlbiB0d28gZWxlbWVudHMKICoKICogQGNsYXNzCiAqIEBjb25zdHJ1Y3RvcgogKgogKiBAZXh0ZW5kcyBCYXNlCiAqLwpmdW5jdGlvbiBDb25uZWN0aW9uKCkgewogIEJhc2UuY2FsbCh0aGlzKTsKCiAgLyoqCiAgICogVGhlIGVsZW1lbnQgdGhpcyBjb25uZWN0aW9uIG9yaWdpbmF0ZXMgZnJvbQogICAqCiAgICogQG5hbWUgQ29ubmVjdGlvbiNzb3VyY2UKICAgKiBAdHlwZSBCYXNlCiAgICovCiAgb3V0Z29pbmdSZWZzLmJpbmQodGhpcywgJ3NvdXJjZScpOwoKICAvKioKICAgKiBUaGUgZWxlbWVudCB0aGlzIGNvbm5lY3Rpb24gcG9pbnRzIHRvCiAgICoKICAgKiBAbmFtZSBDb25uZWN0aW9uI3RhcmdldAogICAqIEB0eXBlIEJhc2UKICAgKi8KICBpbmNvbWluZ1JlZnMuYmluZCh0aGlzLCAndGFyZ2V0Jyk7Cn0KCkNvbm5lY3Rpb24ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShCYXNlLnByb3RvdHlwZSk7CgoKdmFyIHR5cGVzID0gewogIGNvbm5lY3Rpb246IENvbm5lY3Rpb24sCiAgc2hhcGU6IFNoYXBlLAogIGxhYmVsOiBMYWJlbCwKICByb290OiBSb290Cn07CgovKioKICogQ3JlYXRlcyBhIG5ldyBtb2RlbCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQgdHlwZQogKgogKiBAbWV0aG9kIGNyZWF0ZQogKgogKiBAZXhhbXBsZQogKgogKiB2YXIgc2hhcGUxID0gTW9kZWwuY3JlYXRlKCdzaGFwZScsIHsgeDogMTAsIHk6IDEwLCB3aWR0aDogMTAwLCBoZWlnaHQ6IDEwMCB9KTsKICogdmFyIHNoYXBlMiA9IE1vZGVsLmNyZWF0ZSgnc2hhcGUnLCB7IHg6IDIxMCwgeTogMjEwLCB3aWR0aDogMTAwLCBoZWlnaHQ6IDEwMCB9KTsKICoKICogdmFyIGNvbm5lY3Rpb24gPSBNb2RlbC5jcmVhdGUoJ2Nvbm5lY3Rpb24nLCB7IHdheXBvaW50czogWyB7IHg6IDExMCwgeTogNTUgfSwge3g6IDIxMCwgeTogNTUgfSBdIH0pOwogKgogKiBAcGFyYW0gIHtTdHJpbmd9IHR5cGUgbG93ZXItY2FzZWQgbW9kZWwgbmFtZQogKiBAcGFyYW0gIHtPYmplY3R9IGF0dHJzIGF0dHJpYnV0ZXMgdG8gaW5pdGlhbGl6ZSB0aGUgbmV3IG1vZGVsIGluc3RhbmNlIHdpdGgKICoKICogQHJldHVybiB7QmFzZX0gdGhlIG5ldyBtb2RlbCBpbnN0YW5jZQogKi8KbW9kdWxlLmV4cG9ydHMuY3JlYXRlID0gZnVuY3Rpb24odHlwZSwgYXR0cnMpIHsKICB2YXIgVHlwZSA9IHR5cGVzW3R5cGVdOwogIGlmICghVHlwZSkgewogICAgdGhyb3cgbmV3IEVycm9yKCd1bmtub3duIHR5cGU6IDwnICsgdHlwZSArICc+Jyk7CiAgfQogIHJldHVybiBfLmV4dGVuZChuZXcgVHlwZSgpLCBhdHRycyk7Cn07CgoKbW9kdWxlLmV4cG9ydHMuUm9vdCA9IFJvb3Q7Cm1vZHVsZS5leHBvcnRzLlNoYXBlID0gU2hhcGU7Cm1vZHVsZS5leHBvcnRzLkNvbm5lY3Rpb24gPSBDb25uZWN0aW9uOwptb2R1bGUuZXhwb3J0cy5MYWJlbCA9IExhYmVsOwp9LHsib2JqZWN0LXJlZnMiOjcyfV0sNjQ6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgovKioKICogRmFpbHNhZmUgcmVtb3ZlIGFuIGVsZW1lbnQgZnJvbSBhIGNvbGxlY3Rpb24KICoKICogQHBhcmFtICB7QXJyYXk8T2JqZWN0Pn0gW2NvbGxlY3Rpb25dCiAqIEBwYXJhbSAge09iamVjdH0gW2VsZW1lbnRdCiAqCiAqIEByZXR1cm4ge09iamVjdH0gdGhlIGVsZW1lbnQgdGhhdCBnb3QgcmVtb3ZlZCBvciB1bmRlZmluZWQKICovCm1vZHVsZS5leHBvcnRzLnJlbW92ZSA9IGZ1bmN0aW9uKGNvbGxlY3Rpb24sIGVsZW1lbnQpIHsKCiAgaWYgKCFjb2xsZWN0aW9uIHx8ICFlbGVtZW50KSB7CiAgICByZXR1cm47CiAgfQoKICB2YXIgaWR4ID0gY29sbGVjdGlvbi5pbmRleE9mKGVsZW1lbnQpOwogIGlmIChpZHggPT09IC0xKSB7CiAgICByZXR1cm47CiAgfQoKICBjb2xsZWN0aW9uLnNwbGljZShpZHgsIDEpOwoKICByZXR1cm4gZWxlbWVudDsKfTsKfSx7fV0sNjU6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CgovKioKICogQG1vZHVsZSB1dGlsL0dyYXBoaWNzVXRpbAogKi8KCmZ1bmN0aW9uIGlzKGUsIGNscykgewogIHJldHVybiBlLmhhc0NsYXNzKGNscyk7Cn0KCgovKioKICoKICogQSBub3RlIG9uIGhvdyBTVkcgZWxlbWVudHMgYXJlIHN0cnVjdHVyZWQ6CiAqCiAqIFNoYXBlIGxheW91dDoKICoKICogW2dyb3VwLmRqcy1ncm91cC5kanMtc2hhcGVdCiAqICB8LT4gW3JlY3QuZGpzLWhpdF0KICogIHwtPiBbcmVjdC5kanMtdmlzdWFsXQogKiAgfC0+IFtyZWN0LmRqcy1vdXRsaW5lXQogKiAgLi4uCiAqCiAqIFtncm91cC5kanMtZ3JvdXAuZGpzLWNvbm5lY3Rpb25dCiAqICB8LT4gW3BvbHlsaW5lLmRqcy1oaXRdCiAqICB8LT4gW3BvbHlsaW5lLmRqcy12aXN1YWxdCiAqICB8LT4gW3BvbHlsaW5lLmRqcy1vdXRsaW5lXQogKiAgLi4uCiAqCiAqLwoKLyoqCiAqIFJldHVybnMgdGhlIHZpc3VhbCBwYXJ0IG9mIGEgZGlhZ3JhbSBlbGVtZW50CiAqCiAqIEBwYXJhbSAge3NuYXBzdmcuRWxlbWVudH0gZ2Z4CiAqIEByZXR1cm4ge3NuYXBzdmcuRWxlbWVudH0KICovCmZ1bmN0aW9uIGdldFZpc3VhbChnZngpIHsKICByZXR1cm4gZ2Z4LnNlbGVjdCgnLmRqcy12aXN1YWwnKTsKfQoKbW9kdWxlLmV4cG9ydHMuZ2V0VmlzdWFsID0gZ2V0VmlzdWFsOwp9LHt9XSw2NjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCi8qKgogKiBVdGlsIHRoYXQgcHJvdmlkZXMgdW5pcXVlIElEcy4KICoKICogQGNsYXNzIGRqcy51dGlsLklkR2VuZXJhdG9yCiAqIEBtZW1iZXJPZiBkanMudXRpbAogKgogKiBAY29uc3RydWN0b3IKICoKICogVGhlIGlkcyBjYW4gYmUgY3VzdG9taXplZCB2aWEgYSBnaXZlbiBwcmVmaXggYW5kIGNvbnRhaW4gYSByYW5kb20gdmFsdWUgdG8gYXZvaWQgY29sbGlzaW9ucy4KICoKICogQHBhcmFtIHtTdHJpbmd9IHByZWZpeCBhIHByZWZpeCB0byBwcmVwZW5kIHRvIGdlbmVyYXRlZCBpZHMgKGZvciBiZXR0ZXIgcmVhZGFiaWxpdHkpCiAqLwpmdW5jdGlvbiBJZEdlbmVyYXRvcihwcmVmaXgpIHsKCiAgdGhpcy5fY291bnRlciA9IDA7CiAgdGhpcy5fcHJlZml4ID0gKHByZWZpeCA/IHByZWZpeCArICctJyA6ICcnKSArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDAwMDApICsgJy0nOwp9Cgptb2R1bGUuZXhwb3J0cyA9IElkR2VuZXJhdG9yOwoKLyoqCiAqIFJldHVybnMgYSBuZXh0IHVuaXF1ZSBJRC4KICoKICogQG1ldGhvZCBkanMudXRpbC5JZEdlbmVyYXRvciNuZXh0CiAqCiAqIEByZXR1cm5zIHtTdHJpbmd9IHRoZSBpZAogKi8KSWRHZW5lcmF0b3IucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5fcHJlZml4ICsgKCsrdGhpcy5fY291bnRlcik7Cn07Cgp9LHt9XSw2NzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBfID0gKHdpbmRvdy5fKTsKCnZhciBERUZBVUxUX0JPWF9QQURESU5HID0gNTsKCnZhciBERUZBVUxUX0xBQkVMX1NJWkUgPSB7CiAgd2lkdGg6IDE1MCwKICBoZWlnaHQ6IDUwCn07CgoKZnVuY3Rpb24gcGFyc2VBbGlnbihhbGlnbikgewoKICB2YXIgcGFydHMgPSBhbGlnbi5zcGxpdCgnLScpOwoKICByZXR1cm4gewogICAgaG9yaXpvbnRhbDogcGFydHNbMF0gfHwgJ2NlbnRlcicsCiAgICB2ZXJ0aWNhbDogcGFydHNbMV0gfHwgJ3RvcCcKICB9Owp9CgpmdW5jdGlvbiBwYXJzZVBhZGRpbmcocGFkZGluZykgewoKICBpZiAoXy5pc09iamVjdChwYWRkaW5nKSkgewogICAgcmV0dXJuIF8uZXh0ZW5kKHsgdG9wOiAwLCBsZWZ0OiAwLCByaWdodDogMCwgYm90dG9tOiAwIH0sIHBhZGRpbmcpOwogIH0gZWxzZSB7CiAgICByZXR1cm4gewogICAgICB0b3A6IHBhZGRpbmcsCiAgICAgIGxlZnQ6IHBhZGRpbmcsCiAgICAgIHJpZ2h0OiBwYWRkaW5nLAogICAgICBib3R0b206IHBhZGRpbmcKICAgIH07CiAgfQp9CgoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgbGFiZWwgdXRpbGl0eQogKgogKiBAcGFyYW0ge09iamVjdH0gY29uZmlnCiAqIEBwYXJhbSB7RGltZW5zaW9uc30gY29uZmlnLnNpemUKICogQHBhcmFtIHtOdW1iZXJ9IGNvbmZpZy5wYWRkaW5nCiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcuc3R5bGUKICogQHBhcmFtIHtTdHJpbmd9IGNvbmZpZy5hbGlnbgogKi8KZnVuY3Rpb24gTGFiZWxVdGlsKGNvbmZpZykgewoKICBjb25maWcgPSBfLmV4dGVuZCh7fSwgewogICAgc2l6ZTogREVGQVVMVF9MQUJFTF9TSVpFLAogICAgcGFkZGluZzogREVGQVVMVF9CT1hfUEFERElORywKICAgIHN0eWxlOiB7fSwKICAgIGFsaWduOiAnY2VudGVyLXRvcCcKICB9LCBjb25maWcgfHwge30pOwoKICAvKioKICAgKiBDcmVhdGUgYSBsYWJlbCBpbiB0aGUgcGFyZW50IG5vZGUuCiAgICoKICAgKiBAbWV0aG9kIExhYmVsVXRpbCNjcmVhdGVMYWJlbAogICAqCiAgICogQHBhcmFtIHtTVkdFbGVtZW50fSBwYXJlbnQgdGhlIHBhcmVudCB0byBkcmF3IHRoZSBsYWJlbCBvbgogICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IHRoZSB0ZXh0IHRvIHJlbmRlciBvbiB0aGUgbGFiZWwKICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7U3RyaW5nfSBvcHRpb25zLmFsaWduIGhvdyB0byBhbGlnbiBpbiB0aGUgYm91bmRpbmcgYm94LgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbnkgb2YgeyAnY2VudGVyLW1pZGRsZScsICdjZW50ZXItdG9wJyB9LCBkZWZhdWx0cyB0byAnY2VudGVyLXRvcCcuCiAgICogQHBhcmFtIHtTdHJpbmd9IG9wdGlvbnMuc3R5bGUgc3R5bGUgdG8gYmUgYXBwbGllZCB0byB0aGUgdGV4dAogICAqCiAgICogQHJldHVybiB7U1ZHVGV4dH0gdGhlIHRleHQgZWxlbWVudCBjcmVhdGVkCiAgICovCiAgZnVuY3Rpb24gY3JlYXRlTGFiZWwocGFyZW50LCB0ZXh0LCBvcHRpb25zKSB7CgogICAgdmFyIGJveCA9IF8ubWVyZ2Uoe30sIGNvbmZpZy5zaXplLCBvcHRpb25zLmJveCB8fCB7fSksCiAgICAgICAgc3R5bGUgPSBfLm1lcmdlKHt9LCBjb25maWcuc3R5bGUsIG9wdGlvbnMuc3R5bGUgfHwge30pLAogICAgICAgIGFsaWduID0gcGFyc2VBbGlnbihvcHRpb25zLmFsaWduIHx8IGNvbmZpZy5hbGlnbiksCiAgICAgICAgcGFkZGluZyA9IHBhcnNlUGFkZGluZyhvcHRpb25zLnBhZGRpbmcgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucGFkZGluZyA6IGNvbmZpZy5wYWRkaW5nKTsKCiAgICB2YXIgbGluZXMgPSB0ZXh0LnNwbGl0KC9ccj9cbi9nKSwKICAgICAgICBsYXlvdXRlZCA9IFtdOwoKICAgIHZhciBtYXhXaWR0aCA9IGJveC53aWR0aCAtIHBhZGRpbmcubGVmdCAtIHBhZGRpbmcucmlnaHQ7CgogICAgLyoqCiAgICAgKiBMYXlvdXQgdGhlIG5leHQgbGluZSBhbmQgcmV0dXJuIHRoZSBsYXlvdXRlZCBlbGVtZW50LgogICAgICoKICAgICAqIEFsdGVycyB0aGUgbGluZXMgcGFzc2VkLgogICAgICoKICAgICAqIEBwYXJhbSAge0FycmF5PFN0cmluZz59IGxpbmVzCiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IHRoZSBsaW5lIGRlc2NyaXB0b3IsIGFuIG9iamVjdCB7IHdpZHRoLCBoZWlnaHQsIHRleHQgfQogICAgICovCiAgICBmdW5jdGlvbiBsYXlvdXROZXh0KGxpbmVzKSB7CgogICAgICB2YXIgb3JpZ2luYWxMaW5lID0gbGluZXMuc2hpZnQoKSwKICAgICAgICAgIGZpdExpbmUgPSBvcmlnaW5hbExpbmU7CgogICAgICB2YXIgdGV4dEJCb3g7CgogICAgICBmdW5jdGlvbiBmaXQoKSB7CiAgICAgICAgaWYgKGZpdExpbmUubGVuZ3RoIDwgb3JpZ2luYWxMaW5lLmxlbmd0aCkgewogICAgICAgICAgdmFyIG5leHRMaW5lID0gbGluZXNbMF0gfHwgJycsCiAgICAgICAgICAgICAgcmVtYWluZGVyID0gb3JpZ2luYWxMaW5lLnNsaWNlKGZpdExpbmUubGVuZ3RoKTsKCiAgICAgICAgICBpZiAoLy1ccyokLy50ZXN0KHJlbWFpbmRlcikpIHsKICAgICAgICAgICAgbmV4dExpbmUgPSByZW1haW5kZXIucmVwbGFjZSgvLVxzKiQvLCAnJykgKyBuZXh0TGluZS5yZXBsYWNlKC9eXHMrLywgJycpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV4dExpbmUgPSByZW1haW5kZXIgKyAnICcgKyBuZXh0TGluZTsKICAgICAgICAgIH0KCiAgICAgICAgICBsaW5lc1swXSA9IG5leHRMaW5lOwogICAgICAgIH0KICAgICAgICByZXR1cm4geyB3aWR0aDogdGV4dEJCb3gud2lkdGgsIGhlaWdodDogdGV4dEJCb3guaGVpZ2h0LCB0ZXh0OiBmaXRMaW5lIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGdldFRleHRCQm94KHRleHQpIHsKICAgICAgICB2YXIgdGV4dEVsZW1lbnQgPSBwYXJlbnQudGV4dCgwLCAwLCBmaXRMaW5lKS5hdHRyKHN0eWxlKTsKCiAgICAgICAgdmFyIGJib3ggPSB0ZXh0RWxlbWVudC5nZXRCQm94KCk7CgogICAgICAgIHRleHRFbGVtZW50LnJlbW92ZSgpOwogICAgICAgIHJldHVybiBiYm94OwogICAgICB9CgogICAgICAvKioKICAgICAgICogU2hvcnRlbnMgYSBsaW5lIGJhc2VkIG9uIHNwYWNpbmcgYW5kIGh5cGhlbnMuCiAgICAgICAqIFJldHVybnMgdGhlIHNob3J0ZW5lZCByZXN1bHQgb24gc3VjY2Vzcy4KICAgICAgICoKICAgICAgICogQHBhcmFtICB7U3RyaW5nfSBsaW5lCiAgICAgICAqIEBwYXJhbSAge051bWJlcn0gbWF4TGVuZ3RoIHRoZSBtYXhpbXVtIGNoYXJhY3RlcnMgb2YgdGhlIHN0cmluZwogICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IHRoZSBzaG9ydGVuZWQgc3RyaW5nCiAgICAgICAqLwogICAgICBmdW5jdGlvbiBzZW1hbnRpY1Nob3J0ZW4obGluZSwgbWF4TGVuZ3RoKSB7CiAgICAgICAgdmFyIHBhcnRzID0gbGluZS5zcGxpdCgvKFxzfC0pL2cpLAogICAgICAgICAgICBwYXJ0LAogICAgICAgICAgICBzaG9ydGVuZWRQYXJ0cyA9IFtdLAogICAgICAgICAgICBsZW5ndGggPSAwOwoKICAgICAgICAvLyB0cnkgdG8gc2hvcnRlbiB2aWEgc3BhY2VzICsgaHlwaGVucwogICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPiAxKSB7CiAgICAgICAgICB3aGlsZSAoKHBhcnQgPSBwYXJ0cy5zaGlmdCgpKSkgewoKICAgICAgICAgICAgaWYgKHBhcnQubGVuZ3RoICsgbGVuZ3RoIDwgbWF4TGVuZ3RoKSB7CiAgICAgICAgICAgICAgc2hvcnRlbmVkUGFydHMucHVzaChwYXJ0KTsKICAgICAgICAgICAgICBsZW5ndGggKz0gcGFydC5sZW5ndGg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gcmVtb3ZlIHByZXZpb3VzIHBhcnQsIHRvbyBpZiBoeXBoZW4gZG9lcyBub3QgZml0IGFueW1vcmUKICAgICAgICAgICAgICBpZiAocGFydCA9PT0gJy0nKSB7CiAgICAgICAgICAgICAgICBzaG9ydGVuZWRQYXJ0cy5wb3AoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2hvcnRlbmVkUGFydHMuam9pbignJyk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHNob3J0ZW5MaW5lKGxpbmUsIHdpZHRoLCBtYXhXaWR0aCkgewogICAgICAgIHZhciBzaG9ydGVuZWRMaW5lID0gJyc7CgogICAgICAgIHZhciBhcHByb3hpbWF0ZUxlbmd0aCA9IGxpbmUubGVuZ3RoICogKG1heFdpZHRoIC8gd2lkdGgpOwoKICAgICAgICAvLyB0cnkgdG8gc2hvcnRlbiBzZW1hbnRpY2FsbHkgKGkuZS4gYmFzZWQgb24gc3BhY2VzIGFuZCBoeXBoZW5zKQogICAgICAgIHNob3J0ZW5lZExpbmUgPSBzZW1hbnRpY1Nob3J0ZW4obGluZSwgYXBwcm94aW1hdGVMZW5ndGgpOwoKICAgICAgICBpZiAoIXNob3J0ZW5lZExpbmUpIHsKCiAgICAgICAgICAvLyBmb3JjZSBzaG9ydGVuIGJ5IGN1dHRpbmcgdGhlIGxvbmcgd29yZAogICAgICAgICAgc2hvcnRlbmVkTGluZSA9IGxpbmUuc2xpY2UoMCwgTWF0aC5mbG9vcihhcHByb3hpbWF0ZUxlbmd0aCAtIDEpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzaG9ydGVuZWRMaW5lOwogICAgICB9CgoKICAgICAgd2hpbGUgKHRydWUpIHsKCiAgICAgICAgdGV4dEJCb3ggPSBnZXRUZXh0QkJveChmaXRMaW5lKTsKCiAgICAgICAgLy8gdHJ5IHRvIGZpdAogICAgICAgIGlmICh0ZXh0QkJveC53aWR0aCA8IG1heFdpZHRoKSB7CiAgICAgICAgICByZXR1cm4gZml0KCk7CiAgICAgICAgfQoKICAgICAgICBmaXRMaW5lID0gc2hvcnRlbkxpbmUoZml0TGluZSwgdGV4dEJCb3gud2lkdGgsIG1heFdpZHRoKTsKICAgICAgfQogICAgfQoKICAgIHdoaWxlIChsaW5lcy5sZW5ndGgpIHsKICAgICAgbGF5b3V0ZWQucHVzaChsYXlvdXROZXh0KGxpbmVzKSk7CiAgICB9CgogICAgdmFyIHRvdGFsSGVpZ2h0ID0gXy5yZWR1Y2UobGF5b3V0ZWQsIGZ1bmN0aW9uKHN1bSwgbGluZSwgaWR4KSB7CiAgICAgIHJldHVybiBzdW0gKyBsaW5lLmhlaWdodDsKICAgIH0sIDApOwoKCiAgICAvLyB0aGUgY2VudGVyIHggcG9zaXRpb24gdG8gYWxpZ24gYWdhaW5zdAogICAgdmFyIGN4ID0gYm94LndpZHRoIC8gMjsKCiAgICAvLyB0aGUgeSBwb3NpdGlvbiBvZiB0aGUgbmV4dCBsaW5lCiAgICB2YXIgeSwgeDsKCiAgICBzd2l0Y2ggKGFsaWduLnZlcnRpY2FsKSB7CiAgICAgIGNhc2UgJ21pZGRsZSc6CiAgICAgICAgeSA9IChib3guaGVpZ2h0IC0gdG90YWxIZWlnaHQpIC8gMiAtIGxheW91dGVkWzBdLmhlaWdodCAvIDQ7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIHkgPSBwYWRkaW5nLnRvcDsKICAgIH0KCiAgICB2YXIgdGV4dEVsZW1lbnQgPSBwYXJlbnQuZ3JvdXAoKS5hdHRyKHN0eWxlKTsKCiAgICBfLmZvckVhY2gobGF5b3V0ZWQsIGZ1bmN0aW9uKGxpbmUpIHsKICAgICAgeSArPSBsaW5lLmhlaWdodDsKCiAgICAgIHN3aXRjaCAoYWxpZ24uaG9yaXpvbnRhbCkgewogICAgICAgIGNhc2UgJ2xlZnQnOgogICAgICAgICAgeCA9IHBhZGRpbmcubGVmdDsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdyaWdodCc6CiAgICAgICAgICB4ID0gKG1heFdpZHRoIC0gcGFkZGluZy5yaWdodCAtIGxpbmUud2lkdGgpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAvLyBha2EgY2VudGVyCiAgICAgICAgICB4ID0gKG1heFdpZHRoIC0gbGluZS53aWR0aCkgLyAyICsgcGFkZGluZy5sZWZ0OwogICAgICB9CgoKICAgICAgcGFyZW50LnRleHQoeCwgeSwgbGluZS50ZXh0KS5hcHBlbmRUbyh0ZXh0RWxlbWVudCk7CiAgICB9KTsKCiAgICByZXR1cm4gdGV4dEVsZW1lbnQ7CiAgfQoKICAvLyBBUEkKICB0aGlzLmNyZWF0ZUxhYmVsID0gY3JlYXRlTGFiZWw7Cn0KCgptb2R1bGUuZXhwb3J0cyA9IExhYmVsVXRpbDsKfSx7fV0sNjg6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewoKdmFyIGlzQXJyYXkgPSBmdW5jdGlvbihvYmopIHsKICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikgPT09ICdbb2JqZWN0IEFycmF5XSc7Cn07Cgp2YXIgYW5ub3RhdGUgPSBmdW5jdGlvbigpIHsKICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgCiAgaWYgKGFyZ3MubGVuZ3RoID09PSAxICYmIGlzQXJyYXkoYXJnc1swXSkpIHsKICAgIGFyZ3MgPSBhcmdzWzBdOwogIH0KCiAgdmFyIGZuID0gYXJncy5wb3AoKTsKCiAgZm4uJGluamVjdCA9IGFyZ3M7CgogIHJldHVybiBmbjsKfTsKCgovLyBDdXJyZW50IGxpbWl0YXRpb25zOgovLyAtIGNhbid0IHB1dCBpbnRvICJmdW5jdGlvbiBhcmciIGNvbW1lbnRzCi8vIGZ1bmN0aW9uIC8qIChubyBwYXJlbnRoZXNpcyBsaWtlIHRoaXMpICovICgpe30KLy8gZnVuY3Rpb24gYWJjKCAvKiB4eCAobm8gcGFyZW50aGVzaXMgbGlrZSB0aGlzKSAqLyBhLCBiKSB7fQovLwovLyBKdXN0IHB1dCB0aGUgY29tbWVudCBiZWZvcmUgZnVuY3Rpb24gb3IgaW5zaWRlOgovLyAvKiAoKCh0aGlzIGlzIGZpbmUpKSkgKi8gZnVuY3Rpb24oYSwgYikge30KLy8gZnVuY3Rpb24gYWJjKGEpIHsgLyogKCgodGhpcyBpcyBmaW5lKSkpICovfQoKdmFyIEZOX0FSR1MgPSAvXmZ1bmN0aW9uXHMqW15cKF0qXChccyooW15cKV0qKVwpL207CnZhciBGTl9BUkcgPSAvXC9cKihbXlwqXSopXCpcLy9tOwoKdmFyIHBhcnNlID0gZnVuY3Rpb24oZm4pIHsKICBpZiAodHlwZW9mIGZuICE9PSAnZnVuY3Rpb24nKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBhbm5vdGF0ZSAiJyArIGZuICsgJyIuIEV4cGVjdGVkIGEgZnVuY3Rpb24hJyk7CiAgfQoKICB2YXIgbWF0Y2ggPSBmbi50b1N0cmluZygpLm1hdGNoKEZOX0FSR1MpOwogIHJldHVybiBtYXRjaFsxXSAmJiBtYXRjaFsxXS5zcGxpdCgnLCcpLm1hcChmdW5jdGlvbihhcmcpIHsKICAgIG1hdGNoID0gYXJnLm1hdGNoKEZOX0FSRyk7CiAgICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXS50cmltKCkgOiBhcmcudHJpbSgpOwogIH0pIHx8IFtdOwp9OwoKCmV4cG9ydHMuYW5ub3RhdGUgPSBhbm5vdGF0ZTsKZXhwb3J0cy5wYXJzZSA9IHBhcnNlOwpleHBvcnRzLmlzQXJyYXkgPSBpc0FycmF5OwoKfSx7fV0sNjk6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cyA9IHsKICBhbm5vdGF0ZTogX2RlcmVxXygnLi9hbm5vdGF0aW9uJykuYW5ub3RhdGUsCiAgTW9kdWxlOiBfZGVyZXFfKCcuL21vZHVsZScpLAogIEluamVjdG9yOiBfZGVyZXFfKCcuL2luamVjdG9yJykKfTsKCn0seyIuL2Fubm90YXRpb24iOjY4LCIuL2luamVjdG9yIjo3MCwiLi9tb2R1bGUiOjcxfV0sNzA6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgTW9kdWxlID0gX2RlcmVxXygnLi9tb2R1bGUnKTsKdmFyIGF1dG9Bbm5vdGF0ZSA9IF9kZXJlcV8oJy4vYW5ub3RhdGlvbicpLnBhcnNlOwp2YXIgYW5ub3RhdGUgPSBfZGVyZXFfKCcuL2Fubm90YXRpb24nKS5hbm5vdGF0ZTsKdmFyIGlzQXJyYXkgPSBfZGVyZXFfKCcuL2Fubm90YXRpb24nKS5pc0FycmF5OwoKCnZhciBJbmplY3RvciA9IGZ1bmN0aW9uKG1vZHVsZXMsIHBhcmVudCkgewogIHBhcmVudCA9IHBhcmVudCB8fCB7CiAgICBnZXQ6IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgY3VycmVudGx5UmVzb2x2aW5nLnB1c2gobmFtZSk7CiAgICAgIHRocm93IGVycm9yKCdObyBwcm92aWRlciBmb3IgIicgKyBuYW1lICsgJyIhJyk7CiAgICB9CiAgfTsKCiAgdmFyIGN1cnJlbnRseVJlc29sdmluZyA9IFtdOwogIHZhciBwcm92aWRlcnMgPSB0aGlzLl9wcm92aWRlcnMgPSBPYmplY3QuY3JlYXRlKHBhcmVudC5fcHJvdmlkZXJzIHx8IG51bGwpOwogIHZhciBpbnN0YW5jZXMgPSB0aGlzLl9pbnN0YW5jZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICB2YXIgc2VsZiA9IGluc3RhbmNlcy5pbmplY3RvciA9IHRoaXM7CgogIHZhciBlcnJvciA9IGZ1bmN0aW9uKG1zZykgewogICAgdmFyIHN0YWNrID0gY3VycmVudGx5UmVzb2x2aW5nLmpvaW4oJyAtPiAnKTsKICAgIGN1cnJlbnRseVJlc29sdmluZy5sZW5ndGggPSAwOwogICAgcmV0dXJuIG5ldyBFcnJvcihzdGFjayA/IG1zZyArICcgKFJlc29sdmluZzogJyArIHN0YWNrICsgJyknIDogbXNnKTsKICB9OwoKICB2YXIgZ2V0ID0gZnVuY3Rpb24obmFtZSkgewogICAgaWYgKCFwcm92aWRlcnNbbmFtZV0gJiYgbmFtZS5pbmRleE9mKCcuJykgIT09IC0xKSB7CiAgICAgIHZhciBwYXJ0cyA9IG5hbWUuc3BsaXQoJy4nKTsKICAgICAgdmFyIHBpdm90ID0gZ2V0KHBhcnRzLnNoaWZ0KCkpOwoKICAgICAgd2hpbGUocGFydHMubGVuZ3RoKSB7CiAgICAgICAgcGl2b3QgPSBwaXZvdFtwYXJ0cy5zaGlmdCgpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBpdm90OwogICAgfQoKICAgIGlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChpbnN0YW5jZXMsIG5hbWUpKSB7CiAgICAgIHJldHVybiBpbnN0YW5jZXNbbmFtZV07CiAgICB9CgogICAgaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHByb3ZpZGVycywgbmFtZSkpIHsKICAgICAgaWYgKGN1cnJlbnRseVJlc29sdmluZy5pbmRleE9mKG5hbWUpICE9PSAtMSkgewogICAgICAgIGN1cnJlbnRseVJlc29sdmluZy5wdXNoKG5hbWUpOwogICAgICAgIHRocm93IGVycm9yKCdDYW5ub3QgcmVzb2x2ZSBjaXJjdWxhciBkZXBlbmRlbmN5IScpOwogICAgICB9CgogICAgICBjdXJyZW50bHlSZXNvbHZpbmcucHVzaChuYW1lKTsKICAgICAgaW5zdGFuY2VzW25hbWVdID0gcHJvdmlkZXJzW25hbWVdWzBdKHByb3ZpZGVyc1tuYW1lXVsxXSk7CiAgICAgIGN1cnJlbnRseVJlc29sdmluZy5wb3AoKTsKCiAgICAgIHJldHVybiBpbnN0YW5jZXNbbmFtZV07CiAgICB9CgogICAgcmV0dXJuIHBhcmVudC5nZXQobmFtZSk7CiAgfTsKCiAgdmFyIGluc3RhbnRpYXRlID0gZnVuY3Rpb24oVHlwZSkgewogICAgdmFyIGluc3RhbmNlID0gT2JqZWN0LmNyZWF0ZShUeXBlLnByb3RvdHlwZSk7CiAgICB2YXIgcmV0dXJuZWQgPSBpbnZva2UoVHlwZSwgaW5zdGFuY2UpOwoKICAgIHJldHVybiB0eXBlb2YgcmV0dXJuZWQgPT09ICdvYmplY3QnID8gcmV0dXJuZWQgOiBpbnN0YW5jZTsKICB9OwoKICB2YXIgaW52b2tlID0gZnVuY3Rpb24oZm4sIGNvbnRleHQpIHsKICAgIGlmICh0eXBlb2YgZm4gIT09ICdmdW5jdGlvbicpIHsKICAgICAgaWYgKGlzQXJyYXkoZm4pKSB7CiAgICAgICAgZm4gPSBhbm5vdGF0ZShmbi5zbGljZSgpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBpbnZva2UgIicgKyBmbiArICciLiBFeHBlY3RlZCBhIGZ1bmN0aW9uIScpOwogICAgICB9CiAgICB9CgogICAgdmFyIGluamVjdCA9IGZuLiRpbmplY3QgJiYgZm4uJGluamVjdCB8fCBhdXRvQW5ub3RhdGUoZm4pOwogICAgdmFyIGRlcGVuZGVuY2llcyA9IGluamVjdC5tYXAoZnVuY3Rpb24oZGVwKSB7CiAgICAgIHJldHVybiBnZXQoZGVwKTsKICAgIH0pOwoKICAgIC8vIFRPRE8odm9qdGEpOiBvcHRpbWl6ZSB3aXRob3V0IGFwcGx5CiAgICByZXR1cm4gZm4uYXBwbHkoY29udGV4dCwgZGVwZW5kZW5jaWVzKTsKICB9OwoKCiAgdmFyIGNyZWF0ZVByaXZhdGVJbmplY3RvckZhY3RvcnkgPSBmdW5jdGlvbihwcml2YXRlQ2hpbGRJbmplY3RvcikgewogICAgcmV0dXJuIGFubm90YXRlKGZ1bmN0aW9uKGtleSkgewogICAgICByZXR1cm4gcHJpdmF0ZUNoaWxkSW5qZWN0b3IuZ2V0KGtleSk7CiAgICB9KTsKICB9OwoKICB2YXIgY3JlYXRlQ2hpbGQgPSBmdW5jdGlvbihtb2R1bGVzLCBmb3JjZU5ld0luc3RhbmNlcykgewogICAgaWYgKGZvcmNlTmV3SW5zdGFuY2VzICYmIGZvcmNlTmV3SW5zdGFuY2VzLmxlbmd0aCkgewogICAgICB2YXIgZnJvbVBhcmVudE1vZHVsZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIHZhciBtYXRjaGVkU2NvcGVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCiAgICAgIHZhciBwcml2YXRlSW5qZWN0b3JzQ2FjaGUgPSBbXTsKICAgICAgdmFyIHByaXZhdGVDaGlsZEluamVjdG9ycyA9IFtdOwogICAgICB2YXIgcHJpdmF0ZUNoaWxkRmFjdG9yaWVzID0gW107CgogICAgICB2YXIgcHJvdmlkZXI7CiAgICAgIHZhciBjYWNoZUlkeDsKICAgICAgdmFyIHByaXZhdGVDaGlsZEluamVjdG9yOwogICAgICB2YXIgcHJpdmF0ZUNoaWxkSW5qZWN0b3JGYWN0b3J5OwogICAgICBmb3IgKHZhciBuYW1lIGluIHByb3ZpZGVycykgewogICAgICAgIHByb3ZpZGVyID0gcHJvdmlkZXJzW25hbWVdOwoKICAgICAgICBpZiAoZm9yY2VOZXdJbnN0YW5jZXMuaW5kZXhPZihuYW1lKSAhPT0gLTEpIHsKICAgICAgICAgIGlmIChwcm92aWRlclsyXSA9PT0gJ3ByaXZhdGUnKSB7CiAgICAgICAgICAgIGNhY2hlSWR4ID0gcHJpdmF0ZUluamVjdG9yc0NhY2hlLmluZGV4T2YocHJvdmlkZXJbM10pOwogICAgICAgICAgICBpZiAoY2FjaGVJZHggPT09IC0xKSB7CiAgICAgICAgICAgICAgcHJpdmF0ZUNoaWxkSW5qZWN0b3IgPSBwcm92aWRlclszXS5jcmVhdGVDaGlsZChbXSwgZm9yY2VOZXdJbnN0YW5jZXMpOwogICAgICAgICAgICAgIHByaXZhdGVDaGlsZEluamVjdG9yRmFjdG9yeSA9IGNyZWF0ZVByaXZhdGVJbmplY3RvckZhY3RvcnkocHJpdmF0ZUNoaWxkSW5qZWN0b3IpOwogICAgICAgICAgICAgIHByaXZhdGVJbmplY3RvcnNDYWNoZS5wdXNoKHByb3ZpZGVyWzNdKTsKICAgICAgICAgICAgICBwcml2YXRlQ2hpbGRJbmplY3RvcnMucHVzaChwcml2YXRlQ2hpbGRJbmplY3Rvcik7CiAgICAgICAgICAgICAgcHJpdmF0ZUNoaWxkRmFjdG9yaWVzLnB1c2gocHJpdmF0ZUNoaWxkSW5qZWN0b3JGYWN0b3J5KTsKICAgICAgICAgICAgICBmcm9tUGFyZW50TW9kdWxlW25hbWVdID0gW3ByaXZhdGVDaGlsZEluamVjdG9yRmFjdG9yeSwgbmFtZSwgJ3ByaXZhdGUnLCBwcml2YXRlQ2hpbGRJbmplY3Rvcl07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZnJvbVBhcmVudE1vZHVsZVtuYW1lXSA9IFtwcml2YXRlQ2hpbGRGYWN0b3JpZXNbY2FjaGVJZHhdLCBuYW1lLCAncHJpdmF0ZScsIHByaXZhdGVDaGlsZEluamVjdG9yc1tjYWNoZUlkeF1dOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmcm9tUGFyZW50TW9kdWxlW25hbWVdID0gW3Byb3ZpZGVyWzJdLCBwcm92aWRlclsxXV07CiAgICAgICAgICB9CiAgICAgICAgICBtYXRjaGVkU2NvcGVzW25hbWVdID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmICgocHJvdmlkZXJbMl0gPT09ICdmYWN0b3J5JyB8fCBwcm92aWRlclsyXSA9PT0gJ3R5cGUnKSAmJiBwcm92aWRlclsxXS4kc2NvcGUpIHsKICAgICAgICAgIGZvcmNlTmV3SW5zdGFuY2VzLmZvckVhY2goZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgICAgICAgaWYgKHByb3ZpZGVyWzFdLiRzY29wZS5pbmRleE9mKHNjb3BlKSAhPT0gLTEpIHsKICAgICAgICAgICAgICBmcm9tUGFyZW50TW9kdWxlW25hbWVdID0gW3Byb3ZpZGVyWzJdLCBwcm92aWRlclsxXV07CiAgICAgICAgICAgICAgbWF0Y2hlZFNjb3Blc1tzY29wZV0gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvcmNlTmV3SW5zdGFuY2VzLmZvckVhY2goZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgICBpZiAoIW1hdGNoZWRTY29wZXNbc2NvcGVdKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHByb3ZpZGVyIGZvciAiJyArIHNjb3BlICsgJyIuIENhbm5vdCB1c2UgcHJvdmlkZXIgZnJvbSB0aGUgcGFyZW50IScpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICBtb2R1bGVzLnVuc2hpZnQoZnJvbVBhcmVudE1vZHVsZSk7CiAgICB9CgogICAgcmV0dXJuIG5ldyBJbmplY3Rvcihtb2R1bGVzLCBzZWxmKTsKICB9OwoKICB2YXIgZmFjdG9yeU1hcCA9IHsKICAgIGZhY3Rvcnk6IGludm9rZSwKICAgIHR5cGU6IGluc3RhbnRpYXRlLAogICAgdmFsdWU6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICB9OwoKICBtb2R1bGVzLmZvckVhY2goZnVuY3Rpb24obW9kdWxlKSB7CgogICAgZnVuY3Rpb24gYXJyYXlVbndyYXAodHlwZSwgdmFsdWUpIHsKICAgICAgaWYgKHR5cGUgIT09ICd2YWx1ZScgJiYgaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICB2YWx1ZSA9IGFubm90YXRlKHZhbHVlLnNsaWNlKCkpOwogICAgICB9CgogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CgogICAgLy8gVE9ETyh2b2p0YSk6IGhhbmRsZSB3cm9uZyBpbnB1dHMgKG1vZHVsZXMpCiAgICBpZiAobW9kdWxlIGluc3RhbmNlb2YgTW9kdWxlKSB7CiAgICAgIG1vZHVsZS5mb3JFYWNoKGZ1bmN0aW9uKHByb3ZpZGVyKSB7CiAgICAgICAgdmFyIG5hbWUgPSBwcm92aWRlclswXTsKICAgICAgICB2YXIgdHlwZSA9IHByb3ZpZGVyWzFdOwogICAgICAgIHZhciB2YWx1ZSA9IHByb3ZpZGVyWzJdOwoKICAgICAgICBwcm92aWRlcnNbbmFtZV0gPSBbZmFjdG9yeU1hcFt0eXBlXSwgYXJyYXlVbndyYXAodHlwZSwgdmFsdWUpLCB0eXBlXTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKSB7CiAgICAgIGlmIChtb2R1bGUuX19leHBvcnRzX18pIHsKICAgICAgICB2YXIgY2xvbmVkTW9kdWxlID0gT2JqZWN0LmtleXMobW9kdWxlKS5yZWR1Y2UoZnVuY3Rpb24obSwga2V5KSB7CiAgICAgICAgICBpZiAoa2V5LnN1YnN0cmluZygwLCAyKSAhPT0gJ19fJykgewogICAgICAgICAgICBtW2tleV0gPSBtb2R1bGVba2V5XTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBtOwogICAgICAgIH0sIE9iamVjdC5jcmVhdGUobnVsbCkpOwoKICAgICAgICB2YXIgcHJpdmF0ZUluamVjdG9yID0gbmV3IEluamVjdG9yKChtb2R1bGUuX19tb2R1bGVzX18gfHwgW10pLmNvbmNhdChbY2xvbmVkTW9kdWxlXSksIHNlbGYpOwogICAgICAgIHZhciBnZXRGcm9tUHJpdmF0ZUluamVjdG9yID0gYW5ub3RhdGUoZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICByZXR1cm4gcHJpdmF0ZUluamVjdG9yLmdldChrZXkpOwogICAgICAgIH0pOwogICAgICAgIG1vZHVsZS5fX2V4cG9ydHNfXy5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgcHJvdmlkZXJzW2tleV0gPSBbZ2V0RnJvbVByaXZhdGVJbmplY3Rvciwga2V5LCAncHJpdmF0ZScsIHByaXZhdGVJbmplY3Rvcl07CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgT2JqZWN0LmtleXMobW9kdWxlKS5mb3JFYWNoKGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICAgIGlmIChtb2R1bGVbbmFtZV1bMl0gPT09ICdwcml2YXRlJykgewogICAgICAgICAgICBwcm92aWRlcnNbbmFtZV0gPSBtb2R1bGVbbmFtZV07CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdHlwZSA9IG1vZHVsZVtuYW1lXVswXTsKICAgICAgICAgIHZhciB2YWx1ZSA9IG1vZHVsZVtuYW1lXVsxXTsKCiAgICAgICAgICBwcm92aWRlcnNbbmFtZV0gPSBbZmFjdG9yeU1hcFt0eXBlXSwgYXJyYXlVbndyYXAodHlwZSwgdmFsdWUpLCB0eXBlXTsKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0pOwoKICAvLyBwdWJsaWMgQVBJCiAgdGhpcy5nZXQgPSBnZXQ7CiAgdGhpcy5pbnZva2UgPSBpbnZva2U7CiAgdGhpcy5pbnN0YW50aWF0ZSA9IGluc3RhbnRpYXRlOwogIHRoaXMuY3JlYXRlQ2hpbGQgPSBjcmVhdGVDaGlsZDsKfTsKCm1vZHVsZS5leHBvcnRzID0gSW5qZWN0b3I7Cgp9LHsiLi9hbm5vdGF0aW9uIjo2OCwiLi9tb2R1bGUiOjcxfV0sNzE6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgTW9kdWxlID0gZnVuY3Rpb24oKSB7CiAgdmFyIHByb3ZpZGVycyA9IFtdOwoKICB0aGlzLmZhY3RvcnkgPSBmdW5jdGlvbihuYW1lLCBmYWN0b3J5KSB7CiAgICBwcm92aWRlcnMucHVzaChbbmFtZSwgJ2ZhY3RvcnknLCBmYWN0b3J5XSk7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICB0aGlzLnZhbHVlID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKICAgIHByb3ZpZGVycy5wdXNoKFtuYW1lLCAndmFsdWUnLCB2YWx1ZV0pOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgdGhpcy50eXBlID0gZnVuY3Rpb24obmFtZSwgdHlwZSkgewogICAgcHJvdmlkZXJzLnB1c2goW25hbWUsICd0eXBlJywgdHlwZV0pOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgdGhpcy5mb3JFYWNoID0gZnVuY3Rpb24oaXRlcmF0b3IpIHsKICAgIHByb3ZpZGVycy5mb3JFYWNoKGl0ZXJhdG9yKTsKICB9Owp9OwoKbW9kdWxlLmV4cG9ydHMgPSBNb2R1bGU7Cgp9LHt9XSw3MjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gX2RlcmVxXygnLi9saWIvcmVmcycpOwoKbW9kdWxlLmV4cG9ydHMuQ29sbGVjdGlvbiA9IF9kZXJlcV8oJy4vbGliL2NvbGxlY3Rpb24nKTsKfSx7Ii4vbGliL2NvbGxlY3Rpb24iOjczLCIuL2xpYi9yZWZzIjo3NH1dLDczOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKLyoqCiAqIEFuIGVtcHR5IGNvbGxlY3Rpb24gc3R1Yi4gVXNlIHtAbGluayBSZWZzQ29sbGVjdGlvbi5leHRlbmR9IHRvIGV4dGVuZCBhCiAqIGNvbGxlY3Rpb24gd2l0aCByZWYgc2VtYW50aWNzLgogKgogKiBAY2xhc3NkZXNjIEEgY2hhbmdlIGFuZCBpbnZlcnNlLXJlZmVyZW5jZSBhd2FyZSBjb2xsZWN0aW9uIHdpdGggc2V0IHNlbWFudGljcy4KICoKICogQGNsYXNzIFJlZnNDb2xsZWN0aW9uCiAqLwpmdW5jdGlvbiBSZWZzQ29sbGVjdGlvbigpIHsgfQoKLyoqCiAqIEV4dGVuZHMgYSBjb2xsZWN0aW9uIHdpdGgge0BsaW5rIFJlZnN9IGF3YXJlIG1ldGhvZHMKICoKICogQG1lbWJlcm9mIFJlZnNDb2xsZWN0aW9uCiAqIEBzdGF0aWMKICoKICogQHBhcmFtICB7QXJyYXk8T2JqZWN0Pn0gY29sbGVjdGlvbgogKiBAcGFyYW0gIHtSZWZzfSByZWZzIGluc3RhbmNlCiAqIEBwYXJhbSAge09iamVjdH0gcHJvcGVydHkgcmVwcmVzZW50ZWQgYnkgdGhlIGNvbGxlY3Rpb24KICogQHBhcmFtICB7T2JqZWN0fSB0YXJnZXQgb2JqZWN0IHRoZSBjb2xsZWN0aW9uIGlzIGF0dGFjaGVkIHRvCiAqCiAqIEByZXR1cm4ge1JlZnNDb2xsZWN0aW9uPE9iamVjdD59IHRoZSBleHRlbmRlZCBhcnJheQogKi8KZnVuY3Rpb24gZXh0ZW5kKGNvbGxlY3Rpb24sIHJlZnMsIHByb3BlcnR5LCB0YXJnZXQpIHsKCiAgdmFyIGludmVyc2VQcm9wZXJ0eSA9IHByb3BlcnR5LmludmVyc2U7CgogIC8qKgogICAqIFJlbW92ZXMgdGhlIGdpdmVuIGVsZW1lbnQgZnJvbSB0aGUgYXJyYXkgYW5kIHJldHVybnMgaXQuCiAgICoKICAgKiBAbWV0aG9kIFJlZnNDb2xsZWN0aW9uI3JlbW92ZQogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IGVsZW1lbnQgdGhlIGVsZW1lbnQgdG8gcmVtb3ZlCiAgICovCiAgY29sbGVjdGlvbi5yZW1vdmUgPSBmdW5jdGlvbihlbGVtZW50KSB7CiAgICB2YXIgaWR4ID0gdGhpcy5pbmRleE9mKGVsZW1lbnQpOwogICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgdGhpcy5zcGxpY2UoaWR4LCAxKTsKCiAgICAgIC8vIHVuc2V0IGludmVyc2UKICAgICAgcmVmcy51bnNldChlbGVtZW50LCBpbnZlcnNlUHJvcGVydHksIHRhcmdldCk7CiAgICB9CgogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfTsKCiAgLyoqCiAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBjb2xsZWN0aW9uIGNvbnRhaW5zIHRoZSBnaXZlbiBlbGVtZW50CiAgICoKICAgKiBAbWV0aG9kIFJlZnNDb2xsZWN0aW9uI2NvbnRhaW5zCiAgICoKICAgKiBAcGFyYW0ge09iamVjdH0gZWxlbWVudCB0aGUgZWxlbWVudCB0byBjaGVjayBmb3IKICAgKi8KICBjb2xsZWN0aW9uLmNvbnRhaW5zID0gZnVuY3Rpb24oZWxlbWVudCkgewogICAgcmV0dXJuIHRoaXMuaW5kZXhPZihlbGVtZW50KSAhPT0gLTE7CiAgfTsKCiAgLyoqCiAgICogQWRkcyBhbiBlbGVtZW50IHRvIHRoZSBhcnJheSwgdW5sZXNzIGl0IGV4aXN0cyBhbHJlYWR5IChzZXQgc2VtYW50aWNzKS4KICAgKgogICAqIEBtZXRob2QgUmVmc0NvbGxlY3Rpb24jYWRkCiAgICoKICAgKiBAcGFyYW0ge09iamVjdH0gZWxlbWVudCB0aGUgZWxlbWVudCB0byBhZGQKICAgKi8KICBjb2xsZWN0aW9uLmFkZCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHsKCiAgICBpZiAoIXRoaXMuY29udGFpbnMoZWxlbWVudCkpIHsKICAgICAgdGhpcy5wdXNoKGVsZW1lbnQpOwoKICAgICAgLy8gc2V0IGludmVyc2UKICAgICAgcmVmcy5zZXQoZWxlbWVudCwgaW52ZXJzZVByb3BlcnR5LCB0YXJnZXQpOwogICAgfQogIH07CgogIHJldHVybiBjb2xsZWN0aW9uOwp9CgoKbW9kdWxlLmV4cG9ydHMuZXh0ZW5kID0gZXh0ZW5kOwp9LHt9XSw3NDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBDb2xsZWN0aW9uID0gX2RlcmVxXygnLi9jb2xsZWN0aW9uJyk7CgpmdW5jdGlvbiBoYXNPd25Qcm9wZXJ0eShlLCBwcm9wZXJ0eSkgewogIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgcHJvcGVydHkubmFtZSB8fCBwcm9wZXJ0eSk7Cn0KCgpmdW5jdGlvbiBkZWZpbmVDb2xsZWN0aW9uUHJvcGVydHkocmVmLCBwcm9wZXJ0eSwgdGFyZ2V0KSB7CiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHkubmFtZSwgewogICAgZW51bWVyYWJsZTogcHJvcGVydHkuZW51bWVyYWJsZSwKICAgIHZhbHVlOiBDb2xsZWN0aW9uLmV4dGVuZCh0YXJnZXRbcHJvcGVydHkubmFtZV0gfHwgW10sIHJlZiwgcHJvcGVydHksIHRhcmdldCkKICB9KTsKfQoKCmZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KHJlZiwgcHJvcGVydHksIHRhcmdldCkgewoKICB2YXIgaW52ZXJzZVByb3BlcnR5ID0gcHJvcGVydHkuaW52ZXJzZTsKCiAgdmFyIF92YWx1ZSA9IHRhcmdldFtwcm9wZXJ0eS5uYW1lXTsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHkubmFtZSwgewogICAgZW51bWVyYWJsZTogcHJvcGVydHkuZW51bWVyYWJsZSwKCiAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gX3ZhbHVlOwogICAgfSwKCiAgICBzZXQ6IGZ1bmN0aW9uKHZhbHVlKSB7CgogICAgICAvLyByZXR1cm4gaWYgd2UgYWxyZWFkeSBwZXJmb3JtZWQgYWxsIGNoYW5nZXMKICAgICAgaWYgKHZhbHVlID09PSBfdmFsdWUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBvbGQgPSBfdmFsdWU7CgogICAgICAvLyB0ZW1wb3Jhcnkgc2V0IG51bGwKICAgICAgX3ZhbHVlID0gbnVsbDsKCiAgICAgIGlmIChvbGQpIHsKICAgICAgICByZWYudW5zZXQob2xkLCBpbnZlcnNlUHJvcGVydHksIHRhcmdldCk7CiAgICAgIH0KCiAgICAgIC8vIHNldCBuZXcgdmFsdWUKICAgICAgX3ZhbHVlID0gdmFsdWU7CgogICAgICAvLyBzZXQgaW52ZXJzZSB2YWx1ZQogICAgICByZWYuc2V0KF92YWx1ZSwgaW52ZXJzZVByb3BlcnR5LCB0YXJnZXQpOwogICAgfQogIH0pOwoKfQoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgcmVmZXJlbmNlcyBvYmplY3QgZGVmaW5pbmcgdHdvIGludmVyc2x5IHJlbGF0ZWQKICogYXR0cmlidXRlIGRlc2NyaXB0b3JzIGEgYW5kIGIuCiAqCiAqIDxwPgogKiAgIFdoZW4gYm91bmQgdG8gYW4gb2JqZWN0IHVzaW5nIHtAbGluayBSZWZzI2JpbmR9IHRoZSByZWZlcmVuY2VzCiAqICAgZ2V0IGFjdGl2YXRlZCBhbmQgZW5zdXJlIHRoYXQgYWRkIGFuZCByZW1vdmUgb3BlcmF0aW9ucyBhcmUgYXBwbGllZAogKiAgIHJldmVyc2VseSwgdG9vLgogKiA8L3A+CiAqCiAqIDxwPgogKiAgIEZvciBhdHRyaWJ1dGVzIHJlcHJlc2VudGVkIGFzIGNvbGxlY3Rpb25zIHtAbGluayBSZWZzfSBwcm92aWRlcyB0aGUKICogICB7QGxpbmsgUmVmc0NvbGxlY3Rpb24jYWRkfSwge0BsaW5rIFJlZnNDb2xsZWN0aW9uI3JlbW92ZX0gYW5kIHtAbGluayBSZWZzQ29sbGVjdGlvbiNjb250YWluc30gZXh0ZW5zaW9ucwogKiAgIHRoYXQgbXVzdCBiZSB1c2VkIHRvIHByb3Blcmx5IGhvb2sgaW50byB0aGUgaW52ZXJzZSBjaGFuZ2UgbWVjaGFuaXNtLgogKiA8L3A+CiAqCiAqIEBjbGFzcyBSZWZzCiAqCiAqIEBjbGFzc2Rlc2MgQSBiaS1kaXJlY3Rpb25hbCByZWZlcmVuY2UgYmV0d2VlbiB0d28gYXR0cmlidXRlcy4KICoKICogQHBhcmFtIHtSZWZzLkF0dHJpYnV0ZURlc2NyaXB0b3J9IGEgcHJvcGVydHkgZGVzY3JpcHRvcgogKiBAcGFyYW0ge1JlZnMuQXR0cmlidXRlRGVzY3JpcHRvcn0gYiBwcm9wZXJ0eSBkZXNjcmlwdG9yCiAqCiAqIEBleGFtcGxlCiAqCiAqIHZhciByZWZzID0gUmVmcyh7IG5hbWU6ICd3aGVlbHMnLCBjb2xsZWN0aW9uOiB0cnVlLCBlbnVtZXJhYmxlOiB0cnVlIH0sIHsgbmFtZTogJ2NhcicgfSk7CiAqCiAqIHZhciBjYXIgPSB7IG5hbWU6ICd0b3lvdGEnIH07CiAqIHZhciB3aGVlbHMgPSBbeyBwb3M6ICdmcm9udC1sZWZ0JyB9LCB7IHBvczogJ2Zyb250LXJpZ2h0JyB9XTsKICoKICogcmVmcy5iaW5kKGNhciwgJ3doZWVscycpOwogKgogKiBjYXIud2hlZWxzIC8vIFtdCiAqIGNhci53aGVlbHMuYWRkKHdoZWVsc1swXSk7CiAqIGNhci53aGVlbHMuYWRkKHdoZWVsc1sxXSk7CiAqCiAqIGNhci53aGVlbHMgLy8gW3sgcG9zOiAnZnJvbnQtbGVmdCcgfSwgeyBwb3M6ICdmcm9udC1yaWdodCcgfV0KICoKICogd2hlZWxzWzBdLmNhciAvLyB7IG5hbWU6ICd0b3lvdGEnIH07CiAqIGNhci53aGVlbHMucmVtb3ZlKHdoZWVsc1swXSk7CiAqCiAqIHdoZWVsc1swXS5jYXIgLy8gdW5kZWZpbmVkCiAqLwpmdW5jdGlvbiBSZWZzKGEsIGIpIHsKCiAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFJlZnMpKSB7CiAgICByZXR1cm4gbmV3IFJlZnMoYSwgYik7CiAgfQoKICAvLyBsaW5rCiAgYS5pbnZlcnNlID0gYjsKICBiLmludmVyc2UgPSBhOwoKICB0aGlzLnByb3BzID0ge307CiAgdGhpcy5wcm9wc1thLm5hbWVdID0gYTsKICB0aGlzLnByb3BzW2IubmFtZV0gPSBiOwp9CgovKioKICogQmluZHMgb25lIHNpZGUgb2YgYSBiaS1kaXJlY3Rpb25hbCByZWZlcmVuY2UgdG8gYQogKiB0YXJnZXQgb2JqZWN0LgogKgogKiBAbWVtYmVyT2YgUmVmcwogKgogKiBAcGFyYW0gIHtPYmplY3R9IHRhcmdldAogKiBAcGFyYW0gIHtTdHJpbmd9IHByb3BlcnR5CiAqLwpSZWZzLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24odGFyZ2V0LCBwcm9wZXJ0eSkgewogIGlmICh0eXBlb2YgcHJvcGVydHkgPT09ICdzdHJpbmcnKSB7CiAgICBpZiAoIXRoaXMucHJvcHNbcHJvcGVydHldKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignbm8gcHJvcGVydHkgPCcgKyBwcm9wZXJ0eSArICc+IGluIHJlZicpOwogICAgfQogICAgcHJvcGVydHkgPSB0aGlzLnByb3BzW3Byb3BlcnR5XTsKICB9CgogIGlmIChwcm9wZXJ0eS5jb2xsZWN0aW9uKSB7CiAgICBkZWZpbmVDb2xsZWN0aW9uUHJvcGVydHkodGhpcywgcHJvcGVydHksIHRhcmdldCk7CiAgfSBlbHNlIHsKICAgIGRlZmluZVByb3BlcnR5KHRoaXMsIHByb3BlcnR5LCB0YXJnZXQpOwogIH0KfTsKClJlZnMucHJvdG90eXBlLmVuc3VyZUJvdW5kID0gZnVuY3Rpb24odGFyZ2V0LCBwcm9wZXJ0eSkgewogIGlmICghaGFzT3duUHJvcGVydHkodGFyZ2V0LCBwcm9wZXJ0eSkpIHsKICAgIHRoaXMuYmluZCh0YXJnZXQsIHByb3BlcnR5KTsKICB9Cn07CgpSZWZzLnByb3RvdHlwZS51bnNldCA9IGZ1bmN0aW9uKHRhcmdldCwgcHJvcGVydHksIHZhbHVlKSB7CgogIGlmICh0YXJnZXQpIHsKICAgIHRoaXMuZW5zdXJlQm91bmQodGFyZ2V0LCBwcm9wZXJ0eSk7CgogICAgaWYgKHByb3BlcnR5LmNvbGxlY3Rpb24pIHsKICAgICAgdGFyZ2V0W3Byb3BlcnR5Lm5hbWVdLnJlbW92ZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICB0YXJnZXRbcHJvcGVydHkubmFtZV0gPSB1bmRlZmluZWQ7CiAgICB9CiAgfQp9OwoKUmVmcy5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24odGFyZ2V0LCBwcm9wZXJ0eSwgdmFsdWUpIHsKCiAgaWYgKHRhcmdldCkgewogICAgdGhpcy5lbnN1cmVCb3VuZCh0YXJnZXQsIHByb3BlcnR5KTsKCiAgICBpZiAocHJvcGVydHkuY29sbGVjdGlvbikgewogICAgICB0YXJnZXRbcHJvcGVydHkubmFtZV0uYWRkKHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHRhcmdldFtwcm9wZXJ0eS5uYW1lXSA9IHZhbHVlOwogICAgfQogIH0KfTsKCm1vZHVsZS5leHBvcnRzID0gUmVmczsKCgovKioKICogQW4gYXR0cmlidXRlIGRlc2NyaXB0b3IgdG8gYmUgdXNlZCBzcGVjaWZ5IGFuIGF0dHJpYnV0ZSBpbiBhIHtAbGluayBSZWZzfSBpbnN0YW5jZQogKgogKiBAdHlwZWRlZiB7T2JqZWN0fSBSZWZzLkF0dHJpYnV0ZURlc2NyaXB0b3IKICogQHByb3BlcnR5IHtTdHJpbmd9IG5hbWUKICogQHByb3BlcnR5IHtib29sZWFufSBbY29sbGVjdGlvbj1mYWxzZV0KICogQHByb3BlcnR5IHtib29sZWFufSBbZW51bWVyYWJsZT1mYWxzZV0KICovCn0seyIuL2NvbGxlY3Rpb24iOjczfV0sNzU6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cz1fZGVyZXFfKDcyKQp9LHsiLi9saWIvY29sbGVjdGlvbiI6NzYsIi4vbGliL3JlZnMiOjc3fV0sNzY6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cz1fZGVyZXFfKDczKQp9LHt9XSw3NzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzPV9kZXJlcV8oNzQpCn0seyIuL2NvbGxlY3Rpb24iOjc2fV19LHt9LFsxXSkKKDEpCn0pOwo=</content>
    <filesize>298817</filesize>
  </attachment>
  <attachment>
    <filename>sax.js</filename>
    <author>XWiki.Admin</author>
    <date>1409494156000</date>
    <version>1.1</version>
    <comment/>
    <content>Ly8gd3JhcHBlciBmb3Igbm9uLW5vZGUgZW52cwo7KGZ1bmN0aW9uIChzYXgpIHsKCnNheC5wYXJzZXIgPSBmdW5jdGlvbiAoc3RyaWN0LCBvcHQpIHsgcmV0dXJuIG5ldyBTQVhQYXJzZXIoc3RyaWN0LCBvcHQpIH0Kc2F4LlNBWFBhcnNlciA9IFNBWFBhcnNlcgpzYXguU0FYU3RyZWFtID0gU0FYU3RyZWFtCnNheC5jcmVhdGVTdHJlYW0gPSBjcmVhdGVTdHJlYW0KCi8vIFdoZW4gd2UgcGFzcyB0aGUgTUFYX0JVRkZFUl9MRU5HVEggcG9zaXRpb24sIHN0YXJ0IGNoZWNraW5nIGZvciBidWZmZXIgb3ZlcnJ1bnMuCi8vIFdoZW4gd2UgY2hlY2ssIHNjaGVkdWxlIHRoZSBuZXh0IGNoZWNrIGZvciBNQVhfQlVGRkVSX0xFTkdUSCAtIChtYXgoYnVmZmVyIGxlbmd0aHMpKSwKLy8gc2luY2UgdGhhdCdzIHRoZSBlYXJsaWVzdCB0aGF0IGEgYnVmZmVyIG92ZXJydW4gY291bGQgb2NjdXIuICBUaGlzIHdheSwgY2hlY2tzIGFyZQovLyBhcyByYXJlIGFzIHJlcXVpcmVkLCBidXQgYXMgb2Z0ZW4gYXMgbmVjZXNzYXJ5IHRvIGVuc3VyZSBuZXZlciBjcm9zc2luZyB0aGlzIGJvdW5kLgovLyBGdXJ0aGVybW9yZSwgYnVmZmVycyBhcmUgb25seSB0ZXN0ZWQgYXQgbW9zdCBvbmNlIHBlciB3cml0ZSgpLCBzbyBwYXNzaW5nIGEgdmVyeQovLyBsYXJnZSBzdHJpbmcgaW50byB3cml0ZSgpIG1pZ2h0IGhhdmUgdW5kZXNpcmFibGUgZWZmZWN0cywgYnV0IHRoaXMgaXMgbWFuYWdlYWJsZSBieQovLyB0aGUgY2FsbGVyLCBzbyBpdCBpcyBhc3N1bWVkIHRvIGJlIHNhZmUuICBUaHVzLCBhIGNhbGwgdG8gd3JpdGUoKSBtYXksIGluIHRoZSBleHRyZW1lCi8vIGVkZ2UgY2FzZSwgcmVzdWx0IGluIGNyZWF0aW5nIGF0IG1vc3Qgb25lIGNvbXBsZXRlIGNvcHkgb2YgdGhlIHN0cmluZyBwYXNzZWQgaW4uCi8vIFNldCB0byBJbmZpbml0eSB0byBoYXZlIHVubGltaXRlZCBidWZmZXJzLgpzYXguTUFYX0JVRkZFUl9MRU5HVEggPSA2NCAqIDEwMjQKCnZhciBidWZmZXJzID0gWwogICJjb21tZW50IiwgInNnbWxEZWNsIiwgInRleHROb2RlIiwgInRhZ05hbWUiLCAiZG9jdHlwZSIsCiAgInByb2NJbnN0TmFtZSIsICJwcm9jSW5zdEJvZHkiLCAiZW50aXR5IiwgImF0dHJpYk5hbWUiLAogICJhdHRyaWJWYWx1ZSIsICJjZGF0YSIsICJzY3JpcHQiCl0KCnNheC5FVkVOVFMgPSAvLyBmb3IgZGlzY292ZXJhYmlsaXR5LgogIFsgInRleHQiCiAgLCAicHJvY2Vzc2luZ2luc3RydWN0aW9uIgogICwgInNnbWxkZWNsYXJhdGlvbiIKICAsICJkb2N0eXBlIgogICwgImNvbW1lbnQiCiAgLCAiYXR0cmlidXRlIgogICwgIm9wZW50YWciCiAgLCAiY2xvc2V0YWciCiAgLCAib3BlbmNkYXRhIgogICwgImNkYXRhIgogICwgImNsb3NlY2RhdGEiCiAgLCAiZXJyb3IiCiAgLCAiZW5kIgogICwgInJlYWR5IgogICwgInNjcmlwdCIKICAsICJvcGVubmFtZXNwYWNlIgogICwgImNsb3NlbmFtZXNwYWNlIgogIF0KCmZ1bmN0aW9uIFNBWFBhcnNlciAoc3RyaWN0LCBvcHQpIHsKICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU0FYUGFyc2VyKSkgcmV0dXJuIG5ldyBTQVhQYXJzZXIoc3RyaWN0LCBvcHQpCgogIHZhciBwYXJzZXIgPSB0aGlzCiAgY2xlYXJCdWZmZXJzKHBhcnNlcikKICBwYXJzZXIucSA9IHBhcnNlci5jID0gIiIKICBwYXJzZXIuYnVmZmVyQ2hlY2tQb3NpdGlvbiA9IHNheC5NQVhfQlVGRkVSX0xFTkdUSAogIHBhcnNlci5vcHQgPSBvcHQgfHwge30KICBwYXJzZXIub3B0Lmxvd2VyY2FzZSA9IHBhcnNlci5vcHQubG93ZXJjYXNlIHx8IHBhcnNlci5vcHQubG93ZXJjYXNldGFncwogIHBhcnNlci5sb29zZUNhc2UgPSBwYXJzZXIub3B0Lmxvd2VyY2FzZSA/ICJ0b0xvd2VyQ2FzZSIgOiAidG9VcHBlckNhc2UiCiAgcGFyc2VyLnRhZ3MgPSBbXQogIHBhcnNlci5jbG9zZWQgPSBwYXJzZXIuY2xvc2VkUm9vdCA9IHBhcnNlci5zYXdSb290ID0gZmFsc2UKICBwYXJzZXIudGFnID0gcGFyc2VyLmVycm9yID0gbnVsbAogIHBhcnNlci5zdHJpY3QgPSAhIXN0cmljdAogIHBhcnNlci5ub3NjcmlwdCA9ICEhKHN0cmljdCB8fCBwYXJzZXIub3B0Lm5vc2NyaXB0KQogIHBhcnNlci5zdGF0ZSA9IFMuQkVHSU4KICBwYXJzZXIuRU5USVRJRVMgPSBPYmplY3QuY3JlYXRlKHNheC5FTlRJVElFUykKICBwYXJzZXIuYXR0cmliTGlzdCA9IFtdCgogIC8vIG5hbWVzcGFjZXMgZm9ybSBhIHByb3RvdHlwZSBjaGFpbi4KICAvLyBpdCBhbHdheXMgcG9pbnRzIGF0IHRoZSBjdXJyZW50IHRhZywKICAvLyB3aGljaCBwcm90b3MgdG8gaXRzIHBhcmVudCB0YWcuCiAgaWYgKHBhcnNlci5vcHQueG1sbnMpIHBhcnNlci5ucyA9IE9iamVjdC5jcmVhdGUocm9vdE5TKQoKICAvLyBtb3N0bHkganVzdCBmb3IgZXJyb3IgcmVwb3J0aW5nCiAgcGFyc2VyLnRyYWNrUG9zaXRpb24gPSBwYXJzZXIub3B0LnBvc2l0aW9uICE9PSBmYWxzZQogIGlmIChwYXJzZXIudHJhY2tQb3NpdGlvbikgewogICAgcGFyc2VyLnBvc2l0aW9uID0gcGFyc2VyLmxpbmUgPSBwYXJzZXIuY29sdW1uID0gMAogIH0KICBlbWl0KHBhcnNlciwgIm9ucmVhZHkiKQp9CgppZiAoIU9iamVjdC5jcmVhdGUpIE9iamVjdC5jcmVhdGUgPSBmdW5jdGlvbiAobykgewogIGZ1bmN0aW9uIGYgKCkgeyB0aGlzLl9fcHJvdG9fXyA9IG8gfQogIGYucHJvdG90eXBlID0gbwogIHJldHVybiBuZXcgZgp9CgppZiAoIU9iamVjdC5nZXRQcm90b3R5cGVPZikgT2JqZWN0LmdldFByb3RvdHlwZU9mID0gZnVuY3Rpb24gKG8pIHsKICByZXR1cm4gby5fX3Byb3RvX18KfQoKaWYgKCFPYmplY3Qua2V5cykgT2JqZWN0LmtleXMgPSBmdW5jdGlvbiAobykgewogIHZhciBhID0gW10KICBmb3IgKHZhciBpIGluIG8pIGlmIChvLmhhc093blByb3BlcnR5KGkpKSBhLnB1c2goaSkKICByZXR1cm4gYQp9CgpmdW5jdGlvbiBjaGVja0J1ZmZlckxlbmd0aCAocGFyc2VyKSB7CiAgdmFyIG1heEFsbG93ZWQgPSBNYXRoLm1heChzYXguTUFYX0JVRkZFUl9MRU5HVEgsIDEwKQogICAgLCBtYXhBY3R1YWwgPSAwCiAgZm9yICh2YXIgaSA9IDAsIGwgPSBidWZmZXJzLmxlbmd0aDsgaSA8IGw7IGkgKyspIHsKICAgIHZhciBsZW4gPSBwYXJzZXJbYnVmZmVyc1tpXV0ubGVuZ3RoCiAgICBpZiAobGVuID4gbWF4QWxsb3dlZCkgewogICAgICAvLyBUZXh0L2NkYXRhIG5vZGVzIGNhbiBnZXQgYmlnLCBhbmQgc2luY2UgdGhleSdyZSBidWZmZXJlZCwKICAgICAgLy8gd2UgY2FuIGdldCBoZXJlIHVuZGVyIG5vcm1hbCBjb25kaXRpb25zLgogICAgICAvLyBBdm9pZCBpc3N1ZXMgYnkgZW1pdHRpbmcgdGhlIHRleHQgbm9kZSBub3csCiAgICAgIC8vIHNvIGF0IGxlYXN0IGl0IHdvbid0IGdldCBhbnkgYmlnZ2VyLgogICAgICBzd2l0Y2ggKGJ1ZmZlcnNbaV0pIHsKICAgICAgICBjYXNlICJ0ZXh0Tm9kZSI6CiAgICAgICAgICBjbG9zZVRleHQocGFyc2VyKQogICAgICAgIGJyZWFrCgogICAgICAgIGNhc2UgImNkYXRhIjoKICAgICAgICAgIGVtaXROb2RlKHBhcnNlciwgIm9uY2RhdGEiLCBwYXJzZXIuY2RhdGEpCiAgICAgICAgICBwYXJzZXIuY2RhdGEgPSAiIgogICAgICAgIGJyZWFrCgogICAgICAgIGNhc2UgInNjcmlwdCI6CiAgICAgICAgICBlbWl0Tm9kZShwYXJzZXIsICJvbnNjcmlwdCIsIHBhcnNlci5zY3JpcHQpCiAgICAgICAgICBwYXJzZXIuc2NyaXB0ID0gIiIKICAgICAgICBicmVhawoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgZXJyb3IocGFyc2VyLCAiTWF4IGJ1ZmZlciBsZW5ndGggZXhjZWVkZWQ6ICIrYnVmZmVyc1tpXSkKICAgICAgfQogICAgfQogICAgbWF4QWN0dWFsID0gTWF0aC5tYXgobWF4QWN0dWFsLCBsZW4pCiAgfQogIC8vIHNjaGVkdWxlIHRoZSBuZXh0IGNoZWNrIGZvciB0aGUgZWFybGllc3QgcG9zc2libGUgYnVmZmVyIG92ZXJydW4uCiAgcGFyc2VyLmJ1ZmZlckNoZWNrUG9zaXRpb24gPSAoc2F4Lk1BWF9CVUZGRVJfTEVOR1RIIC0gbWF4QWN0dWFsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgcGFyc2VyLnBvc2l0aW9uCn0KCmZ1bmN0aW9uIGNsZWFyQnVmZmVycyAocGFyc2VyKSB7CiAgZm9yICh2YXIgaSA9IDAsIGwgPSBidWZmZXJzLmxlbmd0aDsgaSA8IGw7IGkgKyspIHsKICAgIHBhcnNlcltidWZmZXJzW2ldXSA9ICIiCiAgfQp9CgpmdW5jdGlvbiBmbHVzaEJ1ZmZlcnMgKHBhcnNlcikgewogIGNsb3NlVGV4dChwYXJzZXIpCiAgaWYgKHBhcnNlci5jZGF0YSAhPT0gIiIpIHsKICAgIGVtaXROb2RlKHBhcnNlciwgIm9uY2RhdGEiLCBwYXJzZXIuY2RhdGEpCiAgICBwYXJzZXIuY2RhdGEgPSAiIgogIH0KICBpZiAocGFyc2VyLnNjcmlwdCAhPT0gIiIpIHsKICAgIGVtaXROb2RlKHBhcnNlciwgIm9uc2NyaXB0IiwgcGFyc2VyLnNjcmlwdCkKICAgIHBhcnNlci5zY3JpcHQgPSAiIgogIH0KfQoKU0FYUGFyc2VyLnByb3RvdHlwZSA9CiAgeyBlbmQ6IGZ1bmN0aW9uICgpIHsgZW5kKHRoaXMpIH0KICAsIHdyaXRlOiB3cml0ZQogICwgcmVzdW1lOiBmdW5jdGlvbiAoKSB7IHRoaXMuZXJyb3IgPSBudWxsOyByZXR1cm4gdGhpcyB9CiAgLCBjbG9zZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy53cml0ZShudWxsKSB9CiAgLCBmbHVzaDogZnVuY3Rpb24gKCkgeyBmbHVzaEJ1ZmZlcnModGhpcykgfQogIH0KCnRyeSB7CiAgdmFyIFN0cmVhbSA9IHJlcXVpcmUoInN0cmVhbSIpLlN0cmVhbQp9IGNhdGNoIChleCkgewogIHZhciBTdHJlYW0gPSBmdW5jdGlvbiAoKSB7fQp9CgoKdmFyIHN0cmVhbVdyYXBzID0gc2F4LkVWRU5UUy5maWx0ZXIoZnVuY3Rpb24gKGV2KSB7CiAgcmV0dXJuIGV2ICE9PSAiZXJyb3IiICYmIGV2ICE9PSAiZW5kIgp9KQoKZnVuY3Rpb24gY3JlYXRlU3RyZWFtIChzdHJpY3QsIG9wdCkgewogIHJldHVybiBuZXcgU0FYU3RyZWFtKHN0cmljdCwgb3B0KQp9CgpmdW5jdGlvbiBTQVhTdHJlYW0gKHN0cmljdCwgb3B0KSB7CiAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNBWFN0cmVhbSkpIHJldHVybiBuZXcgU0FYU3RyZWFtKHN0cmljdCwgb3B0KQoKICBTdHJlYW0uYXBwbHkodGhpcykKCiAgdGhpcy5fcGFyc2VyID0gbmV3IFNBWFBhcnNlcihzdHJpY3QsIG9wdCkKICB0aGlzLndyaXRhYmxlID0gdHJ1ZQogIHRoaXMucmVhZGFibGUgPSB0cnVlCgoKICB2YXIgbWUgPSB0aGlzCgogIHRoaXMuX3BhcnNlci5vbmVuZCA9IGZ1bmN0aW9uICgpIHsKICAgIG1lLmVtaXQoImVuZCIpCiAgfQoKICB0aGlzLl9wYXJzZXIub25lcnJvciA9IGZ1bmN0aW9uIChlcikgewogICAgbWUuZW1pdCgiZXJyb3IiLCBlcikKCiAgICAvLyBpZiBkaWRuJ3QgdGhyb3csIHRoZW4gbWVhbnMgZXJyb3Igd2FzIGhhbmRsZWQuCiAgICAvLyBnbyBhaGVhZCBhbmQgY2xlYXIgZXJyb3IsIHNvIHdlIGNhbiB3cml0ZSBhZ2Fpbi4KICAgIG1lLl9wYXJzZXIuZXJyb3IgPSBudWxsCiAgfQoKICB0aGlzLl9kZWNvZGVyID0gbnVsbDsKCiAgc3RyZWFtV3JhcHMuZm9yRWFjaChmdW5jdGlvbiAoZXYpIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtZSwgIm9uIiArIGV2LCB7CiAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gbWUuX3BhcnNlclsib24iICsgZXZdIH0sCiAgICAgIHNldDogZnVuY3Rpb24gKGgpIHsKICAgICAgICBpZiAoIWgpIHsKICAgICAgICAgIG1lLnJlbW92ZUFsbExpc3RlbmVycyhldikKICAgICAgICAgIHJldHVybiBtZS5fcGFyc2VyWyJvbiIrZXZdID0gaAogICAgICAgIH0KICAgICAgICBtZS5vbihldiwgaCkKICAgICAgfSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiBmYWxzZQogICAgfSkKICB9KQp9CgpTQVhTdHJlYW0ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTdHJlYW0ucHJvdG90eXBlLAogIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IFNBWFN0cmVhbSB9IH0pCgpTQVhTdHJlYW0ucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24gKGRhdGEpIHsKICBpZiAodHlwZW9mIEJ1ZmZlciA9PT0gJ2Z1bmN0aW9uJyAmJgogICAgICB0eXBlb2YgQnVmZmVyLmlzQnVmZmVyID09PSAnZnVuY3Rpb24nICYmCiAgICAgIEJ1ZmZlci5pc0J1ZmZlcihkYXRhKSkgewogICAgaWYgKCF0aGlzLl9kZWNvZGVyKSB7CiAgICAgIHZhciBTRCA9IHJlcXVpcmUoJ3N0cmluZ19kZWNvZGVyJykuU3RyaW5nRGVjb2RlcgogICAgICB0aGlzLl9kZWNvZGVyID0gbmV3IFNEKCd1dGY4JykKICAgIH0KICAgIGRhdGEgPSB0aGlzLl9kZWNvZGVyLndyaXRlKGRhdGEpOwogIH0KCiAgdGhpcy5fcGFyc2VyLndyaXRlKGRhdGEudG9TdHJpbmcoKSkKICB0aGlzLmVtaXQoImRhdGEiLCBkYXRhKQogIHJldHVybiB0cnVlCn0KClNBWFN0cmVhbS5wcm90b3R5cGUuZW5kID0gZnVuY3Rpb24gKGNodW5rKSB7CiAgaWYgKGNodW5rICYmIGNodW5rLmxlbmd0aCkgdGhpcy53cml0ZShjaHVuaykKICB0aGlzLl9wYXJzZXIuZW5kKCkKICByZXR1cm4gdHJ1ZQp9CgpTQVhTdHJlYW0ucHJvdG90eXBlLm9uID0gZnVuY3Rpb24gKGV2LCBoYW5kbGVyKSB7CiAgdmFyIG1lID0gdGhpcwogIGlmICghbWUuX3BhcnNlclsib24iK2V2XSAmJiBzdHJlYW1XcmFwcy5pbmRleE9mKGV2KSAhPT0gLTEpIHsKICAgIG1lLl9wYXJzZXJbIm9uIitldl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzLmxlbmd0aCA9PT0gMSA/IFthcmd1bWVudHNbMF1dCiAgICAgICAgICAgICAgIDogQXJyYXkuYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgICBhcmdzLnNwbGljZSgwLCAwLCBldikKICAgICAgbWUuZW1pdC5hcHBseShtZSwgYXJncykKICAgIH0KICB9CgogIHJldHVybiBTdHJlYW0ucHJvdG90eXBlLm9uLmNhbGwobWUsIGV2LCBoYW5kbGVyKQp9CgoKCi8vIGNoYXJhY3RlciBjbGFzc2VzIGFuZCB0b2tlbnMKdmFyIHdoaXRlc3BhY2UgPSAiXHJcblx0ICIKICAvLyB0aGlzIHJlYWxseSBuZWVkcyB0byBiZSByZXBsYWNlZCB3aXRoIGNoYXJhY3RlciBjbGFzc2VzLgogIC8vIFhNTCBhbGxvd3MgYWxsIG1hbm5lciBvZiByaWRpY3Vsb3VzIG51bWJlcnMgYW5kIGRpZ2l0cy4KICAsIG51bWJlciA9ICIwMTI0MzU2Nzg5IgogICwgbGV0dGVyID0gImFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVoiCiAgLy8gKExldHRlciB8ICJfIiB8ICI6IikKICAsIHF1b3RlID0gIidcIiIKICAsIGVudGl0eSA9IG51bWJlcitsZXR0ZXIrIiMiCiAgLCBhdHRyaWJFbmQgPSB3aGl0ZXNwYWNlICsgIj4iCiAgLCBDREFUQSA9ICJbQ0RBVEFbIgogICwgRE9DVFlQRSA9ICJET0NUWVBFIgogICwgWE1MX05BTUVTUEFDRSA9ICJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UiCiAgLCBYTUxOU19OQU1FU1BBQ0UgPSAiaHR0cDovL3d3dy53My5vcmcvMjAwMC94bWxucy8iCiAgLCByb290TlMgPSB7IHhtbDogWE1MX05BTUVTUEFDRSwgeG1sbnM6IFhNTE5TX05BTUVTUEFDRSB9CgovLyB0dXJuIGFsbCB0aGUgc3RyaW5nIGNoYXJhY3RlciBzZXRzIGludG8gY2hhcmFjdGVyIGNsYXNzIG9iamVjdHMuCndoaXRlc3BhY2UgPSBjaGFyQ2xhc3Mod2hpdGVzcGFjZSkKbnVtYmVyID0gY2hhckNsYXNzKG51bWJlcikKbGV0dGVyID0gY2hhckNsYXNzKGxldHRlcikKCi8vIGh0dHA6Ly93d3cudzMub3JnL1RSL1JFQy14bWwvI05ULU5hbWVTdGFydENoYXIKLy8gVGhpcyBpbXBsZW1lbnRhdGlvbiB3b3JrcyBvbiBzdHJpbmdzLCBhIHNpbmdsZSBjaGFyYWN0ZXIgYXQgYSB0aW1lCi8vIGFzIHN1Y2gsIGl0IGNhbm5vdCBldmVyIHN1cHBvcnQgYXN0cmFsLXBsYW5lIGNoYXJhY3RlcnMgKDEwMDAwLUVGRkZGKQovLyB3aXRob3V0IGEgc2lnbmlmaWNhbnQgYnJlYWtpbmcgY2hhbmdlIHRvIGVpdGhlciB0aGlzICBwYXJzZXIsIG9yIHRoZQovLyBKYXZhU2NyaXB0IGxhbmd1YWdlLiAgSW1wbGVtZW50YXRpb24gb2YgYW4gZW1vamktY2FwYWJsZSB4bWwgcGFyc2VyCi8vIGlzIGxlZnQgYXMgYW4gZXhlcmNpc2UgZm9yIHRoZSByZWFkZXIuCnZhciBuYW1lU3RhcnQgPSAvWzpfQS1aYS16XHUwMEMwLVx1MDBENlx1MDBEOC1cdTAwRjZcdTAwRjgtXHUwMkZGXHUwMzcwLVx1MDM3RFx1MDM3Ri1cdTFGRkZcdTIwMEMtXHUyMDBEXHUyMDcwLVx1MjE4Rlx1MkMwMC1cdTJGRUZcdTMwMDEtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRkRdLwoKdmFyIG5hbWVCb2R5ID0gL1s6X0EtWmEtelx1MDBDMC1cdTAwRDZcdTAwRDgtXHUwMEY2XHUwMEY4LVx1MDJGRlx1MDM3MC1cdTAzN0RcdTAzN0YtXHUxRkZGXHUyMDBDLVx1MjAwRFx1MjA3MC1cdTIxOEZcdTJDMDAtXHUyRkVGXHUzMDAxLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkZEXHUwMEI3XHUwMzAwLVx1MDM2Rlx1MjAzRi1cdTIwNDBcLlxkLV0vCgpxdW90ZSA9IGNoYXJDbGFzcyhxdW90ZSkKZW50aXR5ID0gY2hhckNsYXNzKGVudGl0eSkKYXR0cmliRW5kID0gY2hhckNsYXNzKGF0dHJpYkVuZCkKCmZ1bmN0aW9uIGNoYXJDbGFzcyAoc3RyKSB7CiAgcmV0dXJuIHN0ci5zcGxpdCgiIikucmVkdWNlKGZ1bmN0aW9uIChzLCBjKSB7CiAgICBzW2NdID0gdHJ1ZQogICAgcmV0dXJuIHMKICB9LCB7fSkKfQoKZnVuY3Rpb24gaXNSZWdFeHAgKGMpIHsKICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGMpID09PSAnW29iamVjdCBSZWdFeHBdJwp9CgpmdW5jdGlvbiBpcyAoY2hhcmNsYXNzLCBjKSB7CiAgcmV0dXJuIGlzUmVnRXhwKGNoYXJjbGFzcykgPyAhIWMubWF0Y2goY2hhcmNsYXNzKSA6IGNoYXJjbGFzc1tjXQp9CgpmdW5jdGlvbiBub3QgKGNoYXJjbGFzcywgYykgewogIHJldHVybiAhaXMoY2hhcmNsYXNzLCBjKQp9Cgp2YXIgUyA9IDAKc2F4LlNUQVRFID0KeyBCRUdJTiAgICAgICAgICAgICAgICAgICAgIDogUysrCiwgVEVYVCAgICAgICAgICAgICAgICAgICAgICA6IFMrKyAvLyBnZW5lcmFsIHN0dWZmCiwgVEVYVF9FTlRJVFkgICAgICAgICAgICAgICA6IFMrKyAvLyAmYW1wIGFuZCBzdWNoLgosIE9QRU5fV0FLQSAgICAgICAgICAgICAgICAgOiBTKysgLy8gPAosIFNHTUxfREVDTCAgICAgICAgICAgICAgICAgOiBTKysgLy8gPCFCTEFSRwosIFNHTUxfREVDTF9RVU9URUQgICAgICAgICAgOiBTKysgLy8gPCFCTEFSRyBmb28gImJhcgosIERPQ1RZUEUgICAgICAgICAgICAgICAgICAgOiBTKysgLy8gPCFET0NUWVBFCiwgRE9DVFlQRV9RVU9URUQgICAgICAgICAgICA6IFMrKyAvLyA8IURPQ1RZUEUgIi8vYmxhaAosIERPQ1RZUEVfRFREICAgICAgICAgICAgICAgOiBTKysgLy8gPCFET0NUWVBFICIvL2JsYWgiIFsgLi4uCiwgRE9DVFlQRV9EVERfUVVPVEVEICAgICAgICA6IFMrKyAvLyA8IURPQ1RZUEUgIi8vYmxhaCIgWyAiZm9vCiwgQ09NTUVOVF9TVEFSVElORyAgICAgICAgICA6IFMrKyAvLyA8IS0KLCBDT01NRU5UICAgICAgICAgICAgICAgICAgIDogUysrIC8vIDwhLS0KLCBDT01NRU5UX0VORElORyAgICAgICAgICAgIDogUysrIC8vIDwhLS0gYmxhaCAtCiwgQ09NTUVOVF9FTkRFRCAgICAgICAgICAgICA6IFMrKyAvLyA8IS0tIGJsYWggLS0KLCBDREFUQSAgICAgICAgICAgICAgICAgICAgIDogUysrIC8vIDwhW0NEQVRBWyBzb21ldGhpbmcKLCBDREFUQV9FTkRJTkcgICAgICAgICAgICAgIDogUysrIC8vIF0KLCBDREFUQV9FTkRJTkdfMiAgICAgICAgICAgIDogUysrIC8vIF1dCiwgUFJPQ19JTlNUICAgICAgICAgICAgICAgICA6IFMrKyAvLyA8P2hpCiwgUFJPQ19JTlNUX0JPRFkgICAgICAgICAgICA6IFMrKyAvLyA8P2hpIHRoZXJlCiwgUFJPQ19JTlNUX0VORElORyAgICAgICAgICA6IFMrKyAvLyA8P2hpICJ0aGVyZSIgPwosIE9QRU5fVEFHICAgICAgICAgICAgICAgICAgOiBTKysgLy8gPHN0cm9uZwosIE9QRU5fVEFHX1NMQVNIICAgICAgICAgICAgOiBTKysgLy8gPHN0cm9uZyAvCiwgQVRUUklCICAgICAgICAgICAgICAgICAgICA6IFMrKyAvLyA8YQosIEFUVFJJQl9OQU1FICAgICAgICAgICAgICAgOiBTKysgLy8gPGEgZm9vCiwgQVRUUklCX05BTUVfU0FXX1dISVRFICAgICA6IFMrKyAvLyA8YSBmb28gXwosIEFUVFJJQl9WQUxVRSAgICAgICAgICAgICAgOiBTKysgLy8gPGEgZm9vPQosIEFUVFJJQl9WQUxVRV9RVU9URUQgICAgICAgOiBTKysgLy8gPGEgZm9vPSJiYXIKLCBBVFRSSUJfVkFMVUVfQ0xPU0VEICAgICAgIDogUysrIC8vIDxhIGZvbz0iYmFyIgosIEFUVFJJQl9WQUxVRV9VTlFVT1RFRCAgICAgOiBTKysgLy8gPGEgZm9vPWJhcgosIEFUVFJJQl9WQUxVRV9FTlRJVFlfUSAgICAgOiBTKysgLy8gPGZvbyBiYXI9IiZxdW90OyIKLCBBVFRSSUJfVkFMVUVfRU5USVRZX1UgICAgIDogUysrIC8vIDxmb28gYmFyPSZxdW90OwosIENMT1NFX1RBRyAgICAgICAgICAgICAgICAgOiBTKysgLy8gPC9hCiwgQ0xPU0VfVEFHX1NBV19XSElURSAgICAgICA6IFMrKyAvLyA8L2EgICA+CiwgU0NSSVBUICAgICAgICAgICAgICAgICAgICA6IFMrKyAvLyA8c2NyaXB0PiAuLi4KLCBTQ1JJUFRfRU5ESU5HICAgICAgICAgICAgIDogUysrIC8vIDxzY3JpcHQ+IC4uLiA8Cn0KCnNheC5FTlRJVElFUyA9CnsgImFtcCIgOiAiJiIKLCAiZ3QiIDogIj4iCiwgImx0IiA6ICI8IgosICJxdW90IiA6ICJcIiIKLCAiYXBvcyIgOiAiJyIKLCAiQUVsaWciIDogMTk4CiwgIkFhY3V0ZSIgOiAxOTMKLCAiQWNpcmMiIDogMTk0CiwgIkFncmF2ZSIgOiAxOTIKLCAiQXJpbmciIDogMTk3CiwgIkF0aWxkZSIgOiAxOTUKLCAiQXVtbCIgOiAxOTYKLCAiQ2NlZGlsIiA6IDE5OQosICJFVEgiIDogMjA4CiwgIkVhY3V0ZSIgOiAyMDEKLCAiRWNpcmMiIDogMjAyCiwgIkVncmF2ZSIgOiAyMDAKLCAiRXVtbCIgOiAyMDMKLCAiSWFjdXRlIiA6IDIwNQosICJJY2lyYyIgOiAyMDYKLCAiSWdyYXZlIiA6IDIwNAosICJJdW1sIiA6IDIwNwosICJOdGlsZGUiIDogMjA5CiwgIk9hY3V0ZSIgOiAyMTEKLCAiT2NpcmMiIDogMjEyCiwgIk9ncmF2ZSIgOiAyMTAKLCAiT3NsYXNoIiA6IDIxNgosICJPdGlsZGUiIDogMjEzCiwgIk91bWwiIDogMjE0CiwgIlRIT1JOIiA6IDIyMgosICJVYWN1dGUiIDogMjE4CiwgIlVjaXJjIiA6IDIxOQosICJVZ3JhdmUiIDogMjE3CiwgIlV1bWwiIDogMjIwCiwgIllhY3V0ZSIgOiAyMjEKLCAiYWFjdXRlIiA6IDIyNQosICJhY2lyYyIgOiAyMjYKLCAiYWVsaWciIDogMjMwCiwgImFncmF2ZSIgOiAyMjQKLCAiYXJpbmciIDogMjI5CiwgImF0aWxkZSIgOiAyMjcKLCAiYXVtbCIgOiAyMjgKLCAiY2NlZGlsIiA6IDIzMQosICJlYWN1dGUiIDogMjMzCiwgImVjaXJjIiA6IDIzNAosICJlZ3JhdmUiIDogMjMyCiwgImV0aCIgOiAyNDAKLCAiZXVtbCIgOiAyMzUKLCAiaWFjdXRlIiA6IDIzNwosICJpY2lyYyIgOiAyMzgKLCAiaWdyYXZlIiA6IDIzNgosICJpdW1sIiA6IDIzOQosICJudGlsZGUiIDogMjQxCiwgIm9hY3V0ZSIgOiAyNDMKLCAib2NpcmMiIDogMjQ0CiwgIm9ncmF2ZSIgOiAyNDIKLCAib3NsYXNoIiA6IDI0OAosICJvdGlsZGUiIDogMjQ1CiwgIm91bWwiIDogMjQ2CiwgInN6bGlnIiA6IDIyMwosICJ0aG9ybiIgOiAyNTQKLCAidWFjdXRlIiA6IDI1MAosICJ1Y2lyYyIgOiAyNTEKLCAidWdyYXZlIiA6IDI0OQosICJ1dW1sIiA6IDI1MgosICJ5YWN1dGUiIDogMjUzCiwgInl1bWwiIDogMjU1CiwgImNvcHkiIDogMTY5CiwgInJlZyIgOiAxNzQKLCAibmJzcCIgOiAxNjAKLCAiaWV4Y2wiIDogMTYxCiwgImNlbnQiIDogMTYyCiwgInBvdW5kIiA6IDE2MwosICJjdXJyZW4iIDogMTY0CiwgInllbiIgOiAxNjUKLCAiYnJ2YmFyIiA6IDE2NgosICJzZWN0IiA6IDE2NwosICJ1bWwiIDogMTY4CiwgIm9yZGYiIDogMTcwCiwgImxhcXVvIiA6IDE3MQosICJub3QiIDogMTcyCiwgInNoeSIgOiAxNzMKLCAibWFjciIgOiAxNzUKLCAiZGVnIiA6IDE3NgosICJwbHVzbW4iIDogMTc3CiwgInN1cDEiIDogMTg1CiwgInN1cDIiIDogMTc4CiwgInN1cDMiIDogMTc5CiwgImFjdXRlIiA6IDE4MAosICJtaWNybyIgOiAxODEKLCAicGFyYSIgOiAxODIKLCAibWlkZG90IiA6IDE4MwosICJjZWRpbCIgOiAxODQKLCAib3JkbSIgOiAxODYKLCAicmFxdW8iIDogMTg3CiwgImZyYWMxNCIgOiAxODgKLCAiZnJhYzEyIiA6IDE4OQosICJmcmFjMzQiIDogMTkwCiwgImlxdWVzdCIgOiAxOTEKLCAidGltZXMiIDogMjE1CiwgImRpdmlkZSIgOiAyNDcKLCAiT0VsaWciIDogMzM4CiwgIm9lbGlnIiA6IDMzOQosICJTY2Fyb24iIDogMzUyCiwgInNjYXJvbiIgOiAzNTMKLCAiWXVtbCIgOiAzNzYKLCAiZm5vZiIgOiA0MDIKLCAiY2lyYyIgOiA3MTAKLCAidGlsZGUiIDogNzMyCiwgIkFscGhhIiA6IDkxMwosICJCZXRhIiA6IDkxNAosICJHYW1tYSIgOiA5MTUKLCAiRGVsdGEiIDogOTE2CiwgIkVwc2lsb24iIDogOTE3CiwgIlpldGEiIDogOTE4CiwgIkV0YSIgOiA5MTkKLCAiVGhldGEiIDogOTIwCiwgIklvdGEiIDogOTIxCiwgIkthcHBhIiA6IDkyMgosICJMYW1iZGEiIDogOTIzCiwgIk11IiA6IDkyNAosICJOdSIgOiA5MjUKLCAiWGkiIDogOTI2CiwgIk9taWNyb24iIDogOTI3CiwgIlBpIiA6IDkyOAosICJSaG8iIDogOTI5CiwgIlNpZ21hIiA6IDkzMQosICJUYXUiIDogOTMyCiwgIlVwc2lsb24iIDogOTMzCiwgIlBoaSIgOiA5MzQKLCAiQ2hpIiA6IDkzNQosICJQc2kiIDogOTM2CiwgIk9tZWdhIiA6IDkzNwosICJhbHBoYSIgOiA5NDUKLCAiYmV0YSIgOiA5NDYKLCAiZ2FtbWEiIDogOTQ3CiwgImRlbHRhIiA6IDk0OAosICJlcHNpbG9uIiA6IDk0OQosICJ6ZXRhIiA6IDk1MAosICJldGEiIDogOTUxCiwgInRoZXRhIiA6IDk1MgosICJpb3RhIiA6IDk1MwosICJrYXBwYSIgOiA5NTQKLCAibGFtYmRhIiA6IDk1NQosICJtdSIgOiA5NTYKLCAibnUiIDogOTU3CiwgInhpIiA6IDk1OAosICJvbWljcm9uIiA6IDk1OQosICJwaSIgOiA5NjAKLCAicmhvIiA6IDk2MQosICJzaWdtYWYiIDogOTYyCiwgInNpZ21hIiA6IDk2MwosICJ0YXUiIDogOTY0CiwgInVwc2lsb24iIDogOTY1CiwgInBoaSIgOiA5NjYKLCAiY2hpIiA6IDk2NwosICJwc2kiIDogOTY4CiwgIm9tZWdhIiA6IDk2OQosICJ0aGV0YXN5bSIgOiA5NzcKLCAidXBzaWgiIDogOTc4CiwgInBpdiIgOiA5ODIKLCAiZW5zcCIgOiA4MTk0CiwgImVtc3AiIDogODE5NQosICJ0aGluc3AiIDogODIwMQosICJ6d25qIiA6IDgyMDQKLCAiendqIiA6IDgyMDUKLCAibHJtIiA6IDgyMDYKLCAicmxtIiA6IDgyMDcKLCAibmRhc2giIDogODIxMQosICJtZGFzaCIgOiA4MjEyCiwgImxzcXVvIiA6IDgyMTYKLCAicnNxdW8iIDogODIxNwosICJzYnF1byIgOiA4MjE4CiwgImxkcXVvIiA6IDgyMjAKLCAicmRxdW8iIDogODIyMQosICJiZHF1byIgOiA4MjIyCiwgImRhZ2dlciIgOiA4MjI0CiwgIkRhZ2dlciIgOiA4MjI1CiwgImJ1bGwiIDogODIyNgosICJoZWxsaXAiIDogODIzMAosICJwZXJtaWwiIDogODI0MAosICJwcmltZSIgOiA4MjQyCiwgIlByaW1lIiA6IDgyNDMKLCAibHNhcXVvIiA6IDgyNDkKLCAicnNhcXVvIiA6IDgyNTAKLCAib2xpbmUiIDogODI1NAosICJmcmFzbCIgOiA4MjYwCiwgImV1cm8iIDogODM2NAosICJpbWFnZSIgOiA4NDY1CiwgIndlaWVycCIgOiA4NDcyCiwgInJlYWwiIDogODQ3NgosICJ0cmFkZSIgOiA4NDgyCiwgImFsZWZzeW0iIDogODUwMQosICJsYXJyIiA6IDg1OTIKLCAidWFyciIgOiA4NTkzCiwgInJhcnIiIDogODU5NAosICJkYXJyIiA6IDg1OTUKLCAiaGFyciIgOiA4NTk2CiwgImNyYXJyIiA6IDg2MjkKLCAibEFyciIgOiA4NjU2CiwgInVBcnIiIDogODY1NwosICJyQXJyIiA6IDg2NTgKLCAiZEFyciIgOiA4NjU5CiwgImhBcnIiIDogODY2MAosICJmb3JhbGwiIDogODcwNAosICJwYXJ0IiA6IDg3MDYKLCAiZXhpc3QiIDogODcwNwosICJlbXB0eSIgOiA4NzA5CiwgIm5hYmxhIiA6IDg3MTEKLCAiaXNpbiIgOiA4NzEyCiwgIm5vdGluIiA6IDg3MTMKLCAibmkiIDogODcxNQosICJwcm9kIiA6IDg3MTkKLCAic3VtIiA6IDg3MjEKLCAibWludXMiIDogODcyMgosICJsb3dhc3QiIDogODcyNwosICJyYWRpYyIgOiA4NzMwCiwgInByb3AiIDogODczMwosICJpbmZpbiIgOiA4NzM0CiwgImFuZyIgOiA4NzM2CiwgImFuZCIgOiA4NzQzCiwgIm9yIiA6IDg3NDQKLCAiY2FwIiA6IDg3NDUKLCAiY3VwIiA6IDg3NDYKLCAiaW50IiA6IDg3NDcKLCAidGhlcmU0IiA6IDg3NTYKLCAic2ltIiA6IDg3NjQKLCAiY29uZyIgOiA4NzczCiwgImFzeW1wIiA6IDg3NzYKLCAibmUiIDogODgwMAosICJlcXVpdiIgOiA4ODAxCiwgImxlIiA6IDg4MDQKLCAiZ2UiIDogODgwNQosICJzdWIiIDogODgzNAosICJzdXAiIDogODgzNQosICJuc3ViIiA6IDg4MzYKLCAic3ViZSIgOiA4ODM4CiwgInN1cGUiIDogODgzOQosICJvcGx1cyIgOiA4ODUzCiwgIm90aW1lcyIgOiA4ODU1CiwgInBlcnAiIDogODg2OQosICJzZG90IiA6IDg5MDEKLCAibGNlaWwiIDogODk2OAosICJyY2VpbCIgOiA4OTY5CiwgImxmbG9vciIgOiA4OTcwCiwgInJmbG9vciIgOiA4OTcxCiwgImxhbmciIDogOTAwMQosICJyYW5nIiA6IDkwMDIKLCAibG96IiA6IDk2NzQKLCAic3BhZGVzIiA6IDk4MjQKLCAiY2x1YnMiIDogOTgyNwosICJoZWFydHMiIDogOTgyOQosICJkaWFtcyIgOiA5ODMwCn0KCk9iamVjdC5rZXlzKHNheC5FTlRJVElFUykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICB2YXIgZSA9IHNheC5FTlRJVElFU1trZXldCiAgICB2YXIgcyA9IHR5cGVvZiBlID09PSAnbnVtYmVyJyA/IFN0cmluZy5mcm9tQ2hhckNvZGUoZSkgOiBlCiAgICBzYXguRU5USVRJRVNba2V5XSA9IHMKfSkKCmZvciAodmFyIFMgaW4gc2F4LlNUQVRFKSBzYXguU1RBVEVbc2F4LlNUQVRFW1NdXSA9IFMKCi8vIHNob3J0aGFuZApTID0gc2F4LlNUQVRFCgpmdW5jdGlvbiBlbWl0IChwYXJzZXIsIGV2ZW50LCBkYXRhKSB7CiAgcGFyc2VyW2V2ZW50XSAmJiBwYXJzZXJbZXZlbnRdKGRhdGEpCn0KCmZ1bmN0aW9uIGVtaXROb2RlIChwYXJzZXIsIG5vZGVUeXBlLCBkYXRhKSB7CiAgaWYgKHBhcnNlci50ZXh0Tm9kZSkgY2xvc2VUZXh0KHBhcnNlcikKICBlbWl0KHBhcnNlciwgbm9kZVR5cGUsIGRhdGEpCn0KCmZ1bmN0aW9uIGNsb3NlVGV4dCAocGFyc2VyKSB7CiAgcGFyc2VyLnRleHROb2RlID0gdGV4dG9wdHMocGFyc2VyLm9wdCwgcGFyc2VyLnRleHROb2RlKQogIGlmIChwYXJzZXIudGV4dE5vZGUpIGVtaXQocGFyc2VyLCAib250ZXh0IiwgcGFyc2VyLnRleHROb2RlKQogIHBhcnNlci50ZXh0Tm9kZSA9ICIiCn0KCmZ1bmN0aW9uIHRleHRvcHRzIChvcHQsIHRleHQpIHsKICBpZiAob3B0LnRyaW0pIHRleHQgPSB0ZXh0LnRyaW0oKQogIGlmIChvcHQubm9ybWFsaXplKSB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9ccysvZywgIiAiKQogIHJldHVybiB0ZXh0Cn0KCmZ1bmN0aW9uIGVycm9yIChwYXJzZXIsIGVyKSB7CiAgY2xvc2VUZXh0KHBhcnNlcikKICBpZiAocGFyc2VyLnRyYWNrUG9zaXRpb24pIHsKICAgIGVyICs9ICJcbkxpbmU6ICIrcGFyc2VyLmxpbmUrCiAgICAgICAgICAiXG5Db2x1bW46ICIrcGFyc2VyLmNvbHVtbisKICAgICAgICAgICJcbkNoYXI6ICIrcGFyc2VyLmMKICB9CiAgZXIgPSBuZXcgRXJyb3IoZXIpCiAgcGFyc2VyLmVycm9yID0gZXIKICBlbWl0KHBhcnNlciwgIm9uZXJyb3IiLCBlcikKICByZXR1cm4gcGFyc2VyCn0KCmZ1bmN0aW9uIGVuZCAocGFyc2VyKSB7CiAgaWYgKCFwYXJzZXIuY2xvc2VkUm9vdCkgc3RyaWN0RmFpbChwYXJzZXIsICJVbmNsb3NlZCByb290IHRhZyIpCiAgaWYgKChwYXJzZXIuc3RhdGUgIT09IFMuQkVHSU4pICYmIChwYXJzZXIuc3RhdGUgIT09IFMuVEVYVCkpIGVycm9yKHBhcnNlciwgIlVuZXhwZWN0ZWQgZW5kIikKICBjbG9zZVRleHQocGFyc2VyKQogIHBhcnNlci5jID0gIiIKICBwYXJzZXIuY2xvc2VkID0gdHJ1ZQogIGVtaXQocGFyc2VyLCAib25lbmQiKQogIFNBWFBhcnNlci5jYWxsKHBhcnNlciwgcGFyc2VyLnN0cmljdCwgcGFyc2VyLm9wdCkKICByZXR1cm4gcGFyc2VyCn0KCmZ1bmN0aW9uIHN0cmljdEZhaWwgKHBhcnNlciwgbWVzc2FnZSkgewogIGlmICh0eXBlb2YgcGFyc2VyICE9PSAnb2JqZWN0JyB8fCAhKHBhcnNlciBpbnN0YW5jZW9mIFNBWFBhcnNlcikpCiAgICB0aHJvdyBuZXcgRXJyb3IoJ2JhZCBjYWxsIHRvIHN0cmljdEZhaWwnKTsKICBpZiAocGFyc2VyLnN0cmljdCkgZXJyb3IocGFyc2VyLCBtZXNzYWdlKQp9CgpmdW5jdGlvbiBuZXdUYWcgKHBhcnNlcikgewogIGlmICghcGFyc2VyLnN0cmljdCkgcGFyc2VyLnRhZ05hbWUgPSBwYXJzZXIudGFnTmFtZVtwYXJzZXIubG9vc2VDYXNlXSgpCiAgdmFyIHBhcmVudCA9IHBhcnNlci50YWdzW3BhcnNlci50YWdzLmxlbmd0aCAtIDFdIHx8IHBhcnNlcgogICAgLCB0YWcgPSBwYXJzZXIudGFnID0geyBuYW1lIDogcGFyc2VyLnRhZ05hbWUsIGF0dHJpYnV0ZXMgOiB7fSB9CgogIC8vIHdpbGwgYmUgb3ZlcnJpZGRlbiBpZiB0YWcgY29udGFpbHMgYW4geG1sbnM9ImZvbyIgb3IgeG1sbnM6Zm9vPSJiYXIiCiAgaWYgKHBhcnNlci5vcHQueG1sbnMpIHRhZy5ucyA9IHBhcmVudC5ucwogIHBhcnNlci5hdHRyaWJMaXN0Lmxlbmd0aCA9IDAKfQoKZnVuY3Rpb24gcW5hbWUgKG5hbWUsIGF0dHJpYnV0ZSkgewogIHZhciBpID0gbmFtZS5pbmRleE9mKCI6IikKICAgICwgcXVhbE5hbWUgPSBpIDwgMCA/IFsgIiIsIG5hbWUgXSA6IG5hbWUuc3BsaXQoIjoiKQogICAgLCBwcmVmaXggPSBxdWFsTmFtZVswXQogICAgLCBsb2NhbCA9IHF1YWxOYW1lWzFdCgogIC8vIDx4ICJ4bWxucyI9Imh0dHA6Ly9mb28iPgogIGlmIChhdHRyaWJ1dGUgJiYgbmFtZSA9PT0gInhtbG5zIikgewogICAgcHJlZml4ID0gInhtbG5zIgogICAgbG9jYWwgPSAiIgogIH0KCiAgcmV0dXJuIHsgcHJlZml4OiBwcmVmaXgsIGxvY2FsOiBsb2NhbCB9Cn0KCmZ1bmN0aW9uIGF0dHJpYiAocGFyc2VyKSB7CiAgaWYgKCFwYXJzZXIuc3RyaWN0KSBwYXJzZXIuYXR0cmliTmFtZSA9IHBhcnNlci5hdHRyaWJOYW1lW3BhcnNlci5sb29zZUNhc2VdKCkKCiAgaWYgKHBhcnNlci5hdHRyaWJMaXN0LmluZGV4T2YocGFyc2VyLmF0dHJpYk5hbWUpICE9PSAtMSB8fAogICAgICBwYXJzZXIudGFnLmF0dHJpYnV0ZXMuaGFzT3duUHJvcGVydHkocGFyc2VyLmF0dHJpYk5hbWUpKSB7CiAgICByZXR1cm4gcGFyc2VyLmF0dHJpYk5hbWUgPSBwYXJzZXIuYXR0cmliVmFsdWUgPSAiIgogIH0KCiAgaWYgKHBhcnNlci5vcHQueG1sbnMpIHsKICAgIHZhciBxbiA9IHFuYW1lKHBhcnNlci5hdHRyaWJOYW1lLCB0cnVlKQogICAgICAsIHByZWZpeCA9IHFuLnByZWZpeAogICAgICAsIGxvY2FsID0gcW4ubG9jYWwKCiAgICBpZiAocHJlZml4ID09PSAieG1sbnMiKSB7CiAgICAgIC8vIG5hbWVzcGFjZSBiaW5kaW5nIGF0dHJpYnV0ZTsgcHVzaCB0aGUgYmluZGluZyBpbnRvIHNjb3BlCiAgICAgIGlmIChsb2NhbCA9PT0gInhtbCIgJiYgcGFyc2VyLmF0dHJpYlZhbHVlICE9PSBYTUxfTkFNRVNQQUNFKSB7CiAgICAgICAgc3RyaWN0RmFpbCggcGFyc2VyCiAgICAgICAgICAgICAgICAgICwgInhtbDogcHJlZml4IG11c3QgYmUgYm91bmQgdG8gIiArIFhNTF9OQU1FU1BBQ0UgKyAiXG4iCiAgICAgICAgICAgICAgICAgICsgIkFjdHVhbDogIiArIHBhcnNlci5hdHRyaWJWYWx1ZSApCiAgICAgIH0gZWxzZSBpZiAobG9jYWwgPT09ICJ4bWxucyIgJiYgcGFyc2VyLmF0dHJpYlZhbHVlICE9PSBYTUxOU19OQU1FU1BBQ0UpIHsKICAgICAgICBzdHJpY3RGYWlsKCBwYXJzZXIKICAgICAgICAgICAgICAgICAgLCAieG1sbnM6IHByZWZpeCBtdXN0IGJlIGJvdW5kIHRvICIgKyBYTUxOU19OQU1FU1BBQ0UgKyAiXG4iCiAgICAgICAgICAgICAgICAgICsgIkFjdHVhbDogIiArIHBhcnNlci5hdHRyaWJWYWx1ZSApCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHRhZyA9IHBhcnNlci50YWcKICAgICAgICAgICwgcGFyZW50ID0gcGFyc2VyLnRhZ3NbcGFyc2VyLnRhZ3MubGVuZ3RoIC0gMV0gfHwgcGFyc2VyCiAgICAgICAgaWYgKHRhZy5ucyA9PT0gcGFyZW50Lm5zKSB7CiAgICAgICAgICB0YWcubnMgPSBPYmplY3QuY3JlYXRlKHBhcmVudC5ucykKICAgICAgICB9CiAgICAgICAgdGFnLm5zW2xvY2FsXSA9IHBhcnNlci5hdHRyaWJWYWx1ZQogICAgICB9CiAgICB9CgogICAgLy8gZGVmZXIgb25hdHRyaWJ1dGUgZXZlbnRzIHVudGlsIGFsbCBhdHRyaWJ1dGVzIGhhdmUgYmVlbiBzZWVuCiAgICAvLyBzbyBhbnkgbmV3IGJpbmRpbmdzIGNhbiB0YWtlIGVmZmVjdDsgcHJlc2VydmUgYXR0cmlidXRlIG9yZGVyCiAgICAvLyBzbyBkZWZlcnJlZCBldmVudHMgY2FuIGJlIGVtaXR0ZWQgaW4gZG9jdW1lbnQgb3JkZXIKICAgIHBhcnNlci5hdHRyaWJMaXN0LnB1c2goW3BhcnNlci5hdHRyaWJOYW1lLCBwYXJzZXIuYXR0cmliVmFsdWVdKQogIH0gZWxzZSB7CiAgICAvLyBpbiBub24teG1sbnMgbW9kZSwgd2UgY2FuIGVtaXQgdGhlIGV2ZW50IHJpZ2h0IGF3YXkKICAgIHBhcnNlci50YWcuYXR0cmlidXRlc1twYXJzZXIuYXR0cmliTmFtZV0gPSBwYXJzZXIuYXR0cmliVmFsdWUKICAgIGVtaXROb2RlKCBwYXJzZXIKICAgICAgICAgICAgLCAib25hdHRyaWJ1dGUiCiAgICAgICAgICAgICwgeyBuYW1lOiBwYXJzZXIuYXR0cmliTmFtZQogICAgICAgICAgICAgICwgdmFsdWU6IHBhcnNlci5hdHRyaWJWYWx1ZSB9ICkKICB9CgogIHBhcnNlci5hdHRyaWJOYW1lID0gcGFyc2VyLmF0dHJpYlZhbHVlID0gIiIKfQoKZnVuY3Rpb24gb3BlblRhZyAocGFyc2VyLCBzZWxmQ2xvc2luZykgewogIGlmIChwYXJzZXIub3B0LnhtbG5zKSB7CiAgICAvLyBlbWl0IG5hbWVzcGFjZSBiaW5kaW5nIGV2ZW50cwogICAgdmFyIHRhZyA9IHBhcnNlci50YWcKCiAgICAvLyBhZGQgbmFtZXNwYWNlIGluZm8gdG8gdGFnCiAgICB2YXIgcW4gPSBxbmFtZShwYXJzZXIudGFnTmFtZSkKICAgIHRhZy5wcmVmaXggPSBxbi5wcmVmaXgKICAgIHRhZy5sb2NhbCA9IHFuLmxvY2FsCiAgICB0YWcudXJpID0gdGFnLm5zW3FuLnByZWZpeF0gfHwgIiIKCiAgICBpZiAodGFnLnByZWZpeCAmJiAhdGFnLnVyaSkgewogICAgICBzdHJpY3RGYWlsKHBhcnNlciwgIlVuYm91bmQgbmFtZXNwYWNlIHByZWZpeDogIgogICAgICAgICAgICAgICAgICAgICAgICsgSlNPTi5zdHJpbmdpZnkocGFyc2VyLnRhZ05hbWUpKQogICAgICB0YWcudXJpID0gcW4ucHJlZml4CiAgICB9CgogICAgdmFyIHBhcmVudCA9IHBhcnNlci50YWdzW3BhcnNlci50YWdzLmxlbmd0aCAtIDFdIHx8IHBhcnNlcgogICAgaWYgKHRhZy5ucyAmJiBwYXJlbnQubnMgIT09IHRhZy5ucykgewogICAgICBPYmplY3Qua2V5cyh0YWcubnMpLmZvckVhY2goZnVuY3Rpb24gKHApIHsKICAgICAgICBlbWl0Tm9kZSggcGFyc2VyCiAgICAgICAgICAgICAgICAsICJvbm9wZW5uYW1lc3BhY2UiCiAgICAgICAgICAgICAgICAsIHsgcHJlZml4OiBwICwgdXJpOiB0YWcubnNbcF0gfSApCiAgICAgIH0pCiAgICB9CgogICAgLy8gaGFuZGxlIGRlZmVycmVkIG9uYXR0cmlidXRlIGV2ZW50cwogICAgLy8gTm90ZTogZG8gbm90IGFwcGx5IGRlZmF1bHQgbnMgdG8gYXR0cmlidXRlczoKICAgIC8vICAgaHR0cDovL3d3dy53My5vcmcvVFIvUkVDLXhtbC1uYW1lcy8jZGVmYXVsdGluZwogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBwYXJzZXIuYXR0cmliTGlzdC5sZW5ndGg7IGkgPCBsOyBpICsrKSB7CiAgICAgIHZhciBudiA9IHBhcnNlci5hdHRyaWJMaXN0W2ldCiAgICAgIHZhciBuYW1lID0gbnZbMF0KICAgICAgICAsIHZhbHVlID0gbnZbMV0KICAgICAgICAsIHF1YWxOYW1lID0gcW5hbWUobmFtZSwgdHJ1ZSkKICAgICAgICAsIHByZWZpeCA9IHF1YWxOYW1lLnByZWZpeAogICAgICAgICwgbG9jYWwgPSBxdWFsTmFtZS5sb2NhbAogICAgICAgICwgdXJpID0gcHJlZml4ID09ICIiID8gIiIgOiAodGFnLm5zW3ByZWZpeF0gfHwgIiIpCiAgICAgICAgLCBhID0geyBuYW1lOiBuYW1lCiAgICAgICAgICAgICAgLCB2YWx1ZTogdmFsdWUKICAgICAgICAgICAgICAsIHByZWZpeDogcHJlZml4CiAgICAgICAgICAgICAgLCBsb2NhbDogbG9jYWwKICAgICAgICAgICAgICAsIHVyaTogdXJpCiAgICAgICAgICAgICAgfQoKICAgICAgLy8gaWYgdGhlcmUncyBhbnkgYXR0cmlidXRlcyB3aXRoIGFuIHVuZGVmaW5lZCBuYW1lc3BhY2UsCiAgICAgIC8vIHRoZW4gZmFpbCBvbiB0aGVtIG5vdy4KICAgICAgaWYgKHByZWZpeCAmJiBwcmVmaXggIT0gInhtbG5zIiAmJiAhdXJpKSB7CiAgICAgICAgc3RyaWN0RmFpbChwYXJzZXIsICJVbmJvdW5kIG5hbWVzcGFjZSBwcmVmaXg6ICIKICAgICAgICAgICAgICAgICAgICAgICAgICsgSlNPTi5zdHJpbmdpZnkocHJlZml4KSkKICAgICAgICBhLnVyaSA9IHByZWZpeAogICAgICB9CiAgICAgIHBhcnNlci50YWcuYXR0cmlidXRlc1tuYW1lXSA9IGEKICAgICAgZW1pdE5vZGUocGFyc2VyLCAib25hdHRyaWJ1dGUiLCBhKQogICAgfQogICAgcGFyc2VyLmF0dHJpYkxpc3QubGVuZ3RoID0gMAogIH0KCiAgcGFyc2VyLnRhZy5pc1NlbGZDbG9zaW5nID0gISFzZWxmQ2xvc2luZwoKICAvLyBwcm9jZXNzIHRoZSB0YWcKICBwYXJzZXIuc2F3Um9vdCA9IHRydWUKICBwYXJzZXIudGFncy5wdXNoKHBhcnNlci50YWcpCiAgZW1pdE5vZGUocGFyc2VyLCAib25vcGVudGFnIiwgcGFyc2VyLnRhZykKICBpZiAoIXNlbGZDbG9zaW5nKSB7CiAgICAvLyBzcGVjaWFsIGNhc2UgZm9yIDxzY3JpcHQ+IGluIG5vbi1zdHJpY3QgbW9kZS4KICAgIGlmICghcGFyc2VyLm5vc2NyaXB0ICYmIHBhcnNlci50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJzY3JpcHQiKSB7CiAgICAgIHBhcnNlci5zdGF0ZSA9IFMuU0NSSVBUCiAgICB9IGVsc2UgewogICAgICBwYXJzZXIuc3RhdGUgPSBTLlRFWFQKICAgIH0KICAgIHBhcnNlci50YWcgPSBudWxsCiAgICBwYXJzZXIudGFnTmFtZSA9ICIiCiAgfQogIHBhcnNlci5hdHRyaWJOYW1lID0gcGFyc2VyLmF0dHJpYlZhbHVlID0gIiIKICBwYXJzZXIuYXR0cmliTGlzdC5sZW5ndGggPSAwCn0KCmZ1bmN0aW9uIGNsb3NlVGFnIChwYXJzZXIpIHsKICBpZiAoIXBhcnNlci50YWdOYW1lKSB7CiAgICBzdHJpY3RGYWlsKHBhcnNlciwgIldlaXJkIGVtcHR5IGNsb3NlIHRhZy4iKQogICAgcGFyc2VyLnRleHROb2RlICs9ICI8Lz4iCiAgICBwYXJzZXIuc3RhdGUgPSBTLlRFWFQKICAgIHJldHVybgogIH0KCiAgaWYgKHBhcnNlci5zY3JpcHQpIHsKICAgIGlmIChwYXJzZXIudGFnTmFtZSAhPT0gInNjcmlwdCIpIHsKICAgICAgcGFyc2VyLnNjcmlwdCArPSAiPC8iICsgcGFyc2VyLnRhZ05hbWUgKyAiPiIKICAgICAgcGFyc2VyLnRhZ05hbWUgPSAiIgogICAgICBwYXJzZXIuc3RhdGUgPSBTLlNDUklQVAogICAgICByZXR1cm4KICAgIH0KICAgIGVtaXROb2RlKHBhcnNlciwgIm9uc2NyaXB0IiwgcGFyc2VyLnNjcmlwdCkKICAgIHBhcnNlci5zY3JpcHQgPSAiIgogIH0KCiAgLy8gZmlyc3QgbWFrZSBzdXJlIHRoYXQgdGhlIGNsb3NpbmcgdGFnIGFjdHVhbGx5IGV4aXN0cy4KICAvLyA8YT48Yj48L2M+PC9iPjwvYT4gd2lsbCBjbG9zZSBldmVyeXRoaW5nLCBvdGhlcndpc2UuCiAgdmFyIHQgPSBwYXJzZXIudGFncy5sZW5ndGgKICB2YXIgdGFnTmFtZSA9IHBhcnNlci50YWdOYW1lCiAgaWYgKCFwYXJzZXIuc3RyaWN0KSB0YWdOYW1lID0gdGFnTmFtZVtwYXJzZXIubG9vc2VDYXNlXSgpCiAgdmFyIGNsb3NlVG8gPSB0YWdOYW1lCiAgd2hpbGUgKHQgLS0pIHsKICAgIHZhciBjbG9zZSA9IHBhcnNlci50YWdzW3RdCiAgICBpZiAoY2xvc2UubmFtZSAhPT0gY2xvc2VUbykgewogICAgICAvLyBmYWlsIHRoZSBmaXJzdCB0aW1lIGluIHN0cmljdCBtb2RlCiAgICAgIHN0cmljdEZhaWwocGFyc2VyLCAiVW5leHBlY3RlZCBjbG9zZSB0YWciKQogICAgfSBlbHNlIGJyZWFrCiAgfQoKICAvLyBkaWRuJ3QgZmluZCBpdC4gIHdlIGFscmVhZHkgZmFpbGVkIGZvciBzdHJpY3QsIHNvIGp1c3QgYWJvcnQuCiAgaWYgKHQgPCAwKSB7CiAgICBzdHJpY3RGYWlsKHBhcnNlciwgIlVubWF0Y2hlZCBjbG9zaW5nIHRhZzogIitwYXJzZXIudGFnTmFtZSkKICAgIHBhcnNlci50ZXh0Tm9kZSArPSAiPC8iICsgcGFyc2VyLnRhZ05hbWUgKyAiPiIKICAgIHBhcnNlci5zdGF0ZSA9IFMuVEVYVAogICAgcmV0dXJuCiAgfQogIHBhcnNlci50YWdOYW1lID0gdGFnTmFtZQogIHZhciBzID0gcGFyc2VyLnRhZ3MubGVuZ3RoCiAgd2hpbGUgKHMgLS0+IHQpIHsKICAgIHZhciB0YWcgPSBwYXJzZXIudGFnID0gcGFyc2VyLnRhZ3MucG9wKCkKICAgIHBhcnNlci50YWdOYW1lID0gcGFyc2VyLnRhZy5uYW1lCiAgICBlbWl0Tm9kZShwYXJzZXIsICJvbmNsb3NldGFnIiwgcGFyc2VyLnRhZ05hbWUpCgogICAgdmFyIHggPSB7fQogICAgZm9yICh2YXIgaSBpbiB0YWcubnMpIHhbaV0gPSB0YWcubnNbaV0KCiAgICB2YXIgcGFyZW50ID0gcGFyc2VyLnRhZ3NbcGFyc2VyLnRhZ3MubGVuZ3RoIC0gMV0gfHwgcGFyc2VyCiAgICBpZiAocGFyc2VyLm9wdC54bWxucyAmJiB0YWcubnMgIT09IHBhcmVudC5ucykgewogICAgICAvLyByZW1vdmUgbmFtZXNwYWNlIGJpbmRpbmdzIGludHJvZHVjZWQgYnkgdGFnCiAgICAgIE9iamVjdC5rZXlzKHRhZy5ucykuZm9yRWFjaChmdW5jdGlvbiAocCkgewogICAgICAgIHZhciBuID0gdGFnLm5zW3BdCiAgICAgICAgZW1pdE5vZGUocGFyc2VyLCAib25jbG9zZW5hbWVzcGFjZSIsIHsgcHJlZml4OiBwLCB1cmk6IG4gfSkKICAgICAgfSkKICAgIH0KICB9CiAgaWYgKHQgPT09IDApIHBhcnNlci5jbG9zZWRSb290ID0gdHJ1ZQogIHBhcnNlci50YWdOYW1lID0gcGFyc2VyLmF0dHJpYlZhbHVlID0gcGFyc2VyLmF0dHJpYk5hbWUgPSAiIgogIHBhcnNlci5hdHRyaWJMaXN0Lmxlbmd0aCA9IDAKICBwYXJzZXIuc3RhdGUgPSBTLlRFWFQKfQoKZnVuY3Rpb24gcGFyc2VFbnRpdHkgKHBhcnNlcikgewogIHZhciBlbnRpdHkgPSBwYXJzZXIuZW50aXR5CiAgICAsIGVudGl0eUxDID0gZW50aXR5LnRvTG93ZXJDYXNlKCkKICAgICwgbnVtCiAgICAsIG51bVN0ciA9ICIiCiAgaWYgKHBhcnNlci5FTlRJVElFU1tlbnRpdHldKQogICAgcmV0dXJuIHBhcnNlci5FTlRJVElFU1tlbnRpdHldCiAgaWYgKHBhcnNlci5FTlRJVElFU1tlbnRpdHlMQ10pCiAgICByZXR1cm4gcGFyc2VyLkVOVElUSUVTW2VudGl0eUxDXQogIGVudGl0eSA9IGVudGl0eUxDCiAgaWYgKGVudGl0eS5jaGFyQXQoMCkgPT09ICIjIikgewogICAgaWYgKGVudGl0eS5jaGFyQXQoMSkgPT09ICJ4IikgewogICAgICBlbnRpdHkgPSBlbnRpdHkuc2xpY2UoMikKICAgICAgbnVtID0gcGFyc2VJbnQoZW50aXR5LCAxNikKICAgICAgbnVtU3RyID0gbnVtLnRvU3RyaW5nKDE2KQogICAgfSBlbHNlIHsKICAgICAgZW50aXR5ID0gZW50aXR5LnNsaWNlKDEpCiAgICAgIG51bSA9IHBhcnNlSW50KGVudGl0eSwgMTApCiAgICAgIG51bVN0ciA9IG51bS50b1N0cmluZygxMCkKICAgIH0KICB9CiAgZW50aXR5ID0gZW50aXR5LnJlcGxhY2UoL14wKy8sICIiKQogIGlmIChudW1TdHIudG9Mb3dlckNhc2UoKSAhPT0gZW50aXR5KSB7CiAgICBzdHJpY3RGYWlsKHBhcnNlciwgIkludmFsaWQgY2hhcmFjdGVyIGVudGl0eSIpCiAgICByZXR1cm4gIiYiK3BhcnNlci5lbnRpdHkgKyAiOyIKICB9CgogIHJldHVybiBTdHJpbmcuZnJvbUNvZGVQb2ludChudW0pCn0KCmZ1bmN0aW9uIHdyaXRlIChjaHVuaykgewogIHZhciBwYXJzZXIgPSB0aGlzCiAgaWYgKHRoaXMuZXJyb3IpIHRocm93IHRoaXMuZXJyb3IKICBpZiAocGFyc2VyLmNsb3NlZCkgcmV0dXJuIGVycm9yKHBhcnNlciwKICAgICJDYW5ub3Qgd3JpdGUgYWZ0ZXIgY2xvc2UuIEFzc2lnbiBhbiBvbnJlYWR5IGhhbmRsZXIuIikKICBpZiAoY2h1bmsgPT09IG51bGwpIHJldHVybiBlbmQocGFyc2VyKQogIHZhciBpID0gMCwgYyA9ICIiCiAgd2hpbGUgKHBhcnNlci5jID0gYyA9IGNodW5rLmNoYXJBdChpKyspKSB7CiAgICBpZiAocGFyc2VyLnRyYWNrUG9zaXRpb24pIHsKICAgICAgcGFyc2VyLnBvc2l0aW9uICsrCiAgICAgIGlmIChjID09PSAiXG4iKSB7CiAgICAgICAgcGFyc2VyLmxpbmUgKysKICAgICAgICBwYXJzZXIuY29sdW1uID0gMAogICAgICB9IGVsc2UgcGFyc2VyLmNvbHVtbiArKwogICAgfQogICAgc3dpdGNoIChwYXJzZXIuc3RhdGUpIHsKCiAgICAgIGNhc2UgUy5CRUdJTjoKICAgICAgICBpZiAoYyA9PT0gIjwiKSB7CiAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLk9QRU5fV0FLQQogICAgICAgICAgcGFyc2VyLnN0YXJ0VGFnUG9zaXRpb24gPSBwYXJzZXIucG9zaXRpb24KICAgICAgICB9IGVsc2UgaWYgKG5vdCh3aGl0ZXNwYWNlLGMpKSB7CiAgICAgICAgICAvLyBoYXZlIHRvIHByb2Nlc3MgdGhpcyBhcyBhIHRleHQgbm9kZS4KICAgICAgICAgIC8vIHdlaXJkLCBidXQgaGFwcGVucy4KICAgICAgICAgIHN0cmljdEZhaWwocGFyc2VyLCAiTm9uLXdoaXRlc3BhY2UgYmVmb3JlIGZpcnN0IHRhZy4iKQogICAgICAgICAgcGFyc2VyLnRleHROb2RlID0gYwogICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5URVhUCiAgICAgICAgfQogICAgICBjb250aW51ZQoKICAgICAgY2FzZSBTLlRFWFQ6CiAgICAgICAgaWYgKHBhcnNlci5zYXdSb290ICYmICFwYXJzZXIuY2xvc2VkUm9vdCkgewogICAgICAgICAgdmFyIHN0YXJ0aSA9IGktMQogICAgICAgICAgd2hpbGUgKGMgJiYgYyE9PSI8IiAmJiBjIT09IiYiKSB7CiAgICAgICAgICAgIGMgPSBjaHVuay5jaGFyQXQoaSsrKQogICAgICAgICAgICBpZiAoYyAmJiBwYXJzZXIudHJhY2tQb3NpdGlvbikgewogICAgICAgICAgICAgIHBhcnNlci5wb3NpdGlvbiArKwogICAgICAgICAgICAgIGlmIChjID09PSAiXG4iKSB7CiAgICAgICAgICAgICAgICBwYXJzZXIubGluZSArKwogICAgICAgICAgICAgICAgcGFyc2VyLmNvbHVtbiA9IDAKICAgICAgICAgICAgICB9IGVsc2UgcGFyc2VyLmNvbHVtbiArKwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZXIudGV4dE5vZGUgKz0gY2h1bmsuc3Vic3RyaW5nKHN0YXJ0aSwgaS0xKQogICAgICAgIH0KICAgICAgICBpZiAoYyA9PT0gIjwiKSB7CiAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLk9QRU5fV0FLQQogICAgICAgICAgcGFyc2VyLnN0YXJ0VGFnUG9zaXRpb24gPSBwYXJzZXIucG9zaXRpb24KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKG5vdCh3aGl0ZXNwYWNlLCBjKSAmJiAoIXBhcnNlci5zYXdSb290IHx8IHBhcnNlci5jbG9zZWRSb290KSkKICAgICAgICAgICAgc3RyaWN0RmFpbChwYXJzZXIsICJUZXh0IGRhdGEgb3V0c2lkZSBvZiByb290IG5vZGUuIikKICAgICAgICAgIGlmIChjID09PSAiJiIpIHBhcnNlci5zdGF0ZSA9IFMuVEVYVF9FTlRJVFkKICAgICAgICAgIGVsc2UgcGFyc2VyLnRleHROb2RlICs9IGMKICAgICAgICB9CiAgICAgIGNvbnRpbnVlCgogICAgICBjYXNlIFMuU0NSSVBUOgogICAgICAgIC8vIG9ubHkgbm9uLXN0cmljdAogICAgICAgIGlmIChjID09PSAiPCIpIHsKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuU0NSSVBUX0VORElORwogICAgICAgIH0gZWxzZSBwYXJzZXIuc2NyaXB0ICs9IGMKICAgICAgY29udGludWUKCiAgICAgIGNhc2UgUy5TQ1JJUFRfRU5ESU5HOgogICAgICAgIGlmIChjID09PSAiLyIpIHsKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQ0xPU0VfVEFHCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBhcnNlci5zY3JpcHQgKz0gIjwiICsgYwogICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5TQ1JJUFQKICAgICAgICB9CiAgICAgIGNvbnRpbnVlCgogICAgICBjYXNlIFMuT1BFTl9XQUtBOgogICAgICAgIC8vIGVpdGhlciBhIC8sID8sICEsIG9yIHRleHQgaXMgY29taW5nIG5leHQuCiAgICAgICAgaWYgKGMgPT09ICIhIikgewogICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5TR01MX0RFQ0wKICAgICAgICAgIHBhcnNlci5zZ21sRGVjbCA9ICIiCiAgICAgICAgfSBlbHNlIGlmIChpcyh3aGl0ZXNwYWNlLCBjKSkgewogICAgICAgICAgLy8gd2FpdCBmb3IgaXQuLi4KICAgICAgICB9IGVsc2UgaWYgKGlzKG5hbWVTdGFydCxjKSkgewogICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5PUEVOX1RBRwogICAgICAgICAgcGFyc2VyLnRhZ05hbWUgPSBjCiAgICAgICAgfSBlbHNlIGlmIChjID09PSAiLyIpIHsKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQ0xPU0VfVEFHCiAgICAgICAgICBwYXJzZXIudGFnTmFtZSA9ICIiCiAgICAgICAgfSBlbHNlIGlmIChjID09PSAiPyIpIHsKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuUFJPQ19JTlNUCiAgICAgICAgICBwYXJzZXIucHJvY0luc3ROYW1lID0gcGFyc2VyLnByb2NJbnN0Qm9keSA9ICIiCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0cmljdEZhaWwocGFyc2VyLCAiVW5lbmNvZGVkIDwiKQogICAgICAgICAgLy8gaWYgdGhlcmUgd2FzIHNvbWUgd2hpdGVzcGFjZSwgdGhlbiBhZGQgdGhhdCBpbi4KICAgICAgICAgIGlmIChwYXJzZXIuc3RhcnRUYWdQb3NpdGlvbiArIDEgPCBwYXJzZXIucG9zaXRpb24pIHsKICAgICAgICAgICAgdmFyIHBhZCA9IHBhcnNlci5wb3NpdGlvbiAtIHBhcnNlci5zdGFydFRhZ1Bvc2l0aW9uCiAgICAgICAgICAgIGMgPSBuZXcgQXJyYXkocGFkKS5qb2luKCIgIikgKyBjCiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZXIudGV4dE5vZGUgKz0gIjwiICsgYwogICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5URVhUCiAgICAgICAgfQogICAgICBjb250aW51ZQoKICAgICAgY2FzZSBTLlNHTUxfREVDTDoKICAgICAgICBpZiAoKHBhcnNlci5zZ21sRGVjbCtjKS50b1VwcGVyQ2FzZSgpID09PSBDREFUQSkgewogICAgICAgICAgZW1pdE5vZGUocGFyc2VyLCAib25vcGVuY2RhdGEiKQogICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5DREFUQQogICAgICAgICAgcGFyc2VyLnNnbWxEZWNsID0gIiIKICAgICAgICAgIHBhcnNlci5jZGF0YSA9ICIiCiAgICAgICAgfSBlbHNlIGlmIChwYXJzZXIuc2dtbERlY2wrYyA9PT0gIi0tIikgewogICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5DT01NRU5UCiAgICAgICAgICBwYXJzZXIuY29tbWVudCA9ICIiCiAgICAgICAgICBwYXJzZXIuc2dtbERlY2wgPSAiIgogICAgICAgIH0gZWxzZSBpZiAoKHBhcnNlci5zZ21sRGVjbCtjKS50b1VwcGVyQ2FzZSgpID09PSBET0NUWVBFKSB7CiAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkRPQ1RZUEUKICAgICAgICAgIGlmIChwYXJzZXIuZG9jdHlwZSB8fCBwYXJzZXIuc2F3Um9vdCkgc3RyaWN0RmFpbChwYXJzZXIsCiAgICAgICAgICAgICJJbmFwcHJvcHJpYXRlbHkgbG9jYXRlZCBkb2N0eXBlIGRlY2xhcmF0aW9uIikKICAgICAgICAgIHBhcnNlci5kb2N0eXBlID0gIiIKICAgICAgICAgIHBhcnNlci5zZ21sRGVjbCA9ICIiCiAgICAgICAgfSBlbHNlIGlmIChjID09PSAiPiIpIHsKICAgICAgICAgIGVtaXROb2RlKHBhcnNlciwgIm9uc2dtbGRlY2xhcmF0aW9uIiwgcGFyc2VyLnNnbWxEZWNsKQogICAgICAgICAgcGFyc2VyLnNnbWxEZWNsID0gIiIKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuVEVYVAogICAgICAgIH0gZWxzZSBpZiAoaXMocXVvdGUsIGMpKSB7CiAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLlNHTUxfREVDTF9RVU9URUQKICAgICAgICAgIHBhcnNlci5zZ21sRGVjbCArPSBjCiAgICAgICAgfSBlbHNlIHBhcnNlci5zZ21sRGVjbCArPSBjCiAgICAgIGNvbnRpbnVlCgogICAgICBjYXNlIFMuU0dNTF9ERUNMX1FVT1RFRDoKICAgICAgICBpZiAoYyA9PT0gcGFyc2VyLnEpIHsKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuU0dNTF9ERUNMCiAgICAgICAgICBwYXJzZXIucSA9ICIiCiAgICAgICAgfQogICAgICAgIHBhcnNlci5zZ21sRGVjbCArPSBjCiAgICAgIGNvbnRpbnVlCgogICAgICBjYXNlIFMuRE9DVFlQRToKICAgICAgICBpZiAoYyA9PT0gIj4iKSB7CiAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLlRFWFQKICAgICAgICAgIGVtaXROb2RlKHBhcnNlciwgIm9uZG9jdHlwZSIsIHBhcnNlci5kb2N0eXBlKQogICAgICAgICAgcGFyc2VyLmRvY3R5cGUgPSB0cnVlIC8vIGp1c3QgcmVtZW1iZXIgdGhhdCB3ZSBzYXcgaXQuCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBhcnNlci5kb2N0eXBlICs9IGMKICAgICAgICAgIGlmIChjID09PSAiWyIpIHBhcnNlci5zdGF0ZSA9IFMuRE9DVFlQRV9EVEQKICAgICAgICAgIGVsc2UgaWYgKGlzKHF1b3RlLCBjKSkgewogICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkRPQ1RZUEVfUVVPVEVECiAgICAgICAgICAgIHBhcnNlci5xID0gYwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgY29udGludWUKCiAgICAgIGNhc2UgUy5ET0NUWVBFX1FVT1RFRDoKICAgICAgICBwYXJzZXIuZG9jdHlwZSArPSBjCiAgICAgICAgaWYgKGMgPT09IHBhcnNlci5xKSB7CiAgICAgICAgICBwYXJzZXIucSA9ICIiCiAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkRPQ1RZUEUKICAgICAgICB9CiAgICAgIGNvbnRpbnVlCgogICAgICBjYXNlIFMuRE9DVFlQRV9EVEQ6CiAgICAgICAgcGFyc2VyLmRvY3R5cGUgKz0gYwogICAgICAgIGlmIChjID09PSAiXSIpIHBhcnNlci5zdGF0ZSA9IFMuRE9DVFlQRQogICAgICAgIGVsc2UgaWYgKGlzKHF1b3RlLGMpKSB7CiAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkRPQ1RZUEVfRFREX1FVT1RFRAogICAgICAgICAgcGFyc2VyLnEgPSBjCiAgICAgICAgfQogICAgICBjb250aW51ZQoKICAgICAgY2FzZSBTLkRPQ1RZUEVfRFREX1FVT1RFRDoKICAgICAgICBwYXJzZXIuZG9jdHlwZSArPSBjCiAgICAgICAgaWYgKGMgPT09IHBhcnNlci5xKSB7CiAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkRPQ1RZUEVfRFRECiAgICAgICAgICBwYXJzZXIucSA9ICIiCiAgICAgICAgfQogICAgICBjb250aW51ZQoKICAgICAgY2FzZSBTLkNPTU1FTlQ6CiAgICAgICAgaWYgKGMgPT09ICItIikgcGFyc2VyLnN0YXRlID0gUy5DT01NRU5UX0VORElORwogICAgICAgIGVsc2UgcGFyc2VyLmNvbW1lbnQgKz0gYwogICAgICBjb250aW51ZQoKICAgICAgY2FzZSBTLkNPTU1FTlRfRU5ESU5HOgogICAgICAgIGlmIChjID09PSAiLSIpIHsKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQ09NTUVOVF9FTkRFRAogICAgICAgICAgcGFyc2VyLmNvbW1lbnQgPSB0ZXh0b3B0cyhwYXJzZXIub3B0LCBwYXJzZXIuY29tbWVudCkKICAgICAgICAgIGlmIChwYXJzZXIuY29tbWVudCkgZW1pdE5vZGUocGFyc2VyLCAib25jb21tZW50IiwgcGFyc2VyLmNvbW1lbnQpCiAgICAgICAgICBwYXJzZXIuY29tbWVudCA9ICIiCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBhcnNlci5jb21tZW50ICs9ICItIiArIGMKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQ09NTUVOVAogICAgICAgIH0KICAgICAgY29udGludWUKCiAgICAgIGNhc2UgUy5DT01NRU5UX0VOREVEOgogICAgICAgIGlmIChjICE9PSAiPiIpIHsKICAgICAgICAgIHN0cmljdEZhaWwocGFyc2VyLCAiTWFsZm9ybWVkIGNvbW1lbnQiKQogICAgICAgICAgLy8gYWxsb3cgPCEtLSBibGFoIC0tIGJsb28gLS0+IGluIG5vbi1zdHJpY3QgbW9kZSwKICAgICAgICAgIC8vIHdoaWNoIGlzIGEgY29tbWVudCBvZiAiIGJsYWggLS0gYmxvbyAiCiAgICAgICAgICBwYXJzZXIuY29tbWVudCArPSAiLS0iICsgYwogICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5DT01NRU5UCiAgICAgICAgfSBlbHNlIHBhcnNlci5zdGF0ZSA9IFMuVEVYVAogICAgICBjb250aW51ZQoKICAgICAgY2FzZSBTLkNEQVRBOgogICAgICAgIGlmIChjID09PSAiXSIpIHBhcnNlci5zdGF0ZSA9IFMuQ0RBVEFfRU5ESU5HCiAgICAgICAgZWxzZSBwYXJzZXIuY2RhdGEgKz0gYwogICAgICBjb250aW51ZQoKICAgICAgY2FzZSBTLkNEQVRBX0VORElORzoKICAgICAgICBpZiAoYyA9PT0gIl0iKSBwYXJzZXIuc3RhdGUgPSBTLkNEQVRBX0VORElOR18yCiAgICAgICAgZWxzZSB7CiAgICAgICAgICBwYXJzZXIuY2RhdGEgKz0gIl0iICsgYwogICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5DREFUQQogICAgICAgIH0KICAgICAgY29udGludWUKCiAgICAgIGNhc2UgUy5DREFUQV9FTkRJTkdfMjoKICAgICAgICBpZiAoYyA9PT0gIj4iKSB7CiAgICAgICAgICBpZiAocGFyc2VyLmNkYXRhKSBlbWl0Tm9kZShwYXJzZXIsICJvbmNkYXRhIiwgcGFyc2VyLmNkYXRhKQogICAgICAgICAgZW1pdE5vZGUocGFyc2VyLCAib25jbG9zZWNkYXRhIikKICAgICAgICAgIHBhcnNlci5jZGF0YSA9ICIiCiAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLlRFWFQKICAgICAgICB9IGVsc2UgaWYgKGMgPT09ICJdIikgewogICAgICAgICAgcGFyc2VyLmNkYXRhICs9ICJdIgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwYXJzZXIuY2RhdGEgKz0gIl1dIiArIGMKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQ0RBVEEKICAgICAgICB9CiAgICAgIGNvbnRpbnVlCgogICAgICBjYXNlIFMuUFJPQ19JTlNUOgogICAgICAgIGlmIChjID09PSAiPyIpIHBhcnNlci5zdGF0ZSA9IFMuUFJPQ19JTlNUX0VORElORwogICAgICAgIGVsc2UgaWYgKGlzKHdoaXRlc3BhY2UsIGMpKSBwYXJzZXIuc3RhdGUgPSBTLlBST0NfSU5TVF9CT0RZCiAgICAgICAgZWxzZSBwYXJzZXIucHJvY0luc3ROYW1lICs9IGMKICAgICAgY29udGludWUKCiAgICAgIGNhc2UgUy5QUk9DX0lOU1RfQk9EWToKICAgICAgICBpZiAoIXBhcnNlci5wcm9jSW5zdEJvZHkgJiYgaXMod2hpdGVzcGFjZSwgYykpIGNvbnRpbnVlCiAgICAgICAgZWxzZSBpZiAoYyA9PT0gIj8iKSBwYXJzZXIuc3RhdGUgPSBTLlBST0NfSU5TVF9FTkRJTkcKICAgICAgICBlbHNlIHBhcnNlci5wcm9jSW5zdEJvZHkgKz0gYwogICAgICBjb250aW51ZQoKICAgICAgY2FzZSBTLlBST0NfSU5TVF9FTkRJTkc6CiAgICAgICAgaWYgKGMgPT09ICI+IikgewogICAgICAgICAgZW1pdE5vZGUocGFyc2VyLCAib25wcm9jZXNzaW5naW5zdHJ1Y3Rpb24iLCB7CiAgICAgICAgICAgIG5hbWUgOiBwYXJzZXIucHJvY0luc3ROYW1lLAogICAgICAgICAgICBib2R5IDogcGFyc2VyLnByb2NJbnN0Qm9keQogICAgICAgICAgfSkKICAgICAgICAgIHBhcnNlci5wcm9jSW5zdE5hbWUgPSBwYXJzZXIucHJvY0luc3RCb2R5ID0gIiIKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuVEVYVAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwYXJzZXIucHJvY0luc3RCb2R5ICs9ICI/IiArIGMKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuUFJPQ19JTlNUX0JPRFkKICAgICAgICB9CiAgICAgIGNvbnRpbnVlCgogICAgICBjYXNlIFMuT1BFTl9UQUc6CiAgICAgICAgaWYgKGlzKG5hbWVCb2R5LCBjKSkgcGFyc2VyLnRhZ05hbWUgKz0gYwogICAgICAgIGVsc2UgewogICAgICAgICAgbmV3VGFnKHBhcnNlcikKICAgICAgICAgIGlmIChjID09PSAiPiIpIG9wZW5UYWcocGFyc2VyKQogICAgICAgICAgZWxzZSBpZiAoYyA9PT0gIi8iKSBwYXJzZXIuc3RhdGUgPSBTLk9QRU5fVEFHX1NMQVNICiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKG5vdCh3aGl0ZXNwYWNlLCBjKSkgc3RyaWN0RmFpbCgKICAgICAgICAgICAgICBwYXJzZXIsICJJbnZhbGlkIGNoYXJhY3RlciBpbiB0YWcgbmFtZSIpCiAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQVRUUklCCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICBjb250aW51ZQoKICAgICAgY2FzZSBTLk9QRU5fVEFHX1NMQVNIOgogICAgICAgIGlmIChjID09PSAiPiIpIHsKICAgICAgICAgIG9wZW5UYWcocGFyc2VyLCB0cnVlKQogICAgICAgICAgY2xvc2VUYWcocGFyc2VyKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJpY3RGYWlsKHBhcnNlciwgIkZvcndhcmQtc2xhc2ggaW4gb3BlbmluZyB0YWcgbm90IGZvbGxvd2VkIGJ5ID4iKQogICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5BVFRSSUIKICAgICAgICB9CiAgICAgIGNvbnRpbnVlCgogICAgICBjYXNlIFMuQVRUUklCOgogICAgICAgIC8vIGhhdmVuJ3QgcmVhZCB0aGUgYXR0cmlidXRlIG5hbWUgeWV0LgogICAgICAgIGlmIChpcyh3aGl0ZXNwYWNlLCBjKSkgY29udGludWUKICAgICAgICBlbHNlIGlmIChjID09PSAiPiIpIG9wZW5UYWcocGFyc2VyKQogICAgICAgIGVsc2UgaWYgKGMgPT09ICIvIikgcGFyc2VyLnN0YXRlID0gUy5PUEVOX1RBR19TTEFTSAogICAgICAgIGVsc2UgaWYgKGlzKG5hbWVTdGFydCwgYykpIHsKICAgICAgICAgIHBhcnNlci5hdHRyaWJOYW1lID0gYwogICAgICAgICAgcGFyc2VyLmF0dHJpYlZhbHVlID0gIiIKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQVRUUklCX05BTUUKICAgICAgICB9IGVsc2Ugc3RyaWN0RmFpbChwYXJzZXIsICJJbnZhbGlkIGF0dHJpYnV0ZSBuYW1lIikKICAgICAgY29udGludWUKCiAgICAgIGNhc2UgUy5BVFRSSUJfTkFNRToKICAgICAgICBpZiAoYyA9PT0gIj0iKSBwYXJzZXIuc3RhdGUgPSBTLkFUVFJJQl9WQUxVRQogICAgICAgIGVsc2UgaWYgKGMgPT09ICI+IikgewogICAgICAgICAgc3RyaWN0RmFpbChwYXJzZXIsICJBdHRyaWJ1dGUgd2l0aG91dCB2YWx1ZSIpCiAgICAgICAgICBwYXJzZXIuYXR0cmliVmFsdWUgPSBwYXJzZXIuYXR0cmliTmFtZQogICAgICAgICAgYXR0cmliKHBhcnNlcikKICAgICAgICAgIG9wZW5UYWcocGFyc2VyKQogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChpcyh3aGl0ZXNwYWNlLCBjKSkgcGFyc2VyLnN0YXRlID0gUy5BVFRSSUJfTkFNRV9TQVdfV0hJVEUKICAgICAgICBlbHNlIGlmIChpcyhuYW1lQm9keSwgYykpIHBhcnNlci5hdHRyaWJOYW1lICs9IGMKICAgICAgICBlbHNlIHN0cmljdEZhaWwocGFyc2VyLCAiSW52YWxpZCBhdHRyaWJ1dGUgbmFtZSIpCiAgICAgIGNvbnRpbnVlCgogICAgICBjYXNlIFMuQVRUUklCX05BTUVfU0FXX1dISVRFOgogICAgICAgIGlmIChjID09PSAiPSIpIHBhcnNlci5zdGF0ZSA9IFMuQVRUUklCX1ZBTFVFCiAgICAgICAgZWxzZSBpZiAoaXMod2hpdGVzcGFjZSwgYykpIGNvbnRpbnVlCiAgICAgICAgZWxzZSB7CiAgICAgICAgICBzdHJpY3RGYWlsKHBhcnNlciwgIkF0dHJpYnV0ZSB3aXRob3V0IHZhbHVlIikKICAgICAgICAgIHBhcnNlci50YWcuYXR0cmlidXRlc1twYXJzZXIuYXR0cmliTmFtZV0gPSAiIgogICAgICAgICAgcGFyc2VyLmF0dHJpYlZhbHVlID0gIiIKICAgICAgICAgIGVtaXROb2RlKHBhcnNlciwgIm9uYXR0cmlidXRlIiwKICAgICAgICAgICAgICAgICAgIHsgbmFtZSA6IHBhcnNlci5hdHRyaWJOYW1lLCB2YWx1ZSA6ICIiIH0pCiAgICAgICAgICBwYXJzZXIuYXR0cmliTmFtZSA9ICIiCiAgICAgICAgICBpZiAoYyA9PT0gIj4iKSBvcGVuVGFnKHBhcnNlcikKICAgICAgICAgIGVsc2UgaWYgKGlzKG5hbWVTdGFydCwgYykpIHsKICAgICAgICAgICAgcGFyc2VyLmF0dHJpYk5hbWUgPSBjCiAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQVRUUklCX05BTUUKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0cmljdEZhaWwocGFyc2VyLCAiSW52YWxpZCBhdHRyaWJ1dGUgbmFtZSIpCiAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQVRUUklCCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICBjb250aW51ZQoKICAgICAgY2FzZSBTLkFUVFJJQl9WQUxVRToKICAgICAgICBpZiAoaXMod2hpdGVzcGFjZSwgYykpIGNvbnRpbnVlCiAgICAgICAgZWxzZSBpZiAoaXMocXVvdGUsIGMpKSB7CiAgICAgICAgICBwYXJzZXIucSA9IGMKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQVRUUklCX1ZBTFVFX1FVT1RFRAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJpY3RGYWlsKHBhcnNlciwgIlVucXVvdGVkIGF0dHJpYnV0ZSB2YWx1ZSIpCiAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkFUVFJJQl9WQUxVRV9VTlFVT1RFRAogICAgICAgICAgcGFyc2VyLmF0dHJpYlZhbHVlID0gYwogICAgICAgIH0KICAgICAgY29udGludWUKCiAgICAgIGNhc2UgUy5BVFRSSUJfVkFMVUVfUVVPVEVEOgogICAgICAgIGlmIChjICE9PSBwYXJzZXIucSkgewogICAgICAgICAgaWYgKGMgPT09ICImIikgcGFyc2VyLnN0YXRlID0gUy5BVFRSSUJfVkFMVUVfRU5USVRZX1EKICAgICAgICAgIGVsc2UgcGFyc2VyLmF0dHJpYlZhbHVlICs9IGMKICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgfQogICAgICAgIGF0dHJpYihwYXJzZXIpCiAgICAgICAgcGFyc2VyLnEgPSAiIgogICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQVRUUklCX1ZBTFVFX0NMT1NFRAogICAgICBjb250aW51ZQoKICAgICAgY2FzZSBTLkFUVFJJQl9WQUxVRV9DTE9TRUQ6CiAgICAgICAgaWYgKGlzKHdoaXRlc3BhY2UsIGMpKSB7CiAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkFUVFJJQgogICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gIj4iKSBvcGVuVGFnKHBhcnNlcikKICAgICAgICBlbHNlIGlmIChjID09PSAiLyIpIHBhcnNlci5zdGF0ZSA9IFMuT1BFTl9UQUdfU0xBU0gKICAgICAgICBlbHNlIGlmIChpcyhuYW1lU3RhcnQsIGMpKSB7CiAgICAgICAgICBzdHJpY3RGYWlsKHBhcnNlciwgIk5vIHdoaXRlc3BhY2UgYmV0d2VlbiBhdHRyaWJ1dGVzIikKICAgICAgICAgIHBhcnNlci5hdHRyaWJOYW1lID0gYwogICAgICAgICAgcGFyc2VyLmF0dHJpYlZhbHVlID0gIiIKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQVRUUklCX05BTUUKICAgICAgICB9IGVsc2Ugc3RyaWN0RmFpbChwYXJzZXIsICJJbnZhbGlkIGF0dHJpYnV0ZSBuYW1lIikKICAgICAgY29udGludWUKCiAgICAgIGNhc2UgUy5BVFRSSUJfVkFMVUVfVU5RVU9URUQ6CiAgICAgICAgaWYgKG5vdChhdHRyaWJFbmQsYykpIHsKICAgICAgICAgIGlmIChjID09PSAiJiIpIHBhcnNlci5zdGF0ZSA9IFMuQVRUUklCX1ZBTFVFX0VOVElUWV9VCiAgICAgICAgICBlbHNlIHBhcnNlci5hdHRyaWJWYWx1ZSArPSBjCiAgICAgICAgICBjb250aW51ZQogICAgICAgIH0KICAgICAgICBhdHRyaWIocGFyc2VyKQogICAgICAgIGlmIChjID09PSAiPiIpIG9wZW5UYWcocGFyc2VyKQogICAgICAgIGVsc2UgcGFyc2VyLnN0YXRlID0gUy5BVFRSSUIKICAgICAgY29udGludWUKCiAgICAgIGNhc2UgUy5DTE9TRV9UQUc6CiAgICAgICAgaWYgKCFwYXJzZXIudGFnTmFtZSkgewogICAgICAgICAgaWYgKGlzKHdoaXRlc3BhY2UsIGMpKSBjb250aW51ZQogICAgICAgICAgZWxzZSBpZiAobm90KG5hbWVTdGFydCwgYykpIHsKICAgICAgICAgICAgaWYgKHBhcnNlci5zY3JpcHQpIHsKICAgICAgICAgICAgICBwYXJzZXIuc2NyaXB0ICs9ICI8LyIgKyBjCiAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5TQ1JJUFQKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzdHJpY3RGYWlsKHBhcnNlciwgIkludmFsaWQgdGFnbmFtZSBpbiBjbG9zaW5nIHRhZy4iKQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgcGFyc2VyLnRhZ05hbWUgPSBjCiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGMgPT09ICI+IikgY2xvc2VUYWcocGFyc2VyKQogICAgICAgIGVsc2UgaWYgKGlzKG5hbWVCb2R5LCBjKSkgcGFyc2VyLnRhZ05hbWUgKz0gYwogICAgICAgIGVsc2UgaWYgKHBhcnNlci5zY3JpcHQpIHsKICAgICAgICAgIHBhcnNlci5zY3JpcHQgKz0gIjwvIiArIHBhcnNlci50YWdOYW1lCiAgICAgICAgICBwYXJzZXIudGFnTmFtZSA9ICIiCiAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLlNDUklQVAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAobm90KHdoaXRlc3BhY2UsIGMpKSBzdHJpY3RGYWlsKHBhcnNlciwKICAgICAgICAgICAgIkludmFsaWQgdGFnbmFtZSBpbiBjbG9zaW5nIHRhZyIpCiAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkNMT1NFX1RBR19TQVdfV0hJVEUKICAgICAgICB9CiAgICAgIGNvbnRpbnVlCgogICAgICBjYXNlIFMuQ0xPU0VfVEFHX1NBV19XSElURToKICAgICAgICBpZiAoaXMod2hpdGVzcGFjZSwgYykpIGNvbnRpbnVlCiAgICAgICAgaWYgKGMgPT09ICI+IikgY2xvc2VUYWcocGFyc2VyKQogICAgICAgIGVsc2Ugc3RyaWN0RmFpbChwYXJzZXIsICJJbnZhbGlkIGNoYXJhY3RlcnMgaW4gY2xvc2luZyB0YWciKQogICAgICBjb250aW51ZQoKICAgICAgY2FzZSBTLlRFWFRfRU5USVRZOgogICAgICBjYXNlIFMuQVRUUklCX1ZBTFVFX0VOVElUWV9ROgogICAgICBjYXNlIFMuQVRUUklCX1ZBTFVFX0VOVElUWV9VOgogICAgICAgIHN3aXRjaChwYXJzZXIuc3RhdGUpIHsKICAgICAgICAgIGNhc2UgUy5URVhUX0VOVElUWToKICAgICAgICAgICAgdmFyIHJldHVyblN0YXRlID0gUy5URVhULCBidWZmZXIgPSAidGV4dE5vZGUiCiAgICAgICAgICBicmVhawoKICAgICAgICAgIGNhc2UgUy5BVFRSSUJfVkFMVUVfRU5USVRZX1E6CiAgICAgICAgICAgIHZhciByZXR1cm5TdGF0ZSA9IFMuQVRUUklCX1ZBTFVFX1FVT1RFRCwgYnVmZmVyID0gImF0dHJpYlZhbHVlIgogICAgICAgICAgYnJlYWsKCiAgICAgICAgICBjYXNlIFMuQVRUUklCX1ZBTFVFX0VOVElUWV9VOgogICAgICAgICAgICB2YXIgcmV0dXJuU3RhdGUgPSBTLkFUVFJJQl9WQUxVRV9VTlFVT1RFRCwgYnVmZmVyID0gImF0dHJpYlZhbHVlIgogICAgICAgICAgYnJlYWsKICAgICAgICB9CiAgICAgICAgaWYgKGMgPT09ICI7IikgewogICAgICAgICAgcGFyc2VyW2J1ZmZlcl0gKz0gcGFyc2VFbnRpdHkocGFyc2VyKQogICAgICAgICAgcGFyc2VyLmVudGl0eSA9ICIiCiAgICAgICAgICBwYXJzZXIuc3RhdGUgPSByZXR1cm5TdGF0ZQogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChpcyhlbnRpdHksIGMpKSBwYXJzZXIuZW50aXR5ICs9IGMKICAgICAgICBlbHNlIHsKICAgICAgICAgIHN0cmljdEZhaWwocGFyc2VyLCAiSW52YWxpZCBjaGFyYWN0ZXIgZW50aXR5IikKICAgICAgICAgIHBhcnNlcltidWZmZXJdICs9ICImIiArIHBhcnNlci5lbnRpdHkgKyBjCiAgICAgICAgICBwYXJzZXIuZW50aXR5ID0gIiIKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IHJldHVyblN0YXRlCiAgICAgICAgfQogICAgICBjb250aW51ZQoKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgRXJyb3IocGFyc2VyLCAiVW5rbm93biBzdGF0ZTogIiArIHBhcnNlci5zdGF0ZSkKICAgIH0KICB9IC8vIHdoaWxlCiAgLy8gY2RhdGEgYmxvY2tzIGNhbiBnZXQgdmVyeSBiaWcgdW5kZXIgbm9ybWFsIGNvbmRpdGlvbnMuIGVtaXQgYW5kIG1vdmUgb24uCiAgLy8gaWYgKHBhcnNlci5zdGF0ZSA9PT0gUy5DREFUQSAmJiBwYXJzZXIuY2RhdGEpIHsKICAvLyAgIGVtaXROb2RlKHBhcnNlciwgIm9uY2RhdGEiLCBwYXJzZXIuY2RhdGEpCiAgLy8gICBwYXJzZXIuY2RhdGEgPSAiIgogIC8vIH0KICBpZiAocGFyc2VyLnBvc2l0aW9uID49IHBhcnNlci5idWZmZXJDaGVja1Bvc2l0aW9uKSBjaGVja0J1ZmZlckxlbmd0aChwYXJzZXIpCiAgcmV0dXJuIHBhcnNlcgp9CgovKiEgaHR0cDovL210aHMuYmUvZnJvbWNvZGVwb2ludCB2MC4xLjAgYnkgQG1hdGhpYXMgKi8KaWYgKCFTdHJpbmcuZnJvbUNvZGVQb2ludCkgewogICAgICAgIChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciBzdHJpbmdGcm9tQ2hhckNvZGUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlOwogICAgICAgICAgICAgICAgdmFyIGZsb29yID0gTWF0aC5mbG9vcjsKICAgICAgICAgICAgICAgIHZhciBmcm9tQ29kZVBvaW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBNQVhfU0laRSA9IDB4NDAwMDsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvZGVVbml0cyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGlnaFN1cnJvZ2F0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxvd1N1cnJvZ2F0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gLTE7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvZGVQb2ludCA9IE51bWJlcihhcmd1bWVudHNbaW5kZXhdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhaXNGaW5pdGUoY29kZVBvaW50KSB8fCAvLyBgTmFOYCwgYCtJbmZpbml0eWAsIG9yIGAtSW5maW5pdHlgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlUG9pbnQgPCAwIHx8IC8vIG5vdCBhIHZhbGlkIFVuaWNvZGUgY29kZSBwb2ludAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZVBvaW50ID4gMHgxMEZGRkYgfHwgLy8gbm90IGEgdmFsaWQgVW5pY29kZSBjb2RlIHBvaW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG9vcihjb2RlUG9pbnQpICE9IGNvZGVQb2ludCAvLyBub3QgYW4gaW50ZWdlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgUmFuZ2VFcnJvcignSW52YWxpZCBjb2RlIHBvaW50OiAnICsgY29kZVBvaW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvZGVQb2ludCA8PSAweEZGRkYpIHsgLy8gQk1QIGNvZGUgcG9pbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVVbml0cy5wdXNoKGNvZGVQb2ludCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsgLy8gQXN0cmFsIGNvZGUgcG9pbnQ7IHNwbGl0IGluIHN1cnJvZ2F0ZSBoYWx2ZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGh0dHA6Ly9tYXRoaWFzYnluZW5zLmJlL25vdGVzL2phdmFzY3JpcHQtZW5jb2Rpbmcjc3Vycm9nYXRlLWZvcm11bGFlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlUG9pbnQgLT0gMHgxMDAwMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hTdXJyb2dhdGUgPSAoY29kZVBvaW50ID4+IDEwKSArIDB4RDgwMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvd1N1cnJvZ2F0ZSA9IChjb2RlUG9pbnQgJSAweDQwMCkgKyAweERDMDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlVW5pdHMucHVzaChoaWdoU3Vycm9nYXRlLCBsb3dTdXJyb2dhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggKyAxID09IGxlbmd0aCB8fCBjb2RlVW5pdHMubGVuZ3RoID4gTUFYX1NJWkUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBzdHJpbmdGcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgY29kZVVuaXRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVVbml0cy5sZW5ndGggPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZywgJ2Zyb21Db2RlUG9pbnQnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJzogZnJvbUNvZGVQb2ludCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29uZmlndXJhYmxlJzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnd3JpdGFibGUnOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nLmZyb21Db2RlUG9pbnQgPSBmcm9tQ29kZVBvaW50OwogICAgICAgICAgICAgICAgfQogICAgICAgIH0oKSk7Cn0KCn0pKHR5cGVvZiBleHBvcnRzID09PSAidW5kZWZpbmVkIiA/IHNheCA9IHt9IDogZXhwb3J0cykK</content>
    <filesize>40380</filesize>
  </attachment>
  <attachment>
    <filename>snap.svg.js</filename>
    <author>XWiki.Admin</author>
    <date>1409494163000</date>
    <version>1.1</version>
    <comment/>
    <content>Ly8gU25hcC5zdmcgMC4zLjAKLy8gCi8vIENvcHlyaWdodCAoYykgMjAxMyBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KLy8gCi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwovLyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCi8vIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAovLyAKLy8gaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCi8vIAovLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCi8vIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCi8vIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgovLyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCi8vIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgovLyAKLy8gYnVpbGQ6IDIwMTQtMDYtMDMKLy8gQ29weXJpZ2h0IChjKSAyMDEzIEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkLiBBbGwgcmlnaHRzIHJlc2VydmVkLgovLyAKLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7Ci8vIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KLy8gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0Ci8vIAovLyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKLy8gCi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKLy8gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKLy8gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCi8vIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKLy8gbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCi8vIOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkCBcXAovLyDilIIgRXZlIDAuNC4yIC0gSmF2YVNjcmlwdCBFdmVudHMgTGlicmFyeSAgICAgICAgICAgICAgICAgICAgICDilIIgXFwKLy8g4pSc4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSkIFxcCi8vIOKUgiBBdXRob3IgRG1pdHJ5IEJhcmFub3Zza2l5IChodHRwOi8vZG1pdHJ5LmJhcmFub3Zza2l5LmNvbS8pIOKUgiBcXAovLyDilJTilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJggXFwKCihmdW5jdGlvbiAoZ2xvYikgewogICAgdmFyIHZlcnNpb24gPSAiMC40LjIiLAogICAgICAgIGhhcyA9ICJoYXNPd25Qcm9wZXJ0eSIsCiAgICAgICAgc2VwYXJhdG9yID0gL1tcLlwvXS8sCiAgICAgICAgY29tYXNlcGFyYXRvciA9IC9ccyosXHMqLywKICAgICAgICB3aWxkY2FyZCA9ICIqIiwKICAgICAgICBmdW4gPSBmdW5jdGlvbiAoKSB7fSwKICAgICAgICBudW1zb3J0ID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgICAgIH0sCiAgICAgICAgY3VycmVudF9ldmVudCwKICAgICAgICBzdG9wLAogICAgICAgIGV2ZW50cyA9IHtuOiB7fX0sCiAgICAgICAgZmlyc3REZWZpbmVkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSB0aGlzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpc1tpXSAhPSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzW2ldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBsYXN0RGVmaW5lZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGkgPSB0aGlzLmxlbmd0aDsKICAgICAgICAgICAgd2hpbGUgKC0taSkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzW2ldICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNbaV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgLypcCiAgICAgKiBldmUKICAgICBbIG1ldGhvZCBdCgogICAgICogRmlyZXMgZXZlbnQgd2l0aCBnaXZlbiBgbmFtZWAsIGdpdmVuIHNjb3BlIGFuZCBvdGhlciBwYXJhbWV0ZXJzLgoKICAgICA+IEFyZ3VtZW50cwoKICAgICAtIG5hbWUgKHN0cmluZykgbmFtZSBvZiB0aGUgKmV2ZW50KiwgZG90IChgLmApIG9yIHNsYXNoIChgL2ApIHNlcGFyYXRlZAogICAgIC0gc2NvcGUgKG9iamVjdCkgY29udGV4dCBmb3IgdGhlIGV2ZW50IGhhbmRsZXJzCiAgICAgLSB2YXJhcmdzICguLi4pIHRoZSByZXN0IG9mIGFyZ3VtZW50cyB3aWxsIGJlIHNlbnQgdG8gZXZlbnQgaGFuZGxlcnMKCiAgICAgPSAob2JqZWN0KSBhcnJheSBvZiByZXR1cm5lZCB2YWx1ZXMgZnJvbSB0aGUgbGlzdGVuZXJzLiBBcnJheSBoYXMgdHdvIG1ldGhvZHMgYC5maXJzdERlZmluZWQoKWAgYW5kIGAubGFzdERlZmluZWQoKWAgdG8gZ2V0IGZpcnN0IG9yIGxhc3Qgbm90IGB1bmRlZmluZWRgIHZhbHVlLgogICAgXCovCiAgICAgICAgZXZlID0gZnVuY3Rpb24gKG5hbWUsIHNjb3BlKSB7CiAgICAgICAgICAgIG5hbWUgPSBTdHJpbmcobmFtZSk7CiAgICAgICAgICAgIHZhciBlID0gZXZlbnRzLAogICAgICAgICAgICAgICAgb2xkc3RvcCA9IHN0b3AsCiAgICAgICAgICAgICAgICBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKSwKICAgICAgICAgICAgICAgIGxpc3RlbmVycyA9IGV2ZS5saXN0ZW5lcnMobmFtZSksCiAgICAgICAgICAgICAgICB6ID0gMCwKICAgICAgICAgICAgICAgIGYgPSBmYWxzZSwKICAgICAgICAgICAgICAgIGwsCiAgICAgICAgICAgICAgICBpbmRleGVkID0gW10sCiAgICAgICAgICAgICAgICBxdWV1ZSA9IHt9LAogICAgICAgICAgICAgICAgb3V0ID0gW10sCiAgICAgICAgICAgICAgICBjZSA9IGN1cnJlbnRfZXZlbnQsCiAgICAgICAgICAgICAgICBlcnJvcnMgPSBbXTsKICAgICAgICAgICAgb3V0LmZpcnN0RGVmaW5lZCA9IGZpcnN0RGVmaW5lZDsKICAgICAgICAgICAgb3V0Lmxhc3REZWZpbmVkID0gbGFzdERlZmluZWQ7CiAgICAgICAgICAgIGN1cnJlbnRfZXZlbnQgPSBuYW1lOwogICAgICAgICAgICBzdG9wID0gMDsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gbGlzdGVuZXJzLmxlbmd0aDsgaSA8IGlpOyBpKyspIGlmICgiekluZGV4IiBpbiBsaXN0ZW5lcnNbaV0pIHsKICAgICAgICAgICAgICAgIGluZGV4ZWQucHVzaChsaXN0ZW5lcnNbaV0uekluZGV4KTsKICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcnNbaV0uekluZGV4IDwgMCkgewogICAgICAgICAgICAgICAgICAgIHF1ZXVlW2xpc3RlbmVyc1tpXS56SW5kZXhdID0gbGlzdGVuZXJzW2ldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGluZGV4ZWQuc29ydChudW1zb3J0KTsKICAgICAgICAgICAgd2hpbGUgKGluZGV4ZWRbel0gPCAwKSB7CiAgICAgICAgICAgICAgICBsID0gcXVldWVbaW5kZXhlZFt6KytdXTsKICAgICAgICAgICAgICAgIG91dC5wdXNoKGwuYXBwbHkoc2NvcGUsIGFyZ3MpKTsKICAgICAgICAgICAgICAgIGlmIChzdG9wKSB7CiAgICAgICAgICAgICAgICAgICAgc3RvcCA9IG9sZHN0b3A7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG91dDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgICAgbCA9IGxpc3RlbmVyc1tpXTsKICAgICAgICAgICAgICAgIGlmICgiekluZGV4IiBpbiBsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGwuekluZGV4ID09IGluZGV4ZWRbel0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0LnB1c2gobC5hcHBseShzY29wZSwgYXJncykpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RvcCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeisrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IHF1ZXVlW2luZGV4ZWRbel1dOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbCAmJiBvdXQucHVzaChsLmFwcGx5KHNjb3BlLCBhcmdzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RvcCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IHdoaWxlIChsKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlW2wuekluZGV4XSA9IGw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBvdXQucHVzaChsLmFwcGx5KHNjb3BlLCBhcmdzKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0b3ApIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0b3AgPSBvbGRzdG9wOwogICAgICAgICAgICBjdXJyZW50X2V2ZW50ID0gY2U7CiAgICAgICAgICAgIHJldHVybiBvdXQ7CiAgICAgICAgfTsKICAgICAgICAvLyBVbmRvY3VtZW50ZWQuIERlYnVnIG9ubHkuCiAgICAgICAgZXZlLl9ldmVudHMgPSBldmVudHM7CiAgICAvKlwKICAgICAqIGV2ZS5saXN0ZW5lcnMKICAgICBbIG1ldGhvZCBdCgogICAgICogSW50ZXJuYWwgbWV0aG9kIHdoaWNoIGdpdmVzIHlvdSBhcnJheSBvZiBhbGwgZXZlbnQgaGFuZGxlcnMgdGhhdCB3aWxsIGJlIHRyaWdnZXJlZCBieSB0aGUgZ2l2ZW4gYG5hbWVgLgoKICAgICA+IEFyZ3VtZW50cwoKICAgICAtIG5hbWUgKHN0cmluZykgbmFtZSBvZiB0aGUgZXZlbnQsIGRvdCAoYC5gKSBvciBzbGFzaCAoYC9gKSBzZXBhcmF0ZWQKCiAgICAgPSAoYXJyYXkpIGFycmF5IG9mIGV2ZW50IGhhbmRsZXJzCiAgICBcKi8KICAgIGV2ZS5saXN0ZW5lcnMgPSBmdW5jdGlvbiAobmFtZSkgewogICAgICAgIHZhciBuYW1lcyA9IG5hbWUuc3BsaXQoc2VwYXJhdG9yKSwKICAgICAgICAgICAgZSA9IGV2ZW50cywKICAgICAgICAgICAgaXRlbSwKICAgICAgICAgICAgaXRlbXMsCiAgICAgICAgICAgIGssCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIGlpLAogICAgICAgICAgICBqLAogICAgICAgICAgICBqaiwKICAgICAgICAgICAgbmVzLAogICAgICAgICAgICBlcyA9IFtlXSwKICAgICAgICAgICAgb3V0ID0gW107CiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBuYW1lcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIG5lcyA9IFtdOwogICAgICAgICAgICBmb3IgKGogPSAwLCBqaiA9IGVzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICAgIGUgPSBlc1tqXS5uOwogICAgICAgICAgICAgICAgaXRlbXMgPSBbZVtuYW1lc1tpXV0sIGVbd2lsZGNhcmRdXTsKICAgICAgICAgICAgICAgIGsgPSAyOwogICAgICAgICAgICAgICAgd2hpbGUgKGstLSkgewogICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBpdGVtc1trXTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICBuZXMucHVzaChpdGVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0ID0gb3V0LmNvbmNhdChpdGVtLmYgfHwgW10pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlcyA9IG5lczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG91dDsKICAgIH07CiAgICAKICAgIC8qXAogICAgICogZXZlLm9uCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBCaW5kcyBnaXZlbiBldmVudCBoYW5kbGVyIHdpdGggYSBnaXZlbiBuYW1lLiBZb3UgY2FuIHVzZSB3aWxkY2FyZHMg4oCcYCpg4oCdIGZvciB0aGUgbmFtZXM6CiAgICAgfCBldmUub24oIioudW5kZXIuKiIsIGYpOwogICAgIHwgZXZlKCJtb3VzZS51bmRlci5mbG9vciIpOyAvLyB0cmlnZ2VycyBmCiAgICAgKiBVc2UgQGV2ZSB0byB0cmlnZ2VyIHRoZSBsaXN0ZW5lci4KICAgICAqKgogICAgID4gQXJndW1lbnRzCiAgICAgKioKICAgICAtIG5hbWUgKHN0cmluZykgbmFtZSBvZiB0aGUgZXZlbnQsIGRvdCAoYC5gKSBvciBzbGFzaCAoYC9gKSBzZXBhcmF0ZWQsIHdpdGggb3B0aW9uYWwgd2lsZGNhcmRzCiAgICAgLSBmIChmdW5jdGlvbikgZXZlbnQgaGFuZGxlciBmdW5jdGlvbgogICAgICoqCiAgICAgPSAoZnVuY3Rpb24pIHJldHVybmVkIGZ1bmN0aW9uIGFjY2VwdHMgYSBzaW5nbGUgbnVtZXJpYyBwYXJhbWV0ZXIgdGhhdCByZXByZXNlbnRzIHotaW5kZXggb2YgdGhlIGhhbmRsZXIuIEl0IGlzIGFuIG9wdGlvbmFsIGZlYXR1cmUgYW5kIG9ubHkgdXNlZCB3aGVuIHlvdSBuZWVkIHRvIGVuc3VyZSB0aGF0IHNvbWUgc3Vic2V0IG9mIGhhbmRsZXJzIHdpbGwgYmUgaW52b2tlZCBpbiBhIGdpdmVuIG9yZGVyLCBkZXNwaXRlIG9mIHRoZSBvcmRlciBvZiBhc3NpZ25tZW50LiAKICAgICA+IEV4YW1wbGU6CiAgICAgfCBldmUub24oIm1vdXNlIiwgZWF0SXQpKDIpOwogICAgIHwgZXZlLm9uKCJtb3VzZSIsIHNjcmVhbSk7CiAgICAgfCBldmUub24oIm1vdXNlIiwgY2F0Y2hJdCkoMSk7CiAgICAgKiBUaGlzIHdpbGwgZW5zdXJlIHRoYXQgYGNhdGNoSXRgIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIGJlZm9yZSBgZWF0SXRgLgogICAgICoKICAgICAqIElmIHlvdSB3YW50IHRvIHB1dCB5b3VyIGhhbmRsZXIgYmVmb3JlIG5vbi1pbmRleGVkIGhhbmRsZXJzLCBzcGVjaWZ5IGEgbmVnYXRpdmUgdmFsdWUuCiAgICAgKiBOb3RlOiBJIGFzc3VtZSBtb3N0IG9mIHRoZSB0aW1lIHlvdSBkb27igJl0IG5lZWQgdG8gd29ycnkgYWJvdXQgei1pbmRleCwgYnV0IGl04oCZcyBuaWNlIHRvIGhhdmUgdGhpcyBmZWF0dXJlIOKAnGp1c3QgaW4gY2FzZeKAnS4KICAgIFwqLwogICAgZXZlLm9uID0gZnVuY3Rpb24gKG5hbWUsIGYpIHsKICAgICAgICBuYW1lID0gU3RyaW5nKG5hbWUpOwogICAgICAgIGlmICh0eXBlb2YgZiAhPSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7fTsKICAgICAgICB9CiAgICAgICAgdmFyIG5hbWVzID0gbmFtZS5zcGxpdChjb21hc2VwYXJhdG9yKTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBuYW1lcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIChmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICAgICAgdmFyIG5hbWVzID0gbmFtZS5zcGxpdChzZXBhcmF0b3IpLAogICAgICAgICAgICAgICAgICAgIGUgPSBldmVudHMsCiAgICAgICAgICAgICAgICAgICAgZXhpc3Q7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBuYW1lcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgZSA9IGUubjsKICAgICAgICAgICAgICAgICAgICBlID0gZS5oYXNPd25Qcm9wZXJ0eShuYW1lc1tpXSkgJiYgZVtuYW1lc1tpXV0gfHwgKGVbbmFtZXNbaV1dID0ge246IHt9fSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlLmYgPSBlLmYgfHwgW107CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGUuZi5sZW5ndGg7IGkgPCBpaTsgaSsrKSBpZiAoZS5mW2ldID09IGYpIHsKICAgICAgICAgICAgICAgICAgICBleGlzdCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAhZXhpc3QgJiYgZS5mLnB1c2goZik7CiAgICAgICAgICAgIH0obmFtZXNbaV0pKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh6SW5kZXgpIHsKICAgICAgICAgICAgaWYgKCt6SW5kZXggPT0gK3pJbmRleCkgewogICAgICAgICAgICAgICAgZi56SW5kZXggPSArekluZGV4OwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH07CiAgICAvKlwKICAgICAqIGV2ZS5mCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBSZXR1cm5zIGZ1bmN0aW9uIHRoYXQgd2lsbCBmaXJlIGdpdmVuIGV2ZW50IHdpdGggb3B0aW9uYWwgYXJndW1lbnRzLgogICAgICogQXJndW1lbnRzIHRoYXQgd2lsbCBiZSBwYXNzZWQgdG8gdGhlIHJlc3VsdCBmdW5jdGlvbiB3aWxsIGJlIGFsc28KICAgICAqIGNvbmNhdGVkIHRvIHRoZSBsaXN0IG9mIGZpbmFsIGFyZ3VtZW50cy4KICAgICB8IGVsLm9uY2xpY2sgPSBldmUuZigiY2xpY2siLCAxLCAyKTsKICAgICB8IGV2ZS5vbigiY2xpY2siLCBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgIHwgICAgIGNvbnNvbGUubG9nKGEsIGIsIGMpOyAvLyAxLCAyLCBbZXZlbnQgb2JqZWN0XQogICAgIHwgfSk7CiAgICAgPiBBcmd1bWVudHMKICAgICAtIGV2ZW50IChzdHJpbmcpIGV2ZW50IG5hbWUKICAgICAtIHZhcmFyZ3MgKOKApikgYW5kIGFueSBvdGhlciBhcmd1bWVudHMKICAgICA9IChmdW5jdGlvbikgcG9zc2libGUgZXZlbnQgaGFuZGxlciBmdW5jdGlvbgogICAgXCovCiAgICBldmUuZiA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIHZhciBhdHRycyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBldmUuYXBwbHkobnVsbCwgW2V2ZW50LCBudWxsXS5jb25jYXQoYXR0cnMpLmNvbmNhdChbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCkpKTsKICAgICAgICB9OwogICAgfTsKICAgIC8qXAogICAgICogZXZlLnN0b3AKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIElzIHVzZWQgaW5zaWRlIGFuIGV2ZW50IGhhbmRsZXIgdG8gc3RvcCB0aGUgZXZlbnQsIHByZXZlbnRpbmcgYW55IHN1YnNlcXVlbnQgbGlzdGVuZXJzIGZyb20gZmlyaW5nLgogICAgXCovCiAgICBldmUuc3RvcCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBzdG9wID0gMTsKICAgIH07CiAgICAvKlwKICAgICAqIGV2ZS5udAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogQ291bGQgYmUgdXNlZCBpbnNpZGUgZXZlbnQgaGFuZGxlciB0byBmaWd1cmUgb3V0IGFjdHVhbCBuYW1lIG9mIHRoZSBldmVudC4KICAgICAqKgogICAgID4gQXJndW1lbnRzCiAgICAgKioKICAgICAtIHN1Ym5hbWUgKHN0cmluZykgI29wdGlvbmFsIHN1Ym5hbWUgb2YgdGhlIGV2ZW50CiAgICAgKioKICAgICA9IChzdHJpbmcpIG5hbWUgb2YgdGhlIGV2ZW50LCBpZiBgc3VibmFtZWAgaXMgbm90IHNwZWNpZmllZAogICAgICogb3IKICAgICA9IChib29sZWFuKSBgdHJ1ZWAsIGlmIGN1cnJlbnQgZXZlbnTigJlzIG5hbWUgY29udGFpbnMgYHN1Ym5hbWVgCiAgICBcKi8KICAgIGV2ZS5udCA9IGZ1bmN0aW9uIChzdWJuYW1lKSB7CiAgICAgICAgaWYgKHN1Ym5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWdFeHAoIig/OlxcLnxcXC98XikiICsgc3VibmFtZSArICIoPzpcXC58XFwvfCQpIikudGVzdChjdXJyZW50X2V2ZW50KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGN1cnJlbnRfZXZlbnQ7CiAgICB9OwogICAgLypcCiAgICAgKiBldmUubnRzCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBDb3VsZCBiZSB1c2VkIGluc2lkZSBldmVudCBoYW5kbGVyIHRvIGZpZ3VyZSBvdXQgYWN0dWFsIG5hbWUgb2YgdGhlIGV2ZW50LgogICAgICoqCiAgICAgKioKICAgICA9IChhcnJheSkgbmFtZXMgb2YgdGhlIGV2ZW50CiAgICBcKi8KICAgIGV2ZS5udHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGN1cnJlbnRfZXZlbnQuc3BsaXQoc2VwYXJhdG9yKTsKICAgIH07CiAgICAvKlwKICAgICAqIGV2ZS5vZmYKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJlbW92ZXMgZ2l2ZW4gZnVuY3Rpb24gZnJvbSB0aGUgbGlzdCBvZiBldmVudCBsaXN0ZW5lcnMgYXNzaWduZWQgdG8gZ2l2ZW4gbmFtZS4KICAgICAqIElmIG5vIGFyZ3VtZW50cyBzcGVjaWZpZWQgYWxsIHRoZSBldmVudHMgd2lsbCBiZSBjbGVhcmVkLgogICAgICoqCiAgICAgPiBBcmd1bWVudHMKICAgICAqKgogICAgIC0gbmFtZSAoc3RyaW5nKSBuYW1lIG9mIHRoZSBldmVudCwgZG90IChgLmApIG9yIHNsYXNoIChgL2ApIHNlcGFyYXRlZCwgd2l0aCBvcHRpb25hbCB3aWxkY2FyZHMKICAgICAtIGYgKGZ1bmN0aW9uKSBldmVudCBoYW5kbGVyIGZ1bmN0aW9uCiAgICBcKi8KICAgIC8qXAogICAgICogZXZlLnVuYmluZAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogU2VlIEBldmUub2ZmCiAgICBcKi8KICAgIGV2ZS5vZmYgPSBldmUudW5iaW5kID0gZnVuY3Rpb24gKG5hbWUsIGYpIHsKICAgICAgICBpZiAoIW5hbWUpIHsKICAgICAgICAgICAgZXZlLl9ldmVudHMgPSBldmVudHMgPSB7bjoge319OwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciBuYW1lcyA9IG5hbWUuc3BsaXQoY29tYXNlcGFyYXRvcik7CiAgICAgICAgaWYgKG5hbWVzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gbmFtZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgICAgZXZlLm9mZihuYW1lc1tpXSwgZik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBuYW1lcyA9IG5hbWUuc3BsaXQoc2VwYXJhdG9yKTsKICAgICAgICB2YXIgZSwKICAgICAgICAgICAga2V5LAogICAgICAgICAgICBzcGxpY2UsCiAgICAgICAgICAgIGksIGlpLCBqLCBqaiwKICAgICAgICAgICAgY3VyID0gW2V2ZW50c107CiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBuYW1lcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBjdXIubGVuZ3RoOyBqICs9IHNwbGljZS5sZW5ndGggLSAyKSB7CiAgICAgICAgICAgICAgICBzcGxpY2UgPSBbaiwgMV07CiAgICAgICAgICAgICAgICBlID0gY3VyW2pdLm47CiAgICAgICAgICAgICAgICBpZiAobmFtZXNbaV0gIT0gd2lsZGNhcmQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZVtuYW1lc1tpXV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3BsaWNlLnB1c2goZVtuYW1lc1tpXV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChrZXkgaW4gZSkgaWYgKGVbaGFzXShrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNwbGljZS5wdXNoKGVba2V5XSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY3VyLnNwbGljZS5hcHBseShjdXIsIHNwbGljZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjdXIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICBlID0gY3VyW2ldOwogICAgICAgICAgICB3aGlsZSAoZS5uKSB7CiAgICAgICAgICAgICAgICBpZiAoZikgewogICAgICAgICAgICAgICAgICAgIGlmIChlLmYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMCwgamogPSBlLmYubGVuZ3RoOyBqIDwgamo7IGorKykgaWYgKGUuZltqXSA9PSBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmYuc3BsaWNlKGosIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgIWUuZi5sZW5ndGggJiYgZGVsZXRlIGUuZjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZm9yIChrZXkgaW4gZS5uKSBpZiAoZS5uW2hhc10oa2V5KSAmJiBlLm5ba2V5XS5mKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmdW5jcyA9IGUubltrZXldLmY7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaiA9IDAsIGpqID0gZnVuY3MubGVuZ3RoOyBqIDwgamo7IGorKykgaWYgKGZ1bmNzW2pdID09IGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmNzLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICFmdW5jcy5sZW5ndGggJiYgZGVsZXRlIGUubltrZXldLmY7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgZS5mOwogICAgICAgICAgICAgICAgICAgIGZvciAoa2V5IGluIGUubikgaWYgKGUubltoYXNdKGtleSkgJiYgZS5uW2tleV0uZikgewogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgZS5uW2tleV0uZjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlID0gZS5uOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIC8qXAogICAgICogZXZlLm9uY2UKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIEJpbmRzIGdpdmVuIGV2ZW50IGhhbmRsZXIgd2l0aCBhIGdpdmVuIG5hbWUgdG8gb25seSBydW4gb25jZSB0aGVuIHVuYmluZCBpdHNlbGYuCiAgICAgfCBldmUub25jZSgibG9naW4iLCBmKTsKICAgICB8IGV2ZSgibG9naW4iKTsgLy8gdHJpZ2dlcnMgZgogICAgIHwgZXZlKCJsb2dpbiIpOyAvLyBubyBsaXN0ZW5lcnMKICAgICAqIFVzZSBAZXZlIHRvIHRyaWdnZXIgdGhlIGxpc3RlbmVyLgogICAgICoqCiAgICAgPiBBcmd1bWVudHMKICAgICAqKgogICAgIC0gbmFtZSAoc3RyaW5nKSBuYW1lIG9mIHRoZSBldmVudCwgZG90IChgLmApIG9yIHNsYXNoIChgL2ApIHNlcGFyYXRlZCwgd2l0aCBvcHRpb25hbCB3aWxkY2FyZHMKICAgICAtIGYgKGZ1bmN0aW9uKSBldmVudCBoYW5kbGVyIGZ1bmN0aW9uCiAgICAgKioKICAgICA9IChmdW5jdGlvbikgc2FtZSByZXR1cm4gZnVuY3Rpb24gYXMgQGV2ZS5vbgogICAgXCovCiAgICBldmUub25jZSA9IGZ1bmN0aW9uIChuYW1lLCBmKSB7CiAgICAgICAgdmFyIGYyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBldmUudW5iaW5kKG5hbWUsIGYyKTsKICAgICAgICAgICAgcmV0dXJuIGYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBldmUub24obmFtZSwgZjIpOwogICAgfTsKICAgIC8qXAogICAgICogZXZlLnZlcnNpb24KICAgICBbIHByb3BlcnR5IChzdHJpbmcpIF0KICAgICAqKgogICAgICogQ3VycmVudCB2ZXJzaW9uIG9mIHRoZSBsaWJyYXJ5LgogICAgXCovCiAgICBldmUudmVyc2lvbiA9IHZlcnNpb247CiAgICBldmUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICJZb3UgYXJlIHJ1bm5pbmcgRXZlICIgKyB2ZXJzaW9uOwogICAgfTsKICAgICh0eXBlb2YgbW9kdWxlICE9ICJ1bmRlZmluZWQiICYmIG1vZHVsZS5leHBvcnRzKSA/IChtb2R1bGUuZXhwb3J0cyA9IGV2ZSkgOiAodHlwZW9mIGRlZmluZSA9PT0gImZ1bmN0aW9uIiAmJiBkZWZpbmUuYW1kID8gKGRlZmluZSgiZXZlIiwgW10sIGZ1bmN0aW9uKCkgeyByZXR1cm4gZXZlOyB9KSkgOiAoZ2xvYi5ldmUgPSBldmUpKTsKfSkodGhpcyk7CgooZnVuY3Rpb24gKGdsb2IsIGZhY3RvcnkpIHsKICAgIC8vIEFNRCBzdXBwb3J0CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gImZ1bmN0aW9uIiAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgLy8gRGVmaW5lIGFzIGFuIGFub255bW91cyBtb2R1bGUKICAgICAgICBkZWZpbmUoWyJldmUiXSwgZnVuY3Rpb24oIGV2ZSApIHsKICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkoZ2xvYiwgZXZlKTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgLy8gQnJvd3NlciBnbG9iYWxzIChnbG9iIGlzIHdpbmRvdykKICAgICAgICAvLyBTbmFwIGFkZHMgaXRzZWxmIHRvIHdpbmRvdwogICAgICAgIGZhY3RvcnkoZ2xvYiwgZ2xvYi5ldmUpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uICh3aW5kb3csIGV2ZSkgewovLyBDb3B5cmlnaHQgKGMpIDIwMTMgQWRvYmUgU3lzdGVtcyBJbmNvcnBvcmF0ZWQuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCi8vIAovLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKLy8geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgovLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKLy8gCi8vIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAovLyAKLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQovLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAovLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KLy8gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAovLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KdmFyIG1pbmEgPSAoZnVuY3Rpb24gKGV2ZSkgewogICAgdmFyIGFuaW1hdGlvbnMgPSB7fSwKICAgIHJlcXVlc3RBbmltRnJhbWUgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lICAgICAgIHx8CiAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fAogICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgICAgfHwKICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub1JlcXVlc3RBbmltYXRpb25GcmFtZSAgICAgIHx8CiAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lICAgICB8fAogICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNhbGxiYWNrLCAxNik7CiAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgIGlzQXJyYXkgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBBcnJheSB8fAogICAgICAgICAgICBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYSkgPT0gIltvYmplY3QgQXJyYXldIjsKICAgIH0sCiAgICBpZGdlbiA9IDAsCiAgICBpZHByZWZpeCA9ICJNIiArICgrbmV3IERhdGUpLnRvU3RyaW5nKDM2KSwKICAgIElEID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBpZHByZWZpeCArIChpZGdlbisrKS50b1N0cmluZygzNik7CiAgICB9LAogICAgZGlmZiA9IGZ1bmN0aW9uIChhLCBiLCBBLCBCKSB7CiAgICAgICAgaWYgKGlzQXJyYXkoYSkpIHsKICAgICAgICAgICAgcmVzID0gW107CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGEubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgICAgcmVzW2ldID0gZGlmZihhW2ldLCBiLCBBW2ldLCBCKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KICAgICAgICB2YXIgZGlmID0gKEEgLSBhKSAvIChCIC0gYik7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChiYikgewogICAgICAgICAgICByZXR1cm4gYSArIGRpZiAqIChiYiAtIGIpOwogICAgICAgIH07CiAgICB9LAogICAgdGltZXIgPSBEYXRlLm5vdyB8fCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICtuZXcgRGF0ZTsKICAgIH0sCiAgICBzdGEgPSBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gYS5zOwogICAgICAgIH0KICAgICAgICB2YXIgZHMgPSBhLnMgLSB2YWw7CiAgICAgICAgYS5iICs9IGEuZHVyICogZHM7CiAgICAgICAgYS5CICs9IGEuZHVyICogZHM7CiAgICAgICAgYS5zID0gdmFsOwogICAgfSwKICAgIHNwZWVkID0gZnVuY3Rpb24gKHZhbCkgewogICAgICAgIHZhciBhID0gdGhpczsKICAgICAgICBpZiAodmFsID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIGEuc3BkOwogICAgICAgIH0KICAgICAgICBhLnNwZCA9IHZhbDsKICAgIH0sCiAgICBkdXJhdGlvbiA9IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICB2YXIgYSA9IHRoaXM7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBhLmR1cjsKICAgICAgICB9CiAgICAgICAgYS5zID0gYS5zICogdmFsIC8gYS5kdXI7CiAgICAgICAgYS5kdXIgPSB2YWw7CiAgICB9LAogICAgc3RvcGl0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBhID0gdGhpczsKICAgICAgICBkZWxldGUgYW5pbWF0aW9uc1thLmlkXTsKICAgICAgICBhLnVwZGF0ZSgpOwogICAgICAgIGV2ZSgibWluYS5zdG9wLiIgKyBhLmlkLCBhKTsKICAgIH0sCiAgICBwYXVzZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYSA9IHRoaXM7CiAgICAgICAgaWYgKGEucGRpZikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBhbmltYXRpb25zW2EuaWRdOwogICAgICAgIGEudXBkYXRlKCk7CiAgICAgICAgYS5wZGlmID0gYS5nZXQoKSAtIGEuYjsKICAgIH0sCiAgICByZXN1bWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzOwogICAgICAgIGlmICghYS5wZGlmKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYS5iID0gYS5nZXQoKSAtIGEucGRpZjsKICAgICAgICBkZWxldGUgYS5wZGlmOwogICAgICAgIGFuaW1hdGlvbnNbYS5pZF0gPSBhOwogICAgfSwKICAgIHVwZGF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYSA9IHRoaXMsCiAgICAgICAgICAgIHJlczsKICAgICAgICBpZiAoaXNBcnJheShhLnN0YXJ0KSkgewogICAgICAgICAgICByZXMgPSBbXTsKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpqID0gYS5zdGFydC5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgICAgICAgICByZXNbal0gPSArYS5zdGFydFtqXSArCiAgICAgICAgICAgICAgICAgICAgKGEuZW5kW2pdIC0gYS5zdGFydFtqXSkgKiBhLmVhc2luZyhhLnMpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzID0gK2Euc3RhcnQgKyAoYS5lbmQgLSBhLnN0YXJ0KSAqIGEuZWFzaW5nKGEucyk7CiAgICAgICAgfQogICAgICAgIGEuc2V0KHJlcyk7CiAgICB9LAogICAgZnJhbWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGxlbiA9IDA7CiAgICAgICAgZm9yICh2YXIgaSBpbiBhbmltYXRpb25zKSBpZiAoYW5pbWF0aW9ucy5oYXNPd25Qcm9wZXJ0eShpKSkgewogICAgICAgICAgICB2YXIgYSA9IGFuaW1hdGlvbnNbaV0sCiAgICAgICAgICAgICAgICBiID0gYS5nZXQoKSwKICAgICAgICAgICAgICAgIHJlczsKICAgICAgICAgICAgbGVuKys7CiAgICAgICAgICAgIGEucyA9IChiIC0gYS5iKSAvIChhLmR1ciAvIGEuc3BkKTsKICAgICAgICAgICAgaWYgKGEucyA+PSAxKSB7CiAgICAgICAgICAgICAgICBkZWxldGUgYW5pbWF0aW9uc1tpXTsKICAgICAgICAgICAgICAgIGEucyA9IDE7CiAgICAgICAgICAgICAgICBsZW4tLTsKICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBldmUoIm1pbmEuZmluaXNoLiIgKyBhLmlkLCBhKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0oYSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGEudXBkYXRlKCk7CiAgICAgICAgfQogICAgICAgIGxlbiAmJiByZXF1ZXN0QW5pbUZyYW1lKGZyYW1lKTsKICAgIH0sCiAgICAvKlwKICAgICAqIG1pbmEKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIEdlbmVyaWMgYW5pbWF0aW9uIG9mIG51bWJlcnMKICAgICAqKgogICAgIC0gYSAobnVtYmVyKSBzdGFydCBfc2xhdmVfIG51bWJlcgogICAgIC0gQSAobnVtYmVyKSBlbmQgX3NsYXZlXyBudW1iZXIKICAgICAtIGIgKG51bWJlcikgc3RhcnQgX21hc3Rlcl8gbnVtYmVyIChzdGFydCB0aW1lIGluIGdlbmVyYWwgY2FzZSkKICAgICAtIEIgKG51bWJlcikgZW5kIF9tYXN0ZXJfIG51bWJlciAoZW5kIHRpbWUgaW4gZ2VyZWFsIGNhc2UpCiAgICAgLSBnZXQgKGZ1bmN0aW9uKSBnZXR0ZXIgb2YgX21hc3Rlcl8gbnVtYmVyIChzZWUgQG1pbmEudGltZSkKICAgICAtIHNldCAoZnVuY3Rpb24pIHNldHRlciBvZiBfc2xhdmVfIG51bWJlcgogICAgIC0gZWFzaW5nIChmdW5jdGlvbikgI29wdGlvbmFsIGVhc2luZyBmdW5jdGlvbiwgZGVmYXVsdCBpcyBAbWluYS5saW5lYXIKICAgICA9IChvYmplY3QpIGFuaW1hdGlvbiBkZXNjcmlwdG9yCiAgICAgbyB7CiAgICAgbyAgICAgICAgIGlkIChzdHJpbmcpIGFuaW1hdGlvbiBpZCwKICAgICBvICAgICAgICAgc3RhcnQgKG51bWJlcikgc3RhcnQgX3NsYXZlXyBudW1iZXIsCiAgICAgbyAgICAgICAgIGVuZCAobnVtYmVyKSBlbmQgX3NsYXZlXyBudW1iZXIsCiAgICAgbyAgICAgICAgIGIgKG51bWJlcikgc3RhcnQgX21hc3Rlcl8gbnVtYmVyLAogICAgIG8gICAgICAgICBzIChudW1iZXIpIGFuaW1hdGlvbiBzdGF0dXMgKDAuLjEpLAogICAgIG8gICAgICAgICBkdXIgKG51bWJlcikgYW5pbWF0aW9uIGR1cmF0aW9uLAogICAgIG8gICAgICAgICBzcGQgKG51bWJlcikgYW5pbWF0aW9uIHNwZWVkLAogICAgIG8gICAgICAgICBnZXQgKGZ1bmN0aW9uKSBnZXR0ZXIgb2YgX21hc3Rlcl8gbnVtYmVyIChzZWUgQG1pbmEudGltZSksCiAgICAgbyAgICAgICAgIHNldCAoZnVuY3Rpb24pIHNldHRlciBvZiBfc2xhdmVfIG51bWJlciwKICAgICBvICAgICAgICAgZWFzaW5nIChmdW5jdGlvbikgZWFzaW5nIGZ1bmN0aW9uLCBkZWZhdWx0IGlzIEBtaW5hLmxpbmVhciwKICAgICBvICAgICAgICAgc3RhdHVzIChmdW5jdGlvbikgc3RhdHVzIGdldHRlci9zZXR0ZXIsCiAgICAgbyAgICAgICAgIHNwZWVkIChmdW5jdGlvbikgc3BlZWQgZ2V0dGVyL3NldHRlciwKICAgICBvICAgICAgICAgZHVyYXRpb24gKGZ1bmN0aW9uKSBkdXJhdGlvbiBnZXR0ZXIvc2V0dGVyLAogICAgIG8gICAgICAgICBzdG9wIChmdW5jdGlvbikgYW5pbWF0aW9uIHN0b3BwZXIKICAgICBvICAgICAgICAgcGF1c2UgKGZ1bmN0aW9uKSBwYXVzZXMgdGhlIGFuaW1hdGlvbgogICAgIG8gICAgICAgICByZXN1bWUgKGZ1bmN0aW9uKSByZXN1bWVzIHRoZSBhbmltYXRpb24KICAgICBvICAgICAgICAgdXBkYXRlIChmdW5jdGlvbikgY2FsbGVzIHNldHRlciB3aXRoIHRoZSByaWdodCB2YWx1ZSBvZiB0aGUgYW5pbWF0aW9uCiAgICAgbyB9CiAgICBcKi8KICAgIG1pbmEgPSBmdW5jdGlvbiAoYSwgQSwgYiwgQiwgZ2V0LCBzZXQsIGVhc2luZykgewogICAgICAgIHZhciBhbmltID0gewogICAgICAgICAgICBpZDogSUQoKSwKICAgICAgICAgICAgc3RhcnQ6IGEsCiAgICAgICAgICAgIGVuZDogQSwKICAgICAgICAgICAgYjogYiwKICAgICAgICAgICAgczogMCwKICAgICAgICAgICAgZHVyOiBCIC0gYiwKICAgICAgICAgICAgc3BkOiAxLAogICAgICAgICAgICBnZXQ6IGdldCwKICAgICAgICAgICAgc2V0OiBzZXQsCiAgICAgICAgICAgIGVhc2luZzogZWFzaW5nIHx8IG1pbmEubGluZWFyLAogICAgICAgICAgICBzdGF0dXM6IHN0YSwKICAgICAgICAgICAgc3BlZWQ6IHNwZWVkLAogICAgICAgICAgICBkdXJhdGlvbjogZHVyYXRpb24sCiAgICAgICAgICAgIHN0b3A6IHN0b3BpdCwKICAgICAgICAgICAgcGF1c2U6IHBhdXNlLAogICAgICAgICAgICByZXN1bWU6IHJlc3VtZSwKICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGUKICAgICAgICB9OwogICAgICAgIGFuaW1hdGlvbnNbYW5pbS5pZF0gPSBhbmltOwogICAgICAgIHZhciBsZW4gPSAwLCBpOwogICAgICAgIGZvciAoaSBpbiBhbmltYXRpb25zKSBpZiAoYW5pbWF0aW9ucy5oYXNPd25Qcm9wZXJ0eShpKSkgewogICAgICAgICAgICBsZW4rKzsKICAgICAgICAgICAgaWYgKGxlbiA9PSAyKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsZW4gPT0gMSAmJiByZXF1ZXN0QW5pbUZyYW1lKGZyYW1lKTsKICAgICAgICByZXR1cm4gYW5pbTsKICAgIH07CiAgICAvKlwKICAgICAqIG1pbmEudGltZQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogUmV0dXJucyB0aGUgY3VycmVudCB0aW1lLiBFcXVpdmFsZW50IHRvOgogICAgIHwgZnVuY3Rpb24gKCkgewogICAgIHwgICAgIHJldHVybiAobmV3IERhdGUpLmdldFRpbWUoKTsKICAgICB8IH0KICAgIFwqLwogICAgbWluYS50aW1lID0gdGltZXI7CiAgICAvKlwKICAgICAqIG1pbmEuZ2V0QnlJZAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogUmV0dXJucyBhbiBhbmltYXRpb24gYnkgaXRzIGlkCiAgICAgLSBpZCAoc3RyaW5nKSBhbmltYXRpb24ncyBpZAogICAgID0gKG9iamVjdCkgU2VlIEBtaW5hCiAgICBcKi8KICAgIG1pbmEuZ2V0QnlJZCA9IGZ1bmN0aW9uIChpZCkgewogICAgICAgIHJldHVybiBhbmltYXRpb25zW2lkXSB8fCBudWxsOwogICAgfTsKCiAgICAvKlwKICAgICAqIG1pbmEubGluZWFyCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBEZWZhdWx0IGxpbmVhciBlYXNpbmcKICAgICAtIG4gKG51bWJlcikgaW5wdXQgMC4uMQogICAgID0gKG51bWJlcikgb3V0cHV0IDAuLjEKICAgIFwqLwogICAgbWluYS5saW5lYXIgPSBmdW5jdGlvbiAobikgewogICAgICAgIHJldHVybiBuOwogICAgfTsKICAgIC8qXAogICAgICogbWluYS5lYXNlb3V0CiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBFYXNlb3V0IGVhc2luZwogICAgIC0gbiAobnVtYmVyKSBpbnB1dCAwLi4xCiAgICAgPSAobnVtYmVyKSBvdXRwdXQgMC4uMQogICAgXCovCiAgICBtaW5hLmVhc2VvdXQgPSBmdW5jdGlvbiAobikgewogICAgICAgIHJldHVybiBNYXRoLnBvdyhuLCAxLjcpOwogICAgfTsKICAgIC8qXAogICAgICogbWluYS5lYXNlaW4KICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIEVhc2VpbiBlYXNpbmcKICAgICAtIG4gKG51bWJlcikgaW5wdXQgMC4uMQogICAgID0gKG51bWJlcikgb3V0cHV0IDAuLjEKICAgIFwqLwogICAgbWluYS5lYXNlaW4gPSBmdW5jdGlvbiAobikgewogICAgICAgIHJldHVybiBNYXRoLnBvdyhuLCAuNDgpOwogICAgfTsKICAgIC8qXAogICAgICogbWluYS5lYXNlaW5vdXQKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIEVhc2Vpbm91dCBlYXNpbmcKICAgICAtIG4gKG51bWJlcikgaW5wdXQgMC4uMQogICAgID0gKG51bWJlcikgb3V0cHV0IDAuLjEKICAgIFwqLwogICAgbWluYS5lYXNlaW5vdXQgPSBmdW5jdGlvbiAobikgewogICAgICAgIGlmIChuID09IDEpIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICAgIGlmIChuID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHZhciBxID0gLjQ4IC0gbiAvIDEuMDQsCiAgICAgICAgICAgIFEgPSBNYXRoLnNxcnQoLjE3MzQgKyBxICogcSksCiAgICAgICAgICAgIHggPSBRIC0gcSwKICAgICAgICAgICAgWCA9IE1hdGgucG93KE1hdGguYWJzKHgpLCAxIC8gMykgKiAoeCA8IDAgPyAtMSA6IDEpLAogICAgICAgICAgICB5ID0gLVEgLSBxLAogICAgICAgICAgICBZID0gTWF0aC5wb3coTWF0aC5hYnMoeSksIDEgLyAzKSAqICh5IDwgMCA/IC0xIDogMSksCiAgICAgICAgICAgIHQgPSBYICsgWSArIC41OwogICAgICAgIHJldHVybiAoMSAtIHQpICogMyAqIHQgKiB0ICsgdCAqIHQgKiB0OwogICAgfTsKICAgIC8qXAogICAgICogbWluYS5iYWNraW4KICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIEJhY2tpbiBlYXNpbmcKICAgICAtIG4gKG51bWJlcikgaW5wdXQgMC4uMQogICAgID0gKG51bWJlcikgb3V0cHV0IDAuLjEKICAgIFwqLwogICAgbWluYS5iYWNraW4gPSBmdW5jdGlvbiAobikgewogICAgICAgIGlmIChuID09IDEpIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICAgIHZhciBzID0gMS43MDE1ODsKICAgICAgICByZXR1cm4gbiAqIG4gKiAoKHMgKyAxKSAqIG4gLSBzKTsKICAgIH07CiAgICAvKlwKICAgICAqIG1pbmEuYmFja291dAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogQmFja291dCBlYXNpbmcKICAgICAtIG4gKG51bWJlcikgaW5wdXQgMC4uMQogICAgID0gKG51bWJlcikgb3V0cHV0IDAuLjEKICAgIFwqLwogICAgbWluYS5iYWNrb3V0ID0gZnVuY3Rpb24gKG4pIHsKICAgICAgICBpZiAobiA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBuID0gbiAtIDE7CiAgICAgICAgdmFyIHMgPSAxLjcwMTU4OwogICAgICAgIHJldHVybiBuICogbiAqICgocyArIDEpICogbiArIHMpICsgMTsKICAgIH07CiAgICAvKlwKICAgICAqIG1pbmEuZWxhc3RpYwogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogRWxhc3RpYyBlYXNpbmcKICAgICAtIG4gKG51bWJlcikgaW5wdXQgMC4uMQogICAgID0gKG51bWJlcikgb3V0cHV0IDAuLjEKICAgIFwqLwogICAgbWluYS5lbGFzdGljID0gZnVuY3Rpb24gKG4pIHsKICAgICAgICBpZiAobiA9PSAhIW4pIHsKICAgICAgICAgICAgcmV0dXJuIG47CiAgICAgICAgfQogICAgICAgIHJldHVybiBNYXRoLnBvdygyLCAtMTAgKiBuKSAqIE1hdGguc2luKChuIC0gLjA3NSkgKgogICAgICAgICAgICAoMiAqIE1hdGguUEkpIC8gLjMpICsgMTsKICAgIH07CiAgICAvKlwKICAgICAqIG1pbmEuYm91bmNlCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBCb3VuY2UgZWFzaW5nCiAgICAgLSBuIChudW1iZXIpIGlucHV0IDAuLjEKICAgICA9IChudW1iZXIpIG91dHB1dCAwLi4xCiAgICBcKi8KICAgIG1pbmEuYm91bmNlID0gZnVuY3Rpb24gKG4pIHsKICAgICAgICB2YXIgcyA9IDcuNTYyNSwKICAgICAgICAgICAgcCA9IDIuNzUsCiAgICAgICAgICAgIGw7CiAgICAgICAgaWYgKG4gPCAoMSAvIHApKSB7CiAgICAgICAgICAgIGwgPSBzICogbiAqIG47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKG4gPCAoMiAvIHApKSB7CiAgICAgICAgICAgICAgICBuIC09ICgxLjUgLyBwKTsKICAgICAgICAgICAgICAgIGwgPSBzICogbiAqIG4gKyAuNzU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAobiA8ICgyLjUgLyBwKSkgewogICAgICAgICAgICAgICAgICAgIG4gLT0gKDIuMjUgLyBwKTsKICAgICAgICAgICAgICAgICAgICBsID0gcyAqIG4gKiBuICsgLjkzNzU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG4gLT0gKDIuNjI1IC8gcCk7CiAgICAgICAgICAgICAgICAgICAgbCA9IHMgKiBuICogbiArIC45ODQzNzU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGw7CiAgICB9OwogICAgd2luZG93Lm1pbmEgPSBtaW5hOwogICAgcmV0dXJuIG1pbmE7Cn0pKHR5cGVvZiBldmUgPT0gInVuZGVmaW5lZCIgPyBmdW5jdGlvbiAoKSB7fSA6IGV2ZSk7Ci8vIENvcHlyaWdodCAoYykgMjAxMyBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KLy8gCi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwovLyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCi8vIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAovLyAKLy8gaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCi8vIAovLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCi8vIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCi8vIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgovLyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCi8vIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoKdmFyIFNuYXAgPSAoZnVuY3Rpb24oKSB7ClNuYXAudmVyc2lvbiA9ICIwLjMuMCI7Ci8qXAogKiBTbmFwCiBbIG1ldGhvZCBdCiAqKgogKiBDcmVhdGVzIGEgZHJhd2luZyBzdXJmYWNlIG9yIHdyYXBzIGV4aXN0aW5nIFNWRyBlbGVtZW50LgogKioKIC0gd2lkdGggKG51bWJlcnxzdHJpbmcpIHdpZHRoIG9mIHN1cmZhY2UKIC0gaGVpZ2h0IChudW1iZXJ8c3RyaW5nKSBoZWlnaHQgb2Ygc3VyZmFjZQogKiBvcgogLSBET00gKFNWR0VsZW1lbnQpIGVsZW1lbnQgdG8gYmUgd3JhcHBlZCBpbnRvIFNuYXAgc3RydWN0dXJlCiAqIG9yCiAtIGFycmF5IChhcnJheSkgYXJyYXkgb2YgZWxlbWVudHMgKHdpbGwgcmV0dXJuIHNldCBvZiBlbGVtZW50cykKICogb3IKIC0gcXVlcnkgKHN0cmluZykgQ1NTIHF1ZXJ5IHNlbGVjdG9yCiA9IChvYmplY3QpIEBFbGVtZW50ClwqLwpmdW5jdGlvbiBTbmFwKHcsIGgpIHsKICAgIGlmICh3KSB7CiAgICAgICAgaWYgKHcudGFnTmFtZSkgewogICAgICAgICAgICByZXR1cm4gd3JhcCh3KTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzKHcsICJhcnJheSIpICYmIFNuYXAuc2V0KSB7CiAgICAgICAgICAgIHJldHVybiBTbmFwLnNldC5hcHBseShTbmFwLCB3KTsKICAgICAgICB9CiAgICAgICAgaWYgKHcgaW5zdGFuY2VvZiBFbGVtZW50KSB7CiAgICAgICAgICAgIHJldHVybiB3OwogICAgICAgIH0KICAgICAgICBpZiAoaCA9PSBudWxsKSB7CiAgICAgICAgICAgIHcgPSBnbG9iLmRvYy5xdWVyeVNlbGVjdG9yKHcpOwogICAgICAgICAgICByZXR1cm4gd3JhcCh3KTsKICAgICAgICB9CiAgICB9CiAgICB3ID0gdyA9PSBudWxsID8gIjEwMCUiIDogdzsKICAgIGggPSBoID09IG51bGwgPyAiMTAwJSIgOiBoOwogICAgcmV0dXJuIG5ldyBQYXBlcih3LCBoKTsKfQpTbmFwLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuICJTbmFwIHYiICsgdGhpcy52ZXJzaW9uOwp9OwpTbmFwLl8gPSB7fTsKdmFyIGdsb2IgPSB7CiAgICB3aW46IHdpbmRvdywKICAgIGRvYzogd2luZG93LmRvY3VtZW50Cn07ClNuYXAuXy5nbG9iID0gZ2xvYjsKdmFyIGhhcyA9ICJoYXNPd25Qcm9wZXJ0eSIsCiAgICBTdHIgPSBTdHJpbmcsCiAgICB0b0Zsb2F0ID0gcGFyc2VGbG9hdCwKICAgIHRvSW50ID0gcGFyc2VJbnQsCiAgICBtYXRoID0gTWF0aCwKICAgIG1tYXggPSBtYXRoLm1heCwKICAgIG1taW4gPSBtYXRoLm1pbiwKICAgIGFicyA9IG1hdGguYWJzLAogICAgcG93ID0gbWF0aC5wb3csCiAgICBQSSA9IG1hdGguUEksCiAgICByb3VuZCA9IG1hdGgucm91bmQsCiAgICBFID0gIiIsCiAgICBTID0gIiAiLAogICAgb2JqZWN0VG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLAogICAgSVNVUkwgPSAvXnVybFwoWyciXT8oW15cKV0rPylbJyJdP1wpJC9pLAogICAgY29sb3VyUmVnRXhwID0gL15ccyooKCNbYS1mXGRdezZ9KXwoI1thLWZcZF17M30pfHJnYmE/XChccyooW1xkXC5dKyU/XHMqLFxzKltcZFwuXSslP1xzKixccypbXGRcLl0rJT8oPzpccyosXHMqW1xkXC5dKyU/KT8pXHMqXCl8aHNiYT9cKFxzKihbXGRcLl0rKD86ZGVnfFx4YjB8JSk/XHMqLFxzKltcZFwuXSslP1xzKixccypbXGRcLl0rKD86JT9ccyosXHMqW1xkXC5dKyk/JT8pXHMqXCl8aHNsYT9cKFxzKihbXGRcLl0rKD86ZGVnfFx4YjB8JSk/XHMqLFxzKltcZFwuXSslP1xzKixccypbXGRcLl0rKD86JT9ccyosXHMqW1xkXC5dKyk/JT8pXHMqXCkpXHMqJC9pLAogICAgYmV6aWVycmcgPSAvXig/OmN1YmljLSk/YmV6aWVyXCgoW14sXSspLChbXixdKyksKFteLF0rKSwoW15cKV0rKVwpLywKICAgIHJlVVJMVmFsdWUgPSAvXnVybFwoIz8oW14pXSspXCkkLywKICAgIHNwYWNlcyA9ICJceDA5XHgwYVx4MGJceDBjXHgwZFx4MjBceGEwXHUxNjgwXHUxODBlXHUyMDAwXHUyMDAxXHUyMDAyXHUyMDAzXHUyMDA0XHUyMDA1XHUyMDA2XHUyMDA3XHUyMDA4XHUyMDA5XHUyMDBhXHUyMDJmXHUyMDVmXHUzMDAwXHUyMDI4XHUyMDI5IiwKICAgIHNlcGFyYXRvciA9IFNuYXAuXy5zZXBhcmF0b3IgPSBuZXcgUmVnRXhwKCJbLCIgKyBzcGFjZXMgKyAiXSsiKSwKICAgIHdoaXRlc3BhY2UgPSBuZXcgUmVnRXhwKCJbIiArIHNwYWNlcyArICJdIiwgImciKSwKICAgIGNvbW1hU3BhY2VzID0gbmV3IFJlZ0V4cCgiWyIgKyBzcGFjZXMgKyAiXSosWyIgKyBzcGFjZXMgKyAiXSoiKSwKICAgIGhzcmcgPSB7aHM6IDEsIHJnOiAxfSwKICAgIHBhdGhDb21tYW5kID0gbmV3IFJlZ0V4cCgiKFthLXpdKVsiICsgc3BhY2VzICsgIixdKigoLT9cXGQqXFwuP1xcZCooPzplW1xcLStdP1xcZCspP1siICsgc3BhY2VzICsgIl0qLD9bIiArIHNwYWNlcyArICJdKikrKSIsICJpZyIpLAogICAgdENvbW1hbmQgPSBuZXcgUmVnRXhwKCIoW3JzdG1dKVsiICsgc3BhY2VzICsgIixdKigoLT9cXGQqXFwuP1xcZCooPzplW1xcLStdP1xcZCspP1siICsgc3BhY2VzICsgIl0qLD9bIiArIHNwYWNlcyArICJdKikrKSIsICJpZyIpLAogICAgcGF0aFZhbHVlcyA9IG5ldyBSZWdFeHAoIigtP1xcZCpcXC4/XFxkKig/OmVbXFwtK10/XFxkKyk/KVsiICsgc3BhY2VzICsgIl0qLD9bIiArIHNwYWNlcyArICJdKiIsICJpZyIpLAogICAgaWRnZW4gPSAwLAogICAgaWRwcmVmaXggPSAiUyIgKyAoK25ldyBEYXRlKS50b1N0cmluZygzNiksCiAgICBJRCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gaWRwcmVmaXggKyAoaWRnZW4rKykudG9TdHJpbmcoMzYpOwogICAgfSwKICAgIHhsaW5rID0gImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiLAogICAgeG1sbnMgPSAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLAogICAgaHViID0ge30sCiAgICBVUkwgPSBTbmFwLnVybCA9IGZ1bmN0aW9uICh1cmwpIHsKICAgICAgICByZXR1cm4gInVybCgnIyIgKyB1cmwgKyAiJykiOwogICAgfTsKCmZ1bmN0aW9uICQoZWwsIGF0dHIpIHsKICAgIGlmIChhdHRyKSB7CiAgICAgICAgaWYgKGVsID09ICIjdGV4dCIpIHsKICAgICAgICAgICAgZWwgPSBnbG9iLmRvYy5jcmVhdGVUZXh0Tm9kZShhdHRyLnRleHQgfHwgIiIpOwogICAgICAgIH0KICAgICAgICBpZiAodHlwZW9mIGVsID09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGVsID0gJChlbCk7CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2YgYXR0ciA9PSAic3RyaW5nIikgewogICAgICAgICAgICBpZiAoYXR0ci5zdWJzdHJpbmcoMCwgNikgPT0gInhsaW5rOiIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBlbC5nZXRBdHRyaWJ1dGVOUyh4bGluaywgYXR0ci5zdWJzdHJpbmcoNikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhdHRyLnN1YnN0cmluZygwLCA0KSA9PSAieG1sOiIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBlbC5nZXRBdHRyaWJ1dGVOUyh4bWxucywgYXR0ci5zdWJzdHJpbmcoNCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBlbC5nZXRBdHRyaWJ1dGUoYXR0cik7CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGtleSBpbiBhdHRyKSBpZiAoYXR0cltoYXNdKGtleSkpIHsKICAgICAgICAgICAgdmFyIHZhbCA9IFN0cihhdHRyW2tleV0pOwogICAgICAgICAgICBpZiAodmFsKSB7CiAgICAgICAgICAgICAgICBpZiAoa2V5LnN1YnN0cmluZygwLCA2KSA9PSAieGxpbms6IikgewogICAgICAgICAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZU5TKHhsaW5rLCBrZXkuc3Vic3RyaW5nKDYpLCB2YWwpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChrZXkuc3Vic3RyaW5nKDAsIDQpID09ICJ4bWw6IikgewogICAgICAgICAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZU5TKHhtbG5zLCBrZXkuc3Vic3RyaW5nKDQpLCB2YWwpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoa2V5LCB2YWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZWwucmVtb3ZlQXR0cmlidXRlKGtleSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIGVsID0gZ2xvYi5kb2MuY3JlYXRlRWxlbWVudE5TKHhtbG5zLCBlbCk7CiAgICAgICAgLy8gZWwuc3R5bGUgJiYgKGVsLnN0eWxlLndlYmtpdFRhcEhpZ2hsaWdodENvbG9yID0gInJnYmEoMCwwLDAsMCkiKTsKICAgIH0KICAgIHJldHVybiBlbDsKfQpTbmFwLl8uJCA9ICQ7ClNuYXAuXy5pZCA9IElEOwpmdW5jdGlvbiBnZXRBdHRycyhlbCkgewogICAgdmFyIGF0dHJzID0gZWwuYXR0cmlidXRlcywKICAgICAgICBuYW1lLAogICAgICAgIG91dCA9IHt9OwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhdHRycy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChhdHRyc1tpXS5uYW1lc3BhY2VVUkkgPT0geGxpbmspIHsKICAgICAgICAgICAgbmFtZSA9ICJ4bGluazoiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5hbWUgPSAiIjsKICAgICAgICB9CiAgICAgICAgbmFtZSArPSBhdHRyc1tpXS5uYW1lOwogICAgICAgIG91dFtuYW1lXSA9IGF0dHJzW2ldLnRleHRDb250ZW50OwogICAgfQogICAgcmV0dXJuIG91dDsKfQpmdW5jdGlvbiBpcyhvLCB0eXBlKSB7CiAgICB0eXBlID0gU3RyLnByb3RvdHlwZS50b0xvd2VyQ2FzZS5jYWxsKHR5cGUpOwogICAgaWYgKHR5cGUgPT0gImZpbml0ZSIpIHsKICAgICAgICByZXR1cm4gaXNGaW5pdGUobyk7CiAgICB9CiAgICBpZiAodHlwZSA9PSAiYXJyYXkiICYmCiAgICAgICAgKG8gaW5zdGFuY2VvZiBBcnJheSB8fCBBcnJheS5pc0FycmF5ICYmIEFycmF5LmlzQXJyYXkobykpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gICh0eXBlID09ICJudWxsIiAmJiBvID09PSBudWxsKSB8fAogICAgICAgICAgICAodHlwZSA9PSB0eXBlb2YgbyAmJiBvICE9PSBudWxsKSB8fAogICAgICAgICAgICAodHlwZSA9PSAib2JqZWN0IiAmJiBvID09PSBPYmplY3QobykpIHx8CiAgICAgICAgICAgIG9iamVjdFRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpLnRvTG93ZXJDYXNlKCkgPT0gdHlwZTsKfQovKlwKICogU25hcC5mb3JtYXQKIFsgbWV0aG9kIF0KICoqCiAqIFJlcGxhY2VzIGNvbnN0cnVjdGlvbiBvZiB0eXBlIGB7PG5hbWU+fWAgdG8gdGhlIGNvcnJlc3BvbmRpbmcgYXJndW1lbnQKICoqCiAtIHRva2VuIChzdHJpbmcpIHN0cmluZyB0byBmb3JtYXQKIC0ganNvbiAob2JqZWN0KSBvYmplY3Qgd2hpY2ggcHJvcGVydGllcyBhcmUgdXNlZCBhcyBhIHJlcGxhY2VtZW50CiA9IChzdHJpbmcpIGZvcm1hdHRlZCBzdHJpbmcKID4gVXNhZ2UKIHwgLy8gdGhpcyBkcmF3cyBhIHJlY3Rhbmd1bGFyIHNoYXBlIGVxdWl2YWxlbnQgdG8gIk0xMCwyMGg0MHY1MGgtNDB6IgogfCBwYXBlci5wYXRoKFNuYXAuZm9ybWF0KCJNe3h9LHt5fWh7ZGltLndpZHRofXZ7ZGltLmhlaWdodH1oe2RpbVsnbmVnYXRpdmUgd2lkdGgnXX16IiwgewogfCAgICAgeDogMTAsCiB8ICAgICB5OiAyMCwKIHwgICAgIGRpbTogewogfCAgICAgICAgIHdpZHRoOiA0MCwKIHwgICAgICAgICBoZWlnaHQ6IDUwLAogfCAgICAgICAgICJuZWdhdGl2ZSB3aWR0aCI6IC00MAogfCAgICAgfQogfCB9KSk7ClwqLwpTbmFwLmZvcm1hdCA9IChmdW5jdGlvbiAoKSB7CiAgICB2YXIgdG9rZW5SZWdleCA9IC9ceyhbXlx9XSspXH0vZywKICAgICAgICBvYmpOb3RhdGlvblJlZ2V4ID0gLyg/Oig/Ol58XC4pKC4rPykoPz1cW3xcLnwkfFwoKXxcWygnfCIpKC4rPylcMlxdKShcKFwpKT8vZywgLy8gbWF0Y2hlcyAueHh4eHggb3IgWyJ4eHh4eCJdIHRvIHJ1biBvdmVyIG9iamVjdCBwcm9wZXJ0aWVzCiAgICAgICAgcmVwbGFjZXIgPSBmdW5jdGlvbiAoYWxsLCBrZXksIG9iaikgewogICAgICAgICAgICB2YXIgcmVzID0gb2JqOwogICAgICAgICAgICBrZXkucmVwbGFjZShvYmpOb3RhdGlvblJlZ2V4LCBmdW5jdGlvbiAoYWxsLCBuYW1lLCBxdW90ZSwgcXVvdGVkTmFtZSwgaXNGdW5jKSB7CiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZSB8fCBxdW90ZWROYW1lOwogICAgICAgICAgICAgICAgaWYgKHJlcykgewogICAgICAgICAgICAgICAgICAgIGlmIChuYW1lIGluIHJlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXMgPSByZXNbbmFtZV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHR5cGVvZiByZXMgPT0gImZ1bmN0aW9uIiAmJiBpc0Z1bmMgJiYgKHJlcyA9IHJlcygpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJlcyA9IChyZXMgPT0gbnVsbCB8fCByZXMgPT0gb2JqID8gYWxsIDogcmVzKSArICIiOwogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24gKHN0ciwgb2JqKSB7CiAgICAgICAgcmV0dXJuIFN0cihzdHIpLnJlcGxhY2UodG9rZW5SZWdleCwgZnVuY3Rpb24gKGFsbCwga2V5KSB7CiAgICAgICAgICAgIHJldHVybiByZXBsYWNlcihhbGwsIGtleSwgb2JqKTsKICAgICAgICB9KTsKICAgIH07Cn0pKCk7CmZ1bmN0aW9uIGNsb25lKG9iaikgewogICAgaWYgKHR5cGVvZiBvYmogPT0gImZ1bmN0aW9uIiB8fCBPYmplY3Qob2JqKSAhPT0gb2JqKSB7CiAgICAgICAgcmV0dXJuIG9iajsKICAgIH0KICAgIHZhciByZXMgPSBuZXcgb2JqLmNvbnN0cnVjdG9yOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgaWYgKG9ialtoYXNdKGtleSkpIHsKICAgICAgICByZXNba2V5XSA9IGNsb25lKG9ialtrZXldKTsKICAgIH0KICAgIHJldHVybiByZXM7Cn0KU25hcC5fLmNsb25lID0gY2xvbmU7CmZ1bmN0aW9uIHJlcHVzaChhcnJheSwgaXRlbSkgewogICAgZm9yICh2YXIgaSA9IDAsIGlpID0gYXJyYXkubGVuZ3RoOyBpIDwgaWk7IGkrKykgaWYgKGFycmF5W2ldID09PSBpdGVtKSB7CiAgICAgICAgcmV0dXJuIGFycmF5LnB1c2goYXJyYXkuc3BsaWNlKGksIDEpWzBdKTsKICAgIH0KfQpmdW5jdGlvbiBjYWNoZXIoZiwgc2NvcGUsIHBvc3Rwcm9jZXNzb3IpIHsKICAgIGZ1bmN0aW9uIG5ld2YoKSB7CiAgICAgICAgdmFyIGFyZyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCksCiAgICAgICAgICAgIGFyZ3MgPSBhcmcuam9pbigiXHUyNDAwIiksCiAgICAgICAgICAgIGNhY2hlID0gbmV3Zi5jYWNoZSA9IG5ld2YuY2FjaGUgfHwge30sCiAgICAgICAgICAgIGNvdW50ID0gbmV3Zi5jb3VudCA9IG5ld2YuY291bnQgfHwgW107CiAgICAgICAgaWYgKGNhY2hlW2hhc10oYXJncykpIHsKICAgICAgICAgICAgcmVwdXNoKGNvdW50LCBhcmdzKTsKICAgICAgICAgICAgcmV0dXJuIHBvc3Rwcm9jZXNzb3IgPyBwb3N0cHJvY2Vzc29yKGNhY2hlW2FyZ3NdKSA6IGNhY2hlW2FyZ3NdOwogICAgICAgIH0KICAgICAgICBjb3VudC5sZW5ndGggPj0gMWUzICYmIGRlbGV0ZSBjYWNoZVtjb3VudC5zaGlmdCgpXTsKICAgICAgICBjb3VudC5wdXNoKGFyZ3MpOwogICAgICAgIGNhY2hlW2FyZ3NdID0gZi5hcHBseShzY29wZSwgYXJnKTsKICAgICAgICByZXR1cm4gcG9zdHByb2Nlc3NvciA/IHBvc3Rwcm9jZXNzb3IoY2FjaGVbYXJnc10pIDogY2FjaGVbYXJnc107CiAgICB9CiAgICByZXR1cm4gbmV3ZjsKfQpTbmFwLl8uY2FjaGVyID0gY2FjaGVyOwpmdW5jdGlvbiBhbmdsZSh4MSwgeTEsIHgyLCB5MiwgeDMsIHkzKSB7CiAgICBpZiAoeDMgPT0gbnVsbCkgewogICAgICAgIHZhciB4ID0geDEgLSB4MiwKICAgICAgICAgICAgeSA9IHkxIC0geTI7CiAgICAgICAgaWYgKCF4ICYmICF5KSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKDE4MCArIG1hdGguYXRhbjIoLXksIC14KSAqIDE4MCAvIFBJICsgMzYwKSAlIDM2MDsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGFuZ2xlKHgxLCB5MSwgeDMsIHkzKSAtIGFuZ2xlKHgyLCB5MiwgeDMsIHkzKTsKICAgIH0KfQpmdW5jdGlvbiByYWQoZGVnKSB7CiAgICByZXR1cm4gZGVnICUgMzYwICogUEkgLyAxODA7Cn0KZnVuY3Rpb24gZGVnKHJhZCkgewogICAgcmV0dXJuIHJhZCAqIDE4MCAvIFBJICUgMzYwOwp9CmZ1bmN0aW9uIHhfeSgpIHsKICAgIHJldHVybiB0aGlzLnggKyBTICsgdGhpcy55Owp9CmZ1bmN0aW9uIHhfeV93X2goKSB7CiAgICByZXR1cm4gdGhpcy54ICsgUyArIHRoaXMueSArIFMgKyB0aGlzLndpZHRoICsgIiBceGQ3ICIgKyB0aGlzLmhlaWdodDsKfQoKLypcCiAqIFNuYXAucmFkCiBbIG1ldGhvZCBdCiAqKgogKiBUcmFuc2Zvcm0gYW5nbGUgdG8gcmFkaWFucwogLSBkZWcgKG51bWJlcikgYW5nbGUgaW4gZGVncmVlcwogPSAobnVtYmVyKSBhbmdsZSBpbiByYWRpYW5zClwqLwpTbmFwLnJhZCA9IHJhZDsKLypcCiAqIFNuYXAuZGVnCiBbIG1ldGhvZCBdCiAqKgogKiBUcmFuc2Zvcm0gYW5nbGUgdG8gZGVncmVlcwogLSByYWQgKG51bWJlcikgYW5nbGUgaW4gcmFkaWFucwogPSAobnVtYmVyKSBhbmdsZSBpbiBkZWdyZWVzClwqLwpTbmFwLmRlZyA9IGRlZzsKLypcCiAqIFNuYXAuYW5nbGUKIFsgbWV0aG9kIF0KICoqCiAqIFJldHVybnMgYW4gYW5nbGUgYmV0d2VlbiB0d28gb3IgdGhyZWUgcG9pbnRzCiA+IFBhcmFtZXRlcnMKIC0geDEgKG51bWJlcikgeCBjb29yZCBvZiBmaXJzdCBwb2ludAogLSB5MSAobnVtYmVyKSB5IGNvb3JkIG9mIGZpcnN0IHBvaW50CiAtIHgyIChudW1iZXIpIHggY29vcmQgb2Ygc2Vjb25kIHBvaW50CiAtIHkyIChudW1iZXIpIHkgY29vcmQgb2Ygc2Vjb25kIHBvaW50CiAtIHgzIChudW1iZXIpICNvcHRpb25hbCB4IGNvb3JkIG9mIHRoaXJkIHBvaW50CiAtIHkzIChudW1iZXIpICNvcHRpb25hbCB5IGNvb3JkIG9mIHRoaXJkIHBvaW50CiA9IChudW1iZXIpIGFuZ2xlIGluIGRlZ3JlZXMKXCovClNuYXAuYW5nbGUgPSBhbmdsZTsKLypcCiAqIFNuYXAuaXMKIFsgbWV0aG9kIF0KICoqCiAqIEhhbmR5IHJlcGxhY2VtZW50IGZvciB0aGUgYHR5cGVvZmAgb3BlcmF0b3IKIC0gbyAo4oCmKSBhbnkgb2JqZWN0IG9yIHByaW1pdGl2ZQogLSB0eXBlIChzdHJpbmcpIG5hbWUgb2YgdGhlIHR5cGUsIGUuZy4sIGBzdHJpbmdgLCBgZnVuY3Rpb25gLCBgbnVtYmVyYCwgZXRjLgogPSAoYm9vbGVhbikgYHRydWVgIGlmIGdpdmVuIHZhbHVlIGlzIG9mIGdpdmVuIHR5cGUKXCovClNuYXAuaXMgPSBpczsKLypcCiAqIFNuYXAuc25hcFRvCiBbIG1ldGhvZCBdCiAqKgogKiBTbmFwcyBnaXZlbiB2YWx1ZSB0byBnaXZlbiBncmlkCiAtIHZhbHVlcyAoYXJyYXl8bnVtYmVyKSBnaXZlbiBhcnJheSBvZiB2YWx1ZXMgb3Igc3RlcCBvZiB0aGUgZ3JpZAogLSB2YWx1ZSAobnVtYmVyKSB2YWx1ZSB0byBhZGp1c3QKIC0gdG9sZXJhbmNlIChudW1iZXIpICNvcHRpb25hbCBtYXhpbXVtIGRpc3RhbmNlIHRvIHRoZSB0YXJnZXQgdmFsdWUgdGhhdCB3b3VsZCB0cmlnZ2VyIHRoZSBzbmFwLiBEZWZhdWx0IGlzIGAxMGAuCiA9IChudW1iZXIpIGFkanVzdGVkIHZhbHVlClwqLwpTbmFwLnNuYXBUbyA9IGZ1bmN0aW9uICh2YWx1ZXMsIHZhbHVlLCB0b2xlcmFuY2UpIHsKICAgIHRvbGVyYW5jZSA9IGlzKHRvbGVyYW5jZSwgImZpbml0ZSIpID8gdG9sZXJhbmNlIDogMTA7CiAgICBpZiAoaXModmFsdWVzLCAiYXJyYXkiKSkgewogICAgICAgIHZhciBpID0gdmFsdWVzLmxlbmd0aDsKICAgICAgICB3aGlsZSAoaS0tKSBpZiAoYWJzKHZhbHVlc1tpXSAtIHZhbHVlKSA8PSB0b2xlcmFuY2UpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlc1tpXTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIHZhbHVlcyA9ICt2YWx1ZXM7CiAgICAgICAgdmFyIHJlbSA9IHZhbHVlICUgdmFsdWVzOwogICAgICAgIGlmIChyZW0gPCB0b2xlcmFuY2UpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlIC0gcmVtOwogICAgICAgIH0KICAgICAgICBpZiAocmVtID4gdmFsdWVzIC0gdG9sZXJhbmNlKSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZSAtIHJlbSArIHZhbHVlczsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gdmFsdWU7Cn07Ci8vIENvbG91cgovKlwKICogU25hcC5nZXRSR0IKIFsgbWV0aG9kIF0KICoqCiAqIFBhcnNlcyBjb2xvciBzdHJpbmcgYXMgUkdCIG9iamVjdAogLSBjb2xvciAoc3RyaW5nKSBjb2xvciBzdHJpbmcgaW4gb25lIG9mIHRoZSBmb2xsb3dpbmcgZm9ybWF0czoKICMgPHVsPgogIyAgICAgPGxpPkNvbG9yIG5hbWUgKDxjb2RlPnJlZDwvY29kZT4sIDxjb2RlPmdyZWVuPC9jb2RlPiwgPGNvZGU+Y29ybmZsb3dlcmJsdWU8L2NvZGU+LCBldGMpPC9saT4KICMgICAgIDxsaT4j4oCi4oCi4oCiIOKAlCBzaG9ydGVuZWQgSFRNTCBjb2xvcjogKDxjb2RlPiMwMDA8L2NvZGU+LCA8Y29kZT4jZmMwPC9jb2RlPiwgZXRjLik8L2xpPgogIyAgICAgPGxpPiPigKLigKLigKLigKLigKLigKIg4oCUIGZ1bGwgbGVuZ3RoIEhUTUwgY29sb3I6ICg8Y29kZT4jMDAwMDAwPC9jb2RlPiwgPGNvZGU+I2JkMjMwMDwvY29kZT4pPC9saT4KICMgICAgIDxsaT5yZ2Io4oCi4oCi4oCiLCDigKLigKLigKIsIOKAouKAouKAoikg4oCUIHJlZCwgZ3JlZW4gYW5kIGJsdWUgY2hhbm5lbHMgdmFsdWVzOiAoPGNvZGU+cmdiKDIwMCwmbmJzcDsxMDAsJm5ic3A7MCk8L2NvZGU+KTwvbGk+CiAjICAgICA8bGk+cmdiYSjigKLigKLigKIsIOKAouKAouKAoiwg4oCi4oCi4oCiLCDigKLigKLigKIpIOKAlCBhbHNvIHdpdGggb3BhY2l0eTwvbGk+CiAjICAgICA8bGk+cmdiKOKAouKAouKAoiUsIOKAouKAouKAoiUsIOKAouKAouKAoiUpIOKAlCBzYW1lIGFzIGFib3ZlLCBidXQgaW4gJTogKDxjb2RlPnJnYigxMDAlLCZuYnNwOzE3NSUsJm5ic3A7MCUpPC9jb2RlPik8L2xpPgogIyAgICAgPGxpPnJnYmEo4oCi4oCi4oCiJSwg4oCi4oCi4oCiJSwg4oCi4oCi4oCiJSwg4oCi4oCi4oCiJSkg4oCUIGFsc28gd2l0aCBvcGFjaXR5PC9saT4KICMgICAgIDxsaT5oc2Io4oCi4oCi4oCiLCDigKLigKLigKIsIOKAouKAouKAoikg4oCUIGh1ZSwgc2F0dXJhdGlvbiBhbmQgYnJpZ2h0bmVzcyB2YWx1ZXM6ICg8Y29kZT5oc2IoMC41LCZuYnNwOzAuMjUsJm5ic3A7MSk8L2NvZGU+KTwvbGk+CiAjICAgICA8bGk+aHNiYSjigKLigKLigKIsIOKAouKAouKAoiwg4oCi4oCi4oCiLCDigKLigKLigKIpIOKAlCBhbHNvIHdpdGggb3BhY2l0eTwvbGk+CiAjICAgICA8bGk+aHNiKOKAouKAouKAoiUsIOKAouKAouKAoiUsIOKAouKAouKAoiUpIOKAlCBzYW1lIGFzIGFib3ZlLCBidXQgaW4gJTwvbGk+CiAjICAgICA8bGk+aHNiYSjigKLigKLigKIlLCDigKLigKLigKIlLCDigKLigKLigKIlLCDigKLigKLigKIlKSDigJQgYWxzbyB3aXRoIG9wYWNpdHk8L2xpPgogIyAgICAgPGxpPmhzbCjigKLigKLigKIsIOKAouKAouKAoiwg4oCi4oCi4oCiKSDigJQgaHVlLCBzYXR1cmF0aW9uIGFuZCBsdW1pbm9zaXR5IHZhbHVlczogKDxjb2RlPmhzYigwLjUsJm5ic3A7MC4yNSwmbmJzcDswLjUpPC9jb2RlPik8L2xpPgogIyAgICAgPGxpPmhzbGEo4oCi4oCi4oCiLCDigKLigKLigKIsIOKAouKAouKAoiwg4oCi4oCi4oCiKSDigJQgYWxzbyB3aXRoIG9wYWNpdHk8L2xpPgogIyAgICAgPGxpPmhzbCjigKLigKLigKIlLCDigKLigKLigKIlLCDigKLigKLigKIlKSDigJQgc2FtZSBhcyBhYm92ZSwgYnV0IGluICU8L2xpPgogIyAgICAgPGxpPmhzbGEo4oCi4oCi4oCiJSwg4oCi4oCi4oCiJSwg4oCi4oCi4oCiJSwg4oCi4oCi4oCiJSkg4oCUIGFsc28gd2l0aCBvcGFjaXR5PC9saT4KICMgPC91bD4KICogTm90ZSB0aGF0IGAlYCBjYW4gYmUgdXNlZCBhbnkgdGltZTogYHJnYigyMCUsIDI1NSwgNTAlKWAuCiA9IChvYmplY3QpIFJHQiBvYmplY3QgaW4gdGhlIGZvbGxvd2luZyBmb3JtYXQ6CiBvIHsKIG8gICAgIHIgKG51bWJlcikgcmVkLAogbyAgICAgZyAobnVtYmVyKSBncmVlbiwKIG8gICAgIGIgKG51bWJlcikgYmx1ZSwKIG8gICAgIGhleCAoc3RyaW5nKSBjb2xvciBpbiBIVE1ML0NTUyBmb3JtYXQ6ICPigKLigKLigKLigKLigKLigKIsCiBvICAgICBlcnJvciAoYm9vbGVhbikgdHJ1ZSBpZiBzdHJpbmcgY2FuJ3QgYmUgcGFyc2VkCiBvIH0KXCovClNuYXAuZ2V0UkdCID0gY2FjaGVyKGZ1bmN0aW9uIChjb2xvdXIpIHsKICAgIGlmICghY29sb3VyIHx8ICEhKChjb2xvdXIgPSBTdHIoY29sb3VyKSkuaW5kZXhPZigiLSIpICsgMSkpIHsKICAgICAgICByZXR1cm4ge3I6IC0xLCBnOiAtMSwgYjogLTEsIGhleDogIm5vbmUiLCBlcnJvcjogMSwgdG9TdHJpbmc6IHJnYnRvU3RyaW5nfTsKICAgIH0KICAgIGlmIChjb2xvdXIgPT0gIm5vbmUiKSB7CiAgICAgICAgcmV0dXJuIHtyOiAtMSwgZzogLTEsIGI6IC0xLCBoZXg6ICJub25lIiwgdG9TdHJpbmc6IHJnYnRvU3RyaW5nfTsKICAgIH0KICAgICEoaHNyZ1toYXNdKGNvbG91ci50b0xvd2VyQ2FzZSgpLnN1YnN0cmluZygwLCAyKSkgfHwgY29sb3VyLmNoYXJBdCgpID09ICIjIikgJiYgKGNvbG91ciA9IHRvSGV4KGNvbG91cikpOwogICAgaWYgKCFjb2xvdXIpIHsKICAgICAgICByZXR1cm4ge3I6IC0xLCBnOiAtMSwgYjogLTEsIGhleDogIm5vbmUiLCBlcnJvcjogMSwgdG9TdHJpbmc6IHJnYnRvU3RyaW5nfTsKICAgIH0KICAgIHZhciByZXMsCiAgICAgICAgcmVkLAogICAgICAgIGdyZWVuLAogICAgICAgIGJsdWUsCiAgICAgICAgb3BhY2l0eSwKICAgICAgICB0LAogICAgICAgIHZhbHVlcywKICAgICAgICByZ2IgPSBjb2xvdXIubWF0Y2goY29sb3VyUmVnRXhwKTsKICAgIGlmIChyZ2IpIHsKICAgICAgICBpZiAocmdiWzJdKSB7CiAgICAgICAgICAgIGJsdWUgPSB0b0ludChyZ2JbMl0uc3Vic3RyaW5nKDUpLCAxNik7CiAgICAgICAgICAgIGdyZWVuID0gdG9JbnQocmdiWzJdLnN1YnN0cmluZygzLCA1KSwgMTYpOwogICAgICAgICAgICByZWQgPSB0b0ludChyZ2JbMl0uc3Vic3RyaW5nKDEsIDMpLCAxNik7CiAgICAgICAgfQogICAgICAgIGlmIChyZ2JbM10pIHsKICAgICAgICAgICAgYmx1ZSA9IHRvSW50KCh0ID0gcmdiWzNdLmNoYXJBdCgzKSkgKyB0LCAxNik7CiAgICAgICAgICAgIGdyZWVuID0gdG9JbnQoKHQgPSByZ2JbM10uY2hhckF0KDIpKSArIHQsIDE2KTsKICAgICAgICAgICAgcmVkID0gdG9JbnQoKHQgPSByZ2JbM10uY2hhckF0KDEpKSArIHQsIDE2KTsKICAgICAgICB9CiAgICAgICAgaWYgKHJnYls0XSkgewogICAgICAgICAgICB2YWx1ZXMgPSByZ2JbNF0uc3BsaXQoY29tbWFTcGFjZXMpOwogICAgICAgICAgICByZWQgPSB0b0Zsb2F0KHZhbHVlc1swXSk7CiAgICAgICAgICAgIHZhbHVlc1swXS5zbGljZSgtMSkgPT0gIiUiICYmIChyZWQgKj0gMi41NSk7CiAgICAgICAgICAgIGdyZWVuID0gdG9GbG9hdCh2YWx1ZXNbMV0pOwogICAgICAgICAgICB2YWx1ZXNbMV0uc2xpY2UoLTEpID09ICIlIiAmJiAoZ3JlZW4gKj0gMi41NSk7CiAgICAgICAgICAgIGJsdWUgPSB0b0Zsb2F0KHZhbHVlc1syXSk7CiAgICAgICAgICAgIHZhbHVlc1syXS5zbGljZSgtMSkgPT0gIiUiICYmIChibHVlICo9IDIuNTUpOwogICAgICAgICAgICByZ2JbMV0udG9Mb3dlckNhc2UoKS5zbGljZSgwLCA0KSA9PSAicmdiYSIgJiYgKG9wYWNpdHkgPSB0b0Zsb2F0KHZhbHVlc1szXSkpOwogICAgICAgICAgICB2YWx1ZXNbM10gJiYgdmFsdWVzWzNdLnNsaWNlKC0xKSA9PSAiJSIgJiYgKG9wYWNpdHkgLz0gMTAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHJnYls1XSkgewogICAgICAgICAgICB2YWx1ZXMgPSByZ2JbNV0uc3BsaXQoY29tbWFTcGFjZXMpOwogICAgICAgICAgICByZWQgPSB0b0Zsb2F0KHZhbHVlc1swXSk7CiAgICAgICAgICAgIHZhbHVlc1swXS5zbGljZSgtMSkgPT0gIiUiICYmIChyZWQgLz0gMTAwKTsKICAgICAgICAgICAgZ3JlZW4gPSB0b0Zsb2F0KHZhbHVlc1sxXSk7CiAgICAgICAgICAgIHZhbHVlc1sxXS5zbGljZSgtMSkgPT0gIiUiICYmIChncmVlbiAvPSAxMDApOwogICAgICAgICAgICBibHVlID0gdG9GbG9hdCh2YWx1ZXNbMl0pOwogICAgICAgICAgICB2YWx1ZXNbMl0uc2xpY2UoLTEpID09ICIlIiAmJiAoYmx1ZSAvPSAxMDApOwogICAgICAgICAgICAodmFsdWVzWzBdLnNsaWNlKC0zKSA9PSAiZGVnIiB8fCB2YWx1ZXNbMF0uc2xpY2UoLTEpID09ICJceGIwIikgJiYgKHJlZCAvPSAzNjApOwogICAgICAgICAgICByZ2JbMV0udG9Mb3dlckNhc2UoKS5zbGljZSgwLCA0KSA9PSAiaHNiYSIgJiYgKG9wYWNpdHkgPSB0b0Zsb2F0KHZhbHVlc1szXSkpOwogICAgICAgICAgICB2YWx1ZXNbM10gJiYgdmFsdWVzWzNdLnNsaWNlKC0xKSA9PSAiJSIgJiYgKG9wYWNpdHkgLz0gMTAwKTsKICAgICAgICAgICAgcmV0dXJuIFNuYXAuaHNiMnJnYihyZWQsIGdyZWVuLCBibHVlLCBvcGFjaXR5KTsKICAgICAgICB9CiAgICAgICAgaWYgKHJnYls2XSkgewogICAgICAgICAgICB2YWx1ZXMgPSByZ2JbNl0uc3BsaXQoY29tbWFTcGFjZXMpOwogICAgICAgICAgICByZWQgPSB0b0Zsb2F0KHZhbHVlc1swXSk7CiAgICAgICAgICAgIHZhbHVlc1swXS5zbGljZSgtMSkgPT0gIiUiICYmIChyZWQgLz0gMTAwKTsKICAgICAgICAgICAgZ3JlZW4gPSB0b0Zsb2F0KHZhbHVlc1sxXSk7CiAgICAgICAgICAgIHZhbHVlc1sxXS5zbGljZSgtMSkgPT0gIiUiICYmIChncmVlbiAvPSAxMDApOwogICAgICAgICAgICBibHVlID0gdG9GbG9hdCh2YWx1ZXNbMl0pOwogICAgICAgICAgICB2YWx1ZXNbMl0uc2xpY2UoLTEpID09ICIlIiAmJiAoYmx1ZSAvPSAxMDApOwogICAgICAgICAgICAodmFsdWVzWzBdLnNsaWNlKC0zKSA9PSAiZGVnIiB8fCB2YWx1ZXNbMF0uc2xpY2UoLTEpID09ICJceGIwIikgJiYgKHJlZCAvPSAzNjApOwogICAgICAgICAgICByZ2JbMV0udG9Mb3dlckNhc2UoKS5zbGljZSgwLCA0KSA9PSAiaHNsYSIgJiYgKG9wYWNpdHkgPSB0b0Zsb2F0KHZhbHVlc1szXSkpOwogICAgICAgICAgICB2YWx1ZXNbM10gJiYgdmFsdWVzWzNdLnNsaWNlKC0xKSA9PSAiJSIgJiYgKG9wYWNpdHkgLz0gMTAwKTsKICAgICAgICAgICAgcmV0dXJuIFNuYXAuaHNsMnJnYihyZWQsIGdyZWVuLCBibHVlLCBvcGFjaXR5KTsKICAgICAgICB9CiAgICAgICAgcmVkID0gbW1pbihtYXRoLnJvdW5kKHJlZCksIDI1NSk7CiAgICAgICAgZ3JlZW4gPSBtbWluKG1hdGgucm91bmQoZ3JlZW4pLCAyNTUpOwogICAgICAgIGJsdWUgPSBtbWluKG1hdGgucm91bmQoYmx1ZSksIDI1NSk7CiAgICAgICAgb3BhY2l0eSA9IG1taW4obW1heChvcGFjaXR5LCAwKSwgMSk7CiAgICAgICAgcmdiID0ge3I6IHJlZCwgZzogZ3JlZW4sIGI6IGJsdWUsIHRvU3RyaW5nOiByZ2J0b1N0cmluZ307CiAgICAgICAgcmdiLmhleCA9ICIjIiArICgxNjc3NzIxNiB8IGJsdWUgfCAoZ3JlZW4gPDwgOCkgfCAocmVkIDw8IDE2KSkudG9TdHJpbmcoMTYpLnNsaWNlKDEpOwogICAgICAgIHJnYi5vcGFjaXR5ID0gaXMob3BhY2l0eSwgImZpbml0ZSIpID8gb3BhY2l0eSA6IDE7CiAgICAgICAgcmV0dXJuIHJnYjsKICAgIH0KICAgIHJldHVybiB7cjogLTEsIGc6IC0xLCBiOiAtMSwgaGV4OiAibm9uZSIsIGVycm9yOiAxLCB0b1N0cmluZzogcmdidG9TdHJpbmd9Owp9LCBTbmFwKTsKLy8gU0lFUlJBIEl0IHNlZW1zIG9kZCB0aGF0IHRoZSBmb2xsb3dpbmcgMyBjb252ZXJzaW9uIG1ldGhvZHMgYXJlIG5vdCBleHByZXNzZWQgYXMgLnRoaXMydGhhdCgpLCBsaWtlIHRoZSBvdGhlcnMuCi8qXAogKiBTbmFwLmhzYgogWyBtZXRob2QgXQogKioKICogQ29udmVydHMgSFNCIHZhbHVlcyB0byBhIGhleCByZXByZXNlbnRhdGlvbiBvZiB0aGUgY29sb3IKIC0gaCAobnVtYmVyKSBodWUKIC0gcyAobnVtYmVyKSBzYXR1cmF0aW9uCiAtIGIgKG51bWJlcikgdmFsdWUgb3IgYnJpZ2h0bmVzcwogPSAoc3RyaW5nKSBoZXggcmVwcmVzZW50YXRpb24gb2YgdGhlIGNvbG9yClwqLwpTbmFwLmhzYiA9IGNhY2hlcihmdW5jdGlvbiAoaCwgcywgYikgewogICAgcmV0dXJuIFNuYXAuaHNiMnJnYihoLCBzLCBiKS5oZXg7Cn0pOwovKlwKICogU25hcC5oc2wKIFsgbWV0aG9kIF0KICoqCiAqIENvbnZlcnRzIEhTTCB2YWx1ZXMgdG8gYSBoZXggcmVwcmVzZW50YXRpb24gb2YgdGhlIGNvbG9yCiAtIGggKG51bWJlcikgaHVlCiAtIHMgKG51bWJlcikgc2F0dXJhdGlvbgogLSBsIChudW1iZXIpIGx1bWlub3NpdHkKID0gKHN0cmluZykgaGV4IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBjb2xvcgpcKi8KU25hcC5oc2wgPSBjYWNoZXIoZnVuY3Rpb24gKGgsIHMsIGwpIHsKICAgIHJldHVybiBTbmFwLmhzbDJyZ2IoaCwgcywgbCkuaGV4Owp9KTsKLypcCiAqIFNuYXAucmdiCiBbIG1ldGhvZCBdCiAqKgogKiBDb252ZXJ0cyBSR0IgdmFsdWVzIHRvIGEgaGV4IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBjb2xvcgogLSByIChudW1iZXIpIHJlZAogLSBnIChudW1iZXIpIGdyZWVuCiAtIGIgKG51bWJlcikgYmx1ZQogPSAoc3RyaW5nKSBoZXggcmVwcmVzZW50YXRpb24gb2YgdGhlIGNvbG9yClwqLwpTbmFwLnJnYiA9IGNhY2hlcihmdW5jdGlvbiAociwgZywgYiwgbykgewogICAgaWYgKGlzKG8sICJmaW5pdGUiKSkgewogICAgICAgIHZhciByb3VuZCA9IG1hdGgucm91bmQ7CiAgICAgICAgcmV0dXJuICJyZ2JhKCIgKyBbcm91bmQociksIHJvdW5kKGcpLCByb3VuZChiKSwgK28udG9GaXhlZCgyKV0gKyAiKSI7CiAgICB9CiAgICByZXR1cm4gIiMiICsgKDE2Nzc3MjE2IHwgYiB8IChnIDw8IDgpIHwgKHIgPDwgMTYpKS50b1N0cmluZygxNikuc2xpY2UoMSk7Cn0pOwp2YXIgdG9IZXggPSBmdW5jdGlvbiAoY29sb3IpIHsKICAgIHZhciBpID0gZ2xvYi5kb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXSB8fCBnbG9iLmRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgic3ZnIilbMF0sCiAgICAgICAgcmVkID0gInJnYigyNTUsIDAsIDApIjsKICAgIHRvSGV4ID0gY2FjaGVyKGZ1bmN0aW9uIChjb2xvcikgewogICAgICAgIGlmIChjb2xvci50b0xvd2VyQ2FzZSgpID09ICJyZWQiKSB7CiAgICAgICAgICAgIHJldHVybiByZWQ7CiAgICAgICAgfQogICAgICAgIGkuc3R5bGUuY29sb3IgPSByZWQ7CiAgICAgICAgaS5zdHlsZS5jb2xvciA9IGNvbG9yOwogICAgICAgIHZhciBvdXQgPSBnbG9iLmRvYy5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKGksIEUpLmdldFByb3BlcnR5VmFsdWUoImNvbG9yIik7CiAgICAgICAgcmV0dXJuIG91dCA9PSByZWQgPyBudWxsIDogb3V0OwogICAgfSk7CiAgICByZXR1cm4gdG9IZXgoY29sb3IpOwp9LApoc2J0b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiAiaHNiKCIgKyBbdGhpcy5oLCB0aGlzLnMsIHRoaXMuYl0gKyAiKSI7Cn0sCmhzbHRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuICJoc2woIiArIFt0aGlzLmgsIHRoaXMucywgdGhpcy5sXSArICIpIjsKfSwKcmdidG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5vcGFjaXR5ID09IDEgfHwgdGhpcy5vcGFjaXR5ID09IG51bGwgPwogICAgICAgICAgICB0aGlzLmhleCA6CiAgICAgICAgICAgICJyZ2JhKCIgKyBbdGhpcy5yLCB0aGlzLmcsIHRoaXMuYiwgdGhpcy5vcGFjaXR5XSArICIpIjsKfSwKcHJlcGFyZVJHQiA9IGZ1bmN0aW9uIChyLCBnLCBiKSB7CiAgICBpZiAoZyA9PSBudWxsICYmIGlzKHIsICJvYmplY3QiKSAmJiAiciIgaW4gciAmJiAiZyIgaW4gciAmJiAiYiIgaW4gcikgewogICAgICAgIGIgPSByLmI7CiAgICAgICAgZyA9IHIuZzsKICAgICAgICByID0gci5yOwogICAgfQogICAgaWYgKGcgPT0gbnVsbCAmJiBpcyhyLCBzdHJpbmcpKSB7CiAgICAgICAgdmFyIGNsciA9IFNuYXAuZ2V0UkdCKHIpOwogICAgICAgIHIgPSBjbHIucjsKICAgICAgICBnID0gY2xyLmc7CiAgICAgICAgYiA9IGNsci5iOwogICAgfQogICAgaWYgKHIgPiAxIHx8IGcgPiAxIHx8IGIgPiAxKSB7CiAgICAgICAgciAvPSAyNTU7CiAgICAgICAgZyAvPSAyNTU7CiAgICAgICAgYiAvPSAyNTU7CiAgICB9CiAgICAKICAgIHJldHVybiBbciwgZywgYl07Cn0sCnBhY2thZ2VSR0IgPSBmdW5jdGlvbiAociwgZywgYiwgbykgewogICAgciA9IG1hdGgucm91bmQociAqIDI1NSk7CiAgICBnID0gbWF0aC5yb3VuZChnICogMjU1KTsKICAgIGIgPSBtYXRoLnJvdW5kKGIgKiAyNTUpOwogICAgdmFyIHJnYiA9IHsKICAgICAgICByOiByLAogICAgICAgIGc6IGcsCiAgICAgICAgYjogYiwKICAgICAgICBvcGFjaXR5OiBpcyhvLCAiZmluaXRlIikgPyBvIDogMSwKICAgICAgICBoZXg6IFNuYXAucmdiKHIsIGcsIGIpLAogICAgICAgIHRvU3RyaW5nOiByZ2J0b1N0cmluZwogICAgfTsKICAgIGlzKG8sICJmaW5pdGUiKSAmJiAocmdiLm9wYWNpdHkgPSBvKTsKICAgIHJldHVybiByZ2I7Cn07Ci8vIFNJRVJSQSBDbGFyaWZ5IGlmIFNuYXAgZG9lcyBub3Qgc3VwcG9ydCBjb25zb2xpZGF0ZWQgSFNMQS9SR0JBIGNvbG9ycy4gRS5nLiwgY2FuIHlvdSBzcGVjaWZ5IGEgc2VtaS10cmFuc3BhcmVudCB2YWx1ZSBmb3IgU25hcC5maWx0ZXIuc2hhZG93KCk/Ci8qXAogKiBTbmFwLmNvbG9yCiBbIG1ldGhvZCBdCiAqKgogKiBQYXJzZXMgdGhlIGNvbG9yIHN0cmluZyBhbmQgcmV0dXJucyBhbiBvYmplY3QgZmVhdHVyaW5nIHRoZSBjb2xvcidzIGNvbXBvbmVudCB2YWx1ZXMKIC0gY2xyIChzdHJpbmcpIGNvbG9yIHN0cmluZyBpbiBvbmUgb2YgdGhlIHN1cHBvcnRlZCBmb3JtYXRzIChzZWUgQFNuYXAuZ2V0UkdCKQogPSAob2JqZWN0KSBDb21iaW5lZCBSR0IvSFNCIG9iamVjdCBpbiB0aGUgZm9sbG93aW5nIGZvcm1hdDoKIG8gewogbyAgICAgciAobnVtYmVyKSByZWQsCiBvICAgICBnIChudW1iZXIpIGdyZWVuLAogbyAgICAgYiAobnVtYmVyKSBibHVlLAogbyAgICAgaGV4IChzdHJpbmcpIGNvbG9yIGluIEhUTUwvQ1NTIGZvcm1hdDogI+KAouKAouKAouKAouKAouKAoiwKIG8gICAgIGVycm9yIChib29sZWFuKSBgdHJ1ZWAgaWYgc3RyaW5nIGNhbid0IGJlIHBhcnNlZCwKIG8gICAgIGggKG51bWJlcikgaHVlLAogbyAgICAgcyAobnVtYmVyKSBzYXR1cmF0aW9uLAogbyAgICAgdiAobnVtYmVyKSB2YWx1ZSAoYnJpZ2h0bmVzcyksCiBvICAgICBsIChudW1iZXIpIGxpZ2h0bmVzcwogbyB9ClwqLwpTbmFwLmNvbG9yID0gZnVuY3Rpb24gKGNscikgewogICAgdmFyIHJnYjsKICAgIGlmIChpcyhjbHIsICJvYmplY3QiKSAmJiAiaCIgaW4gY2xyICYmICJzIiBpbiBjbHIgJiYgImIiIGluIGNscikgewogICAgICAgIHJnYiA9IFNuYXAuaHNiMnJnYihjbHIpOwogICAgICAgIGNsci5yID0gcmdiLnI7CiAgICAgICAgY2xyLmcgPSByZ2IuZzsKICAgICAgICBjbHIuYiA9IHJnYi5iOwogICAgICAgIGNsci5vcGFjaXR5ID0gMTsKICAgICAgICBjbHIuaGV4ID0gcmdiLmhleDsKICAgIH0gZWxzZSBpZiAoaXMoY2xyLCAib2JqZWN0IikgJiYgImgiIGluIGNsciAmJiAicyIgaW4gY2xyICYmICJsIiBpbiBjbHIpIHsKICAgICAgICByZ2IgPSBTbmFwLmhzbDJyZ2IoY2xyKTsKICAgICAgICBjbHIuciA9IHJnYi5yOwogICAgICAgIGNsci5nID0gcmdiLmc7CiAgICAgICAgY2xyLmIgPSByZ2IuYjsKICAgICAgICBjbHIub3BhY2l0eSA9IDE7CiAgICAgICAgY2xyLmhleCA9IHJnYi5oZXg7CiAgICB9IGVsc2UgewogICAgICAgIGlmIChpcyhjbHIsICJzdHJpbmciKSkgewogICAgICAgICAgICBjbHIgPSBTbmFwLmdldFJHQihjbHIpOwogICAgICAgIH0KICAgICAgICBpZiAoaXMoY2xyLCAib2JqZWN0IikgJiYgInIiIGluIGNsciAmJiAiZyIgaW4gY2xyICYmICJiIiBpbiBjbHIgJiYgISgiZXJyb3IiIGluIGNscikpIHsKICAgICAgICAgICAgcmdiID0gU25hcC5yZ2IyaHNsKGNscik7CiAgICAgICAgICAgIGNsci5oID0gcmdiLmg7CiAgICAgICAgICAgIGNsci5zID0gcmdiLnM7CiAgICAgICAgICAgIGNsci5sID0gcmdiLmw7CiAgICAgICAgICAgIHJnYiA9IFNuYXAucmdiMmhzYihjbHIpOwogICAgICAgICAgICBjbHIudiA9IHJnYi5iOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNsciA9IHtoZXg6ICJub25lIn07CiAgICAgICAgICAgIGNsci5yID0gY2xyLmcgPSBjbHIuYiA9IGNsci5oID0gY2xyLnMgPSBjbHIudiA9IGNsci5sID0gLTE7CiAgICAgICAgICAgIGNsci5lcnJvciA9IDE7CiAgICAgICAgfQogICAgfQogICAgY2xyLnRvU3RyaW5nID0gcmdidG9TdHJpbmc7CiAgICByZXR1cm4gY2xyOwp9OwovKlwKICogU25hcC5oc2IycmdiCiBbIG1ldGhvZCBdCiAqKgogKiBDb252ZXJ0cyBIU0IgdmFsdWVzIHRvIGFuIFJHQiBvYmplY3QKIC0gaCAobnVtYmVyKSBodWUKIC0gcyAobnVtYmVyKSBzYXR1cmF0aW9uCiAtIHYgKG51bWJlcikgdmFsdWUgb3IgYnJpZ2h0bmVzcwogPSAob2JqZWN0KSBSR0Igb2JqZWN0IGluIHRoZSBmb2xsb3dpbmcgZm9ybWF0OgogbyB7CiBvICAgICByIChudW1iZXIpIHJlZCwKIG8gICAgIGcgKG51bWJlcikgZ3JlZW4sCiBvICAgICBiIChudW1iZXIpIGJsdWUsCiBvICAgICBoZXggKHN0cmluZykgY29sb3IgaW4gSFRNTC9DU1MgZm9ybWF0OiAj4oCi4oCi4oCi4oCi4oCi4oCiCiBvIH0KXCovClNuYXAuaHNiMnJnYiA9IGZ1bmN0aW9uIChoLCBzLCB2LCBvKSB7CiAgICBpZiAoaXMoaCwgIm9iamVjdCIpICYmICJoIiBpbiBoICYmICJzIiBpbiBoICYmICJiIiBpbiBoKSB7CiAgICAgICAgdiA9IGguYjsKICAgICAgICBzID0gaC5zOwogICAgICAgIGggPSBoLmg7CiAgICAgICAgbyA9IGgubzsKICAgIH0KICAgIGggKj0gMzYwOwogICAgdmFyIFIsIEcsIEIsIFgsIEM7CiAgICBoID0gKGggJSAzNjApIC8gNjA7CiAgICBDID0gdiAqIHM7CiAgICBYID0gQyAqICgxIC0gYWJzKGggJSAyIC0gMSkpOwogICAgUiA9IEcgPSBCID0gdiAtIEM7CgogICAgaCA9IH5+aDsKICAgIFIgKz0gW0MsIFgsIDAsIDAsIFgsIENdW2hdOwogICAgRyArPSBbWCwgQywgQywgWCwgMCwgMF1baF07CiAgICBCICs9IFswLCAwLCBYLCBDLCBDLCBYXVtoXTsKICAgIHJldHVybiBwYWNrYWdlUkdCKFIsIEcsIEIsIG8pOwp9OwovKlwKICogU25hcC5oc2wycmdiCiBbIG1ldGhvZCBdCiAqKgogKiBDb252ZXJ0cyBIU0wgdmFsdWVzIHRvIGFuIFJHQiBvYmplY3QKIC0gaCAobnVtYmVyKSBodWUKIC0gcyAobnVtYmVyKSBzYXR1cmF0aW9uCiAtIGwgKG51bWJlcikgbHVtaW5vc2l0eQogPSAob2JqZWN0KSBSR0Igb2JqZWN0IGluIHRoZSBmb2xsb3dpbmcgZm9ybWF0OgogbyB7CiBvICAgICByIChudW1iZXIpIHJlZCwKIG8gICAgIGcgKG51bWJlcikgZ3JlZW4sCiBvICAgICBiIChudW1iZXIpIGJsdWUsCiBvICAgICBoZXggKHN0cmluZykgY29sb3IgaW4gSFRNTC9DU1MgZm9ybWF0OiAj4oCi4oCi4oCi4oCi4oCi4oCiCiBvIH0KXCovClNuYXAuaHNsMnJnYiA9IGZ1bmN0aW9uIChoLCBzLCBsLCBvKSB7CiAgICBpZiAoaXMoaCwgIm9iamVjdCIpICYmICJoIiBpbiBoICYmICJzIiBpbiBoICYmICJsIiBpbiBoKSB7CiAgICAgICAgbCA9IGgubDsKICAgICAgICBzID0gaC5zOwogICAgICAgIGggPSBoLmg7CiAgICB9CiAgICBpZiAoaCA+IDEgfHwgcyA+IDEgfHwgbCA+IDEpIHsKICAgICAgICBoIC89IDM2MDsKICAgICAgICBzIC89IDEwMDsKICAgICAgICBsIC89IDEwMDsKICAgIH0KICAgIGggKj0gMzYwOwogICAgdmFyIFIsIEcsIEIsIFgsIEM7CiAgICBoID0gKGggJSAzNjApIC8gNjA7CiAgICBDID0gMiAqIHMgKiAobCA8IC41ID8gbCA6IDEgLSBsKTsKICAgIFggPSBDICogKDEgLSBhYnMoaCAlIDIgLSAxKSk7CiAgICBSID0gRyA9IEIgPSBsIC0gQyAvIDI7CgogICAgaCA9IH5+aDsKICAgIFIgKz0gW0MsIFgsIDAsIDAsIFgsIENdW2hdOwogICAgRyArPSBbWCwgQywgQywgWCwgMCwgMF1baF07CiAgICBCICs9IFswLCAwLCBYLCBDLCBDLCBYXVtoXTsKICAgIHJldHVybiBwYWNrYWdlUkdCKFIsIEcsIEIsIG8pOwp9OwovKlwKICogU25hcC5yZ2IyaHNiCiBbIG1ldGhvZCBdCiAqKgogKiBDb252ZXJ0cyBSR0IgdmFsdWVzIHRvIGFuIEhTQiBvYmplY3QKIC0gciAobnVtYmVyKSByZWQKIC0gZyAobnVtYmVyKSBncmVlbgogLSBiIChudW1iZXIpIGJsdWUKID0gKG9iamVjdCkgSFNCIG9iamVjdCBpbiB0aGUgZm9sbG93aW5nIGZvcm1hdDoKIG8gewogbyAgICAgaCAobnVtYmVyKSBodWUsCiBvICAgICBzIChudW1iZXIpIHNhdHVyYXRpb24sCiBvICAgICBiIChudW1iZXIpIGJyaWdodG5lc3MKIG8gfQpcKi8KU25hcC5yZ2IyaHNiID0gZnVuY3Rpb24gKHIsIGcsIGIpIHsKICAgIGIgPSBwcmVwYXJlUkdCKHIsIGcsIGIpOwogICAgciA9IGJbMF07CiAgICBnID0gYlsxXTsKICAgIGIgPSBiWzJdOwoKICAgIHZhciBILCBTLCBWLCBDOwogICAgViA9IG1tYXgociwgZywgYik7CiAgICBDID0gViAtIG1taW4ociwgZywgYik7CiAgICBIID0gKEMgPT0gMCA/IG51bGwgOgogICAgICAgICBWID09IHIgPyAoZyAtIGIpIC8gQyA6CiAgICAgICAgIFYgPT0gZyA/IChiIC0gcikgLyBDICsgMiA6CiAgICAgICAgICAgICAgICAgIChyIC0gZykgLyBDICsgNAogICAgICAgICk7CiAgICBIID0gKChIICsgMzYwKSAlIDYpICogNjAgLyAzNjA7CiAgICBTID0gQyA9PSAwID8gMCA6IEMgLyBWOwogICAgcmV0dXJuIHtoOiBILCBzOiBTLCBiOiBWLCB0b1N0cmluZzogaHNidG9TdHJpbmd9Owp9OwovKlwKICogU25hcC5yZ2IyaHNsCiBbIG1ldGhvZCBdCiAqKgogKiBDb252ZXJ0cyBSR0IgdmFsdWVzIHRvIGFuIEhTTCBvYmplY3QKIC0gciAobnVtYmVyKSByZWQKIC0gZyAobnVtYmVyKSBncmVlbgogLSBiIChudW1iZXIpIGJsdWUKID0gKG9iamVjdCkgSFNMIG9iamVjdCBpbiB0aGUgZm9sbG93aW5nIGZvcm1hdDoKIG8gewogbyAgICAgaCAobnVtYmVyKSBodWUsCiBvICAgICBzIChudW1iZXIpIHNhdHVyYXRpb24sCiBvICAgICBsIChudW1iZXIpIGx1bWlub3NpdHkKIG8gfQpcKi8KU25hcC5yZ2IyaHNsID0gZnVuY3Rpb24gKHIsIGcsIGIpIHsKICAgIGIgPSBwcmVwYXJlUkdCKHIsIGcsIGIpOwogICAgciA9IGJbMF07CiAgICBnID0gYlsxXTsKICAgIGIgPSBiWzJdOwoKICAgIHZhciBILCBTLCBMLCBNLCBtLCBDOwogICAgTSA9IG1tYXgociwgZywgYik7CiAgICBtID0gbW1pbihyLCBnLCBiKTsKICAgIEMgPSBNIC0gbTsKICAgIEggPSAoQyA9PSAwID8gbnVsbCA6CiAgICAgICAgIE0gPT0gciA/IChnIC0gYikgLyBDIDoKICAgICAgICAgTSA9PSBnID8gKGIgLSByKSAvIEMgKyAyIDoKICAgICAgICAgICAgICAgICAgKHIgLSBnKSAvIEMgKyA0KTsKICAgIEggPSAoKEggKyAzNjApICUgNikgKiA2MCAvIDM2MDsKICAgIEwgPSAoTSArIG0pIC8gMjsKICAgIFMgPSAoQyA9PSAwID8gMCA6CiAgICAgICAgIEwgPCAuNSA/IEMgLyAoMiAqIEwpIDoKICAgICAgICAgICAgICAgICAgQyAvICgyIC0gMiAqIEwpKTsKICAgIHJldHVybiB7aDogSCwgczogUywgbDogTCwgdG9TdHJpbmc6IGhzbHRvU3RyaW5nfTsKfTsKCi8vIFRyYW5zZm9ybWF0aW9ucwovLyBTSUVSUkEgU25hcC5wYXJzZVBhdGhTdHJpbmcoKTogQnkgX2FycmF5IG9mIGFycmF5cyxfIEkgYXNzdW1lIHlvdSBtZWFuIGEgZm9ybWF0IGxpa2UgdGhpcyBmb3IgdHdvIHNlcGFyYXRlIHNlZ21lbnRzPyBbIFsiTTEwLDEwIiwiTDkwLDkwIl0sIFsiTTkwLDEwIiwiTDEwLDkwIl0gXSBPdGhlcndpc2UgaG93IGlzIGVhY2ggY29tbWFuZCBzdHJ1Y3R1cmVkPwovKlwKICogU25hcC5wYXJzZVBhdGhTdHJpbmcKIFsgbWV0aG9kIF0KICoqCiAqIFV0aWxpdHkgbWV0aG9kCiAqKgogKiBQYXJzZXMgZ2l2ZW4gcGF0aCBzdHJpbmcgaW50byBhbiBhcnJheSBvZiBhcnJheXMgb2YgcGF0aCBzZWdtZW50cwogLSBwYXRoU3RyaW5nIChzdHJpbmd8YXJyYXkpIHBhdGggc3RyaW5nIG9yIGFycmF5IG9mIHNlZ21lbnRzIChpbiB0aGUgbGFzdCBjYXNlIGl0IGlzIHJldHVybmVkIHN0cmFpZ2h0IGF3YXkpCiA9IChhcnJheSkgYXJyYXkgb2Ygc2VnbWVudHMKXCovClNuYXAucGFyc2VQYXRoU3RyaW5nID0gZnVuY3Rpb24gKHBhdGhTdHJpbmcpIHsKICAgIGlmICghcGF0aFN0cmluZykgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgdmFyIHB0aCA9IFNuYXAucGF0aChwYXRoU3RyaW5nKTsKICAgIGlmIChwdGguYXJyKSB7CiAgICAgICAgcmV0dXJuIFNuYXAucGF0aC5jbG9uZShwdGguYXJyKTsKICAgIH0KICAgIAogICAgdmFyIHBhcmFtQ291bnRzID0ge2E6IDcsIGM6IDYsIG86IDIsIGg6IDEsIGw6IDIsIG06IDIsIHI6IDQsIHE6IDQsIHM6IDQsIHQ6IDIsIHY6IDEsIHU6IDMsIHo6IDB9LAogICAgICAgIGRhdGEgPSBbXTsKICAgIGlmIChpcyhwYXRoU3RyaW5nLCAiYXJyYXkiKSAmJiBpcyhwYXRoU3RyaW5nWzBdLCAiYXJyYXkiKSkgeyAvLyByb3VnaCBhc3N1bXB0aW9uCiAgICAgICAgZGF0YSA9IFNuYXAucGF0aC5jbG9uZShwYXRoU3RyaW5nKTsKICAgIH0KICAgIGlmICghZGF0YS5sZW5ndGgpIHsKICAgICAgICBTdHIocGF0aFN0cmluZykucmVwbGFjZShwYXRoQ29tbWFuZCwgZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICAgICAgdmFyIHBhcmFtcyA9IFtdLAogICAgICAgICAgICAgICAgbmFtZSA9IGIudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgYy5yZXBsYWNlKHBhdGhWYWx1ZXMsIGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICBiICYmIHBhcmFtcy5wdXNoKCtiKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmIChuYW1lID09ICJtIiAmJiBwYXJhbXMubGVuZ3RoID4gMikgewogICAgICAgICAgICAgICAgZGF0YS5wdXNoKFtiXS5jb25jYXQocGFyYW1zLnNwbGljZSgwLCAyKSkpOwogICAgICAgICAgICAgICAgbmFtZSA9ICJsIjsKICAgICAgICAgICAgICAgIGIgPSBiID09ICJtIiA/ICJsIiA6ICJMIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobmFtZSA9PSAibyIgJiYgcGFyYW1zLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgICBkYXRhLnB1c2goW2IsIHBhcmFtc1swXV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChuYW1lID09ICJyIikgewogICAgICAgICAgICAgICAgZGF0YS5wdXNoKFtiXS5jb25jYXQocGFyYW1zKSk7CiAgICAgICAgICAgIH0gZWxzZSB3aGlsZSAocGFyYW1zLmxlbmd0aCA+PSBwYXJhbUNvdW50c1tuYW1lXSkgewogICAgICAgICAgICAgICAgZGF0YS5wdXNoKFtiXS5jb25jYXQocGFyYW1zLnNwbGljZSgwLCBwYXJhbUNvdW50c1tuYW1lXSkpKTsKICAgICAgICAgICAgICAgIGlmICghcGFyYW1Db3VudHNbbmFtZV0pIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgZGF0YS50b1N0cmluZyA9IFNuYXAucGF0aC50b1N0cmluZzsKICAgIHB0aC5hcnIgPSBTbmFwLnBhdGguY2xvbmUoZGF0YSk7CiAgICByZXR1cm4gZGF0YTsKfTsKLypcCiAqIFNuYXAucGFyc2VUcmFuc2Zvcm1TdHJpbmcKIFsgbWV0aG9kIF0KICoqCiAqIFV0aWxpdHkgbWV0aG9kCiAqKgogKiBQYXJzZXMgZ2l2ZW4gdHJhbnNmb3JtIHN0cmluZyBpbnRvIGFuIGFycmF5IG9mIHRyYW5zZm9ybWF0aW9ucwogLSBUU3RyaW5nIChzdHJpbmd8YXJyYXkpIHRyYW5zZm9ybSBzdHJpbmcgb3IgYXJyYXkgb2YgdHJhbnNmb3JtYXRpb25zIChpbiB0aGUgbGFzdCBjYXNlIGl0IGlzIHJldHVybmVkIHN0cmFpZ2h0IGF3YXkpCiA9IChhcnJheSkgYXJyYXkgb2YgdHJhbnNmb3JtYXRpb25zClwqLwp2YXIgcGFyc2VUcmFuc2Zvcm1TdHJpbmcgPSBTbmFwLnBhcnNlVHJhbnNmb3JtU3RyaW5nID0gZnVuY3Rpb24gKFRTdHJpbmcpIHsKICAgIGlmICghVFN0cmluZykgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgdmFyIHBhcmFtQ291bnRzID0ge3I6IDMsIHM6IDQsIHQ6IDIsIG06IDZ9LAogICAgICAgIGRhdGEgPSBbXTsKICAgIGlmIChpcyhUU3RyaW5nLCAiYXJyYXkiKSAmJiBpcyhUU3RyaW5nWzBdLCAiYXJyYXkiKSkgeyAvLyByb3VnaCBhc3N1bXB0aW9uCiAgICAgICAgZGF0YSA9IFNuYXAucGF0aC5jbG9uZShUU3RyaW5nKTsKICAgIH0KICAgIGlmICghZGF0YS5sZW5ndGgpIHsKICAgICAgICBTdHIoVFN0cmluZykucmVwbGFjZSh0Q29tbWFuZCwgZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICAgICAgdmFyIHBhcmFtcyA9IFtdLAogICAgICAgICAgICAgICAgbmFtZSA9IGIudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgYy5yZXBsYWNlKHBhdGhWYWx1ZXMsIGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICBiICYmIHBhcmFtcy5wdXNoKCtiKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGRhdGEucHVzaChbYl0uY29uY2F0KHBhcmFtcykpOwogICAgICAgIH0pOwogICAgfQogICAgZGF0YS50b1N0cmluZyA9IFNuYXAucGF0aC50b1N0cmluZzsKICAgIHJldHVybiBkYXRhOwp9OwpmdW5jdGlvbiBzdmdUcmFuc2Zvcm0yc3RyaW5nKHRzdHIpIHsKICAgIHZhciByZXMgPSBbXTsKICAgIHRzdHIgPSB0c3RyLnJlcGxhY2UoLyg/Ol58XHMpKFx3KylcKChbXildKylcKS9nLCBmdW5jdGlvbiAoYWxsLCBuYW1lLCBwYXJhbXMpIHsKICAgICAgICBwYXJhbXMgPSBwYXJhbXMuc3BsaXQoL1xzKixccyp8XHMrLyk7CiAgICAgICAgaWYgKG5hbWUgPT0gInJvdGF0ZSIgJiYgcGFyYW1zLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgIHBhcmFtcy5wdXNoKDAsIDApOwogICAgICAgIH0KICAgICAgICBpZiAobmFtZSA9PSAic2NhbGUiKSB7CiAgICAgICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID4gMikgewogICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zLnNsaWNlKDAsIDIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHBhcmFtcy5sZW5ndGggPT0gMikgewogICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goMCwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICAgICAgcGFyYW1zLnB1c2gocGFyYW1zWzBdLCAwLCAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAobmFtZSA9PSAic2tld1giKSB7CiAgICAgICAgICAgIHJlcy5wdXNoKFsibSIsIDEsIDAsIG1hdGgudGFuKHJhZChwYXJhbXNbMF0pKSwgMSwgMCwgMF0pOwogICAgICAgIH0gZWxzZSBpZiAobmFtZSA9PSAic2tld1kiKSB7CiAgICAgICAgICAgIHJlcy5wdXNoKFsibSIsIDEsIG1hdGgudGFuKHJhZChwYXJhbXNbMF0pKSwgMCwgMSwgMCwgMF0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlcy5wdXNoKFtuYW1lLmNoYXJBdCgwKV0uY29uY2F0KHBhcmFtcykpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYWxsOwogICAgfSk7CiAgICByZXR1cm4gcmVzOwp9ClNuYXAuXy5zdmdUcmFuc2Zvcm0yc3RyaW5nID0gc3ZnVHJhbnNmb3JtMnN0cmluZzsKU25hcC5fLnJnVHJhbnNmb3JtID0gbmV3IFJlZ0V4cCgiXlthLXpdWyIgKyBzcGFjZXMgKyAiXSotP1xcLj9cXGQiLCAiaSIpOwpmdW5jdGlvbiB0cmFuc2Zvcm0ybWF0cml4KHRzdHIsIGJib3gpIHsKICAgIHZhciB0ZGF0YSA9IHBhcnNlVHJhbnNmb3JtU3RyaW5nKHRzdHIpLAogICAgICAgIG0gPSBuZXcgU25hcC5NYXRyaXg7CiAgICBpZiAodGRhdGEpIHsKICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSB0ZGF0YS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGRhdGFbaV0sCiAgICAgICAgICAgICAgICB0bGVuID0gdC5sZW5ndGgsCiAgICAgICAgICAgICAgICBjb21tYW5kID0gU3RyKHRbMF0pLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgICAgICBhYnNvbHV0ZSA9IHRbMF0gIT0gY29tbWFuZCwKICAgICAgICAgICAgICAgIGludmVyID0gYWJzb2x1dGUgPyBtLmludmVydCgpIDogMCwKICAgICAgICAgICAgICAgIHgxLAogICAgICAgICAgICAgICAgeTEsCiAgICAgICAgICAgICAgICB4MiwKICAgICAgICAgICAgICAgIHkyLAogICAgICAgICAgICAgICAgYmI7CiAgICAgICAgICAgIGlmIChjb21tYW5kID09ICJ0IiAmJiB0bGVuID09IDIpewogICAgICAgICAgICAgICAgbS50cmFuc2xhdGUodFsxXSwgMCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29tbWFuZCA9PSAidCIgJiYgdGxlbiA9PSAzKSB7CiAgICAgICAgICAgICAgICBpZiAoYWJzb2x1dGUpIHsKICAgICAgICAgICAgICAgICAgICB4MSA9IGludmVyLngoMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgeTEgPSBpbnZlci55KDAsIDApOwogICAgICAgICAgICAgICAgICAgIHgyID0gaW52ZXIueCh0WzFdLCB0WzJdKTsKICAgICAgICAgICAgICAgICAgICB5MiA9IGludmVyLnkodFsxXSwgdFsyXSk7CiAgICAgICAgICAgICAgICAgICAgbS50cmFuc2xhdGUoeDIgLSB4MSwgeTIgLSB5MSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG0udHJhbnNsYXRlKHRbMV0sIHRbMl0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGNvbW1hbmQgPT0gInIiKSB7CiAgICAgICAgICAgICAgICBpZiAodGxlbiA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgYmIgPSBiYiB8fCBiYm94OwogICAgICAgICAgICAgICAgICAgIG0ucm90YXRlKHRbMV0sIGJiLnggKyBiYi53aWR0aCAvIDIsIGJiLnkgKyBiYi5oZWlnaHQgLyAyKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGxlbiA9PSA0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFic29sdXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHgyID0gaW52ZXIueCh0WzJdLCB0WzNdKTsKICAgICAgICAgICAgICAgICAgICAgICAgeTIgPSBpbnZlci55KHRbMl0sIHRbM10pOwogICAgICAgICAgICAgICAgICAgICAgICBtLnJvdGF0ZSh0WzFdLCB4MiwgeTIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG0ucm90YXRlKHRbMV0sIHRbMl0sIHRbM10pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChjb21tYW5kID09ICJzIikgewogICAgICAgICAgICAgICAgaWYgKHRsZW4gPT0gMiB8fCB0bGVuID09IDMpIHsKICAgICAgICAgICAgICAgICAgICBiYiA9IGJiIHx8IGJib3g7CiAgICAgICAgICAgICAgICAgICAgbS5zY2FsZSh0WzFdLCB0W3RsZW4gLSAxXSwgYmIueCArIGJiLndpZHRoIC8gMiwgYmIueSArIGJiLmhlaWdodCAvIDIpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0bGVuID09IDQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYWJzb2x1dGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgeDIgPSBpbnZlci54KHRbMl0sIHRbM10pOwogICAgICAgICAgICAgICAgICAgICAgICB5MiA9IGludmVyLnkodFsyXSwgdFszXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIG0uc2NhbGUodFsxXSwgdFsxXSwgeDIsIHkyKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBtLnNjYWxlKHRbMV0sIHRbMV0sIHRbMl0sIHRbM10pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGxlbiA9PSA1KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFic29sdXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHgyID0gaW52ZXIueCh0WzNdLCB0WzRdKTsKICAgICAgICAgICAgICAgICAgICAgICAgeTIgPSBpbnZlci55KHRbM10sIHRbNF0pOwogICAgICAgICAgICAgICAgICAgICAgICBtLnNjYWxlKHRbMV0sIHRbMl0sIHgyLCB5Mik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbS5zY2FsZSh0WzFdLCB0WzJdLCB0WzNdLCB0WzRdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29tbWFuZCA9PSAibSIgJiYgdGxlbiA9PSA3KSB7CiAgICAgICAgICAgICAgICBtLmFkZCh0WzFdLCB0WzJdLCB0WzNdLCB0WzRdLCB0WzVdLCB0WzZdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBtOwp9ClNuYXAuXy50cmFuc2Zvcm0ybWF0cml4ID0gdHJhbnNmb3JtMm1hdHJpeDsKZnVuY3Rpb24gZXh0cmFjdFRyYW5zZm9ybShlbCwgdHN0cikgewogICAgaWYgKHRzdHIgPT0gbnVsbCkgewogICAgICAgIHZhciBkb1JldHVybiA9IHRydWU7CiAgICAgICAgaWYgKGVsLnR5cGUgPT0gImxpbmVhckdyYWRpZW50IiB8fCBlbC50eXBlID09ICJyYWRpYWxHcmFkaWVudCIpIHsKICAgICAgICAgICAgdHN0ciA9IGVsLm5vZGUuZ2V0QXR0cmlidXRlKCJncmFkaWVudFRyYW5zZm9ybSIpOwogICAgICAgIH0gZWxzZSBpZiAoZWwudHlwZSA9PSAicGF0dGVybiIpIHsKICAgICAgICAgICAgdHN0ciA9IGVsLm5vZGUuZ2V0QXR0cmlidXRlKCJwYXR0ZXJuVHJhbnNmb3JtIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdHN0ciA9IGVsLm5vZGUuZ2V0QXR0cmlidXRlKCJ0cmFuc2Zvcm0iKTsKICAgICAgICB9CiAgICAgICAgaWYgKCF0c3RyKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgU25hcC5NYXRyaXg7CiAgICAgICAgfQogICAgICAgIHRzdHIgPSBzdmdUcmFuc2Zvcm0yc3RyaW5nKHRzdHIpOwogICAgfSBlbHNlIHsKICAgICAgICBpZiAoIVNuYXAuXy5yZ1RyYW5zZm9ybS50ZXN0KHRzdHIpKSB7CiAgICAgICAgICAgIHRzdHIgPSBzdmdUcmFuc2Zvcm0yc3RyaW5nKHRzdHIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRzdHIgPSBTdHIodHN0cikucmVwbGFjZSgvXC57M318XHUyMDI2L2csIGVsLl8udHJhbnNmb3JtIHx8IEUpOwogICAgICAgIH0KICAgICAgICBpZiAoaXModHN0ciwgImFycmF5IikpIHsKICAgICAgICAgICAgdHN0ciA9IFNuYXAucGF0aCA/IFNuYXAucGF0aC50b1N0cmluZy5jYWxsKHRzdHIpIDogU3RyKHRzdHIpOwogICAgICAgIH0KICAgICAgICBlbC5fLnRyYW5zZm9ybSA9IHRzdHI7CiAgICB9CiAgICB2YXIgbSA9IHRyYW5zZm9ybTJtYXRyaXgodHN0ciwgZWwuZ2V0QkJveCgxKSk7CiAgICBpZiAoZG9SZXR1cm4pIHsKICAgICAgICByZXR1cm4gbTsKICAgIH0gZWxzZSB7CiAgICAgICAgZWwubWF0cml4ID0gbTsKICAgIH0KfQpTbmFwLl91bml0MnB4ID0gdW5pdDJweDsKdmFyIGNvbnRhaW5zID0gZ2xvYi5kb2MuY29udGFpbnMgfHwgZ2xvYi5kb2MuY29tcGFyZURvY3VtZW50UG9zaXRpb24gPwogICAgZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYWRvd24gPSBhLm5vZGVUeXBlID09IDkgPyBhLmRvY3VtZW50RWxlbWVudCA6IGEsCiAgICAgICAgICAgIGJ1cCA9IGIgJiYgYi5wYXJlbnROb2RlOwogICAgICAgICAgICByZXR1cm4gYSA9PSBidXAgfHwgISEoYnVwICYmIGJ1cC5ub2RlVHlwZSA9PSAxICYmICgKICAgICAgICAgICAgICAgIGFkb3duLmNvbnRhaW5zID8KICAgICAgICAgICAgICAgICAgICBhZG93bi5jb250YWlucyhidXApIDoKICAgICAgICAgICAgICAgICAgICBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYnVwKSAmIDE2CiAgICAgICAgICAgICkpOwogICAgfSA6CiAgICBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGlmIChiKSB7CiAgICAgICAgICAgIHdoaWxlIChiKSB7CiAgICAgICAgICAgICAgICBiID0gYi5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgaWYgKGIgPT0gYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CmZ1bmN0aW9uIGdldFNvbWVEZWZzKGVsKSB7CiAgICB2YXIgcCA9IChlbC5ub2RlLm93bmVyU1ZHRWxlbWVudCAmJiB3cmFwKGVsLm5vZGUub3duZXJTVkdFbGVtZW50KSkgfHwKICAgICAgICAgICAgKGVsLm5vZGUucGFyZW50Tm9kZSAmJiB3cmFwKGVsLm5vZGUucGFyZW50Tm9kZSkpIHx8CiAgICAgICAgICAgIFNuYXAuc2VsZWN0KCJzdmciKSB8fAogICAgICAgICAgICBTbmFwKDAsIDApLAogICAgICAgIHBkZWZzID0gcC5zZWxlY3QoImRlZnMiKSwKICAgICAgICBkZWZzICA9IHBkZWZzID09IG51bGwgPyBmYWxzZSA6IHBkZWZzLm5vZGU7CiAgICBpZiAoIWRlZnMpIHsKICAgICAgICBkZWZzID0gbWFrZSgiZGVmcyIsIHAubm9kZSkubm9kZTsKICAgIH0KICAgIHJldHVybiBkZWZzOwp9CmZ1bmN0aW9uIGdldFNvbWVTVkcoZWwpIHsKICAgIHJldHVybiBlbC5ub2RlLm93bmVyU1ZHRWxlbWVudCAmJiB3cmFwKGVsLm5vZGUub3duZXJTVkdFbGVtZW50KSB8fCBTbmFwLnNlbGVjdCgic3ZnIik7Cn0KU25hcC5fLmdldFNvbWVEZWZzID0gZ2V0U29tZURlZnM7ClNuYXAuXy5nZXRTb21lU1ZHID0gZ2V0U29tZVNWRzsKZnVuY3Rpb24gdW5pdDJweChlbCwgbmFtZSwgdmFsdWUpIHsKICAgIHZhciBzdmcgPSBnZXRTb21lU1ZHKGVsKS5ub2RlLAogICAgICAgIG91dCA9IHt9LAogICAgICAgIG1nciA9IHN2Zy5xdWVyeVNlbGVjdG9yKCIuc3ZnLS0tbWdyIik7CiAgICBpZiAoIW1ncikgewogICAgICAgIG1nciA9ICQoInJlY3QiKTsKICAgICAgICAkKG1nciwge3g6IC05ZTksIHk6IC05ZTksIHdpZHRoOiAxMCwgaGVpZ2h0OiAxMCwgImNsYXNzIjogInN2Zy0tLW1nciIsIGZpbGw6ICJub25lIn0pOwogICAgICAgIHN2Zy5hcHBlbmRDaGlsZChtZ3IpOwogICAgfQogICAgZnVuY3Rpb24gZ2V0Vyh2YWwpIHsKICAgICAgICBpZiAodmFsID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIEU7CiAgICAgICAgfQogICAgICAgIGlmICh2YWwgPT0gK3ZhbCkgewogICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgIH0KICAgICAgICAkKG1nciwge3dpZHRoOiB2YWx9KTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gbWdyLmdldEJCb3goKS53aWR0aDsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGdldEgodmFsKSB7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBFOwogICAgICAgIH0KICAgICAgICBpZiAodmFsID09ICt2YWwpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICB9CiAgICAgICAgJChtZ3IsIHtoZWlnaHQ6IHZhbH0pOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBtZ3IuZ2V0QkJveCgpLmhlaWdodDsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHNldChuYW0sIGYpIHsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKSB7CiAgICAgICAgICAgIG91dFtuYW1dID0gZihlbC5hdHRyKG5hbSkgfHwgMCk7CiAgICAgICAgfSBlbHNlIGlmIChuYW0gPT0gbmFtZSkgewogICAgICAgICAgICBvdXQgPSBmKHZhbHVlID09IG51bGwgPyBlbC5hdHRyKG5hbSkgfHwgMCA6IHZhbHVlKTsKICAgICAgICB9CiAgICB9CiAgICBzd2l0Y2ggKGVsLnR5cGUpIHsKICAgICAgICBjYXNlICJyZWN0IjoKICAgICAgICAgICAgc2V0KCJyeCIsIGdldFcpOwogICAgICAgICAgICBzZXQoInJ5IiwgZ2V0SCk7CiAgICAgICAgY2FzZSAiaW1hZ2UiOgogICAgICAgICAgICBzZXQoIndpZHRoIiwgZ2V0Vyk7CiAgICAgICAgICAgIHNldCgiaGVpZ2h0IiwgZ2V0SCk7CiAgICAgICAgY2FzZSAidGV4dCI6CiAgICAgICAgICAgIHNldCgieCIsIGdldFcpOwogICAgICAgICAgICBzZXQoInkiLCBnZXRIKTsKICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjaXJjbGUiOgogICAgICAgICAgICBzZXQoImN4IiwgZ2V0Vyk7CiAgICAgICAgICAgIHNldCgiY3kiLCBnZXRIKTsKICAgICAgICAgICAgc2V0KCJyIiwgZ2V0Vyk7CiAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZWxsaXBzZSI6CiAgICAgICAgICAgIHNldCgiY3giLCBnZXRXKTsKICAgICAgICAgICAgc2V0KCJjeSIsIGdldEgpOwogICAgICAgICAgICBzZXQoInJ4IiwgZ2V0Vyk7CiAgICAgICAgICAgIHNldCgicnkiLCBnZXRIKTsKICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJsaW5lIjoKICAgICAgICAgICAgc2V0KCJ4MSIsIGdldFcpOwogICAgICAgICAgICBzZXQoIngyIiwgZ2V0Vyk7CiAgICAgICAgICAgIHNldCgieTEiLCBnZXRIKTsKICAgICAgICAgICAgc2V0KCJ5MiIsIGdldEgpOwogICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIm1hcmtlciI6CiAgICAgICAgICAgIHNldCgicmVmWCIsIGdldFcpOwogICAgICAgICAgICBzZXQoIm1hcmtlcldpZHRoIiwgZ2V0Vyk7CiAgICAgICAgICAgIHNldCgicmVmWSIsIGdldEgpOwogICAgICAgICAgICBzZXQoIm1hcmtlckhlaWdodCIsIGdldEgpOwogICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInJhZGlhbEdyYWRpZW50IjoKICAgICAgICAgICAgc2V0KCJmeCIsIGdldFcpOwogICAgICAgICAgICBzZXQoImZ5IiwgZ2V0SCk7CiAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAidHNwYW4iOgogICAgICAgICAgICBzZXQoImR4IiwgZ2V0Vyk7CiAgICAgICAgICAgIHNldCgiZHkiLCBnZXRIKTsKICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBzZXQobmFtZSwgZ2V0Vyk7CiAgICB9CiAgICBzdmcucmVtb3ZlQ2hpbGQobWdyKTsKICAgIHJldHVybiBvdXQ7Cn0KLypcCiAqIFNuYXAuc2VsZWN0CiBbIG1ldGhvZCBdCiAqKgogKiBXcmFwcyBhIERPTSBlbGVtZW50IHNwZWNpZmllZCBieSBDU1Mgc2VsZWN0b3IgYXMgQEVsZW1lbnQKIC0gcXVlcnkgKHN0cmluZykgQ1NTIHNlbGVjdG9yIG9mIHRoZSBlbGVtZW50CiA9IChFbGVtZW50KSB0aGUgY3VycmVudCBlbGVtZW50ClwqLwpTbmFwLnNlbGVjdCA9IGZ1bmN0aW9uIChxdWVyeSkgewogICAgcmV0dXJuIHdyYXAoZ2xvYi5kb2MucXVlcnlTZWxlY3RvcihxdWVyeSkpOwp9OwovKlwKICogU25hcC5zZWxlY3RBbGwKIFsgbWV0aG9kIF0KICoqCiAqIFdyYXBzIERPTSBlbGVtZW50cyBzcGVjaWZpZWQgYnkgQ1NTIHNlbGVjdG9yIGFzIHNldCBvciBhcnJheSBvZiBARWxlbWVudAogLSBxdWVyeSAoc3RyaW5nKSBDU1Mgc2VsZWN0b3Igb2YgdGhlIGVsZW1lbnQKID0gKEVsZW1lbnQpIHRoZSBjdXJyZW50IGVsZW1lbnQKXCovClNuYXAuc2VsZWN0QWxsID0gZnVuY3Rpb24gKHF1ZXJ5KSB7CiAgICB2YXIgbm9kZWxpc3QgPSBnbG9iLmRvYy5xdWVyeVNlbGVjdG9yQWxsKHF1ZXJ5KSwKICAgICAgICBzZXQgPSAoU25hcC5zZXQgfHwgQXJyYXkpKCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVsaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgc2V0LnB1c2god3JhcChub2RlbGlzdFtpXSkpOwogICAgfQogICAgcmV0dXJuIHNldDsKfTsKCmZ1bmN0aW9uIGFkZDJncm91cChsaXN0KSB7CiAgICBpZiAoIWlzKGxpc3QsICJhcnJheSIpKSB7CiAgICAgICAgbGlzdCA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7CiAgICB9CiAgICB2YXIgaSA9IDAsCiAgICAgICAgaiA9IDAsCiAgICAgICAgbm9kZSA9IHRoaXMubm9kZTsKICAgIHdoaWxlICh0aGlzW2ldKSBkZWxldGUgdGhpc1tpKytdOwogICAgZm9yIChpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAobGlzdFtpXS50eXBlID09ICJzZXQiKSB7CiAgICAgICAgICAgIGxpc3RbaV0uZm9yRWFjaChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgICAgIG5vZGUuYXBwZW5kQ2hpbGQoZWwubm9kZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5vZGUuYXBwZW5kQ2hpbGQobGlzdFtpXS5ub2RlKTsKICAgICAgICB9CiAgICB9CiAgICB2YXIgY2hpbGRyZW4gPSBub2RlLmNoaWxkTm9kZXM7CiAgICBmb3IgKGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICB0aGlzW2orK10gPSB3cmFwKGNoaWxkcmVuW2ldKTsKICAgIH0KICAgIHJldHVybiB0aGlzOwp9Ci8vIEh1YiBnYXJiYWdlIGNvbGxlY3RvciBldmVyeSAxMHMKc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgZm9yICh2YXIga2V5IGluIGh1YikgaWYgKGh1YltoYXNdKGtleSkpIHsKICAgICAgICB2YXIgZWwgPSBodWJba2V5XSwKICAgICAgICAgICAgbm9kZSA9IGVsLm5vZGU7CiAgICAgICAgaWYgKGVsLnR5cGUgIT0gInN2ZyIgJiYgIW5vZGUub3duZXJTVkdFbGVtZW50IHx8IGVsLnR5cGUgPT0gInN2ZyIgJiYgKCFub2RlLnBhcmVudE5vZGUgfHwgIm93bmVyU1ZHRWxlbWVudCIgaW4gbm9kZS5wYXJlbnROb2RlICYmICFub2RlLm93bmVyU1ZHRWxlbWVudCkpIHsKICAgICAgICAgICAgZGVsZXRlIGh1YltrZXldOwogICAgICAgIH0KICAgIH0KfSwgMWU0KTsKZnVuY3Rpb24gRWxlbWVudChlbCkgewogICAgaWYgKGVsLnNuYXAgaW4gaHViKSB7CiAgICAgICAgcmV0dXJuIGh1YltlbC5zbmFwXTsKICAgIH0KICAgIHZhciBpZCA9IHRoaXMuaWQgPSBJRCgpLAogICAgICAgIHN2ZzsKICAgIHRyeSB7CiAgICAgICAgc3ZnID0gZWwub3duZXJTVkdFbGVtZW50OwogICAgfSBjYXRjaChlKSB7fQogICAgLypcCiAgICAgKiBFbGVtZW50Lm5vZGUKICAgICBbIHByb3BlcnR5IChvYmplY3QpIF0KICAgICAqKgogICAgICogR2l2ZXMgeW91IGEgcmVmZXJlbmNlIHRvIHRoZSBET00gb2JqZWN0LCBzbyB5b3UgY2FuIGFzc2lnbiBldmVudCBoYW5kbGVycyBvciBqdXN0IG1lc3MgYXJvdW5kLgogICAgID4gVXNhZ2UKICAgICB8IC8vIGRyYXcgYSBjaXJjbGUgYXQgY29vcmRpbmF0ZSAxMCwxMCB3aXRoIHJhZGl1cyBvZiAxMAogICAgIHwgdmFyIGMgPSBwYXBlci5jaXJjbGUoMTAsIDEwLCAxMCk7CiAgICAgfCBjLm5vZGUub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICB8ICAgICBjLmF0dHIoImZpbGwiLCAicmVkIik7CiAgICAgfCB9OwogICAgXCovCiAgICB0aGlzLm5vZGUgPSBlbDsKICAgIGlmIChzdmcpIHsKICAgICAgICB0aGlzLnBhcGVyID0gbmV3IFBhcGVyKHN2Zyk7CiAgICB9CiAgICAvKlwKICAgICAqIEVsZW1lbnQudHlwZQogICAgIFsgcHJvcGVydHkgKHN0cmluZykgXQogICAgICoqCiAgICAgKiBTVkcgdGFnIG5hbWUgb2YgdGhlIGdpdmVuIGVsZW1lbnQuCiAgICBcKi8KICAgIHRoaXMudHlwZSA9IGVsLnRhZ05hbWU7CiAgICB0aGlzLmFuaW1zID0ge307CiAgICB0aGlzLl8gPSB7CiAgICAgICAgdHJhbnNmb3JtOiBbXQogICAgfTsKICAgIGVsLnNuYXAgPSBpZDsKICAgIGh1YltpZF0gPSB0aGlzOwogICAgaWYgKHRoaXMudHlwZSA9PSAiZyIpIHsKICAgICAgICB0aGlzLmFkZCA9IGFkZDJncm91cDsKICAgIH0KICAgIGlmICh0aGlzLnR5cGUgaW4geyJnIjogMSwgIm1hc2siOiAxLCAicGF0dGVybiI6IDF9KSB7CiAgICAgICAgZm9yICh2YXIgbWV0aG9kIGluIFBhcGVyLnByb3RvdHlwZSkgaWYgKFBhcGVyLnByb3RvdHlwZVtoYXNdKG1ldGhvZCkpIHsKICAgICAgICAgICAgdGhpc1ttZXRob2RdID0gUGFwZXIucHJvdG90eXBlW21ldGhvZF07CiAgICAgICAgfQogICAgfQp9CihmdW5jdGlvbiAoZWxwcm90bykgewogICAgLypcCiAgICAgKiBFbGVtZW50LmF0dHIKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIEdldHMgb3Igc2V0cyBnaXZlbiBhdHRyaWJ1dGVzIG9mIHRoZSBlbGVtZW50LgogICAgICoqCiAgICAgLSBwYXJhbXMgKG9iamVjdCkgY29udGFpbnMga2V5LXZhbHVlIHBhaXJzIG9mIGF0dHJpYnV0ZXMgeW91IHdhbnQgdG8gc2V0CiAgICAgKiBvcgogICAgIC0gcGFyYW0gKHN0cmluZykgbmFtZSBvZiB0aGUgYXR0cmlidXRlCiAgICAgPSAoRWxlbWVudCkgdGhlIGN1cnJlbnQgZWxlbWVudAogICAgICogb3IKICAgICA9IChzdHJpbmcpIHZhbHVlIG9mIGF0dHJpYnV0ZQogICAgID4gVXNhZ2UKICAgICB8IGVsLmF0dHIoewogICAgIHwgICAgIGZpbGw6ICIjZmMwIiwKICAgICB8ICAgICBzdHJva2U6ICIjMDAwIiwKICAgICB8ICAgICBzdHJva2VXaWR0aDogMiwgLy8gQ2FtZWxDYXNlLi4uCiAgICAgfCAgICAgImZpbGwtb3BhY2l0eSI6IDAuNSwgLy8gb3IgZGFzaC1zZXBhcmF0ZWQgbmFtZXMKICAgICB8ICAgICB3aWR0aDogIio9MiIgLy8gcHJlZml4ZWQgdmFsdWVzCiAgICAgfCB9KTsKICAgICB8IGNvbnNvbGUubG9nKGVsLmF0dHIoImZpbGwiKSk7IC8vICNmYzAKICAgICAqIFByZWZpeGVkIHZhbHVlcyBpbiBmb3JtYXQgYCIrPTEwImAgc3VwcG9ydGVkLiBBbGwgZm91ciBvcGVyYXRpb25zCiAgICAgKiAoYCtgLCBgLWAsIGAqYCBhbmQgYC9gKSBjb3VsZCBiZSB1c2VkLiBPcHRpb25hbGx5IHlvdSBjYW4gdXNlIHVuaXRzIGZvciBgK2AKICAgICAqIGFuZCBgLWA6IGAiKz0yZW0iYC4KICAgIFwqLwogICAgZWxwcm90by5hdHRyID0gZnVuY3Rpb24gKHBhcmFtcywgdmFsdWUpIHsKICAgICAgICB2YXIgZWwgPSB0aGlzLAogICAgICAgICAgICBub2RlID0gZWwubm9kZTsKICAgICAgICBpZiAoIXBhcmFtcykgewogICAgICAgICAgICByZXR1cm4gZWw7CiAgICAgICAgfQogICAgICAgIGlmIChpcyhwYXJhbXMsICJzdHJpbmciKSkgewogICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgIHZhciBqc29uID0ge307CiAgICAgICAgICAgICAgICBqc29uW3BhcmFtc10gPSB2YWx1ZTsKICAgICAgICAgICAgICAgIHBhcmFtcyA9IGpzb247CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZXZlKCJzbmFwLnV0aWwuZ2V0YXR0ci4iICsgcGFyYW1zLCBlbCkuZmlyc3REZWZpbmVkKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgYXR0IGluIHBhcmFtcykgewogICAgICAgICAgICBpZiAocGFyYW1zW2hhc10oYXR0KSkgewogICAgICAgICAgICAgICAgZXZlKCJzbmFwLnV0aWwuYXR0ci4iICsgYXR0LCBlbCwgcGFyYW1zW2F0dF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBlbDsKICAgIH07CiAgICAvKlwKICAgICAqIEVsZW1lbnQuZ2V0QkJveAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogUmV0dXJucyB0aGUgYm91bmRpbmcgYm94IGRlc2NyaXB0b3IgZm9yIHRoZSBnaXZlbiBlbGVtZW50CiAgICAgKioKICAgICA9IChvYmplY3QpIGJvdW5kaW5nIGJveCBkZXNjcmlwdG9yOgogICAgIG8gewogICAgIG8gICAgIGN4OiAobnVtYmVyKSB4IG9mIHRoZSBjZW50ZXIsCiAgICAgbyAgICAgY3k6IChudW1iZXIpIHggb2YgdGhlIGNlbnRlciwKICAgICBvICAgICBoOiAobnVtYmVyKSBoZWlnaHQsCiAgICAgbyAgICAgaGVpZ2h0OiAobnVtYmVyKSBoZWlnaHQsCiAgICAgbyAgICAgcGF0aDogKHN0cmluZykgcGF0aCBjb21tYW5kIGZvciB0aGUgYm94LAogICAgIG8gICAgIHIwOiAobnVtYmVyKSByYWRpdXMgb2YgYSBjaXJjbGUgdGhhdCBmdWxseSBlbmNsb3NlcyB0aGUgYm94LAogICAgIG8gICAgIHIxOiAobnVtYmVyKSByYWRpdXMgb2YgdGhlIHNtYWxsZXN0IGNpcmNsZSB0aGF0IGNhbiBiZSBlbmNsb3NlZCwKICAgICBvICAgICByMjogKG51bWJlcikgcmFkaXVzIG9mIHRoZSBsYXJnZXN0IGNpcmNsZSB0aGF0IGNhbiBiZSBlbmNsb3NlZCwKICAgICBvICAgICB2YjogKHN0cmluZykgYm94IGFzIGEgdmlld2JveCBjb21tYW5kLAogICAgIG8gICAgIHc6IChudW1iZXIpIHdpZHRoLAogICAgIG8gICAgIHdpZHRoOiAobnVtYmVyKSB3aWR0aCwKICAgICBvICAgICB4MjogKG51bWJlcikgeCBvZiB0aGUgcmlnaHQgc2lkZSwKICAgICBvICAgICB4OiAobnVtYmVyKSB4IG9mIHRoZSBsZWZ0IHNpZGUsCiAgICAgbyAgICAgeTI6IChudW1iZXIpIHkgb2YgdGhlIGJvdHRvbSBlZGdlLAogICAgIG8gICAgIHk6IChudW1iZXIpIHkgb2YgdGhlIHRvcCBlZGdlCiAgICAgbyB9CiAgICBcKi8KICAgIGVscHJvdG8uZ2V0QkJveCA9IGZ1bmN0aW9uIChpc1dpdGhvdXRUcmFuc2Zvcm0pIHsKICAgICAgICBpZiAoIVNuYXAuTWF0cml4IHx8ICFTbmFwLnBhdGgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubm9kZS5nZXRCQm94KCk7CiAgICAgICAgfQogICAgICAgIHZhciBlbCA9IHRoaXMsCiAgICAgICAgICAgIG0gPSBuZXcgU25hcC5NYXRyaXg7CiAgICAgICAgaWYgKGVsLnJlbW92ZWQpIHsKICAgICAgICAgICAgcmV0dXJuIFNuYXAuXy5ib3goKTsKICAgICAgICB9CiAgICAgICAgd2hpbGUgKGVsLnR5cGUgPT0gInVzZSIpIHsKICAgICAgICAgICAgaWYgKCFpc1dpdGhvdXRUcmFuc2Zvcm0pIHsKICAgICAgICAgICAgICAgIG0gPSBtLmFkZChlbC50cmFuc2Zvcm0oKS5sb2NhbE1hdHJpeC50cmFuc2xhdGUoZWwuYXR0cigieCIpIHx8IDAsIGVsLmF0dHIoInkiKSB8fCAwKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGVsLm9yaWdpbmFsKSB7CiAgICAgICAgICAgICAgICBlbCA9IGVsLm9yaWdpbmFsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyIGhyZWYgPSBlbC5hdHRyKCJ4bGluazpocmVmIik7CiAgICAgICAgICAgICAgICBlbCA9IGVsLm9yaWdpbmFsID0gZWwubm9kZS5vd25lckRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGhyZWYuc3Vic3RyaW5nKGhyZWYuaW5kZXhPZigiIyIpICsgMSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBfID0gZWwuXywKICAgICAgICAgICAgcGF0aGZpbmRlciA9IFNuYXAucGF0aC5nZXRbZWwudHlwZV0gfHwgU25hcC5wYXRoLmdldC5kZWZsdDsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoaXNXaXRob3V0VHJhbnNmb3JtKSB7CiAgICAgICAgICAgICAgICBfLmJib3h3dCA9IHBhdGhmaW5kZXIgPyBTbmFwLnBhdGguZ2V0QkJveChlbC5yZWFsUGF0aCA9IHBhdGhmaW5kZXIoZWwpKSA6IFNuYXAuXy5ib3goZWwubm9kZS5nZXRCQm94KCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIFNuYXAuXy5ib3goXy5iYm94d3QpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZWwucmVhbFBhdGggPSBwYXRoZmluZGVyKGVsKTsKICAgICAgICAgICAgICAgIGVsLm1hdHJpeCA9IGVsLnRyYW5zZm9ybSgpLmxvY2FsTWF0cml4OwogICAgICAgICAgICAgICAgXy5iYm94ID0gU25hcC5wYXRoLmdldEJCb3goU25hcC5wYXRoLm1hcChlbC5yZWFsUGF0aCwgbS5hZGQoZWwubWF0cml4KSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIFNuYXAuXy5ib3goXy5iYm94KTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgLy8gRmlyZWZveCBkb2VzbuKAmXQgZ2l2ZSB5b3UgYmJveCBvZiBoaWRkZW4gZWxlbWVudAogICAgICAgICAgICByZXR1cm4gU25hcC5fLmJveCgpOwogICAgICAgIH0KICAgIH07CiAgICB2YXIgcHJvcFN0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmc7CiAgICB9OwogICAgLypcCiAgICAgKiBFbGVtZW50LnRyYW5zZm9ybQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogR2V0cyBvciBzZXRzIHRyYW5zZm9ybWF0aW9uIG9mIHRoZSBlbGVtZW50CiAgICAgKioKICAgICAtIHRzdHIgKHN0cmluZykgdHJhbnNmb3JtIHN0cmluZyBpbiBTbmFwIG9yIFNWRyBmb3JtYXQKICAgICA9IChFbGVtZW50KSB0aGUgY3VycmVudCBlbGVtZW50CiAgICAgKiBvcgogICAgID0gKG9iamVjdCkgdHJhbnNmb3JtYXRpb24gZGVzY3JpcHRvcjoKICAgICBvIHsKICAgICBvICAgICBzdHJpbmcgKHN0cmluZykgdHJhbnNmb3JtIHN0cmluZywKICAgICBvICAgICBnbG9iYWxNYXRyaXggKE1hdHJpeCkgbWF0cml4IG9mIGFsbCB0cmFuc2Zvcm1hdGlvbnMgYXBwbGllZCB0byBlbGVtZW50IG9yIGl0cyBwYXJlbnRzLAogICAgIG8gICAgIGxvY2FsTWF0cml4IChNYXRyaXgpIG1hdHJpeCBvZiB0cmFuc2Zvcm1hdGlvbnMgYXBwbGllZCBvbmx5IHRvIHRoZSBlbGVtZW50LAogICAgIG8gICAgIGRpZmZNYXRyaXggKE1hdHJpeCkgbWF0cml4IG9mIGRpZmZlcmVuY2UgYmV0d2VlbiBnbG9iYWwgYW5kIGxvY2FsIHRyYW5zZm9ybWF0aW9ucywKICAgICBvICAgICBnbG9iYWwgKHN0cmluZykgZ2xvYmFsIHRyYW5zZm9ybWF0aW9uIGFzIHN0cmluZywKICAgICBvICAgICBsb2NhbCAoc3RyaW5nKSBsb2NhbCB0cmFuc2Zvcm1hdGlvbiBhcyBzdHJpbmcsCiAgICAgbyAgICAgdG9TdHJpbmcgKGZ1bmN0aW9uKSByZXR1cm5zIGBzdHJpbmdgIHByb3BlcnR5CiAgICAgbyB9CiAgICBcKi8KICAgIGVscHJvdG8udHJhbnNmb3JtID0gZnVuY3Rpb24gKHRzdHIpIHsKICAgICAgICB2YXIgXyA9IHRoaXMuXzsKICAgICAgICBpZiAodHN0ciA9PSBudWxsKSB7CiAgICAgICAgICAgIHZhciBwYXBhID0gdGhpcywKICAgICAgICAgICAgICAgIGdsb2JhbCA9IG5ldyBTbmFwLk1hdHJpeCh0aGlzLm5vZGUuZ2V0Q1RNKCkpLAogICAgICAgICAgICAgICAgbG9jYWwgPSBleHRyYWN0VHJhbnNmb3JtKHRoaXMpLAogICAgICAgICAgICAgICAgbXMgPSBbbG9jYWxdLAogICAgICAgICAgICAgICAgbSA9IG5ldyBTbmFwLk1hdHJpeCwKICAgICAgICAgICAgICAgIGksCiAgICAgICAgICAgICAgICBsb2NhbFN0cmluZyA9IGxvY2FsLnRvVHJhbnNmb3JtU3RyaW5nKCksCiAgICAgICAgICAgICAgICBzdHJpbmcgPSBTdHIobG9jYWwpID09IFN0cih0aGlzLm1hdHJpeCkgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyKF8udHJhbnNmb3JtKSA6IGxvY2FsU3RyaW5nOwogICAgICAgICAgICB3aGlsZSAocGFwYS50eXBlICE9ICJzdmciICYmIChwYXBhID0gcGFwYS5wYXJlbnQoKSkpIHsKICAgICAgICAgICAgICAgIG1zLnB1c2goZXh0cmFjdFRyYW5zZm9ybShwYXBhKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaSA9IG1zLmxlbmd0aDsKICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgbS5hZGQobXNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBzdHJpbmc6IHN0cmluZywKICAgICAgICAgICAgICAgIGdsb2JhbE1hdHJpeDogZ2xvYmFsLAogICAgICAgICAgICAgICAgdG90YWxNYXRyaXg6IG0sCiAgICAgICAgICAgICAgICBsb2NhbE1hdHJpeDogbG9jYWwsCiAgICAgICAgICAgICAgICBkaWZmTWF0cml4OiBnbG9iYWwuY2xvbmUoKS5hZGQobG9jYWwuaW52ZXJ0KCkpLAogICAgICAgICAgICAgICAgZ2xvYmFsOiBnbG9iYWwudG9UcmFuc2Zvcm1TdHJpbmcoKSwKICAgICAgICAgICAgICAgIHRvdGFsOiBtLnRvVHJhbnNmb3JtU3RyaW5nKCksCiAgICAgICAgICAgICAgICBsb2NhbDogbG9jYWxTdHJpbmcsCiAgICAgICAgICAgICAgICB0b1N0cmluZzogcHJvcFN0cmluZwogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBpZiAodHN0ciBpbnN0YW5jZW9mIFNuYXAuTWF0cml4KSB7CiAgICAgICAgICAgIHRoaXMubWF0cml4ID0gdHN0cjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBleHRyYWN0VHJhbnNmb3JtKHRoaXMsIHRzdHIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMubm9kZSkgewogICAgICAgICAgICBpZiAodGhpcy50eXBlID09ICJsaW5lYXJHcmFkaWVudCIgfHwgdGhpcy50eXBlID09ICJyYWRpYWxHcmFkaWVudCIpIHsKICAgICAgICAgICAgICAgICQodGhpcy5ub2RlLCB7Z3JhZGllbnRUcmFuc2Zvcm06IHRoaXMubWF0cml4fSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy50eXBlID09ICJwYXR0ZXJuIikgewogICAgICAgICAgICAgICAgJCh0aGlzLm5vZGUsIHtwYXR0ZXJuVHJhbnNmb3JtOiB0aGlzLm1hdHJpeH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJCh0aGlzLm5vZGUsIHt0cmFuc2Zvcm06IHRoaXMubWF0cml4fSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIC8qXAogICAgICogRWxlbWVudC5wYXJlbnQKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJldHVybnMgdGhlIGVsZW1lbnQncyBwYXJlbnQKICAgICAqKgogICAgID0gKEVsZW1lbnQpIHRoZSBwYXJlbnQgZWxlbWVudAogICAgXCovCiAgICBlbHByb3RvLnBhcmVudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gd3JhcCh0aGlzLm5vZGUucGFyZW50Tm9kZSk7CiAgICB9OwogICAgLypcCiAgICAgKiBFbGVtZW50LmFwcGVuZAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogQXBwZW5kcyB0aGUgZ2l2ZW4gZWxlbWVudCB0byBjdXJyZW50IG9uZQogICAgICoqCiAgICAgLSBlbCAoRWxlbWVudHxTZXQpIGVsZW1lbnQgdG8gYXBwZW5kCiAgICAgPSAoRWxlbWVudCkgdGhlIHBhcmVudCBlbGVtZW50CiAgICBcKi8KICAgIC8qXAogICAgICogRWxlbWVudC5hZGQKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFNlZSBARWxlbWVudC5hcHBlbmQKICAgIFwqLwogICAgZWxwcm90by5hcHBlbmQgPSBlbHByb3RvLmFkZCA9IGZ1bmN0aW9uIChlbCkgewogICAgICAgIGlmIChlbCkgewogICAgICAgICAgICBpZiAoZWwudHlwZSA9PSAic2V0IikgewogICAgICAgICAgICAgICAgdmFyIGl0ID0gdGhpczsKICAgICAgICAgICAgICAgIGVsLmZvckVhY2goZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICAgICAgICAgICAgaXQuYWRkKGVsKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWwgPSB3cmFwKGVsKTsKICAgICAgICAgICAgdGhpcy5ub2RlLmFwcGVuZENoaWxkKGVsLm5vZGUpOwogICAgICAgICAgICBlbC5wYXBlciA9IHRoaXMucGFwZXI7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIC8qXAogICAgICogRWxlbWVudC5hcHBlbmRUbwogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogQXBwZW5kcyB0aGUgY3VycmVudCBlbGVtZW50IHRvIHRoZSBnaXZlbiBvbmUKICAgICAqKgogICAgIC0gZWwgKEVsZW1lbnQpIHBhcmVudCBlbGVtZW50IHRvIGFwcGVuZCB0bwogICAgID0gKEVsZW1lbnQpIHRoZSBjaGlsZCBlbGVtZW50CiAgICBcKi8KICAgIGVscHJvdG8uYXBwZW5kVG8gPSBmdW5jdGlvbiAoZWwpIHsKICAgICAgICBpZiAoZWwpIHsKICAgICAgICAgICAgZWwgPSB3cmFwKGVsKTsKICAgICAgICAgICAgZWwuYXBwZW5kKHRoaXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICAvKlwKICAgICAqIEVsZW1lbnQucHJlcGVuZAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogUHJlcGVuZHMgdGhlIGdpdmVuIGVsZW1lbnQgdG8gdGhlIGN1cnJlbnQgb25lCiAgICAgKioKICAgICAtIGVsIChFbGVtZW50KSBlbGVtZW50IHRvIHByZXBlbmQKICAgICA9IChFbGVtZW50KSB0aGUgcGFyZW50IGVsZW1lbnQKICAgIFwqLwogICAgZWxwcm90by5wcmVwZW5kID0gZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgaWYgKGVsKSB7CiAgICAgICAgICAgIGlmIChlbC50eXBlID09ICJzZXQiKSB7CiAgICAgICAgICAgICAgICB2YXIgaXQgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgIGZpcnN0OwogICAgICAgICAgICAgICAgZWwuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3QuYWZ0ZXIoZWwpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0LnByZXBlbmQoZWwpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmaXJzdCA9IGVsOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbCA9IHdyYXAoZWwpOwogICAgICAgICAgICB2YXIgcGFyZW50ID0gZWwucGFyZW50KCk7CiAgICAgICAgICAgIHRoaXMubm9kZS5pbnNlcnRCZWZvcmUoZWwubm9kZSwgdGhpcy5ub2RlLmZpcnN0Q2hpbGQpOwogICAgICAgICAgICB0aGlzLmFkZCAmJiB0aGlzLmFkZCgpOwogICAgICAgICAgICBlbC5wYXBlciA9IHRoaXMucGFwZXI7CiAgICAgICAgICAgIHRoaXMucGFyZW50KCkgJiYgdGhpcy5wYXJlbnQoKS5hZGQoKTsKICAgICAgICAgICAgcGFyZW50ICYmIHBhcmVudC5hZGQoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgLypcCiAgICAgKiBFbGVtZW50LnByZXBlbmRUbwogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogUHJlcGVuZHMgdGhlIGN1cnJlbnQgZWxlbWVudCB0byB0aGUgZ2l2ZW4gb25lCiAgICAgKioKICAgICAtIGVsIChFbGVtZW50KSBwYXJlbnQgZWxlbWVudCB0byBwcmVwZW5kIHRvCiAgICAgPSAoRWxlbWVudCkgdGhlIGNoaWxkIGVsZW1lbnQKICAgIFwqLwogICAgZWxwcm90by5wcmVwZW5kVG8gPSBmdW5jdGlvbiAoZWwpIHsKICAgICAgICBlbCA9IHdyYXAoZWwpOwogICAgICAgIGVsLnByZXBlbmQodGhpcyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgLypcCiAgICAgKiBFbGVtZW50LmJlZm9yZQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogSW5zZXJ0cyBnaXZlbiBlbGVtZW50IGJlZm9yZSB0aGUgY3VycmVudCBvbmUKICAgICAqKgogICAgIC0gZWwgKEVsZW1lbnQpIGVsZW1lbnQgdG8gaW5zZXJ0CiAgICAgPSAoRWxlbWVudCkgdGhlIHBhcmVudCBlbGVtZW50CiAgICBcKi8KICAgIGVscHJvdG8uYmVmb3JlID0gZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgaWYgKGVsLnR5cGUgPT0gInNldCIpIHsKICAgICAgICAgICAgdmFyIGl0ID0gdGhpczsKICAgICAgICAgICAgZWwuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQoKTsKICAgICAgICAgICAgICAgIGl0Lm5vZGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZWwubm9kZSwgaXQubm9kZSk7CiAgICAgICAgICAgICAgICBwYXJlbnQgJiYgcGFyZW50LmFkZCgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5wYXJlbnQoKS5hZGQoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIGVsID0gd3JhcChlbCk7CiAgICAgICAgdmFyIHBhcmVudCA9IGVsLnBhcmVudCgpOwogICAgICAgIHRoaXMubm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlbC5ub2RlLCB0aGlzLm5vZGUpOwogICAgICAgIHRoaXMucGFyZW50KCkgJiYgdGhpcy5wYXJlbnQoKS5hZGQoKTsKICAgICAgICBwYXJlbnQgJiYgcGFyZW50LmFkZCgpOwogICAgICAgIGVsLnBhcGVyID0gdGhpcy5wYXBlcjsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICAvKlwKICAgICAqIEVsZW1lbnQuYWZ0ZXIKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIEluc2VydHMgZ2l2ZW4gZWxlbWVudCBhZnRlciB0aGUgY3VycmVudCBvbmUKICAgICAqKgogICAgIC0gZWwgKEVsZW1lbnQpIGVsZW1lbnQgdG8gaW5zZXJ0CiAgICAgPSAoRWxlbWVudCkgdGhlIHBhcmVudCBlbGVtZW50CiAgICBcKi8KICAgIGVscHJvdG8uYWZ0ZXIgPSBmdW5jdGlvbiAoZWwpIHsKICAgICAgICBlbCA9IHdyYXAoZWwpOwogICAgICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQoKTsKICAgICAgICBpZiAodGhpcy5ub2RlLm5leHRTaWJsaW5nKSB7CiAgICAgICAgICAgIHRoaXMubm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlbC5ub2RlLCB0aGlzLm5vZGUubmV4dFNpYmxpbmcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMubm9kZS5wYXJlbnROb2RlLmFwcGVuZENoaWxkKGVsLm5vZGUpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBhcmVudCgpICYmIHRoaXMucGFyZW50KCkuYWRkKCk7CiAgICAgICAgcGFyZW50ICYmIHBhcmVudC5hZGQoKTsKICAgICAgICBlbC5wYXBlciA9IHRoaXMucGFwZXI7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgLypcCiAgICAgKiBFbGVtZW50Lmluc2VydEJlZm9yZQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogSW5zZXJ0cyB0aGUgZWxlbWVudCBhZnRlciB0aGUgZ2l2ZW4gb25lCiAgICAgKioKICAgICAtIGVsIChFbGVtZW50KSBlbGVtZW50IG5leHQgdG8gd2hvbSBpbnNlcnQgdG8KICAgICA9IChFbGVtZW50KSB0aGUgcGFyZW50IGVsZW1lbnQKICAgIFwqLwogICAgZWxwcm90by5pbnNlcnRCZWZvcmUgPSBmdW5jdGlvbiAoZWwpIHsKICAgICAgICBlbCA9IHdyYXAoZWwpOwogICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLnBhcmVudCgpOwogICAgICAgIGVsLm5vZGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5ub2RlLCBlbC5ub2RlKTsKICAgICAgICB0aGlzLnBhcGVyID0gZWwucGFwZXI7CiAgICAgICAgcGFyZW50ICYmIHBhcmVudC5hZGQoKTsKICAgICAgICBlbC5wYXJlbnQoKSAmJiBlbC5wYXJlbnQoKS5hZGQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICAvKlwKICAgICAqIEVsZW1lbnQuaW5zZXJ0QWZ0ZXIKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIEluc2VydHMgdGhlIGVsZW1lbnQgYWZ0ZXIgdGhlIGdpdmVuIG9uZQogICAgICoqCiAgICAgLSBlbCAoRWxlbWVudCkgZWxlbWVudCBuZXh0IHRvIHdob20gaW5zZXJ0IHRvCiAgICAgPSAoRWxlbWVudCkgdGhlIHBhcmVudCBlbGVtZW50CiAgICBcKi8KICAgIGVscHJvdG8uaW5zZXJ0QWZ0ZXIgPSBmdW5jdGlvbiAoZWwpIHsKICAgICAgICBlbCA9IHdyYXAoZWwpOwogICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLnBhcmVudCgpOwogICAgICAgIGVsLm5vZGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5ub2RlLCBlbC5ub2RlLm5leHRTaWJsaW5nKTsKICAgICAgICB0aGlzLnBhcGVyID0gZWwucGFwZXI7CiAgICAgICAgcGFyZW50ICYmIHBhcmVudC5hZGQoKTsKICAgICAgICBlbC5wYXJlbnQoKSAmJiBlbC5wYXJlbnQoKS5hZGQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICAvKlwKICAgICAqIEVsZW1lbnQucmVtb3ZlCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBSZW1vdmVzIGVsZW1lbnQgZnJvbSB0aGUgRE9NCiAgICAgPSAoRWxlbWVudCkgdGhlIGRldGFjaGVkIGVsZW1lbnQKICAgIFwqLwogICAgZWxwcm90by5yZW1vdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMucGFyZW50KCk7CiAgICAgICAgdGhpcy5ub2RlLnBhcmVudE5vZGUgJiYgdGhpcy5ub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5ub2RlKTsKICAgICAgICBkZWxldGUgdGhpcy5wYXBlcjsKICAgICAgICB0aGlzLnJlbW92ZWQgPSB0cnVlOwogICAgICAgIHBhcmVudCAmJiBwYXJlbnQuYWRkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgLypcCiAgICAgKiBFbGVtZW50LnNlbGVjdAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogR2F0aGVycyB0aGUgbmVzdGVkIEBFbGVtZW50IG1hdGNoaW5nIHRoZSBnaXZlbiBzZXQgb2YgQ1NTIHNlbGVjdG9ycwogICAgICoqCiAgICAgLSBxdWVyeSAoc3RyaW5nKSBDU1Mgc2VsZWN0b3IKICAgICA9IChFbGVtZW50KSByZXN1bHQgb2YgcXVlcnkgc2VsZWN0aW9uCiAgICBcKi8KICAgIGVscHJvdG8uc2VsZWN0ID0gZnVuY3Rpb24gKHF1ZXJ5KSB7CiAgICAgICAgcmV0dXJuIHdyYXAodGhpcy5ub2RlLnF1ZXJ5U2VsZWN0b3IocXVlcnkpKTsKICAgIH07CiAgICAvKlwKICAgICAqIEVsZW1lbnQuc2VsZWN0QWxsCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBHYXRoZXJzIG5lc3RlZCBARWxlbWVudCBvYmplY3RzIG1hdGNoaW5nIHRoZSBnaXZlbiBzZXQgb2YgQ1NTIHNlbGVjdG9ycwogICAgICoqCiAgICAgLSBxdWVyeSAoc3RyaW5nKSBDU1Mgc2VsZWN0b3IKICAgICA9IChTZXR8YXJyYXkpIHJlc3VsdCBvZiBxdWVyeSBzZWxlY3Rpb24KICAgIFwqLwogICAgZWxwcm90by5zZWxlY3RBbGwgPSBmdW5jdGlvbiAocXVlcnkpIHsKICAgICAgICB2YXIgbm9kZWxpc3QgPSB0aGlzLm5vZGUucXVlcnlTZWxlY3RvckFsbChxdWVyeSksCiAgICAgICAgICAgIHNldCA9IChTbmFwLnNldCB8fCBBcnJheSkoKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVsaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHNldC5wdXNoKHdyYXAobm9kZWxpc3RbaV0pKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNldDsKICAgIH07CiAgICAvKlwKICAgICAqIEVsZW1lbnQuYXNQWAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogUmV0dXJucyBnaXZlbiBhdHRyaWJ1dGUgb2YgdGhlIGVsZW1lbnQgYXMgYSBgcHhgIHZhbHVlIChub3QgJSwgZW0sIGV0Yy4pCiAgICAgKioKICAgICAtIGF0dHIgKHN0cmluZykgYXR0cmlidXRlIG5hbWUKICAgICAtIHZhbHVlIChzdHJpbmcpICNvcHRpb25hbCBhdHRyaWJ1dGUgdmFsdWUKICAgICA9IChFbGVtZW50KSByZXN1bHQgb2YgcXVlcnkgc2VsZWN0aW9uCiAgICBcKi8KICAgIGVscHJvdG8uYXNQWCA9IGZ1bmN0aW9uIChhdHRyLCB2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgIHZhbHVlID0gdGhpcy5hdHRyKGF0dHIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gK3VuaXQycHgodGhpcywgYXR0ciwgdmFsdWUpOwogICAgfTsKICAgIC8vIFNJRVJSQSBFbGVtZW50LnVzZSgpOiBJIHN1Z2dlc3QgYWRkaW5nIGEgbm90ZSBhYm91dCBob3cgdG8gYWNjZXNzIHRoZSBvcmlnaW5hbCBlbGVtZW50IHRoZSByZXR1cm5lZCA8dXNlPiBpbnN0YW50aWF0ZXMuIEl0J3MgYSBwYXJ0IG9mIFNWRyB3aXRoIHdoaWNoIG9yZGluYXJ5IHdlYiBkZXZlbG9wZXJzIG1heSBiZSBsZWFzdCBmYW1pbGlhci4KICAgIC8qXAogICAgICogRWxlbWVudC51c2UKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIENyZWF0ZXMgYSBgPHVzZT5gIGVsZW1lbnQgbGlua2VkIHRvIHRoZSBjdXJyZW50IGVsZW1lbnQKICAgICAqKgogICAgID0gKEVsZW1lbnQpIHRoZSBgPHVzZT5gIGVsZW1lbnQKICAgIFwqLwogICAgZWxwcm90by51c2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHVzZSwKICAgICAgICAgICAgaWQgPSB0aGlzLm5vZGUuaWQ7CiAgICAgICAgaWYgKCFpZCkgewogICAgICAgICAgICBpZCA9IHRoaXMuaWQ7CiAgICAgICAgICAgICQodGhpcy5ub2RlLCB7CiAgICAgICAgICAgICAgICBpZDogaWQKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnR5cGUgPT0gImxpbmVhckdyYWRpZW50IiB8fCB0aGlzLnR5cGUgPT0gInJhZGlhbEdyYWRpZW50IiB8fAogICAgICAgICAgICB0aGlzLnR5cGUgPT0gInBhdHRlcm4iKSB7CiAgICAgICAgICAgIHVzZSA9IG1ha2UodGhpcy50eXBlLCB0aGlzLm5vZGUucGFyZW50Tm9kZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdXNlID0gbWFrZSgidXNlIiwgdGhpcy5ub2RlLnBhcmVudE5vZGUpOwogICAgICAgIH0KICAgICAgICAkKHVzZS5ub2RlLCB7CiAgICAgICAgICAgICJ4bGluazpocmVmIjogIiMiICsgaWQKICAgICAgICB9KTsKICAgICAgICB1c2Uub3JpZ2luYWwgPSB0aGlzOwogICAgICAgIHJldHVybiB1c2U7CiAgICB9OwogICAgLypcCiAgICAgKiBFbGVtZW50LmNsb25lCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgdGhlIGVsZW1lbnQgYW5kIGluc2VydHMgaXQgYWZ0ZXIgdGhlIGVsZW1lbnQKICAgICAqKgogICAgID0gKEVsZW1lbnQpIHRoZSBjbG9uZQogICAgXCovCiAgICBmdW5jdGlvbiBmaXhpZHMoZWwpIHsKICAgICAgICB2YXIgZWxzID0gZWwuc2VsZWN0QWxsKCIqIiksCiAgICAgICAgICAgIGl0LAogICAgICAgICAgICB1cmwgPSAvXlxzKnVybFwoKCJ8J3wpKC4qKVwxXClccyokLywKICAgICAgICAgICAgaWRzID0gW10sCiAgICAgICAgICAgIHVzZXMgPSB7fTsKICAgICAgICBmdW5jdGlvbiB1cmx0ZXN0KGl0LCBuYW1lKSB7CiAgICAgICAgICAgIHZhciB2YWwgPSAkKGl0Lm5vZGUsIG5hbWUpOwogICAgICAgICAgICB2YWwgPSB2YWwgJiYgdmFsLm1hdGNoKHVybCk7CiAgICAgICAgICAgIHZhbCA9IHZhbCAmJiB2YWxbMl07CiAgICAgICAgICAgIGlmICh2YWwgJiYgdmFsLmNoYXJBdCgpID09ICIjIikgewogICAgICAgICAgICAgICAgdmFsID0gdmFsLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodmFsKSB7CiAgICAgICAgICAgICAgICB1c2VzW3ZhbF0gPSAodXNlc1t2YWxdIHx8IFtdKS5jb25jYXQoZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHIgPSB7fTsKICAgICAgICAgICAgICAgICAgICBhdHRyW25hbWVdID0gVVJMKGlkKTsKICAgICAgICAgICAgICAgICAgICAkKGl0Lm5vZGUsIGF0dHIpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbGlua3Rlc3QoaXQpIHsKICAgICAgICAgICAgdmFyIHZhbCA9ICQoaXQubm9kZSwgInhsaW5rOmhyZWYiKTsKICAgICAgICAgICAgaWYgKHZhbCAmJiB2YWwuY2hhckF0KCkgPT0gIiMiKSB7CiAgICAgICAgICAgICAgICB2YWwgPSB2YWwuc3Vic3RyaW5nKDEpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh2YWwpIHsKICAgICAgICAgICAgICAgIHVzZXNbdmFsXSA9ICh1c2VzW3ZhbF0gfHwgW10pLmNvbmNhdChmdW5jdGlvbiAoaWQpIHsKICAgICAgICAgICAgICAgICAgICBpdC5hdHRyKCJ4bGluazpocmVmIiwgIiMiICsgaWQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gZWxzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgaXQgPSBlbHNbaV07CiAgICAgICAgICAgIHVybHRlc3QoaXQsICJmaWxsIik7CiAgICAgICAgICAgIHVybHRlc3QoaXQsICJzdHJva2UiKTsKICAgICAgICAgICAgdXJsdGVzdChpdCwgImZpbHRlciIpOwogICAgICAgICAgICB1cmx0ZXN0KGl0LCAibWFzayIpOwogICAgICAgICAgICB1cmx0ZXN0KGl0LCAiY2xpcC1wYXRoIik7CiAgICAgICAgICAgIGxpbmt0ZXN0KGl0KTsKICAgICAgICAgICAgdmFyIG9sZGlkID0gJChpdC5ub2RlLCAiaWQiKTsKICAgICAgICAgICAgaWYgKG9sZGlkKSB7CiAgICAgICAgICAgICAgICAkKGl0Lm5vZGUsIHtpZDogaXQuaWR9KTsKICAgICAgICAgICAgICAgIGlkcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBvbGQ6IG9sZGlkLAogICAgICAgICAgICAgICAgICAgIGlkOiBpdC5pZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBpZHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICB2YXIgZnMgPSB1c2VzW2lkc1tpXS5vbGRdOwogICAgICAgICAgICBpZiAoZnMpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IGZzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICBmc1tqXShpZHNbaV0uaWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgdmFyIHJnTm90U3BhY2UgPSAvXFMrL2csCiAgICAgICAgcmdCYWRTcGFjZSA9IC9bXHRcclxuXGZdL2csCiAgICAgICAgcmdUcmltID0gLyheXHMrfFxzKyQpL2c7CiAgICBlbHByb3RvLmFkZENsYXNzID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgdmFyIGNsYXNzZXMgPSAodmFsdWUgfHwgIiIpLm1hdGNoKHJnTm90U3BhY2UpIHx8IFtdLAogICAgICAgICAgICBlbGVtID0gdGhpcy5ub2RlLAogICAgICAgICAgICBjbGFzc05hbWUgPSBlbGVtLmNsYXNzTmFtZS5iYXNlVmFsLAogICAgICAgICAgICBjdXJDbGFzc2VzID0gY2xhc3NOYW1lLm1hdGNoKHJnTm90U3BhY2UpIHx8IFtdLAogICAgICAgICAgICBqLAogICAgICAgICAgICBwb3MsCiAgICAgICAgICAgIGNsYXp6LAogICAgICAgICAgICBmaW5hbFZhbHVlOwoKICAgICAgICBpZiAoY2xhc3Nlcy5sZW5ndGgpIHsKICAgICAgICAgICAgaiA9IDA7CiAgICAgICAgICAgIHdoaWxlICgoY2xhenogPSBjbGFzc2VzW2orK10pKSB7CiAgICAgICAgICAgICAgICBwb3MgPSBjdXJDbGFzc2VzLmluZGV4T2YoY2xhenopOwogICAgICAgICAgICAgICAgaWYgKCF+cG9zKSB7CiAgICAgICAgICAgICAgICAgICAgY3VyQ2xhc3Nlcy5wdXNoKGNsYXp6KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZmluYWxWYWx1ZSA9IGN1ckNsYXNzZXMuam9pbigiICIpOwogICAgICAgICAgICBpZiAoY2xhc3NOYW1lICE9IGZpbmFsVmFsdWUpIHsKICAgICAgICAgICAgICAgIGVsZW0uY2xhc3NOYW1lLmJhc2VWYWwgPSBmaW5hbFZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIGVscHJvdG8ucmVtb3ZlQ2xhc3MgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICB2YXIgY2xhc3NlcyA9ICh2YWx1ZSB8fCAiIikubWF0Y2gocmdOb3RTcGFjZSkgfHwgW10sCiAgICAgICAgICAgIGVsZW0gPSB0aGlzLm5vZGUsCiAgICAgICAgICAgIGNsYXNzTmFtZSA9IGVsZW0uY2xhc3NOYW1lLmJhc2VWYWwsCiAgICAgICAgICAgIGN1ckNsYXNzZXMgPSBjbGFzc05hbWUubWF0Y2gocmdOb3RTcGFjZSkgfHwgW10sCiAgICAgICAgICAgIGosCiAgICAgICAgICAgIHBvcywKICAgICAgICAgICAgY2xhenosCiAgICAgICAgICAgIGZpbmFsVmFsdWU7CiAgICAgICAgaWYgKGN1ckNsYXNzZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIGogPSAwOwogICAgICAgICAgICB3aGlsZSAoKGNsYXp6ID0gY2xhc3Nlc1tqKytdKSkgewogICAgICAgICAgICAgICAgcG9zID0gY3VyQ2xhc3Nlcy5pbmRleE9mKGNsYXp6KTsKICAgICAgICAgICAgICAgIGlmICh+cG9zKSB7CiAgICAgICAgICAgICAgICAgICAgY3VyQ2xhc3Nlcy5zcGxpY2UocG9zLCAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZmluYWxWYWx1ZSA9IGN1ckNsYXNzZXMuam9pbigiICIpOwogICAgICAgICAgICBpZiAoY2xhc3NOYW1lICE9IGZpbmFsVmFsdWUpIHsKICAgICAgICAgICAgICAgIGVsZW0uY2xhc3NOYW1lLmJhc2VWYWwgPSBmaW5hbFZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIGVscHJvdG8uaGFzQ2xhc3MgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICB2YXIgZWxlbSA9IHRoaXMubm9kZSwKICAgICAgICAgICAgY2xhc3NOYW1lID0gZWxlbS5jbGFzc05hbWUuYmFzZVZhbCwKICAgICAgICAgICAgY3VyQ2xhc3NlcyA9IGNsYXNzTmFtZS5tYXRjaChyZ05vdFNwYWNlKSB8fCBbXTsKICAgICAgICByZXR1cm4gISF+Y3VyQ2xhc3Nlcy5pbmRleE9mKHZhbHVlKTsKICAgIH07CiAgICBlbHByb3RvLnRvZ2dsZUNsYXNzID0gZnVuY3Rpb24gKHZhbHVlLCBmbGFnKSB7CiAgICAgICAgaWYgKGZsYWcgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoZmxhZykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkQ2xhc3ModmFsdWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlQ2xhc3ModmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBjbGFzc2VzID0gKHZhbHVlIHx8ICIiKS5tYXRjaChyZ05vdFNwYWNlKSB8fCBbXSwKICAgICAgICAgICAgZWxlbSA9IHRoaXMubm9kZSwKICAgICAgICAgICAgY2xhc3NOYW1lID0gZWxlbS5jbGFzc05hbWUuYmFzZVZhbCwKICAgICAgICAgICAgY3VyQ2xhc3NlcyA9IGNsYXNzTmFtZS5tYXRjaChyZ05vdFNwYWNlKSB8fCBbXSwKICAgICAgICAgICAgaiwKICAgICAgICAgICAgcG9zLAogICAgICAgICAgICBjbGF6eiwKICAgICAgICAgICAgZmluYWxWYWx1ZTsKICAgICAgICBqID0gMDsKICAgICAgICB3aGlsZSAoKGNsYXp6ID0gY2xhc3Nlc1tqKytdKSkgewogICAgICAgICAgICBwb3MgPSBjdXJDbGFzc2VzLmluZGV4T2YoY2xhenopOwogICAgICAgICAgICBpZiAofnBvcykgewogICAgICAgICAgICAgICAgY3VyQ2xhc3Nlcy5zcGxpY2UocG9zLCAxKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN1ckNsYXNzZXMucHVzaChjbGF6eik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpbmFsVmFsdWUgPSBjdXJDbGFzc2VzLmpvaW4oIiAiKTsKICAgICAgICBpZiAoY2xhc3NOYW1lICE9IGZpbmFsVmFsdWUpIHsKICAgICAgICAgICAgZWxlbS5jbGFzc05hbWUuYmFzZVZhbCA9IGZpbmFsVmFsdWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIGVscHJvdG8uY2xvbmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGNsb25lID0gd3JhcCh0aGlzLm5vZGUuY2xvbmVOb2RlKHRydWUpKTsKICAgICAgICBpZiAoJChjbG9uZS5ub2RlLCAiaWQiKSkgewogICAgICAgICAgICAkKGNsb25lLm5vZGUsIHtpZDogY2xvbmUuaWR9KTsKICAgICAgICB9CiAgICAgICAgZml4aWRzKGNsb25lKTsKICAgICAgICBjbG9uZS5pbnNlcnRBZnRlcih0aGlzKTsKICAgICAgICByZXR1cm4gY2xvbmU7CiAgICB9OwogICAgLypcCiAgICAgKiBFbGVtZW50LnRvRGVmcwogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogTW92ZXMgZWxlbWVudCB0byB0aGUgc2hhcmVkIGA8ZGVmcz5gIGFyZWEKICAgICAqKgogICAgID0gKEVsZW1lbnQpIHRoZSBlbGVtZW50CiAgICBcKi8KICAgIGVscHJvdG8udG9EZWZzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBkZWZzID0gZ2V0U29tZURlZnModGhpcyk7CiAgICAgICAgZGVmcy5hcHBlbmRDaGlsZCh0aGlzLm5vZGUpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIC8qXAogICAgICogRWxlbWVudC5wYXR0ZXJuCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBEZXByaWNhdGVkLiBVc2UgQEVsZW1lbnQudG9QYXR0ZXJuIGluc3RlYWQuCiAgICBcKi8KICAgIC8qXAogICAgICogRWxlbWVudC50b1BhdHRlcm4KICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIENyZWF0ZXMgYSBgPHBhdHRlcm4+YCBlbGVtZW50IGZyb20gdGhlIGN1cnJlbnQgZWxlbWVudAogICAgICoqCiAgICAgKiBUbyBjcmVhdGUgYSBwYXR0ZXJuIHlvdSBoYXZlIHRvIHNwZWNpZnkgdGhlIHBhdHRlcm4gcmVjdDoKICAgICAtIHggKHN0cmluZ3xudW1iZXIpCiAgICAgLSB5IChzdHJpbmd8bnVtYmVyKQogICAgIC0gd2lkdGggKHN0cmluZ3xudW1iZXIpCiAgICAgLSBoZWlnaHQgKHN0cmluZ3xudW1iZXIpCiAgICAgPSAoRWxlbWVudCkgdGhlIGA8cGF0dGVybj5gIGVsZW1lbnQKICAgICAqIFlvdSBjYW4gdXNlIHBhdHRlcm4gbGF0ZXIgb24gYXMgYW4gYXJndW1lbnQgZm9yIGBmaWxsYCBhdHRyaWJ1dGU6CiAgICAgfCB2YXIgcCA9IHBhcGVyLnBhdGgoIk0xMC01LTEwLDE1TTE1LDAsMCwxNU0wLTUtMjAsMTUiKS5hdHRyKHsKICAgICB8ICAgICAgICAgZmlsbDogIm5vbmUiLAogICAgIHwgICAgICAgICBzdHJva2U6ICIjYmFkYTU1IiwKICAgICB8ICAgICAgICAgc3Ryb2tlV2lkdGg6IDUKICAgICB8ICAgICB9KS5wYXR0ZXJuKDAsIDAsIDEwLCAxMCksCiAgICAgfCAgICAgYyA9IHBhcGVyLmNpcmNsZSgyMDAsIDIwMCwgMTAwKTsKICAgICB8IGMuYXR0cih7CiAgICAgfCAgICAgZmlsbDogcAogICAgIHwgfSk7CiAgICBcKi8KICAgIGVscHJvdG8ucGF0dGVybiA9IGVscHJvdG8udG9QYXR0ZXJuID0gZnVuY3Rpb24gKHgsIHksIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICB2YXIgcCA9IG1ha2UoInBhdHRlcm4iLCBnZXRTb21lRGVmcyh0aGlzKSk7CiAgICAgICAgaWYgKHggPT0gbnVsbCkgewogICAgICAgICAgICB4ID0gdGhpcy5nZXRCQm94KCk7CiAgICAgICAgfQogICAgICAgIGlmIChpcyh4LCAib2JqZWN0IikgJiYgIngiIGluIHgpIHsKICAgICAgICAgICAgeSA9IHgueTsKICAgICAgICAgICAgd2lkdGggPSB4LndpZHRoOwogICAgICAgICAgICBoZWlnaHQgPSB4LmhlaWdodDsKICAgICAgICAgICAgeCA9IHgueDsKICAgICAgICB9CiAgICAgICAgJChwLm5vZGUsIHsKICAgICAgICAgICAgeDogeCwKICAgICAgICAgICAgeTogeSwKICAgICAgICAgICAgd2lkdGg6IHdpZHRoLAogICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCwKICAgICAgICAgICAgcGF0dGVyblVuaXRzOiAidXNlclNwYWNlT25Vc2UiLAogICAgICAgICAgICBpZDogcC5pZCwKICAgICAgICAgICAgdmlld0JveDogW3gsIHksIHdpZHRoLCBoZWlnaHRdLmpvaW4oIiAiKQogICAgICAgIH0pOwogICAgICAgIHAubm9kZS5hcHBlbmRDaGlsZCh0aGlzLm5vZGUpOwogICAgICAgIHJldHVybiBwOwogICAgfTsKLy8gU0lFUlJBIEVsZW1lbnQubWFya2VyKCk6IGNsYXJpZnkgd2hhdCBhIHJlZmVyZW5jZSBwb2ludCBpcy4gRS5nLiwgaGVscHMgeW91IG9mZnNldCB0aGUgb2JqZWN0IGZyb20gaXRzIGVkZ2Ugc3VjaCBhcyB3aGVuIGNlbnRlcmluZyBpdCBvdmVyIGEgcGF0aC4KLy8gU0lFUlJBIEVsZW1lbnQubWFya2VyKCk6IEkgc3VnZ2VzdCB0aGUgbWV0aG9kIHNob3VsZCBhY2NlcHQgZGVmYXVsdCByZWZlcmVuY2UgcG9pbnQgdmFsdWVzLiAgUGVyaGFwcyBjZW50ZXJlZCB3aXRoIChyZWZYID0gd2lkdGgvMikgYW5kIChyZWZZID0gaGVpZ2h0LzIpPyBBbHNvLCBjb3VsZG4ndCBpdCBhc3N1bWUgdGhlIGVsZW1lbnQncyBjdXJyZW50IF93aWR0aF8gYW5kIF9oZWlnaHRfPyBBbmQgcGxlYXNlIHNwZWNpZnkgd2hhdCBfeF8gYW5kIF95XyBtZWFuOiBvZmZzZXRzPyBJZiBzbywgZnJvbSB3aGVyZT8gIENvdWxkbid0IHRoZXkgYWxzbyBiZSBhc3NpZ25lZCBkZWZhdWx0IHZhbHVlcz8KICAgIC8qXAogICAgICogRWxlbWVudC5tYXJrZXIKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIENyZWF0ZXMgYSBgPG1hcmtlcj5gIGVsZW1lbnQgZnJvbSB0aGUgY3VycmVudCBlbGVtZW50CiAgICAgKioKICAgICAqIFRvIGNyZWF0ZSBhIG1hcmtlciB5b3UgaGF2ZSB0byBzcGVjaWZ5IHRoZSBib3VuZGluZyByZWN0IGFuZCByZWZlcmVuY2UgcG9pbnQ6CiAgICAgLSB4IChudW1iZXIpCiAgICAgLSB5IChudW1iZXIpCiAgICAgLSB3aWR0aCAobnVtYmVyKQogICAgIC0gaGVpZ2h0IChudW1iZXIpCiAgICAgLSByZWZYIChudW1iZXIpCiAgICAgLSByZWZZIChudW1iZXIpCiAgICAgPSAoRWxlbWVudCkgdGhlIGA8bWFya2VyPmAgZWxlbWVudAogICAgICogWW91IGNhbiBzcGVjaWZ5IHRoZSBtYXJrZXIgbGF0ZXIgYXMgYW4gYXJndW1lbnQgZm9yIGBtYXJrZXItc3RhcnRgLCBgbWFya2VyLWVuZGAsIGBtYXJrZXItbWlkYCwgYW5kIGBtYXJrZXJgIGF0dHJpYnV0ZXMuIFRoZSBgbWFya2VyYCBhdHRyaWJ1dGUgcGxhY2VzIHRoZSBtYXJrZXIgYXQgZXZlcnkgcG9pbnQgYWxvbmcgdGhlIHBhdGgsIGFuZCBgbWFya2VyLW1pZGAgcGxhY2VzIHRoZW0gYXQgZXZlcnkgcG9pbnQgZXhjZXB0IHRoZSBzdGFydCBhbmQgZW5kLgogICAgXCovCiAgICAvLyBUT0RPIGFkZCB1c2FnZSBmb3IgbWFya2VycwogICAgZWxwcm90by5tYXJrZXIgPSBmdW5jdGlvbiAoeCwgeSwgd2lkdGgsIGhlaWdodCwgcmVmWCwgcmVmWSkgewogICAgICAgIHZhciBwID0gbWFrZSgibWFya2VyIiwgZ2V0U29tZURlZnModGhpcykpOwogICAgICAgIGlmICh4ID09IG51bGwpIHsKICAgICAgICAgICAgeCA9IHRoaXMuZ2V0QkJveCgpOwogICAgICAgIH0KICAgICAgICBpZiAoaXMoeCwgIm9iamVjdCIpICYmICJ4IiBpbiB4KSB7CiAgICAgICAgICAgIHkgPSB4Lnk7CiAgICAgICAgICAgIHdpZHRoID0geC53aWR0aDsKICAgICAgICAgICAgaGVpZ2h0ID0geC5oZWlnaHQ7CiAgICAgICAgICAgIHJlZlggPSB4LnJlZlggfHwgeC5jeDsKICAgICAgICAgICAgcmVmWSA9IHgucmVmWSB8fCB4LmN5OwogICAgICAgICAgICB4ID0geC54OwogICAgICAgIH0KICAgICAgICAkKHAubm9kZSwgewogICAgICAgICAgICB2aWV3Qm94OiBbeCwgeSwgd2lkdGgsIGhlaWdodF0uam9pbihTKSwKICAgICAgICAgICAgbWFya2VyV2lkdGg6IHdpZHRoLAogICAgICAgICAgICBtYXJrZXJIZWlnaHQ6IGhlaWdodCwKICAgICAgICAgICAgb3JpZW50OiAiYXV0byIsCiAgICAgICAgICAgIHJlZlg6IHJlZlggfHwgMCwKICAgICAgICAgICAgcmVmWTogcmVmWSB8fCAwLAogICAgICAgICAgICBpZDogcC5pZAogICAgICAgIH0pOwogICAgICAgIHAubm9kZS5hcHBlbmRDaGlsZCh0aGlzLm5vZGUpOwogICAgICAgIHJldHVybiBwOwogICAgfTsKICAgIC8vIGFuaW1hdGlvbgogICAgZnVuY3Rpb24gc2xpY2UoZnJvbSwgdG8sIGYpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGFycikgewogICAgICAgICAgICB2YXIgcmVzID0gYXJyLnNsaWNlKGZyb20sIHRvKTsKICAgICAgICAgICAgaWYgKHJlcy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICAgICAgcmVzID0gcmVzWzBdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmID8gZihyZXMpIDogcmVzOwogICAgICAgIH07CiAgICB9CiAgICB2YXIgQW5pbWF0aW9uID0gZnVuY3Rpb24gKGF0dHIsIG1zLCBlYXNpbmcsIGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKHR5cGVvZiBlYXNpbmcgPT0gImZ1bmN0aW9uIiAmJiAhZWFzaW5nLmxlbmd0aCkgewogICAgICAgICAgICBjYWxsYmFjayA9IGVhc2luZzsKICAgICAgICAgICAgZWFzaW5nID0gbWluYS5saW5lYXI7CiAgICAgICAgfQogICAgICAgIHRoaXMuYXR0ciA9IGF0dHI7CiAgICAgICAgdGhpcy5kdXIgPSBtczsKICAgICAgICBlYXNpbmcgJiYgKHRoaXMuZWFzaW5nID0gZWFzaW5nKTsKICAgICAgICBjYWxsYmFjayAmJiAodGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrKTsKICAgIH07CiAgICBTbmFwLl8uQW5pbWF0aW9uID0gQW5pbWF0aW9uOwogICAgLypcCiAgICAgKiBTbmFwLmFuaW1hdGlvbgogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogQ3JlYXRlcyBhbiBhbmltYXRpb24gb2JqZWN0CiAgICAgKioKICAgICAtIGF0dHIgKG9iamVjdCkgYXR0cmlidXRlcyBvZiBmaW5hbCBkZXN0aW5hdGlvbgogICAgIC0gZHVyYXRpb24gKG51bWJlcikgZHVyYXRpb24gb2YgdGhlIGFuaW1hdGlvbiwgaW4gbWlsbGlzZWNvbmRzCiAgICAgLSBlYXNpbmcgKGZ1bmN0aW9uKSAjb3B0aW9uYWwgb25lIG9mIGVhc2luZyBmdW5jdGlvbnMgb2YgQG1pbmEgb3IgY3VzdG9tIG9uZQogICAgIC0gY2FsbGJhY2sgKGZ1bmN0aW9uKSAjb3B0aW9uYWwgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBmaXJlcyB3aGVuIGFuaW1hdGlvbiBlbmRzCiAgICAgPSAob2JqZWN0KSBhbmltYXRpb24gb2JqZWN0CiAgICBcKi8KICAgIFNuYXAuYW5pbWF0aW9uID0gZnVuY3Rpb24gKGF0dHIsIG1zLCBlYXNpbmcsIGNhbGxiYWNrKSB7CiAgICAgICAgcmV0dXJuIG5ldyBBbmltYXRpb24oYXR0ciwgbXMsIGVhc2luZywgY2FsbGJhY2spOwogICAgfTsKICAgIC8qXAogICAgICogRWxlbWVudC5pbkFuaW0KICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJldHVybnMgYSBzZXQgb2YgYW5pbWF0aW9ucyB0aGF0IG1heSBiZSBhYmxlIHRvIG1hbmlwdWxhdGUgdGhlIGN1cnJlbnQgZWxlbWVudAogICAgICoqCiAgICAgPSAob2JqZWN0KSBpbiBmb3JtYXQ6CiAgICAgbyB7CiAgICAgbyAgICAgYW5pbSAob2JqZWN0KSBhbmltYXRpb24gb2JqZWN0LAogICAgIG8gICAgIG1pbmEgKG9iamVjdCkgQG1pbmEgb2JqZWN0LAogICAgIG8gICAgIGN1clN0YXR1cyAobnVtYmVyKSAwLi4xIOKAlCBzdGF0dXMgb2YgdGhlIGFuaW1hdGlvbjogMCDigJQganVzdCBzdGFydGVkLCAxIOKAlCBqdXN0IGZpbmlzaGVkLAogICAgIG8gICAgIHN0YXR1cyAoZnVuY3Rpb24pIGdldHMgb3Igc2V0cyB0aGUgc3RhdHVzIG9mIHRoZSBhbmltYXRpb24sCiAgICAgbyAgICAgc3RvcCAoZnVuY3Rpb24pIHN0b3BzIHRoZSBhbmltYXRpb24KICAgICBvIH0KICAgIFwqLwogICAgZWxwcm90by5pbkFuaW0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGVsID0gdGhpcywKICAgICAgICAgICAgcmVzID0gW107CiAgICAgICAgZm9yICh2YXIgaWQgaW4gZWwuYW5pbXMpIGlmIChlbC5hbmltc1toYXNdKGlkKSkgewogICAgICAgICAgICAoZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgIHJlcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBhbmltOiBuZXcgQW5pbWF0aW9uKGEuX2F0dHJzLCBhLmR1ciwgYS5lYXNpbmcsIGEuX2NhbGxiYWNrKSwKICAgICAgICAgICAgICAgICAgICBtaW5hOiBhLAogICAgICAgICAgICAgICAgICAgIGN1clN0YXR1czogYS5zdGF0dXMoKSwKICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuc3RhdHVzKHZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzdG9wOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGEuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KGVsLmFuaW1zW2lkXSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzOwogICAgfTsKICAgIC8qXAogICAgICogU25hcC5hbmltYXRlCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBSdW5zIGdlbmVyaWMgYW5pbWF0aW9uIG9mIG9uZSBudW1iZXIgaW50byBhbm90aGVyIHdpdGggYSBjYXJpbmcgZnVuY3Rpb24KICAgICAqKgogICAgIC0gZnJvbSAobnVtYmVyfGFycmF5KSBudW1iZXIgb3IgYXJyYXkgb2YgbnVtYmVycwogICAgIC0gdG8gKG51bWJlcnxhcnJheSkgbnVtYmVyIG9yIGFycmF5IG9mIG51bWJlcnMKICAgICAtIHNldHRlciAoZnVuY3Rpb24pIGNhcmluZyBmdW5jdGlvbiB0aGF0IGFjY2VwdHMgb25lIG51bWJlciBhcmd1bWVudAogICAgIC0gZHVyYXRpb24gKG51bWJlcikgZHVyYXRpb24sIGluIG1pbGxpc2Vjb25kcwogICAgIC0gZWFzaW5nIChmdW5jdGlvbikgI29wdGlvbmFsIGVhc2luZyBmdW5jdGlvbiBmcm9tIEBtaW5hIG9yIGN1c3RvbQogICAgIC0gY2FsbGJhY2sgKGZ1bmN0aW9uKSAjb3B0aW9uYWwgY2FsbGJhY2sgZnVuY3Rpb24gdG8gZXhlY3V0ZSB3aGVuIGFuaW1hdGlvbiBlbmRzCiAgICAgPSAob2JqZWN0KSBhbmltYXRpb24gb2JqZWN0IGluIEBtaW5hIGZvcm1hdAogICAgIG8gewogICAgIG8gICAgIGlkIChzdHJpbmcpIGFuaW1hdGlvbiBpZCwgY29uc2lkZXIgaXQgcmVhZC1vbmx5LAogICAgIG8gICAgIGR1cmF0aW9uIChmdW5jdGlvbikgZ2V0cyBvciBzZXRzIHRoZSBkdXJhdGlvbiBvZiB0aGUgYW5pbWF0aW9uLAogICAgIG8gICAgIGVhc2luZyAoZnVuY3Rpb24pIGVhc2luZywKICAgICBvICAgICBzcGVlZCAoZnVuY3Rpb24pIGdldHMgb3Igc2V0cyB0aGUgc3BlZWQgb2YgdGhlIGFuaW1hdGlvbiwKICAgICBvICAgICBzdGF0dXMgKGZ1bmN0aW9uKSBnZXRzIG9yIHNldHMgdGhlIHN0YXR1cyBvZiB0aGUgYW5pbWF0aW9uLAogICAgIG8gICAgIHN0b3AgKGZ1bmN0aW9uKSBzdG9wcyB0aGUgYW5pbWF0aW9uCiAgICAgbyB9CiAgICAgfCB2YXIgcmVjdCA9IFNuYXAoKS5yZWN0KDAsIDAsIDEwLCAxMCk7CiAgICAgfCBTbmFwLmFuaW1hdGUoMCwgMTAsIGZ1bmN0aW9uICh2YWwpIHsKICAgICB8ICAgICByZWN0LmF0dHIoewogICAgIHwgICAgICAgICB4OiB2YWwKICAgICB8ICAgICB9KTsKICAgICB8IH0sIDEwMDApOwogICAgIHwgLy8gaW4gZ2l2ZW4gY29udGV4dCBpcyBlcXVpdmFsZW50IHRvCiAgICAgfCByZWN0LmFuaW1hdGUoe3g6IDEwfSwgMTAwMCk7CiAgICBcKi8KICAgIFNuYXAuYW5pbWF0ZSA9IGZ1bmN0aW9uIChmcm9tLCB0bywgc2V0dGVyLCBtcywgZWFzaW5nLCBjYWxsYmFjaykgewogICAgICAgIGlmICh0eXBlb2YgZWFzaW5nID09ICJmdW5jdGlvbiIgJiYgIWVhc2luZy5sZW5ndGgpIHsKICAgICAgICAgICAgY2FsbGJhY2sgPSBlYXNpbmc7CiAgICAgICAgICAgIGVhc2luZyA9IG1pbmEubGluZWFyOwogICAgICAgIH0KICAgICAgICB2YXIgbm93ID0gbWluYS50aW1lKCksCiAgICAgICAgICAgIGFuaW0gPSBtaW5hKGZyb20sIHRvLCBub3csIG5vdyArIG1zLCBtaW5hLnRpbWUsIHNldHRlciwgZWFzaW5nKTsKICAgICAgICBjYWxsYmFjayAmJiBldmUub25jZSgibWluYS5maW5pc2guIiArIGFuaW0uaWQsIGNhbGxiYWNrKTsKICAgICAgICByZXR1cm4gYW5pbTsKICAgIH07CiAgICAvKlwKICAgICAqIEVsZW1lbnQuc3RvcAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogU3RvcHMgYWxsIHRoZSBhbmltYXRpb25zIGZvciB0aGUgY3VycmVudCBlbGVtZW50CiAgICAgKioKICAgICA9IChFbGVtZW50KSB0aGUgY3VycmVudCBlbGVtZW50CiAgICBcKi8KICAgIGVscHJvdG8uc3RvcCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYW5pbXMgPSB0aGlzLmluQW5pbSgpOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGFuaW1zLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgYW5pbXNbaV0uc3RvcCgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICAvKlwKICAgICAqIEVsZW1lbnQuYW5pbWF0ZQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogQW5pbWF0ZXMgdGhlIGdpdmVuIGF0dHJpYnV0ZXMgb2YgdGhlIGVsZW1lbnQKICAgICAqKgogICAgIC0gYXR0cnMgKG9iamVjdCkga2V5LXZhbHVlIHBhaXJzIG9mIGRlc3RpbmF0aW9uIGF0dHJpYnV0ZXMKICAgICAtIGR1cmF0aW9uIChudW1iZXIpIGR1cmF0aW9uIG9mIHRoZSBhbmltYXRpb24gaW4gbWlsbGlzZWNvbmRzCiAgICAgLSBlYXNpbmcgKGZ1bmN0aW9uKSAjb3B0aW9uYWwgZWFzaW5nIGZ1bmN0aW9uIGZyb20gQG1pbmEgb3IgY3VzdG9tCiAgICAgLSBjYWxsYmFjayAoZnVuY3Rpb24pICNvcHRpb25hbCBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IGV4ZWN1dGVzIHdoZW4gdGhlIGFuaW1hdGlvbiBlbmRzCiAgICAgPSAoRWxlbWVudCkgdGhlIGN1cnJlbnQgZWxlbWVudAogICAgXCovCiAgICBlbHByb3RvLmFuaW1hdGUgPSBmdW5jdGlvbiAoYXR0cnMsIG1zLCBlYXNpbmcsIGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKHR5cGVvZiBlYXNpbmcgPT0gImZ1bmN0aW9uIiAmJiAhZWFzaW5nLmxlbmd0aCkgewogICAgICAgICAgICBjYWxsYmFjayA9IGVhc2luZzsKICAgICAgICAgICAgZWFzaW5nID0gbWluYS5saW5lYXI7CiAgICAgICAgfQogICAgICAgIGlmIChhdHRycyBpbnN0YW5jZW9mIEFuaW1hdGlvbikgewogICAgICAgICAgICBjYWxsYmFjayA9IGF0dHJzLmNhbGxiYWNrOwogICAgICAgICAgICBlYXNpbmcgPSBhdHRycy5lYXNpbmc7CiAgICAgICAgICAgIG1zID0gZWFzaW5nLmR1cjsKICAgICAgICAgICAgYXR0cnMgPSBhdHRycy5hdHRyOwogICAgICAgIH0KICAgICAgICB2YXIgZmtleXMgPSBbXSwgdGtleXMgPSBbXSwga2V5cyA9IHt9LCBmcm9tLCB0bywgZiwgZXEsCiAgICAgICAgICAgIGVsID0gdGhpczsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gYXR0cnMpIGlmIChhdHRyc1toYXNdKGtleSkpIHsKICAgICAgICAgICAgaWYgKGVsLmVxdWFsKSB7CiAgICAgICAgICAgICAgICBlcSA9IGVsLmVxdWFsKGtleSwgU3RyKGF0dHJzW2tleV0pKTsKICAgICAgICAgICAgICAgIGZyb20gPSBlcS5mcm9tOwogICAgICAgICAgICAgICAgdG8gPSBlcS50bzsKICAgICAgICAgICAgICAgIGYgPSBlcS5mOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZnJvbSA9ICtlbC5hdHRyKGtleSk7CiAgICAgICAgICAgICAgICB0byA9ICthdHRyc1trZXldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBsZW4gPSBpcyhmcm9tLCAiYXJyYXkiKSA/IGZyb20ubGVuZ3RoIDogMTsKICAgICAgICAgICAga2V5c1trZXldID0gc2xpY2UoZmtleXMubGVuZ3RoLCBma2V5cy5sZW5ndGggKyBsZW4sIGYpOwogICAgICAgICAgICBma2V5cyA9IGZrZXlzLmNvbmNhdChmcm9tKTsKICAgICAgICAgICAgdGtleXMgPSB0a2V5cy5jb25jYXQodG8pOwogICAgICAgIH0KICAgICAgICB2YXIgbm93ID0gbWluYS50aW1lKCksCiAgICAgICAgICAgIGFuaW0gPSBtaW5hKGZrZXlzLCB0a2V5cywgbm93LCBub3cgKyBtcywgbWluYS50aW1lLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgICAgICAgICB2YXIgYXR0ciA9IHt9OwogICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGtleXMpIGlmIChrZXlzW2hhc10oa2V5KSkgewogICAgICAgICAgICAgICAgICAgIGF0dHJba2V5XSA9IGtleXNba2V5XSh2YWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWwuYXR0cihhdHRyKTsKICAgICAgICAgICAgfSwgZWFzaW5nKTsKICAgICAgICBlbC5hbmltc1thbmltLmlkXSA9IGFuaW07CiAgICAgICAgYW5pbS5fYXR0cnMgPSBhdHRyczsKICAgICAgICBhbmltLl9jYWxsYmFjayA9IGNhbGxiYWNrOwogICAgICAgIGV2ZSgic25hcC5hbmltY3JlYXRlZC4iICsgZWwuaWQsIGFuaW0pOwogICAgICAgIGV2ZS5vbmNlKCJtaW5hLmZpbmlzaC4iICsgYW5pbS5pZCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBkZWxldGUgZWwuYW5pbXNbYW5pbS5pZF07CiAgICAgICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwoZWwpOwogICAgICAgIH0pOwogICAgICAgIGV2ZS5vbmNlKCJtaW5hLnN0b3AuIiArIGFuaW0uaWQsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZGVsZXRlIGVsLmFuaW1zW2FuaW0uaWRdOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBlbDsKICAgIH07CiAgICB2YXIgZWxkYXRhID0ge307CiAgICAvKlwKICAgICAqIEVsZW1lbnQuZGF0YQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogQWRkcyBvciByZXRyaWV2ZXMgZ2l2ZW4gdmFsdWUgYXNzb2NpYXRlZCB3aXRoIGdpdmVuIGtleS4gKERvbuKAmXQgY29uZnVzZQogICAgICogd2l0aCBgZGF0YS1gIGF0dHJpYnV0ZXMpCiAgICAgKgogICAgICogU2VlIGFsc28gQEVsZW1lbnQucmVtb3ZlRGF0YQogICAgIC0ga2V5IChzdHJpbmcpIGtleSB0byBzdG9yZSBkYXRhCiAgICAgLSB2YWx1ZSAoYW55KSAjb3B0aW9uYWwgdmFsdWUgdG8gc3RvcmUKICAgICA9IChvYmplY3QpIEBFbGVtZW50CiAgICAgKiBvciwgaWYgdmFsdWUgaXMgbm90IHNwZWNpZmllZDoKICAgICA9IChhbnkpIHZhbHVlCiAgICAgPiBVc2FnZQogICAgIHwgZm9yICh2YXIgaSA9IDAsIGkgPCA1LCBpKyspIHsKICAgICB8ICAgICBwYXBlci5jaXJjbGUoMTAgKyAxNSAqIGksIDEwLCAxMCkKICAgICB8ICAgICAgICAgIC5hdHRyKHtmaWxsOiAiIzAwMCJ9KQogICAgIHwgICAgICAgICAgLmRhdGEoImkiLCBpKQogICAgIHwgICAgICAgICAgLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICB8ICAgICAgICAgICAgIGFsZXJ0KHRoaXMuZGF0YSgiaSIpKTsKICAgICB8ICAgICAgICAgIH0pOwogICAgIHwgfQogICAgXCovCiAgICBlbHByb3RvLmRhdGEgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewogICAgICAgIHZhciBkYXRhID0gZWxkYXRhW3RoaXMuaWRdID0gZWxkYXRhW3RoaXMuaWRdIHx8IHt9OwogICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDApewogICAgICAgICAgICBldmUoInNuYXAuZGF0YS5nZXQuIiArIHRoaXMuaWQsIHRoaXMsIGRhdGEsIG51bGwpOwogICAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgICB9CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICBpZiAoU25hcC5pcyhrZXksICJvYmplY3QiKSkgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBrZXkpIGlmIChrZXlbaGFzXShpKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YShpLCBrZXlbaV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXZlKCJzbmFwLmRhdGEuZ2V0LiIgKyB0aGlzLmlkLCB0aGlzLCBkYXRhW2tleV0sIGtleSk7CiAgICAgICAgICAgIHJldHVybiBkYXRhW2tleV07CiAgICAgICAgfQogICAgICAgIGRhdGFba2V5XSA9IHZhbHVlOwogICAgICAgIGV2ZSgic25hcC5kYXRhLnNldC4iICsgdGhpcy5pZCwgdGhpcywgdmFsdWUsIGtleSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgLypcCiAgICAgKiBFbGVtZW50LnJlbW92ZURhdGEKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJlbW92ZXMgdmFsdWUgYXNzb2NpYXRlZCB3aXRoIGFuIGVsZW1lbnQgYnkgZ2l2ZW4ga2V5LgogICAgICogSWYga2V5IGlzIG5vdCBwcm92aWRlZCwgcmVtb3ZlcyBhbGwgdGhlIGRhdGEgb2YgdGhlIGVsZW1lbnQuCiAgICAgLSBrZXkgKHN0cmluZykgI29wdGlvbmFsIGtleQogICAgID0gKG9iamVjdCkgQEVsZW1lbnQKICAgIFwqLwogICAgZWxwcm90by5yZW1vdmVEYXRhID0gZnVuY3Rpb24gKGtleSkgewogICAgICAgIGlmIChrZXkgPT0gbnVsbCkgewogICAgICAgICAgICBlbGRhdGFbdGhpcy5pZF0gPSB7fTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlbGRhdGFbdGhpcy5pZF0gJiYgZGVsZXRlIGVsZGF0YVt0aGlzLmlkXVtrZXldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICAvKlwKICAgICAqIEVsZW1lbnQub3V0ZXJTVkcKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJldHVybnMgU1ZHIGNvZGUgZm9yIHRoZSBlbGVtZW50LCBlcXVpdmFsZW50IHRvIEhUTUwncyBgb3V0ZXJIVE1MYC4KICAgICAqCiAgICAgKiBTZWUgYWxzbyBARWxlbWVudC5pbm5lclNWRwogICAgID0gKHN0cmluZykgU1ZHIGNvZGUgZm9yIHRoZSBlbGVtZW50CiAgICBcKi8KICAgIC8qXAogICAgICogRWxlbWVudC50b1N0cmluZwogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogU2VlIEBFbGVtZW50Lm91dGVyU1ZHCiAgICBcKi8KICAgIGVscHJvdG8ub3V0ZXJTVkcgPSBlbHByb3RvLnRvU3RyaW5nID0gdG9TdHJpbmcoMSk7CiAgICAvKlwKICAgICAqIEVsZW1lbnQuaW5uZXJTVkcKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJldHVybnMgU1ZHIGNvZGUgZm9yIHRoZSBlbGVtZW50J3MgY29udGVudHMsIGVxdWl2YWxlbnQgdG8gSFRNTCdzIGBpbm5lckhUTUxgCiAgICAgPSAoc3RyaW5nKSBTVkcgY29kZSBmb3IgdGhlIGVsZW1lbnQKICAgIFwqLwogICAgZWxwcm90by5pbm5lclNWRyA9IHRvU3RyaW5nKCk7CiAgICBmdW5jdGlvbiB0b1N0cmluZyh0eXBlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHJlcyA9IHR5cGUgPyAiPCIgKyB0aGlzLnR5cGUgOiAiIiwKICAgICAgICAgICAgICAgIGF0dHIgPSB0aGlzLm5vZGUuYXR0cmlidXRlcywKICAgICAgICAgICAgICAgIGNobGQgPSB0aGlzLm5vZGUuY2hpbGROb2RlczsKICAgICAgICAgICAgaWYgKHR5cGUpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGF0dHIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHJlcyArPSAiICIgKyBhdHRyW2ldLm5hbWUgKyAnPSInICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJbaV0udmFsdWUucmVwbGFjZSgvIi9nLCAnXFwiJykgKyAnIic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNobGQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICB0eXBlICYmIChyZXMgKz0gIj4iKTsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gY2hsZC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNobGRbaV0ubm9kZVR5cGUgPT0gMykgewogICAgICAgICAgICAgICAgICAgICAgICByZXMgKz0gY2hsZFtpXS5ub2RlVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaGxkW2ldLm5vZGVUeXBlID09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzICs9IHdyYXAoY2hsZFtpXSkudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0eXBlICYmIChyZXMgKz0gIjwvIiArIHRoaXMudHlwZSArICI+Iik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0eXBlICYmIChyZXMgKz0gIi8+Iik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9OwogICAgfQp9KEVsZW1lbnQucHJvdG90eXBlKSk7Ci8qXAogKiBTbmFwLnBhcnNlCiBbIG1ldGhvZCBdCiAqKgogKiBQYXJzZXMgU1ZHIGZyYWdtZW50IGFuZCBjb252ZXJ0cyBpdCBpbnRvIGEgQEZyYWdtZW50CiAqKgogLSBzdmcgKHN0cmluZykgU1ZHIHN0cmluZwogPSAoRnJhZ21lbnQpIHRoZSBARnJhZ21lbnQKXCovClNuYXAucGFyc2UgPSBmdW5jdGlvbiAoc3ZnKSB7CiAgICB2YXIgZiA9IGdsb2IuZG9jLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwKICAgICAgICBmdWxsID0gdHJ1ZSwKICAgICAgICBkaXYgPSBnbG9iLmRvYy5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIHN2ZyA9IFN0cihzdmcpOwogICAgaWYgKCFzdmcubWF0Y2goL15ccyo8XHMqc3ZnKD86XHN8PikvKSkgewogICAgICAgIHN2ZyA9ICI8c3ZnPiIgKyBzdmcgKyAiPC9zdmc+IjsKICAgICAgICBmdWxsID0gZmFsc2U7CiAgICB9CiAgICBkaXYuaW5uZXJIVE1MID0gc3ZnOwogICAgc3ZnID0gZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzdmciKVswXTsKICAgIGlmIChzdmcpIHsKICAgICAgICBpZiAoZnVsbCkgewogICAgICAgICAgICBmID0gc3ZnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHdoaWxlIChzdmcuZmlyc3RDaGlsZCkgewogICAgICAgICAgICAgICAgZi5hcHBlbmRDaGlsZChzdmcuZmlyc3RDaGlsZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBkaXYuaW5uZXJIVE1MID0gRTsKICAgIHJldHVybiBuZXcgRnJhZ21lbnQoZik7Cn07CmZ1bmN0aW9uIEZyYWdtZW50KGZyYWcpIHsKICAgIHRoaXMubm9kZSA9IGZyYWc7Cn0KLypcCiAqIEZyYWdtZW50LnNlbGVjdAogWyBtZXRob2QgXQogKioKICogU2VlIEBFbGVtZW50LnNlbGVjdApcKi8KRnJhZ21lbnQucHJvdG90eXBlLnNlbGVjdCA9IEVsZW1lbnQucHJvdG90eXBlLnNlbGVjdDsKLypcCiAqIEZyYWdtZW50LnNlbGVjdEFsbAogWyBtZXRob2QgXQogKioKICogU2VlIEBFbGVtZW50LnNlbGVjdEFsbApcKi8KRnJhZ21lbnQucHJvdG90eXBlLnNlbGVjdEFsbCA9IEVsZW1lbnQucHJvdG90eXBlLnNlbGVjdEFsbDsKLy8gU0lFUlJBIFNuYXAuZnJhZ21lbnQoKSBjb3VsZCBlc3BlY2lhbGx5IHVzZSBhIGNvZGUgZXhhbXBsZQovKlwKICogU25hcC5mcmFnbWVudAogWyBtZXRob2QgXQogKioKICogQ3JlYXRlcyBhIERPTSBmcmFnbWVudCBmcm9tIGEgZ2l2ZW4gbGlzdCBvZiBlbGVtZW50cyBvciBzdHJpbmdzCiAqKgogLSB2YXJhcmdzICjigKYpIFNWRyBzdHJpbmcKID0gKEZyYWdtZW50KSB0aGUgQEZyYWdtZW50ClwqLwpTbmFwLmZyYWdtZW50ID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApLAogICAgICAgIGYgPSBnbG9iLmRvYy5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CiAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBhcmdzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICB2YXIgaXRlbSA9IGFyZ3NbaV07CiAgICAgICAgaWYgKGl0ZW0ubm9kZSAmJiBpdGVtLm5vZGUubm9kZVR5cGUpIHsKICAgICAgICAgICAgZi5hcHBlbmRDaGlsZChpdGVtLm5vZGUpOwogICAgICAgIH0KICAgICAgICBpZiAoaXRlbS5ub2RlVHlwZSkgewogICAgICAgICAgICBmLmFwcGVuZENoaWxkKGl0ZW0pOwogICAgICAgIH0KICAgICAgICBpZiAodHlwZW9mIGl0ZW0gPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgZi5hcHBlbmRDaGlsZChTbmFwLnBhcnNlKGl0ZW0pLm5vZGUpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBuZXcgRnJhZ21lbnQoZik7Cn07CgpmdW5jdGlvbiBtYWtlKG5hbWUsIHBhcmVudCkgewogICAgdmFyIHJlcyA9ICQobmFtZSk7CiAgICBwYXJlbnQuYXBwZW5kQ2hpbGQocmVzKTsKICAgIHZhciBlbCA9IHdyYXAocmVzKTsKICAgIHJldHVybiBlbDsKfQpmdW5jdGlvbiBQYXBlcih3LCBoKSB7CiAgICB2YXIgcmVzLAogICAgICAgIGRlc2MsCiAgICAgICAgZGVmcywKICAgICAgICBwcm90byA9IFBhcGVyLnByb3RvdHlwZTsKICAgIGlmICh3ICYmIHcudGFnTmFtZSA9PSAic3ZnIikgewogICAgICAgIGlmICh3LnNuYXAgaW4gaHViKSB7CiAgICAgICAgICAgIHJldHVybiBodWJbdy5zbmFwXTsKICAgICAgICB9CiAgICAgICAgdmFyIGRvYyA9IHcub3duZXJEb2N1bWVudDsKICAgICAgICByZXMgPSBuZXcgRWxlbWVudCh3KTsKICAgICAgICBkZXNjID0gdy5nZXRFbGVtZW50c0J5VGFnTmFtZSgiZGVzYyIpWzBdOwogICAgICAgIGRlZnMgPSB3LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJkZWZzIilbMF07CiAgICAgICAgaWYgKCFkZXNjKSB7CiAgICAgICAgICAgIGRlc2MgPSAkKCJkZXNjIik7CiAgICAgICAgICAgIGRlc2MuYXBwZW5kQ2hpbGQoZG9jLmNyZWF0ZVRleHROb2RlKCJDcmVhdGVkIHdpdGggU25hcCIpKTsKICAgICAgICAgICAgcmVzLm5vZGUuYXBwZW5kQ2hpbGQoZGVzYyk7CiAgICAgICAgfQogICAgICAgIGlmICghZGVmcykgewogICAgICAgICAgICBkZWZzID0gJCgiZGVmcyIpOwogICAgICAgICAgICByZXMubm9kZS5hcHBlbmRDaGlsZChkZWZzKTsKICAgICAgICB9CiAgICAgICAgcmVzLmRlZnMgPSBkZWZzOwogICAgICAgIGZvciAodmFyIGtleSBpbiBwcm90bykgaWYgKHByb3RvW2hhc10oa2V5KSkgewogICAgICAgICAgICByZXNba2V5XSA9IHByb3RvW2tleV07CiAgICAgICAgfQogICAgICAgIHJlcy5wYXBlciA9IHJlcy5yb290ID0gcmVzOwogICAgfSBlbHNlIHsKICAgICAgICByZXMgPSBtYWtlKCJzdmciLCBnbG9iLmRvYy5ib2R5KTsKICAgICAgICAkKHJlcy5ub2RlLCB7CiAgICAgICAgICAgIGhlaWdodDogaCwKICAgICAgICAgICAgdmVyc2lvbjogMS4xLAogICAgICAgICAgICB3aWR0aDogdywKICAgICAgICAgICAgeG1sbnM6IHhtbG5zCiAgICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gcmVzOwp9CmZ1bmN0aW9uIHdyYXAoZG9tKSB7CiAgICBpZiAoIWRvbSkgewogICAgICAgIHJldHVybiBkb207CiAgICB9CiAgICBpZiAoZG9tIGluc3RhbmNlb2YgRWxlbWVudCB8fCBkb20gaW5zdGFuY2VvZiBGcmFnbWVudCkgewogICAgICAgIHJldHVybiBkb207CiAgICB9CiAgICBpZiAoZG9tLnRhZ05hbWUgJiYgZG9tLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PSAic3ZnIikgewogICAgICAgIHJldHVybiBuZXcgUGFwZXIoZG9tKTsKICAgIH0KICAgIGlmIChkb20udGFnTmFtZSAmJiBkb20udGFnTmFtZS50b0xvd2VyQ2FzZSgpID09ICJvYmplY3QiICYmIGRvbS50eXBlID09ICJpbWFnZS9zdmcreG1sIikgewogICAgICAgIHJldHVybiBuZXcgUGFwZXIoZG9tLmNvbnRlbnREb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic3ZnIilbMF0pOwogICAgfQogICAgcmV0dXJuIG5ldyBFbGVtZW50KGRvbSk7Cn0KClNuYXAuXy5tYWtlID0gbWFrZTsKU25hcC5fLndyYXAgPSB3cmFwOwovKlwKICogUGFwZXIuZWwKIFsgbWV0aG9kIF0KICoqCiAqIENyZWF0ZXMgYW4gZWxlbWVudCBvbiBwYXBlciB3aXRoIGEgZ2l2ZW4gbmFtZSBhbmQgbm8gYXR0cmlidXRlcwogKioKIC0gbmFtZSAoc3RyaW5nKSB0YWcgbmFtZQogLSBhdHRyIChvYmplY3QpIGF0dHJpYnV0ZXMKID0gKEVsZW1lbnQpIHRoZSBjdXJyZW50IGVsZW1lbnQKID4gVXNhZ2UKIHwgdmFyIGMgPSBwYXBlci5jaXJjbGUoMTAsIDEwLCAxMCk7IC8vIGlzIHRoZSBzYW1lIGFzLi4uCiB8IHZhciBjID0gcGFwZXIuZWwoImNpcmNsZSIpLmF0dHIoewogfCAgICAgY3g6IDEwLAogfCAgICAgY3k6IDEwLAogfCAgICAgcjogMTAKIHwgfSk7CiB8IC8vIGFuZCB0aGUgc2FtZSBhcwogfCB2YXIgYyA9IHBhcGVyLmVsKCJjaXJjbGUiLCB7CiB8ICAgICBjeDogMTAsCiB8ICAgICBjeTogMTAsCiB8ICAgICByOiAxMAogfCB9KTsKXCovClBhcGVyLnByb3RvdHlwZS5lbCA9IGZ1bmN0aW9uIChuYW1lLCBhdHRyKSB7CiAgICB2YXIgZWwgPSBtYWtlKG5hbWUsIHRoaXMubm9kZSk7CiAgICBhdHRyICYmIGVsLmF0dHIoYXR0cik7CiAgICByZXR1cm4gZWw7Cn07Ci8vIGRlZmF1bHQKZXZlLm9uKCJzbmFwLnV0aWwuZ2V0YXR0ciIsIGZ1bmN0aW9uICgpIHsKICAgIHZhciBhdHQgPSBldmUubnQoKTsKICAgIGF0dCA9IGF0dC5zdWJzdHJpbmcoYXR0Lmxhc3RJbmRleE9mKCIuIikgKyAxKTsKICAgIHZhciBjc3MgPSBhdHQucmVwbGFjZSgvW0EtWl0vZywgZnVuY3Rpb24gKGxldHRlcikgewogICAgICAgIHJldHVybiAiLSIgKyBsZXR0ZXIudG9Mb3dlckNhc2UoKTsKICAgIH0pOwogICAgaWYgKGNzc0F0dHJbaGFzXShjc3MpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubm9kZS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUodGhpcy5ub2RlLCBudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKGNzcyk7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAkKHRoaXMubm9kZSwgYXR0KTsKICAgIH0KfSk7CnZhciBjc3NBdHRyID0gewogICAgImFsaWdubWVudC1iYXNlbGluZSI6IDAsCiAgICAiYmFzZWxpbmUtc2hpZnQiOiAwLAogICAgImNsaXAiOiAwLAogICAgImNsaXAtcGF0aCI6IDAsCiAgICAiY2xpcC1ydWxlIjogMCwKICAgICJjb2xvciI6IDAsCiAgICAiY29sb3ItaW50ZXJwb2xhdGlvbiI6IDAsCiAgICAiY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzIjogMCwKICAgICJjb2xvci1wcm9maWxlIjogMCwKICAgICJjb2xvci1yZW5kZXJpbmciOiAwLAogICAgImN1cnNvciI6IDAsCiAgICAiZGlyZWN0aW9uIjogMCwKICAgICJkaXNwbGF5IjogMCwKICAgICJkb21pbmFudC1iYXNlbGluZSI6IDAsCiAgICAiZW5hYmxlLWJhY2tncm91bmQiOiAwLAogICAgImZpbGwiOiAwLAogICAgImZpbGwtb3BhY2l0eSI6IDAsCiAgICAiZmlsbC1ydWxlIjogMCwKICAgICJmaWx0ZXIiOiAwLAogICAgImZsb29kLWNvbG9yIjogMCwKICAgICJmbG9vZC1vcGFjaXR5IjogMCwKICAgICJmb250IjogMCwKICAgICJmb250LWZhbWlseSI6IDAsCiAgICAiZm9udC1zaXplIjogMCwKICAgICJmb250LXNpemUtYWRqdXN0IjogMCwKICAgICJmb250LXN0cmV0Y2giOiAwLAogICAgImZvbnQtc3R5bGUiOiAwLAogICAgImZvbnQtdmFyaWFudCI6IDAsCiAgICAiZm9udC13ZWlnaHQiOiAwLAogICAgImdseXBoLW9yaWVudGF0aW9uLWhvcml6b250YWwiOiAwLAogICAgImdseXBoLW9yaWVudGF0aW9uLXZlcnRpY2FsIjogMCwKICAgICJpbWFnZS1yZW5kZXJpbmciOiAwLAogICAgImtlcm5pbmciOiAwLAogICAgImxldHRlci1zcGFjaW5nIjogMCwKICAgICJsaWdodGluZy1jb2xvciI6IDAsCiAgICAibWFya2VyIjogMCwKICAgICJtYXJrZXItZW5kIjogMCwKICAgICJtYXJrZXItbWlkIjogMCwKICAgICJtYXJrZXItc3RhcnQiOiAwLAogICAgIm1hc2siOiAwLAogICAgIm9wYWNpdHkiOiAwLAogICAgIm92ZXJmbG93IjogMCwKICAgICJwb2ludGVyLWV2ZW50cyI6IDAsCiAgICAic2hhcGUtcmVuZGVyaW5nIjogMCwKICAgICJzdG9wLWNvbG9yIjogMCwKICAgICJzdG9wLW9wYWNpdHkiOiAwLAogICAgInN0cm9rZSI6IDAsCiAgICAic3Ryb2tlLWRhc2hhcnJheSI6IDAsCiAgICAic3Ryb2tlLWRhc2hvZmZzZXQiOiAwLAogICAgInN0cm9rZS1saW5lY2FwIjogMCwKICAgICJzdHJva2UtbGluZWpvaW4iOiAwLAogICAgInN0cm9rZS1taXRlcmxpbWl0IjogMCwKICAgICJzdHJva2Utb3BhY2l0eSI6IDAsCiAgICAic3Ryb2tlLXdpZHRoIjogMCwKICAgICJ0ZXh0LWFuY2hvciI6IDAsCiAgICAidGV4dC1kZWNvcmF0aW9uIjogMCwKICAgICJ0ZXh0LXJlbmRlcmluZyI6IDAsCiAgICAidW5pY29kZS1iaWRpIjogMCwKICAgICJ2aXNpYmlsaXR5IjogMCwKICAgICJ3b3JkLXNwYWNpbmciOiAwLAogICAgIndyaXRpbmctbW9kZSI6IDAKfTsKCmV2ZS5vbigic25hcC51dGlsLmF0dHIiLCBmdW5jdGlvbiAodmFsdWUpIHsKICAgIHZhciBhdHQgPSBldmUubnQoKSwKICAgICAgICBhdHRyID0ge307CiAgICBhdHQgPSBhdHQuc3Vic3RyaW5nKGF0dC5sYXN0SW5kZXhPZigiLiIpICsgMSk7CiAgICBhdHRyW2F0dF0gPSB2YWx1ZTsKICAgIHZhciBzdHlsZSA9IGF0dC5yZXBsYWNlKC8tKFx3KS9naSwgZnVuY3Rpb24gKGFsbCwgbGV0dGVyKSB7CiAgICAgICAgICAgIHJldHVybiBsZXR0ZXIudG9VcHBlckNhc2UoKTsKICAgICAgICB9KSwKICAgICAgICBjc3MgPSBhdHQucmVwbGFjZSgvW0EtWl0vZywgZnVuY3Rpb24gKGxldHRlcikgewogICAgICAgICAgICByZXR1cm4gIi0iICsgbGV0dGVyLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgfSk7CiAgICBpZiAoY3NzQXR0cltoYXNdKGNzcykpIHsKICAgICAgICB0aGlzLm5vZGUuc3R5bGVbc3R5bGVdID0gdmFsdWUgPT0gbnVsbCA/IEUgOiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgICAgJCh0aGlzLm5vZGUsIGF0dHIpOwogICAgfQp9KTsKKGZ1bmN0aW9uIChwcm90bykge30oUGFwZXIucHJvdG90eXBlKSk7CgovLyBzaW1wbGUgYWpheAovKlwKICogU25hcC5hamF4CiBbIG1ldGhvZCBdCiAqKgogKiBTaW1wbGUgaW1wbGVtZW50YXRpb24gb2YgQWpheAogKioKIC0gdXJsIChzdHJpbmcpIFVSTAogLSBwb3N0RGF0YSAob2JqZWN0fHN0cmluZykgZGF0YSBmb3IgcG9zdCByZXF1ZXN0CiAtIGNhbGxiYWNrIChmdW5jdGlvbikgY2FsbGJhY2sKIC0gc2NvcGUgKG9iamVjdCkgI29wdGlvbmFsIHNjb3BlIG9mIGNhbGxiYWNrCiAqIG9yCiAtIHVybCAoc3RyaW5nKSBVUkwKIC0gY2FsbGJhY2sgKGZ1bmN0aW9uKSBjYWxsYmFjawogLSBzY29wZSAob2JqZWN0KSAjb3B0aW9uYWwgc2NvcGUgb2YgY2FsbGJhY2sKID0gKFhNTEh0dHBSZXF1ZXN0KSB0aGUgWE1MSHR0cFJlcXVlc3Qgb2JqZWN0LCBqdXN0IGluIGNhc2UKXCovClNuYXAuYWpheCA9IGZ1bmN0aW9uICh1cmwsIHBvc3REYXRhLCBjYWxsYmFjaywgc2NvcGUpewogICAgdmFyIHJlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCwKICAgICAgICBpZCA9IElEKCk7CiAgICBpZiAocmVxKSB7CiAgICAgICAgaWYgKGlzKHBvc3REYXRhLCAiZnVuY3Rpb24iKSkgewogICAgICAgICAgICBzY29wZSA9IGNhbGxiYWNrOwogICAgICAgICAgICBjYWxsYmFjayA9IHBvc3REYXRhOwogICAgICAgICAgICBwb3N0RGF0YSA9IG51bGw7CiAgICAgICAgfSBlbHNlIGlmIChpcyhwb3N0RGF0YSwgIm9iamVjdCIpKSB7CiAgICAgICAgICAgIHZhciBwZCA9IFtdOwogICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gcG9zdERhdGEpIGlmIChwb3N0RGF0YS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgICAgICBwZC5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChrZXkpICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHBvc3REYXRhW2tleV0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwb3N0RGF0YSA9IHBkLmpvaW4oIiYiKTsKICAgICAgICB9CiAgICAgICAgcmVxLm9wZW4oKHBvc3REYXRhID8gIlBPU1QiIDogIkdFVCIpLCB1cmwsIHRydWUpOwogICAgICAgIGlmIChwb3N0RGF0YSkgewogICAgICAgICAgICByZXEuc2V0UmVxdWVzdEhlYWRlcigiWC1SZXF1ZXN0ZWQtV2l0aCIsICJYTUxIdHRwUmVxdWVzdCIpOwogICAgICAgICAgICByZXEuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC10eXBlIiwgImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpOwogICAgICAgIH0KICAgICAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgICAgICAgZXZlLm9uY2UoInNuYXAuYWpheC4iICsgaWQgKyAiLjAiLCBjYWxsYmFjayk7CiAgICAgICAgICAgIGV2ZS5vbmNlKCJzbmFwLmFqYXguIiArIGlkICsgIi4yMDAiLCBjYWxsYmFjayk7CiAgICAgICAgICAgIGV2ZS5vbmNlKCJzbmFwLmFqYXguIiArIGlkICsgIi4zMDQiLCBjYWxsYmFjayk7CiAgICAgICAgfQogICAgICAgIHJlcS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKHJlcS5yZWFkeVN0YXRlICE9IDQpIHJldHVybjsKICAgICAgICAgICAgZXZlKCJzbmFwLmFqYXguIiArIGlkICsgIi4iICsgcmVxLnN0YXR1cywgc2NvcGUsIHJlcSk7CiAgICAgICAgfTsKICAgICAgICBpZiAocmVxLnJlYWR5U3RhdGUgPT0gNCkgewogICAgICAgICAgICByZXR1cm4gcmVxOwogICAgICAgIH0KICAgICAgICByZXEuc2VuZChwb3N0RGF0YSk7CiAgICAgICAgcmV0dXJuIHJlcTsKICAgIH0KfTsKLypcCiAqIFNuYXAubG9hZAogWyBtZXRob2QgXQogKioKICogTG9hZHMgZXh0ZXJuYWwgU1ZHIGZpbGUgYXMgYSBARnJhZ21lbnQgKHNlZSBAU25hcC5hamF4IGZvciBtb3JlIGFkdmFuY2VkIEFKQVgpCiAqKgogLSB1cmwgKHN0cmluZykgVVJMCiAtIGNhbGxiYWNrIChmdW5jdGlvbikgY2FsbGJhY2sKIC0gc2NvcGUgKG9iamVjdCkgI29wdGlvbmFsIHNjb3BlIG9mIGNhbGxiYWNrClwqLwpTbmFwLmxvYWQgPSBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaywgc2NvcGUpIHsKICAgIFNuYXAuYWpheCh1cmwsIGZ1bmN0aW9uIChyZXEpIHsKICAgICAgICB2YXIgZiA9IFNuYXAucGFyc2UocmVxLnJlc3BvbnNlVGV4dCk7CiAgICAgICAgc2NvcGUgPyBjYWxsYmFjay5jYWxsKHNjb3BlLCBmKSA6IGNhbGxiYWNrKGYpOwogICAgfSk7Cn07CnZhciBnZXRPZmZzZXQgPSBmdW5jdGlvbiAoZWxlbSkgewogICAgdmFyIGJveCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksCiAgICAgICAgZG9jID0gZWxlbS5vd25lckRvY3VtZW50LAogICAgICAgIGJvZHkgPSBkb2MuYm9keSwKICAgICAgICBkb2NFbGVtID0gZG9jLmRvY3VtZW50RWxlbWVudCwKICAgICAgICBjbGllbnRUb3AgPSBkb2NFbGVtLmNsaWVudFRvcCB8fCBib2R5LmNsaWVudFRvcCB8fCAwLCBjbGllbnRMZWZ0ID0gZG9jRWxlbS5jbGllbnRMZWZ0IHx8IGJvZHkuY2xpZW50TGVmdCB8fCAwLAogICAgICAgIHRvcCAgPSBib3gudG9wICArIChnLndpbi5wYWdlWU9mZnNldCB8fCBkb2NFbGVtLnNjcm9sbFRvcCB8fCBib2R5LnNjcm9sbFRvcCApIC0gY2xpZW50VG9wLAogICAgICAgIGxlZnQgPSBib3gubGVmdCArIChnLndpbi5wYWdlWE9mZnNldCB8fCBkb2NFbGVtLnNjcm9sbExlZnQgfHwgYm9keS5zY3JvbGxMZWZ0KSAtIGNsaWVudExlZnQ7CiAgICByZXR1cm4gewogICAgICAgIHk6IHRvcCwKICAgICAgICB4OiBsZWZ0CiAgICB9Owp9OwovKlwKICogU25hcC5nZXRFbGVtZW50QnlQb2ludAogWyBtZXRob2QgXQogKioKICogUmV0dXJucyB5b3UgdG9wbW9zdCBlbGVtZW50IHVuZGVyIGdpdmVuIHBvaW50LgogKioKID0gKG9iamVjdCkgU25hcCBlbGVtZW50IG9iamVjdAogLSB4IChudW1iZXIpIHggY29vcmRpbmF0ZSBmcm9tIHRoZSB0b3AgbGVmdCBjb3JuZXIgb2YgdGhlIHdpbmRvdwogLSB5IChudW1iZXIpIHkgY29vcmRpbmF0ZSBmcm9tIHRoZSB0b3AgbGVmdCBjb3JuZXIgb2YgdGhlIHdpbmRvdwogPiBVc2FnZQogfCBTbmFwLmdldEVsZW1lbnRCeVBvaW50KG1vdXNlWCwgbW91c2VZKS5hdHRyKHtzdHJva2U6ICIjZjAwIn0pOwpcKi8KU25hcC5nZXRFbGVtZW50QnlQb2ludCA9IGZ1bmN0aW9uICh4LCB5KSB7CiAgICB2YXIgcGFwZXIgPSB0aGlzLAogICAgICAgIHN2ZyA9IHBhcGVyLmNhbnZhcywKICAgICAgICB0YXJnZXQgPSBnbG9iLmRvYy5lbGVtZW50RnJvbVBvaW50KHgsIHkpOwogICAgaWYgKGdsb2Iud2luLm9wZXJhICYmIHRhcmdldC50YWdOYW1lID09ICJzdmciKSB7CiAgICAgICAgdmFyIHNvID0gZ2V0T2Zmc2V0KHRhcmdldCksCiAgICAgICAgICAgIHNyID0gdGFyZ2V0LmNyZWF0ZVNWR1JlY3QoKTsKICAgICAgICBzci54ID0geCAtIHNvLng7CiAgICAgICAgc3IueSA9IHkgLSBzby55OwogICAgICAgIHNyLndpZHRoID0gc3IuaGVpZ2h0ID0gMTsKICAgICAgICB2YXIgaGl0cyA9IHRhcmdldC5nZXRJbnRlcnNlY3Rpb25MaXN0KHNyLCBudWxsKTsKICAgICAgICBpZiAoaGl0cy5sZW5ndGgpIHsKICAgICAgICAgICAgdGFyZ2V0ID0gaGl0c1toaXRzLmxlbmd0aCAtIDFdOwogICAgICAgIH0KICAgIH0KICAgIGlmICghdGFyZ2V0KSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICByZXR1cm4gd3JhcCh0YXJnZXQpOwp9OwovKlwKICogU25hcC5wbHVnaW4KIFsgbWV0aG9kIF0KICoqCiAqIExldCB5b3Ugd3JpdGUgcGx1Z2lucy4gWW91IHBhc3MgaW4gYSBmdW5jdGlvbiB3aXRoIGZvdXIgYXJndW1lbnRzLCBsaWtlIHRoaXM6CiB8IFNuYXAucGx1Z2luKGZ1bmN0aW9uIChTbmFwLCBFbGVtZW50LCBQYXBlciwgZ2xvYmFsLCBGcmFnbWVudCkgewogfCAgICAgU25hcC5uZXdtZXRob2QgPSBmdW5jdGlvbiAoKSB7fTsKIHwgICAgIEVsZW1lbnQucHJvdG90eXBlLm5ld21ldGhvZCA9IGZ1bmN0aW9uICgpIHt9OwogfCAgICAgUGFwZXIucHJvdG90eXBlLm5ld21ldGhvZCA9IGZ1bmN0aW9uICgpIHt9OwogfCB9KTsKICogSW5zaWRlIHRoZSBmdW5jdGlvbiB5b3UgaGF2ZSBhY2Nlc3MgdG8gYWxsIG1haW4gb2JqZWN0cyAoYW5kIHRoZWlyCiAqIHByb3RvdHlwZXMpLiBUaGlzIGFsbG93IHlvdSB0byBleHRlbmQgYW55dGhpbmcgeW91IHdhbnQuCiAqKgogLSBmIChmdW5jdGlvbikgeW91ciBwbHVnaW4gYm9keQpcKi8KU25hcC5wbHVnaW4gPSBmdW5jdGlvbiAoZikgewogICAgZihTbmFwLCBFbGVtZW50LCBQYXBlciwgZ2xvYiwgRnJhZ21lbnQpOwp9OwpnbG9iLndpbi5TbmFwID0gU25hcDsKcmV0dXJuIFNuYXA7Cn0oKSk7CgovLyBDb3B5cmlnaHQgKGMpIDIwMTMgQWRvYmUgU3lzdGVtcyBJbmNvcnBvcmF0ZWQuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCi8vIAovLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKLy8geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgovLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKLy8gCi8vIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAovLyAKLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQovLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAovLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KLy8gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAovLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KU25hcC5wbHVnaW4oZnVuY3Rpb24gKFNuYXAsIEVsZW1lbnQsIFBhcGVyLCBnbG9iLCBGcmFnbWVudCkgewogICAgdmFyIG9iamVjdFRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZywKICAgICAgICBTdHIgPSBTdHJpbmcsCiAgICAgICAgbWF0aCA9IE1hdGgsCiAgICAgICAgRSA9ICIiOwogICAgZnVuY3Rpb24gTWF0cml4KGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgICAgICBpZiAoYiA9PSBudWxsICYmIG9iamVjdFRvU3RyaW5nLmNhbGwoYSkgPT0gIltvYmplY3QgU1ZHTWF0cml4XSIpIHsKICAgICAgICAgICAgdGhpcy5hID0gYS5hOwogICAgICAgICAgICB0aGlzLmIgPSBhLmI7CiAgICAgICAgICAgIHRoaXMuYyA9IGEuYzsKICAgICAgICAgICAgdGhpcy5kID0gYS5kOwogICAgICAgICAgICB0aGlzLmUgPSBhLmU7CiAgICAgICAgICAgIHRoaXMuZiA9IGEuZjsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoYSAhPSBudWxsKSB7CiAgICAgICAgICAgIHRoaXMuYSA9ICthOwogICAgICAgICAgICB0aGlzLmIgPSArYjsKICAgICAgICAgICAgdGhpcy5jID0gK2M7CiAgICAgICAgICAgIHRoaXMuZCA9ICtkOwogICAgICAgICAgICB0aGlzLmUgPSArZTsKICAgICAgICAgICAgdGhpcy5mID0gK2Y7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5hID0gMTsKICAgICAgICAgICAgdGhpcy5iID0gMDsKICAgICAgICAgICAgdGhpcy5jID0gMDsKICAgICAgICAgICAgdGhpcy5kID0gMTsKICAgICAgICAgICAgdGhpcy5lID0gMDsKICAgICAgICAgICAgdGhpcy5mID0gMDsKICAgICAgICB9CiAgICB9CiAgICAoZnVuY3Rpb24gKG1hdHJpeHByb3RvKSB7CiAgICAgICAgLypcCiAgICAgICAgICogTWF0cml4LmFkZAogICAgICAgICBbIG1ldGhvZCBdCiAgICAgICAgICoqCiAgICAgICAgICogQWRkcyB0aGUgZ2l2ZW4gbWF0cml4IHRvIGV4aXN0aW5nIG9uZQogICAgICAgICAtIGEgKG51bWJlcikKICAgICAgICAgLSBiIChudW1iZXIpCiAgICAgICAgIC0gYyAobnVtYmVyKQogICAgICAgICAtIGQgKG51bWJlcikKICAgICAgICAgLSBlIChudW1iZXIpCiAgICAgICAgIC0gZiAobnVtYmVyKQogICAgICAgICAqIG9yCiAgICAgICAgIC0gbWF0cml4IChvYmplY3QpIEBNYXRyaXgKICAgICAgICBcKi8KICAgICAgICBtYXRyaXhwcm90by5hZGQgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgICAgICB2YXIgb3V0ID0gW1tdLCBbXSwgW11dLAogICAgICAgICAgICAgICAgbSA9IFtbdGhpcy5hLCB0aGlzLmMsIHRoaXMuZV0sIFt0aGlzLmIsIHRoaXMuZCwgdGhpcy5mXSwgWzAsIDAsIDFdXSwKICAgICAgICAgICAgICAgIG1hdHJpeCA9IFtbYSwgYywgZV0sIFtiLCBkLCBmXSwgWzAsIDAsIDFdXSwKICAgICAgICAgICAgICAgIHgsIHksIHosIHJlczsKCiAgICAgICAgICAgIGlmIChhICYmIGEgaW5zdGFuY2VvZiBNYXRyaXgpIHsKICAgICAgICAgICAgICAgIG1hdHJpeCA9IFtbYS5hLCBhLmMsIGEuZV0sIFthLmIsIGEuZCwgYS5mXSwgWzAsIDAsIDFdXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yICh4ID0gMDsgeCA8IDM7IHgrKykgewogICAgICAgICAgICAgICAgZm9yICh5ID0gMDsgeSA8IDM7IHkrKykgewogICAgICAgICAgICAgICAgICAgIHJlcyA9IDA7CiAgICAgICAgICAgICAgICAgICAgZm9yICh6ID0gMDsgeiA8IDM7IHorKykgewogICAgICAgICAgICAgICAgICAgICAgICByZXMgKz0gbVt4XVt6XSAqIG1hdHJpeFt6XVt5XTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgb3V0W3hdW3ldID0gcmVzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYSA9IG91dFswXVswXTsKICAgICAgICAgICAgdGhpcy5iID0gb3V0WzFdWzBdOwogICAgICAgICAgICB0aGlzLmMgPSBvdXRbMF1bMV07CiAgICAgICAgICAgIHRoaXMuZCA9IG91dFsxXVsxXTsKICAgICAgICAgICAgdGhpcy5lID0gb3V0WzBdWzJdOwogICAgICAgICAgICB0aGlzLmYgPSBvdXRbMV1bMl07CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH07CiAgICAgICAgLypcCiAgICAgICAgICogTWF0cml4LmludmVydAogICAgICAgICBbIG1ldGhvZCBdCiAgICAgICAgICoqCiAgICAgICAgICogUmV0dXJucyBhbiBpbnZlcnRlZCB2ZXJzaW9uIG9mIHRoZSBtYXRyaXgKICAgICAgICAgPSAob2JqZWN0KSBATWF0cml4CiAgICAgICAgXCovCiAgICAgICAgbWF0cml4cHJvdG8uaW52ZXJ0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgICAgICAgeCA9IG1lLmEgKiBtZS5kIC0gbWUuYiAqIG1lLmM7CiAgICAgICAgICAgIHJldHVybiBuZXcgTWF0cml4KG1lLmQgLyB4LCAtbWUuYiAvIHgsIC1tZS5jIC8geCwgbWUuYSAvIHgsIChtZS5jICogbWUuZiAtIG1lLmQgKiBtZS5lKSAvIHgsIChtZS5iICogbWUuZSAtIG1lLmEgKiBtZS5mKSAvIHgpOwogICAgICAgIH07CiAgICAgICAgLypcCiAgICAgICAgICogTWF0cml4LmNsb25lCiAgICAgICAgIFsgbWV0aG9kIF0KICAgICAgICAgKioKICAgICAgICAgKiBSZXR1cm5zIGEgY29weSBvZiB0aGUgbWF0cml4CiAgICAgICAgID0gKG9iamVjdCkgQE1hdHJpeAogICAgICAgIFwqLwogICAgICAgIG1hdHJpeHByb3RvLmNsb25lID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IE1hdHJpeCh0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCB0aGlzLmQsIHRoaXMuZSwgdGhpcy5mKTsKICAgICAgICB9OwogICAgICAgIC8qXAogICAgICAgICAqIE1hdHJpeC50cmFuc2xhdGUKICAgICAgICAgWyBtZXRob2QgXQogICAgICAgICAqKgogICAgICAgICAqIFRyYW5zbGF0ZSB0aGUgbWF0cml4CiAgICAgICAgIC0geCAobnVtYmVyKSBob3Jpem9udGFsIG9mZnNldCBkaXN0YW5jZQogICAgICAgICAtIHkgKG51bWJlcikgdmVydGljYWwgb2Zmc2V0IGRpc3RhbmNlCiAgICAgICAgXCovCiAgICAgICAgbWF0cml4cHJvdG8udHJhbnNsYXRlID0gZnVuY3Rpb24gKHgsIHkpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkKDEsIDAsIDAsIDEsIHgsIHkpOwogICAgICAgIH07CiAgICAgICAgLypcCiAgICAgICAgICogTWF0cml4LnNjYWxlCiAgICAgICAgIFsgbWV0aG9kIF0KICAgICAgICAgKioKICAgICAgICAgKiBTY2FsZXMgdGhlIG1hdHJpeAogICAgICAgICAtIHggKG51bWJlcikgYW1vdW50IHRvIGJlIHNjYWxlZCwgd2l0aCBgMWAgcmVzdWx0aW5nIGluIG5vIGNoYW5nZQogICAgICAgICAtIHkgKG51bWJlcikgI29wdGlvbmFsIGFtb3VudCB0byBzY2FsZSBhbG9uZyB0aGUgdmVydGljYWwgYXhpcy4gKE90aGVyd2lzZSBgeGAgYXBwbGllcyB0byBib3RoIGF4ZXMuKQogICAgICAgICAtIGN4IChudW1iZXIpICNvcHRpb25hbCBob3Jpem9udGFsIG9yaWdpbiBwb2ludCBmcm9tIHdoaWNoIHRvIHNjYWxlCiAgICAgICAgIC0gY3kgKG51bWJlcikgI29wdGlvbmFsIHZlcnRpY2FsIG9yaWdpbiBwb2ludCBmcm9tIHdoaWNoIHRvIHNjYWxlCiAgICAgICAgICogRGVmYXVsdCBjeCwgY3kgaXMgdGhlIG1pZGRsZSBwb2ludCBvZiB0aGUgZWxlbWVudC4KICAgICAgICBcKi8KICAgICAgICBtYXRyaXhwcm90by5zY2FsZSA9IGZ1bmN0aW9uICh4LCB5LCBjeCwgY3kpIHsKICAgICAgICAgICAgeSA9PSBudWxsICYmICh5ID0geCk7CiAgICAgICAgICAgIChjeCB8fCBjeSkgJiYgdGhpcy5hZGQoMSwgMCwgMCwgMSwgY3gsIGN5KTsKICAgICAgICAgICAgdGhpcy5hZGQoeCwgMCwgMCwgeSwgMCwgMCk7CiAgICAgICAgICAgIChjeCB8fCBjeSkgJiYgdGhpcy5hZGQoMSwgMCwgMCwgMSwgLWN4LCAtY3kpOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9OwogICAgICAgIC8qXAogICAgICAgICAqIE1hdHJpeC5yb3RhdGUKICAgICAgICAgWyBtZXRob2QgXQogICAgICAgICAqKgogICAgICAgICAqIFJvdGF0ZXMgdGhlIG1hdHJpeAogICAgICAgICAtIGEgKG51bWJlcikgYW5nbGUgb2Ygcm90YXRpb24sIGluIGRlZ3JlZXMKICAgICAgICAgLSB4IChudW1iZXIpIGhvcml6b250YWwgb3JpZ2luIHBvaW50IGZyb20gd2hpY2ggdG8gcm90YXRlCiAgICAgICAgIC0geSAobnVtYmVyKSB2ZXJ0aWNhbCBvcmlnaW4gcG9pbnQgZnJvbSB3aGljaCB0byByb3RhdGUKICAgICAgICBcKi8KICAgICAgICBtYXRyaXhwcm90by5yb3RhdGUgPSBmdW5jdGlvbiAoYSwgeCwgeSkgewogICAgICAgICAgICBhID0gU25hcC5yYWQoYSk7CiAgICAgICAgICAgIHggPSB4IHx8IDA7CiAgICAgICAgICAgIHkgPSB5IHx8IDA7CiAgICAgICAgICAgIHZhciBjb3MgPSArbWF0aC5jb3MoYSkudG9GaXhlZCg5KSwKICAgICAgICAgICAgICAgIHNpbiA9ICttYXRoLnNpbihhKS50b0ZpeGVkKDkpOwogICAgICAgICAgICB0aGlzLmFkZChjb3MsIHNpbiwgLXNpbiwgY29zLCB4LCB5KTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkKDEsIDAsIDAsIDEsIC14LCAteSk7CiAgICAgICAgfTsKICAgICAgICAvKlwKICAgICAgICAgKiBNYXRyaXgueAogICAgICAgICBbIG1ldGhvZCBdCiAgICAgICAgICoqCiAgICAgICAgICogUmV0dXJucyB4IGNvb3JkaW5hdGUgZm9yIGdpdmVuIHBvaW50IGFmdGVyIHRyYW5zZm9ybWF0aW9uIGRlc2NyaWJlZCBieSB0aGUgbWF0cml4LiBTZWUgYWxzbyBATWF0cml4LnkKICAgICAgICAgLSB4IChudW1iZXIpCiAgICAgICAgIC0geSAobnVtYmVyKQogICAgICAgICA9IChudW1iZXIpIHgKICAgICAgICBcKi8KICAgICAgICBtYXRyaXhwcm90by54ID0gZnVuY3Rpb24gKHgsIHkpIHsKICAgICAgICAgICAgcmV0dXJuIHggKiB0aGlzLmEgKyB5ICogdGhpcy5jICsgdGhpcy5lOwogICAgICAgIH07CiAgICAgICAgLypcCiAgICAgICAgICogTWF0cml4LnkKICAgICAgICAgWyBtZXRob2QgXQogICAgICAgICAqKgogICAgICAgICAqIFJldHVybnMgeSBjb29yZGluYXRlIGZvciBnaXZlbiBwb2ludCBhZnRlciB0cmFuc2Zvcm1hdGlvbiBkZXNjcmliZWQgYnkgdGhlIG1hdHJpeC4gU2VlIGFsc28gQE1hdHJpeC54CiAgICAgICAgIC0geCAobnVtYmVyKQogICAgICAgICAtIHkgKG51bWJlcikKICAgICAgICAgPSAobnVtYmVyKSB5CiAgICAgICAgXCovCiAgICAgICAgbWF0cml4cHJvdG8ueSA9IGZ1bmN0aW9uICh4LCB5KSB7CiAgICAgICAgICAgIHJldHVybiB4ICogdGhpcy5iICsgeSAqIHRoaXMuZCArIHRoaXMuZjsKICAgICAgICB9OwogICAgICAgIG1hdHJpeHByb3RvLmdldCA9IGZ1bmN0aW9uIChpKSB7CiAgICAgICAgICAgIHJldHVybiArdGhpc1tTdHIuZnJvbUNoYXJDb2RlKDk3ICsgaSldLnRvRml4ZWQoNCk7CiAgICAgICAgfTsKICAgICAgICBtYXRyaXhwcm90by50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuICJtYXRyaXgoIiArIFt0aGlzLmdldCgwKSwgdGhpcy5nZXQoMSksIHRoaXMuZ2V0KDIpLCB0aGlzLmdldCgzKSwgdGhpcy5nZXQoNCksIHRoaXMuZ2V0KDUpXS5qb2luKCkgKyAiKSI7CiAgICAgICAgfTsKICAgICAgICBtYXRyaXhwcm90by5vZmZzZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBbdGhpcy5lLnRvRml4ZWQoNCksIHRoaXMuZi50b0ZpeGVkKDQpXTsKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIG5vcm0oYSkgewogICAgICAgICAgICByZXR1cm4gYVswXSAqIGFbMF0gKyBhWzFdICogYVsxXTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbm9ybWFsaXplKGEpIHsKICAgICAgICAgICAgdmFyIG1hZyA9IG1hdGguc3FydChub3JtKGEpKTsKICAgICAgICAgICAgYVswXSAmJiAoYVswXSAvPSBtYWcpOwogICAgICAgICAgICBhWzFdICYmIChhWzFdIC89IG1hZyk7CiAgICAgICAgfQogICAgICAgIC8qXAogICAgICAgICAqIE1hdHJpeC5kZXRlcm1pbmFudAogICAgICAgICBbIG1ldGhvZCBdCiAgICAgICAgICoqCiAgICAgICAgICogRmluZHMgZGV0ZXJtaW5hbnQgb2YgdGhlIGdpdmVuIG1hdHJpeC4KICAgICAgICAgPSAobnVtYmVyKSBkZXRlcm1pbmFudAogICAgICAgIFwqLwogICAgICAgIG1hdHJpeHByb3RvLmRldGVybWluYW50ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5hICogdGhpcy5kIC0gdGhpcy5iICogdGhpcy5jOwogICAgICAgIH07CiAgICAgICAgLypcCiAgICAgICAgICogTWF0cml4LnNwbGl0CiAgICAgICAgIFsgbWV0aG9kIF0KICAgICAgICAgKioKICAgICAgICAgKiBTcGxpdHMgbWF0cml4IGludG8gcHJpbWl0aXZlIHRyYW5zZm9ybWF0aW9ucwogICAgICAgICA9IChvYmplY3QpIGluIGZvcm1hdDoKICAgICAgICAgbyBkeCAobnVtYmVyKSB0cmFuc2xhdGlvbiBieSB4CiAgICAgICAgIG8gZHkgKG51bWJlcikgdHJhbnNsYXRpb24gYnkgeQogICAgICAgICBvIHNjYWxleCAobnVtYmVyKSBzY2FsZSBieSB4CiAgICAgICAgIG8gc2NhbGV5IChudW1iZXIpIHNjYWxlIGJ5IHkKICAgICAgICAgbyBzaGVhciAobnVtYmVyKSBzaGVhcgogICAgICAgICBvIHJvdGF0ZSAobnVtYmVyKSByb3RhdGlvbiBpbiBkZWcKICAgICAgICAgbyBpc1NpbXBsZSAoYm9vbGVhbikgY291bGQgaXQgYmUgcmVwcmVzZW50ZWQgdmlhIHNpbXBsZSB0cmFuc2Zvcm1hdGlvbnMKICAgICAgICBcKi8KICAgICAgICBtYXRyaXhwcm90by5zcGxpdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIG91dCA9IHt9OwogICAgICAgICAgICAvLyB0cmFuc2xhdGlvbgogICAgICAgICAgICBvdXQuZHggPSB0aGlzLmU7CiAgICAgICAgICAgIG91dC5keSA9IHRoaXMuZjsKCiAgICAgICAgICAgIC8vIHNjYWxlIGFuZCBzaGVhcgogICAgICAgICAgICB2YXIgcm93ID0gW1t0aGlzLmEsIHRoaXMuY10sIFt0aGlzLmIsIHRoaXMuZF1dOwogICAgICAgICAgICBvdXQuc2NhbGV4ID0gbWF0aC5zcXJ0KG5vcm0ocm93WzBdKSk7CiAgICAgICAgICAgIG5vcm1hbGl6ZShyb3dbMF0pOwoKICAgICAgICAgICAgb3V0LnNoZWFyID0gcm93WzBdWzBdICogcm93WzFdWzBdICsgcm93WzBdWzFdICogcm93WzFdWzFdOwogICAgICAgICAgICByb3dbMV0gPSBbcm93WzFdWzBdIC0gcm93WzBdWzBdICogb3V0LnNoZWFyLCByb3dbMV1bMV0gLSByb3dbMF1bMV0gKiBvdXQuc2hlYXJdOwoKICAgICAgICAgICAgb3V0LnNjYWxleSA9IG1hdGguc3FydChub3JtKHJvd1sxXSkpOwogICAgICAgICAgICBub3JtYWxpemUocm93WzFdKTsKICAgICAgICAgICAgb3V0LnNoZWFyIC89IG91dC5zY2FsZXk7CgogICAgICAgICAgICBpZiAodGhpcy5kZXRlcm1pbmFudCgpIDwgMCkgewogICAgICAgICAgICAgICAgb3V0LnNjYWxleCA9IC1vdXQuc2NhbGV4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyByb3RhdGlvbgogICAgICAgICAgICB2YXIgc2luID0gLXJvd1swXVsxXSwKICAgICAgICAgICAgICAgIGNvcyA9IHJvd1sxXVsxXTsKICAgICAgICAgICAgaWYgKGNvcyA8IDApIHsKICAgICAgICAgICAgICAgIG91dC5yb3RhdGUgPSBTbmFwLmRlZyhtYXRoLmFjb3MoY29zKSk7CiAgICAgICAgICAgICAgICBpZiAoc2luIDwgMCkgewogICAgICAgICAgICAgICAgICAgIG91dC5yb3RhdGUgPSAzNjAgLSBvdXQucm90YXRlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgb3V0LnJvdGF0ZSA9IFNuYXAuZGVnKG1hdGguYXNpbihzaW4pKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgb3V0LmlzU2ltcGxlID0gIStvdXQuc2hlYXIudG9GaXhlZCg5KSAmJiAob3V0LnNjYWxleC50b0ZpeGVkKDkpID09IG91dC5zY2FsZXkudG9GaXhlZCg5KSB8fCAhb3V0LnJvdGF0ZSk7CiAgICAgICAgICAgIG91dC5pc1N1cGVyU2ltcGxlID0gIStvdXQuc2hlYXIudG9GaXhlZCg5KSAmJiBvdXQuc2NhbGV4LnRvRml4ZWQoOSkgPT0gb3V0LnNjYWxleS50b0ZpeGVkKDkpICYmICFvdXQucm90YXRlOwogICAgICAgICAgICBvdXQubm9Sb3RhdGlvbiA9ICErb3V0LnNoZWFyLnRvRml4ZWQoOSkgJiYgIW91dC5yb3RhdGU7CiAgICAgICAgICAgIHJldHVybiBvdXQ7CiAgICAgICAgfTsKICAgICAgICAvKlwKICAgICAgICAgKiBNYXRyaXgudG9UcmFuc2Zvcm1TdHJpbmcKICAgICAgICAgWyBtZXRob2QgXQogICAgICAgICAqKgogICAgICAgICAqIFJldHVybnMgdHJhbnNmb3JtIHN0cmluZyB0aGF0IHJlcHJlc2VudHMgZ2l2ZW4gbWF0cml4CiAgICAgICAgID0gKHN0cmluZykgdHJhbnNmb3JtIHN0cmluZwogICAgICAgIFwqLwogICAgICAgIG1hdHJpeHByb3RvLnRvVHJhbnNmb3JtU3RyaW5nID0gZnVuY3Rpb24gKHNob3J0ZXIpIHsKICAgICAgICAgICAgdmFyIHMgPSBzaG9ydGVyIHx8IHRoaXMuc3BsaXQoKTsKICAgICAgICAgICAgaWYgKCErcy5zaGVhci50b0ZpeGVkKDkpKSB7CiAgICAgICAgICAgICAgICBzLnNjYWxleCA9ICtzLnNjYWxleC50b0ZpeGVkKDQpOwogICAgICAgICAgICAgICAgcy5zY2FsZXkgPSArcy5zY2FsZXkudG9GaXhlZCg0KTsKICAgICAgICAgICAgICAgIHMucm90YXRlID0gK3Mucm90YXRlLnRvRml4ZWQoNCk7CiAgICAgICAgICAgICAgICByZXR1cm4gIChzLmR4IHx8IHMuZHkgPyAidCIgKyBbK3MuZHgudG9GaXhlZCg0KSwgK3MuZHkudG9GaXhlZCg0KV0gOiBFKSArIAogICAgICAgICAgICAgICAgICAgICAgICAocy5zY2FsZXggIT0gMSB8fCBzLnNjYWxleSAhPSAxID8gInMiICsgW3Muc2NhbGV4LCBzLnNjYWxleSwgMCwgMF0gOiBFKSArCiAgICAgICAgICAgICAgICAgICAgICAgIChzLnJvdGF0ZSA/ICJyIiArIFsrcy5yb3RhdGUudG9GaXhlZCg0KSwgMCwgMF0gOiBFKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAibSIgKyBbdGhpcy5nZXQoMCksIHRoaXMuZ2V0KDEpLCB0aGlzLmdldCgyKSwgdGhpcy5nZXQoMyksIHRoaXMuZ2V0KDQpLCB0aGlzLmdldCg1KV07CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfSkoTWF0cml4LnByb3RvdHlwZSk7CiAgICAvKlwKICAgICAqIFNuYXAuTWF0cml4CiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBNYXRyaXggY29uc3RydWN0b3IsIGV4dGVuZCBvbiB5b3VyIG93biByaXNrLgogICAgICogVG8gY3JlYXRlIG1hdHJpY2VzIHVzZSBAU25hcC5tYXRyaXguCiAgICBcKi8KICAgIFNuYXAuTWF0cml4ID0gTWF0cml4OwogICAgLypcCiAgICAgKiBTbmFwLm1hdHJpeAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogVXRpbGl0eSBtZXRob2QKICAgICAqKgogICAgICogUmV0dXJucyBhIG1hdHJpeCBiYXNlZCBvbiB0aGUgZ2l2ZW4gcGFyYW1ldGVycwogICAgIC0gYSAobnVtYmVyKQogICAgIC0gYiAobnVtYmVyKQogICAgIC0gYyAobnVtYmVyKQogICAgIC0gZCAobnVtYmVyKQogICAgIC0gZSAobnVtYmVyKQogICAgIC0gZiAobnVtYmVyKQogICAgICogb3IKICAgICAtIHN2Z01hdHJpeCAoU1ZHTWF0cml4KQogICAgID0gKG9iamVjdCkgQE1hdHJpeAogICAgXCovCiAgICBTbmFwLm1hdHJpeCA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlLCBmKSB7CiAgICAgICAgcmV0dXJuIG5ldyBNYXRyaXgoYSwgYiwgYywgZCwgZSwgZik7CiAgICB9Owp9KTsKLy8gQ29weXJpZ2h0IChjKSAyMDEzIEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkLiBBbGwgcmlnaHRzIHJlc2VydmVkLgovLyAKLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7Ci8vIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KLy8gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0Ci8vIAovLyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKLy8gCi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKLy8gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKLy8gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCi8vIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKLy8gbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuClNuYXAucGx1Z2luKGZ1bmN0aW9uIChTbmFwLCBFbGVtZW50LCBQYXBlciwgZ2xvYiwgRnJhZ21lbnQpIHsKICAgIHZhciBoYXMgPSAiaGFzT3duUHJvcGVydHkiLAogICAgICAgIG1ha2UgPSBTbmFwLl8ubWFrZSwKICAgICAgICB3cmFwID0gU25hcC5fLndyYXAsCiAgICAgICAgaXMgPSBTbmFwLmlzLAogICAgICAgIGdldFNvbWVEZWZzID0gU25hcC5fLmdldFNvbWVEZWZzLAogICAgICAgIHJlVVJMVmFsdWUgPSAvXnVybFwoIz8oW14pXSspXCkkLywKICAgICAgICAkID0gU25hcC5fLiQsCiAgICAgICAgVVJMID0gU25hcC51cmwsCiAgICAgICAgU3RyID0gU3RyaW5nLAogICAgICAgIHNlcGFyYXRvciA9IFNuYXAuXy5zZXBhcmF0b3IsCiAgICAgICAgRSA9ICIiOwogICAgLy8gQXR0cmlidXRlcyBldmVudCBoYW5kbGVycwogICAgZXZlLm9uKCJzbmFwLnV0aWwuYXR0ci5tYXNrIiwgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRWxlbWVudCB8fCB2YWx1ZSBpbnN0YW5jZW9mIEZyYWdtZW50KSB7CiAgICAgICAgICAgIGV2ZS5zdG9wKCk7CiAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEZyYWdtZW50ICYmIHZhbHVlLm5vZGUuY2hpbGROb2Rlcy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5ub2RlLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICBnZXRTb21lRGVmcyh0aGlzKS5hcHBlbmRDaGlsZCh2YWx1ZSk7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IHdyYXAodmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh2YWx1ZS50eXBlID09ICJtYXNrIikgewogICAgICAgICAgICAgICAgdmFyIG1hc2sgPSB2YWx1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1hc2sgPSBtYWtlKCJtYXNrIiwgZ2V0U29tZURlZnModGhpcykpOwogICAgICAgICAgICAgICAgbWFzay5ub2RlLmFwcGVuZENoaWxkKHZhbHVlLm5vZGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICFtYXNrLm5vZGUuaWQgJiYgJChtYXNrLm5vZGUsIHsKICAgICAgICAgICAgICAgIGlkOiBtYXNrLmlkCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkKHRoaXMubm9kZSwgewogICAgICAgICAgICAgICAgbWFzazogVVJMKG1hc2suaWQpCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwogICAgKGZ1bmN0aW9uIChjbGlwSXQpIHsKICAgICAgICBldmUub24oInNuYXAudXRpbC5hdHRyLmNsaXAiLCBjbGlwSXQpOwogICAgICAgIGV2ZS5vbigic25hcC51dGlsLmF0dHIuY2xpcC1wYXRoIiwgY2xpcEl0KTsKICAgICAgICBldmUub24oInNuYXAudXRpbC5hdHRyLmNsaXBQYXRoIiwgY2xpcEl0KTsKICAgIH0oZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRWxlbWVudCB8fCB2YWx1ZSBpbnN0YW5jZW9mIEZyYWdtZW50KSB7CiAgICAgICAgICAgIGV2ZS5zdG9wKCk7CiAgICAgICAgICAgIGlmICh2YWx1ZS50eXBlID09ICJjbGlwUGF0aCIpIHsKICAgICAgICAgICAgICAgIHZhciBjbGlwID0gdmFsdWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjbGlwID0gbWFrZSgiY2xpcFBhdGgiLCBnZXRTb21lRGVmcyh0aGlzKSk7CiAgICAgICAgICAgICAgICBjbGlwLm5vZGUuYXBwZW5kQ2hpbGQodmFsdWUubm9kZSk7CiAgICAgICAgICAgICAgICAhY2xpcC5ub2RlLmlkICYmICQoY2xpcC5ub2RlLCB7CiAgICAgICAgICAgICAgICAgICAgaWQ6IGNsaXAuaWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgICQodGhpcy5ub2RlLCB7CiAgICAgICAgICAgICAgICAiY2xpcC1wYXRoIjogVVJMKGNsaXAuaWQpCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pKTsKICAgIGZ1bmN0aW9uIGZpbGxTdHJva2UobmFtZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgZXZlLnN0b3AoKTsKICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRnJhZ21lbnQgJiYgdmFsdWUubm9kZS5jaGlsZE5vZGVzLmxlbmd0aCA9PSAxICYmCiAgICAgICAgICAgICAgICAodmFsdWUubm9kZS5maXJzdENoaWxkLnRhZ05hbWUgPT0gInJhZGlhbEdyYWRpZW50IiB8fAogICAgICAgICAgICAgICAgdmFsdWUubm9kZS5maXJzdENoaWxkLnRhZ05hbWUgPT0gImxpbmVhckdyYWRpZW50IiB8fAogICAgICAgICAgICAgICAgdmFsdWUubm9kZS5maXJzdENoaWxkLnRhZ05hbWUgPT0gInBhdHRlcm4iKSkgewogICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5ub2RlLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICBnZXRTb21lRGVmcyh0aGlzKS5hcHBlbmRDaGlsZCh2YWx1ZSk7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IHdyYXAodmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50eXBlID09ICJyYWRpYWxHcmFkaWVudCIgfHwgdmFsdWUudHlwZSA9PSAibGluZWFyR3JhZGllbnQiCiAgICAgICAgICAgICAgICAgICB8fCB2YWx1ZS50eXBlID09ICJwYXR0ZXJuIikgewogICAgICAgICAgICAgICAgICAgIGlmICghdmFsdWUubm9kZS5pZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkKHZhbHVlLm5vZGUsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB2YWx1ZS5pZAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGwgPSBVUkwodmFsdWUubm9kZS5pZCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGZpbGwgPSB2YWx1ZS5hdHRyKG5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZmlsbCA9IFNuYXAuY29sb3IodmFsdWUpOwogICAgICAgICAgICAgICAgaWYgKGZpbGwuZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZ3JhZCA9IFNuYXAoZ2V0U29tZURlZnModGhpcykub3duZXJTVkdFbGVtZW50KS5ncmFkaWVudCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGdyYWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFncmFkLm5vZGUuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoZ3JhZC5ub2RlLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGdyYWQuaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGwgPSBVUkwoZ3JhZC5ub2RlLmlkKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBmaWxsID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBmaWxsID0gU3RyKGZpbGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBhdHRycyA9IHt9OwogICAgICAgICAgICBhdHRyc1tuYW1lXSA9IGZpbGw7CiAgICAgICAgICAgICQodGhpcy5ub2RlLCBhdHRycyk7CiAgICAgICAgICAgIHRoaXMubm9kZS5zdHlsZVtuYW1lXSA9IEU7CiAgICAgICAgfTsKICAgIH0KICAgIGV2ZS5vbigic25hcC51dGlsLmF0dHIuZmlsbCIsIGZpbGxTdHJva2UoImZpbGwiKSk7CiAgICBldmUub24oInNuYXAudXRpbC5hdHRyLnN0cm9rZSIsIGZpbGxTdHJva2UoInN0cm9rZSIpKTsKICAgIHZhciBncmFkcmcgPSAvXihbbHJdKSg/OlwoKFteKV0qKVwpKT8oLiopJC9pOwogICAgZXZlLm9uKCJzbmFwLnV0aWwuZ3JhZC5wYXJzZSIsIGZ1bmN0aW9uIHBhcnNlR3JhZChzdHJpbmcpIHsKICAgICAgICBzdHJpbmcgPSBTdHIoc3RyaW5nKTsKICAgICAgICB2YXIgdG9rZW5zID0gc3RyaW5nLm1hdGNoKGdyYWRyZyk7CiAgICAgICAgaWYgKCF0b2tlbnMpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHZhciB0eXBlID0gdG9rZW5zWzFdLAogICAgICAgICAgICBwYXJhbXMgPSB0b2tlbnNbMl0sCiAgICAgICAgICAgIHN0b3BzID0gdG9rZW5zWzNdOwogICAgICAgIHBhcmFtcyA9IHBhcmFtcy5zcGxpdCgvXHMqLFxzKi8pLm1hcChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgcmV0dXJuICtlbCA9PSBlbCA/ICtlbCA6IGVsOwogICAgICAgIH0pOwogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDEgJiYgcGFyYW1zWzBdID09IDApIHsKICAgICAgICAgICAgcGFyYW1zID0gW107CiAgICAgICAgfQogICAgICAgIHN0b3BzID0gc3RvcHMuc3BsaXQoIi0iKTsKICAgICAgICBzdG9wcyA9IHN0b3BzLm1hcChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgZWwgPSBlbC5zcGxpdCgiOiIpOwogICAgICAgICAgICB2YXIgb3V0ID0gewogICAgICAgICAgICAgICAgY29sb3I6IGVsWzBdCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChlbFsxXSkgewogICAgICAgICAgICAgICAgb3V0Lm9mZnNldCA9IHBhcnNlRmxvYXQoZWxbMV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvdXQ7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMsCiAgICAgICAgICAgIHN0b3BzOiBzdG9wcwogICAgICAgIH07CiAgICB9KTsKCiAgICBldmUub24oInNuYXAudXRpbC5hdHRyLmQiLCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICBldmUuc3RvcCgpOwogICAgICAgIGlmIChpcyh2YWx1ZSwgImFycmF5IikgJiYgaXModmFsdWVbMF0sICJhcnJheSIpKSB7CiAgICAgICAgICAgIHZhbHVlID0gU25hcC5wYXRoLnRvU3RyaW5nLmNhbGwodmFsdWUpOwogICAgICAgIH0KICAgICAgICB2YWx1ZSA9IFN0cih2YWx1ZSk7CiAgICAgICAgaWYgKHZhbHVlLm1hdGNoKC9bcnVvXS9pKSkgewogICAgICAgICAgICB2YWx1ZSA9IFNuYXAucGF0aC50b0Fic29sdXRlKHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgJCh0aGlzLm5vZGUsIHtkOiB2YWx1ZX0pOwogICAgfSkoLTEpOwogICAgZXZlLm9uKCJzbmFwLnV0aWwuYXR0ci4jdGV4dCIsIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIGV2ZS5zdG9wKCk7CiAgICAgICAgdmFsdWUgPSBTdHIodmFsdWUpOwogICAgICAgIHZhciB0eHQgPSBnbG9iLmRvYy5jcmVhdGVUZXh0Tm9kZSh2YWx1ZSk7CiAgICAgICAgd2hpbGUgKHRoaXMubm9kZS5maXJzdENoaWxkKSB7CiAgICAgICAgICAgIHRoaXMubm9kZS5yZW1vdmVDaGlsZCh0aGlzLm5vZGUuZmlyc3RDaGlsZCk7CiAgICAgICAgfQogICAgICAgIHRoaXMubm9kZS5hcHBlbmRDaGlsZCh0eHQpOwogICAgfSkoLTEpOwogICAgZXZlLm9uKCJzbmFwLnV0aWwuYXR0ci5wYXRoIiwgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgZXZlLnN0b3AoKTsKICAgICAgICB0aGlzLmF0dHIoe2Q6IHZhbHVlfSk7CiAgICB9KSgtMSk7CiAgICBldmUub24oInNuYXAudXRpbC5hdHRyLmNsYXNzIiwgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgZXZlLnN0b3AoKTsKICAgICAgICB0aGlzLm5vZGUuY2xhc3NOYW1lLmJhc2VWYWwgPSB2YWx1ZTsKICAgIH0pKC0xKTsKICAgIGV2ZS5vbigic25hcC51dGlsLmF0dHIudmlld0JveCIsIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIHZhciB2YjsKICAgICAgICBpZiAoaXModmFsdWUsICJvYmplY3QiKSAmJiAieCIgaW4gdmFsdWUpIHsKICAgICAgICAgICAgdmIgPSBbdmFsdWUueCwgdmFsdWUueSwgdmFsdWUud2lkdGgsIHZhbHVlLmhlaWdodF0uam9pbigiICIpOwogICAgICAgIH0gZWxzZSBpZiAoaXModmFsdWUsICJhcnJheSIpKSB7CiAgICAgICAgICAgIHZiID0gdmFsdWUuam9pbigiICIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZiID0gdmFsdWU7CiAgICAgICAgfQogICAgICAgICQodGhpcy5ub2RlLCB7CiAgICAgICAgICAgIHZpZXdCb3g6IHZiCiAgICAgICAgfSk7CiAgICAgICAgZXZlLnN0b3AoKTsKICAgIH0pKC0xKTsKICAgIGV2ZS5vbigic25hcC51dGlsLmF0dHIudHJhbnNmb3JtIiwgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgdGhpcy50cmFuc2Zvcm0odmFsdWUpOwogICAgICAgIGV2ZS5zdG9wKCk7CiAgICB9KSgtMSk7CiAgICBldmUub24oInNuYXAudXRpbC5hdHRyLnIiLCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICBpZiAodGhpcy50eXBlID09ICJyZWN0IikgewogICAgICAgICAgICBldmUuc3RvcCgpOwogICAgICAgICAgICAkKHRoaXMubm9kZSwgewogICAgICAgICAgICAgICAgcng6IHZhbHVlLAogICAgICAgICAgICAgICAgcnk6IHZhbHVlCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pKC0xKTsKICAgIGV2ZS5vbigic25hcC51dGlsLmF0dHIudGV4dHBhdGgiLCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICBldmUuc3RvcCgpOwogICAgICAgIGlmICh0aGlzLnR5cGUgPT0gInRleHQiKSB7CiAgICAgICAgICAgIHZhciBpZCwgdHAsIG5vZGU7CiAgICAgICAgICAgIGlmICghdmFsdWUgJiYgdGhpcy50ZXh0UGF0aCkgewogICAgICAgICAgICAgICAgdHAgPSB0aGlzLnRleHRQYXRoOwogICAgICAgICAgICAgICAgd2hpbGUgKHRwLm5vZGUuZmlyc3RDaGlsZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZS5hcHBlbmRDaGlsZCh0cC5ub2RlLmZpcnN0Q2hpbGQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdHAucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy50ZXh0UGF0aDsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaXModmFsdWUsICJzdHJpbmciKSkgewogICAgICAgICAgICAgICAgdmFyIGRlZnMgPSBnZXRTb21lRGVmcyh0aGlzKSwKICAgICAgICAgICAgICAgICAgICBwYXRoID0gd3JhcChkZWZzLnBhcmVudE5vZGUpLnBhdGgodmFsdWUpOwogICAgICAgICAgICAgICAgZGVmcy5hcHBlbmRDaGlsZChwYXRoLm5vZGUpOwogICAgICAgICAgICAgICAgaWQgPSBwYXRoLmlkOwogICAgICAgICAgICAgICAgcGF0aC5hdHRyKHtpZDogaWR9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhbHVlID0gd3JhcCh2YWx1ZSk7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBFbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgaWQgPSB2YWx1ZS5hdHRyKCJpZCIpOwogICAgICAgICAgICAgICAgICAgIGlmICghaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSB2YWx1ZS5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUuYXR0cih7aWQ6IGlkfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpZCkgewogICAgICAgICAgICAgICAgdHAgPSB0aGlzLnRleHRQYXRoOwogICAgICAgICAgICAgICAgbm9kZSA9IHRoaXMubm9kZTsKICAgICAgICAgICAgICAgIGlmICh0cCkgewogICAgICAgICAgICAgICAgICAgIHRwLmF0dHIoeyJ4bGluazpocmVmIjogIiMiICsgaWR9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdHAgPSAkKCJ0ZXh0UGF0aCIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgInhsaW5rOmhyZWYiOiAiIyIgKyBpZAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChub2RlLmZpcnN0Q2hpbGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHAuYXBwZW5kQ2hpbGQobm9kZS5maXJzdENoaWxkKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbm9kZS5hcHBlbmRDaGlsZCh0cCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXh0UGF0aCA9IHdyYXAodHApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSkoLTEpOwogICAgZXZlLm9uKCJzbmFwLnV0aWwuYXR0ci50ZXh0IiwgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgaWYgKHRoaXMudHlwZSA9PSAidGV4dCIpIHsKICAgICAgICAgICAgdmFyIGkgPSAwLAogICAgICAgICAgICAgICAgbm9kZSA9IHRoaXMubm9kZSwKICAgICAgICAgICAgICAgIHR1bmVyID0gZnVuY3Rpb24gKGNodW5rKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG91dCA9ICQoInRzcGFuIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzKGNodW5rLCAiYXJyYXkiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNodW5rLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXQuYXBwZW5kQ2hpbGQodHVuZXIoY2h1bmtbaV0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG91dC5hcHBlbmRDaGlsZChnbG9iLmRvYy5jcmVhdGVUZXh0Tm9kZShjaHVuaykpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBvdXQubm9ybWFsaXplICYmIG91dC5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3V0OwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgd2hpbGUgKG5vZGUuZmlyc3RDaGlsZCkgewogICAgICAgICAgICAgICAgbm9kZS5yZW1vdmVDaGlsZChub2RlLmZpcnN0Q2hpbGQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB0dW5lZCA9IHR1bmVyKHZhbHVlKTsKICAgICAgICAgICAgd2hpbGUgKHR1bmVkLmZpcnN0Q2hpbGQpIHsKICAgICAgICAgICAgICAgIG5vZGUuYXBwZW5kQ2hpbGQodHVuZWQuZmlyc3RDaGlsZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZXZlLnN0b3AoKTsKICAgIH0pKC0xKTsKICAgIGZ1bmN0aW9uIHNldEZvbnRTaXplKHZhbHVlKSB7CiAgICAgICAgZXZlLnN0b3AoKTsKICAgICAgICBpZiAodmFsdWUgPT0gK3ZhbHVlKSB7CiAgICAgICAgICAgIHZhbHVlICs9ICJweCI7CiAgICAgICAgfQogICAgICAgIHRoaXMubm9kZS5zdHlsZS5mb250U2l6ZSA9IHZhbHVlOwogICAgfQogICAgZXZlLm9uKCJzbmFwLnV0aWwuYXR0ci5mb250U2l6ZSIsIHNldEZvbnRTaXplKSgtMSk7CiAgICBldmUub24oInNuYXAudXRpbC5hdHRyLmZvbnQtc2l6ZSIsIHNldEZvbnRTaXplKSgtMSk7CgoKICAgIGV2ZS5vbigic25hcC51dGlsLmdldGF0dHIudHJhbnNmb3JtIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGV2ZS5zdG9wKCk7CiAgICAgICAgcmV0dXJuIHRoaXMudHJhbnNmb3JtKCk7CiAgICB9KSgtMSk7CiAgICBldmUub24oInNuYXAudXRpbC5nZXRhdHRyLnRleHRwYXRoIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGV2ZS5zdG9wKCk7CiAgICAgICAgcmV0dXJuIHRoaXMudGV4dFBhdGg7CiAgICB9KSgtMSk7CiAgICAvLyBNYXJrZXJzCiAgICAoZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIGdldHRlcihlbmQpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGV2ZS5zdG9wKCk7CiAgICAgICAgICAgICAgICB2YXIgc3R5bGUgPSBnbG9iLmRvYy5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKHRoaXMubm9kZSwgbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZSgibWFya2VyLSIgKyBlbmQpOwogICAgICAgICAgICAgICAgaWYgKHN0eWxlID09ICJub25lIikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdHlsZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNuYXAoZ2xvYi5kb2MuZ2V0RWxlbWVudEJ5SWQoc3R5bGUubWF0Y2gocmVVUkxWYWx1ZSlbMV0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc2V0dGVyKGVuZCkgewogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBldmUuc3RvcCgpOwogICAgICAgICAgICAgICAgdmFyIG5hbWUgPSAibWFya2VyIiArIGVuZC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGVuZC5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gIiIgfHwgIXZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub2RlLnN0eWxlW25hbWVdID0gIm5vbmUiOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZS50eXBlID09ICJtYXJrZXIiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gdmFsdWUubm9kZS5pZDsKICAgICAgICAgICAgICAgICAgICBpZiAoIWlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQodmFsdWUubm9kZSwge2lkOiB2YWx1ZS5pZH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLm5vZGUuc3R5bGVbbmFtZV0gPSBVUkwoaWQpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZXZlLm9uKCJzbmFwLnV0aWwuZ2V0YXR0ci5tYXJrZXItZW5kIiwgZ2V0dGVyKCJlbmQiKSkoLTEpOwogICAgICAgIGV2ZS5vbigic25hcC51dGlsLmdldGF0dHIubWFya2VyRW5kIiwgZ2V0dGVyKCJlbmQiKSkoLTEpOwogICAgICAgIGV2ZS5vbigic25hcC51dGlsLmdldGF0dHIubWFya2VyLXN0YXJ0IiwgZ2V0dGVyKCJzdGFydCIpKSgtMSk7CiAgICAgICAgZXZlLm9uKCJzbmFwLnV0aWwuZ2V0YXR0ci5tYXJrZXJTdGFydCIsIGdldHRlcigic3RhcnQiKSkoLTEpOwogICAgICAgIGV2ZS5vbigic25hcC51dGlsLmdldGF0dHIubWFya2VyLW1pZCIsIGdldHRlcigibWlkIikpKC0xKTsKICAgICAgICBldmUub24oInNuYXAudXRpbC5nZXRhdHRyLm1hcmtlck1pZCIsIGdldHRlcigibWlkIikpKC0xKTsKICAgICAgICBldmUub24oInNuYXAudXRpbC5hdHRyLm1hcmtlci1lbmQiLCBzZXR0ZXIoImVuZCIpKSgtMSk7CiAgICAgICAgZXZlLm9uKCJzbmFwLnV0aWwuYXR0ci5tYXJrZXJFbmQiLCBzZXR0ZXIoImVuZCIpKSgtMSk7CiAgICAgICAgZXZlLm9uKCJzbmFwLnV0aWwuYXR0ci5tYXJrZXItc3RhcnQiLCBzZXR0ZXIoInN0YXJ0IikpKC0xKTsKICAgICAgICBldmUub24oInNuYXAudXRpbC5hdHRyLm1hcmtlclN0YXJ0Iiwgc2V0dGVyKCJzdGFydCIpKSgtMSk7CiAgICAgICAgZXZlLm9uKCJzbmFwLnV0aWwuYXR0ci5tYXJrZXItbWlkIiwgc2V0dGVyKCJtaWQiKSkoLTEpOwogICAgICAgIGV2ZS5vbigic25hcC51dGlsLmF0dHIubWFya2VyTWlkIiwgc2V0dGVyKCJtaWQiKSkoLTEpOwogICAgfSgpKTsKICAgIGV2ZS5vbigic25hcC51dGlsLmdldGF0dHIuciIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodGhpcy50eXBlID09ICJyZWN0IiAmJiAkKHRoaXMubm9kZSwgInJ4IikgPT0gJCh0aGlzLm5vZGUsICJyeSIpKSB7CiAgICAgICAgICAgIGV2ZS5zdG9wKCk7CiAgICAgICAgICAgIHJldHVybiAkKHRoaXMubm9kZSwgInJ4Iik7CiAgICAgICAgfQogICAgfSkoLTEpOwogICAgZnVuY3Rpb24gdGV4dEV4dHJhY3Qobm9kZSkgewogICAgICAgIHZhciBvdXQgPSBbXTsKICAgICAgICB2YXIgY2hpbGRyZW4gPSBub2RlLmNoaWxkTm9kZXM7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICB2YXIgY2hpID0gY2hpbGRyZW5baV07CiAgICAgICAgICAgIGlmIChjaGkubm9kZVR5cGUgPT0gMykgewogICAgICAgICAgICAgICAgb3V0LnB1c2goY2hpLm5vZGVWYWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNoaS50YWdOYW1lID09ICJ0c3BhbiIpIHsKICAgICAgICAgICAgICAgIGlmIChjaGkuY2hpbGROb2Rlcy5sZW5ndGggPT0gMSAmJiBjaGkuZmlyc3RDaGlsZC5ub2RlVHlwZSA9PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgb3V0LnB1c2goY2hpLmZpcnN0Q2hpbGQubm9kZVZhbHVlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb3V0LnB1c2godGV4dEV4dHJhY3QoY2hpKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIGV2ZS5vbigic25hcC51dGlsLmdldGF0dHIudGV4dCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodGhpcy50eXBlID09ICJ0ZXh0IiB8fCB0aGlzLnR5cGUgPT0gInRzcGFuIikgewogICAgICAgICAgICBldmUuc3RvcCgpOwogICAgICAgICAgICB2YXIgb3V0ID0gdGV4dEV4dHJhY3QodGhpcy5ub2RlKTsKICAgICAgICAgICAgcmV0dXJuIG91dC5sZW5ndGggPT0gMSA/IG91dFswXSA6IG91dDsKICAgICAgICB9CiAgICB9KSgtMSk7CiAgICBldmUub24oInNuYXAudXRpbC5nZXRhdHRyLiN0ZXh0IiwgZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLm5vZGUudGV4dENvbnRlbnQ7CiAgICB9KSgtMSk7CiAgICBldmUub24oInNuYXAudXRpbC5nZXRhdHRyLnZpZXdCb3giLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgZXZlLnN0b3AoKTsKICAgICAgICB2YXIgdmIgPSAkKHRoaXMubm9kZSwgInZpZXdCb3giKTsKICAgICAgICBpZiAodmIpIHsKICAgICAgICAgICAgdmIgPSB2Yi5zcGxpdChzZXBhcmF0b3IpOwogICAgICAgICAgICByZXR1cm4gU25hcC5fLmJveCgrdmJbMF0sICt2YlsxXSwgK3ZiWzJdLCArdmJbM10pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9KSgtMSk7CiAgICBldmUub24oInNuYXAudXRpbC5nZXRhdHRyLnBvaW50cyIsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcCA9ICQodGhpcy5ub2RlLCAicG9pbnRzIik7CiAgICAgICAgZXZlLnN0b3AoKTsKICAgICAgICBpZiAocCkgewogICAgICAgICAgICByZXR1cm4gcC5zcGxpdChzZXBhcmF0b3IpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9KSgtMSk7CiAgICBldmUub24oInNuYXAudXRpbC5nZXRhdHRyLnBhdGgiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHAgPSAkKHRoaXMubm9kZSwgImQiKTsKICAgICAgICBldmUuc3RvcCgpOwogICAgICAgIHJldHVybiBwOwogICAgfSkoLTEpOwogICAgZXZlLm9uKCJzbmFwLnV0aWwuZ2V0YXR0ci5jbGFzcyIsIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ub2RlLmNsYXNzTmFtZS5iYXNlVmFsOwogICAgfSkoLTEpOwogICAgZnVuY3Rpb24gZ2V0Rm9udFNpemUoKSB7CiAgICAgICAgZXZlLnN0b3AoKTsKICAgICAgICByZXR1cm4gdGhpcy5ub2RlLnN0eWxlLmZvbnRTaXplOwogICAgfQogICAgZXZlLm9uKCJzbmFwLnV0aWwuZ2V0YXR0ci5mb250U2l6ZSIsIGdldEZvbnRTaXplKSgtMSk7CiAgICBldmUub24oInNuYXAudXRpbC5nZXRhdHRyLmZvbnQtc2l6ZSIsIGdldEZvbnRTaXplKSgtMSk7Cn0pOwovLyBDb3B5cmlnaHQgKGMpIDIwMTMgQWRvYmUgU3lzdGVtcyBJbmNvcnBvcmF0ZWQuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCi8vIAovLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKLy8geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgovLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKLy8gCi8vIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAovLyAKLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQovLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAovLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KLy8gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAovLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KU25hcC5wbHVnaW4oZnVuY3Rpb24gKFNuYXAsIEVsZW1lbnQsIFBhcGVyLCBnbG9iLCBGcmFnbWVudCkgewogICAgdmFyIG9wZXJhdG9ycyA9IHsKICAgICAgICAgICAgIisiOiBmdW5jdGlvbiAoeCwgeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB4ICsgeTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICItIjogZnVuY3Rpb24gKHgsIHkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4geCAtIHk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAiLyI6IGZ1bmN0aW9uICh4LCB5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHggLyB5OwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgIioiOiBmdW5jdGlvbiAoeCwgeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB4ICogeTsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIFN0ciA9IFN0cmluZywKICAgICAgICByZVVuaXQgPSAvW2Etel0rJC9pLAogICAgICAgIHJlQWRkb24gPSAvXlxzKihbK1wtXC8qXSlccyo9XHMqKFtcZC5lRStcLV0rKVxzKihbXlxkXHNdKyk/XHMqJC87CiAgICBmdW5jdGlvbiBnZXROdW1iZXIodmFsKSB7CiAgICAgICAgcmV0dXJuIHZhbDsKICAgIH0KICAgIGZ1bmN0aW9uIGdldFVuaXQodW5pdCkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgICAgIHJldHVybiArdmFsLnRvRml4ZWQoMykgKyB1bml0OwogICAgICAgIH07CiAgICB9CiAgICBldmUub24oInNuYXAudXRpbC5hdHRyIiwgZnVuY3Rpb24gKHZhbCkgewogICAgICAgIHZhciBwbHVzID0gU3RyKHZhbCkubWF0Y2gocmVBZGRvbik7CiAgICAgICAgaWYgKHBsdXMpIHsKICAgICAgICAgICAgdmFyIGV2bnQgPSBldmUubnQoKSwKICAgICAgICAgICAgICAgIG5hbWUgPSBldm50LnN1YnN0cmluZyhldm50Lmxhc3RJbmRleE9mKCIuIikgKyAxKSwKICAgICAgICAgICAgICAgIGEgPSB0aGlzLmF0dHIobmFtZSksCiAgICAgICAgICAgICAgICBhdHIgPSB7fTsKICAgICAgICAgICAgZXZlLnN0b3AoKTsKICAgICAgICAgICAgdmFyIHVuaXQgPSBwbHVzWzNdIHx8ICIiLAogICAgICAgICAgICAgICAgYVVuaXQgPSBhLm1hdGNoKHJlVW5pdCksCiAgICAgICAgICAgICAgICBvcCA9IG9wZXJhdG9yc1twbHVzWzFdXTsKICAgICAgICAgICAgaWYgKGFVbml0ICYmIGFVbml0ID09IHVuaXQpIHsKICAgICAgICAgICAgICAgIHZhbCA9IG9wKHBhcnNlRmxvYXQoYSksICtwbHVzWzJdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGEgPSB0aGlzLmFzUFgobmFtZSk7CiAgICAgICAgICAgICAgICB2YWwgPSBvcCh0aGlzLmFzUFgobmFtZSksIHRoaXMuYXNQWChuYW1lLCBwbHVzWzJdICsgdW5pdCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc05hTihhKSB8fCBpc05hTih2YWwpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXRyW25hbWVdID0gdmFsOwogICAgICAgICAgICB0aGlzLmF0dHIoYXRyKTsKICAgICAgICB9CiAgICB9KSgtMTApOwogICAgZXZlLm9uKCJzbmFwLnV0aWwuZXF1YWwiLCBmdW5jdGlvbiAobmFtZSwgYikgewogICAgICAgIHZhciBBLCBCLCBhID0gU3RyKHRoaXMuYXR0cihuYW1lKSB8fCAiIiksCiAgICAgICAgICAgIGVsID0gdGhpcywKICAgICAgICAgICAgYnBsdXMgPSBTdHIoYikubWF0Y2gocmVBZGRvbik7CiAgICAgICAgaWYgKGJwbHVzKSB7CiAgICAgICAgICAgIGV2ZS5zdG9wKCk7CiAgICAgICAgICAgIHZhciB1bml0ID0gYnBsdXNbM10gfHwgIiIsCiAgICAgICAgICAgICAgICBhVW5pdCA9IGEubWF0Y2gocmVVbml0KSwKICAgICAgICAgICAgICAgIG9wID0gb3BlcmF0b3JzW2JwbHVzWzFdXTsKICAgICAgICAgICAgaWYgKGFVbml0ICYmIGFVbml0ID09IHVuaXQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgZnJvbTogcGFyc2VGbG9hdChhKSwKICAgICAgICAgICAgICAgICAgICB0bzogb3AocGFyc2VGbG9hdChhKSwgK2JwbHVzWzJdKSwKICAgICAgICAgICAgICAgICAgICBmOiBnZXRVbml0KGFVbml0KQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGEgPSB0aGlzLmFzUFgobmFtZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGZyb206IGEsCiAgICAgICAgICAgICAgICAgICAgdG86IG9wKGEsIHRoaXMuYXNQWChuYW1lLCBicGx1c1syXSArIHVuaXQpKSwKICAgICAgICAgICAgICAgICAgICBmOiBnZXROdW1iZXIKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KSgtMTApOwp9KTsKLy8gQ29weXJpZ2h0IChjKSAyMDEzIEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkLiBBbGwgcmlnaHRzIHJlc2VydmVkLgovLyAKLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7Ci8vIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KLy8gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0Ci8vIAovLyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKLy8gCi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKLy8gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKLy8gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCi8vIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKLy8gbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuClNuYXAucGx1Z2luKGZ1bmN0aW9uIChTbmFwLCBFbGVtZW50LCBQYXBlciwgZ2xvYiwgRnJhZ21lbnQpIHsKICAgIHZhciBwcm90byA9IFBhcGVyLnByb3RvdHlwZSwKICAgICAgICBpcyA9IFNuYXAuaXM7CiAgICAvKlwKICAgICAqIFBhcGVyLnJlY3QKICAgICBbIG1ldGhvZCBdCiAgICAgKgogICAgICogRHJhd3MgYSByZWN0YW5nbGUKICAgICAqKgogICAgIC0geCAobnVtYmVyKSB4IGNvb3JkaW5hdGUgb2YgdGhlIHRvcCBsZWZ0IGNvcm5lcgogICAgIC0geSAobnVtYmVyKSB5IGNvb3JkaW5hdGUgb2YgdGhlIHRvcCBsZWZ0IGNvcm5lcgogICAgIC0gd2lkdGggKG51bWJlcikgd2lkdGgKICAgICAtIGhlaWdodCAobnVtYmVyKSBoZWlnaHQKICAgICAtIHJ4IChudW1iZXIpICNvcHRpb25hbCBob3Jpem9udGFsIHJhZGl1cyBmb3Igcm91bmRlZCBjb3JuZXJzLCBkZWZhdWx0IGlzIDAKICAgICAtIHJ5IChudW1iZXIpICNvcHRpb25hbCB2ZXJ0aWNhbCByYWRpdXMgZm9yIHJvdW5kZWQgY29ybmVycywgZGVmYXVsdCBpcyByeCBvciAwCiAgICAgPSAob2JqZWN0KSB0aGUgYHJlY3RgIGVsZW1lbnQKICAgICAqKgogICAgID4gVXNhZ2UKICAgICB8IC8vIHJlZ3VsYXIgcmVjdGFuZ2xlCiAgICAgfCB2YXIgYyA9IHBhcGVyLnJlY3QoMTAsIDEwLCA1MCwgNTApOwogICAgIHwgLy8gcmVjdGFuZ2xlIHdpdGggcm91bmRlZCBjb3JuZXJzCiAgICAgfCB2YXIgYyA9IHBhcGVyLnJlY3QoNDAsIDQwLCA1MCwgNTAsIDEwKTsKICAgIFwqLwogICAgcHJvdG8ucmVjdCA9IGZ1bmN0aW9uICh4LCB5LCB3LCBoLCByeCwgcnkpIHsKICAgICAgICB2YXIgYXR0cjsKICAgICAgICBpZiAocnkgPT0gbnVsbCkgewogICAgICAgICAgICByeSA9IHJ4OwogICAgICAgIH0KICAgICAgICBpZiAoaXMoeCwgIm9iamVjdCIpICYmIHggPT0gIltvYmplY3QgT2JqZWN0XSIpIHsKICAgICAgICAgICAgYXR0ciA9IHg7CiAgICAgICAgfSBlbHNlIGlmICh4ICE9IG51bGwpIHsKICAgICAgICAgICAgYXR0ciA9IHsKICAgICAgICAgICAgICAgIHg6IHgsCiAgICAgICAgICAgICAgICB5OiB5LAogICAgICAgICAgICAgICAgd2lkdGg6IHcsCiAgICAgICAgICAgICAgICBoZWlnaHQ6IGgKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKHJ4ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGF0dHIucnggPSByeDsKICAgICAgICAgICAgICAgIGF0dHIucnkgPSByeTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5lbCgicmVjdCIsIGF0dHIpOwogICAgfTsKICAgIC8qXAogICAgICogUGFwZXIuY2lyY2xlCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBEcmF3cyBhIGNpcmNsZQogICAgICoqCiAgICAgLSB4IChudW1iZXIpIHggY29vcmRpbmF0ZSBvZiB0aGUgY2VudHJlCiAgICAgLSB5IChudW1iZXIpIHkgY29vcmRpbmF0ZSBvZiB0aGUgY2VudHJlCiAgICAgLSByIChudW1iZXIpIHJhZGl1cwogICAgID0gKG9iamVjdCkgdGhlIGBjaXJjbGVgIGVsZW1lbnQKICAgICAqKgogICAgID4gVXNhZ2UKICAgICB8IHZhciBjID0gcGFwZXIuY2lyY2xlKDUwLCA1MCwgNDApOwogICAgXCovCiAgICBwcm90by5jaXJjbGUgPSBmdW5jdGlvbiAoY3gsIGN5LCByKSB7CiAgICAgICAgdmFyIGF0dHI7CiAgICAgICAgaWYgKGlzKGN4LCAib2JqZWN0IikgJiYgY3ggPT0gIltvYmplY3QgT2JqZWN0XSIpIHsKICAgICAgICAgICAgYXR0ciA9IGN4OwogICAgICAgIH0gZWxzZSBpZiAoY3ggIT0gbnVsbCkgewogICAgICAgICAgICBhdHRyID0gewogICAgICAgICAgICAgICAgY3g6IGN4LAogICAgICAgICAgICAgICAgY3k6IGN5LAogICAgICAgICAgICAgICAgcjogcgogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5lbCgiY2lyY2xlIiwgYXR0cik7CiAgICB9OwoKICAgIHZhciBwcmVsb2FkID0gKGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBvbmVycm9yKCkgewogICAgICAgICAgICB0aGlzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmdW5jdGlvbiAoc3JjLCBmKSB7CiAgICAgICAgICAgIHZhciBpbWcgPSBnbG9iLmRvYy5jcmVhdGVFbGVtZW50KCJpbWciKSwKICAgICAgICAgICAgICAgIGJvZHkgPSBnbG9iLmRvYy5ib2R5OwogICAgICAgICAgICBpbWcuc3R5bGUuY3NzVGV4dCA9ICJwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0Oi05OTk5ZW07dG9wOi05OTk5ZW0iOwogICAgICAgICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgZi5jYWxsKGltZyk7CiAgICAgICAgICAgICAgICBpbWcub25sb2FkID0gaW1nLm9uZXJyb3IgPSBudWxsOwogICAgICAgICAgICAgICAgYm9keS5yZW1vdmVDaGlsZChpbWcpOwogICAgICAgICAgICB9OwogICAgICAgICAgICBpbWcub25lcnJvciA9IG9uZXJyb3I7CiAgICAgICAgICAgIGJvZHkuYXBwZW5kQ2hpbGQoaW1nKTsKICAgICAgICAgICAgaW1nLnNyYyA9IHNyYzsKICAgICAgICB9OwogICAgfSgpKTsKCiAgICAvKlwKICAgICAqIFBhcGVyLmltYWdlCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBQbGFjZXMgYW4gaW1hZ2Ugb24gdGhlIHN1cmZhY2UKICAgICAqKgogICAgIC0gc3JjIChzdHJpbmcpIFVSSSBvZiB0aGUgc291cmNlIGltYWdlCiAgICAgLSB4IChudW1iZXIpIHggb2Zmc2V0IHBvc2l0aW9uCiAgICAgLSB5IChudW1iZXIpIHkgb2Zmc2V0IHBvc2l0aW9uCiAgICAgLSB3aWR0aCAobnVtYmVyKSB3aWR0aCBvZiB0aGUgaW1hZ2UKICAgICAtIGhlaWdodCAobnVtYmVyKSBoZWlnaHQgb2YgdGhlIGltYWdlCiAgICAgPSAob2JqZWN0KSB0aGUgYGltYWdlYCBlbGVtZW50CiAgICAgKiBvcgogICAgID0gKG9iamVjdCkgU25hcCBlbGVtZW50IG9iamVjdCB3aXRoIHR5cGUgYGltYWdlYAogICAgICoqCiAgICAgPiBVc2FnZQogICAgIHwgdmFyIGMgPSBwYXBlci5pbWFnZSgiYXBwbGUucG5nIiwgMTAsIDEwLCA4MCwgODApOwogICAgXCovCiAgICBwcm90by5pbWFnZSA9IGZ1bmN0aW9uIChzcmMsIHgsIHksIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICB2YXIgZWwgPSB0aGlzLmVsKCJpbWFnZSIpOwogICAgICAgIGlmIChpcyhzcmMsICJvYmplY3QiKSAmJiAic3JjIiBpbiBzcmMpIHsKICAgICAgICAgICAgZWwuYXR0cihzcmMpOwogICAgICAgIH0gZWxzZSBpZiAoc3JjICE9IG51bGwpIHsKICAgICAgICAgICAgdmFyIHNldCA9IHsKICAgICAgICAgICAgICAgICJ4bGluazpocmVmIjogc3JjLAogICAgICAgICAgICAgICAgcHJlc2VydmVBc3BlY3RSYXRpbzogIm5vbmUiCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmICh4ICE9IG51bGwgJiYgeSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBzZXQueCA9IHg7CiAgICAgICAgICAgICAgICBzZXQueSA9IHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHdpZHRoICE9IG51bGwgJiYgaGVpZ2h0ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHNldC53aWR0aCA9IHdpZHRoOwogICAgICAgICAgICAgICAgc2V0LmhlaWdodCA9IGhlaWdodDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHByZWxvYWQoc3JjLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgU25hcC5fLiQoZWwubm9kZSwgewogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLm9mZnNldEhlaWdodAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgU25hcC5fLiQoZWwubm9kZSwgc2V0KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVsOwogICAgfTsKICAgIC8qXAogICAgICogUGFwZXIuZWxsaXBzZQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogRHJhd3MgYW4gZWxsaXBzZQogICAgICoqCiAgICAgLSB4IChudW1iZXIpIHggY29vcmRpbmF0ZSBvZiB0aGUgY2VudHJlCiAgICAgLSB5IChudW1iZXIpIHkgY29vcmRpbmF0ZSBvZiB0aGUgY2VudHJlCiAgICAgLSByeCAobnVtYmVyKSBob3Jpem9udGFsIHJhZGl1cwogICAgIC0gcnkgKG51bWJlcikgdmVydGljYWwgcmFkaXVzCiAgICAgPSAob2JqZWN0KSB0aGUgYGVsbGlwc2VgIGVsZW1lbnQKICAgICAqKgogICAgID4gVXNhZ2UKICAgICB8IHZhciBjID0gcGFwZXIuZWxsaXBzZSg1MCwgNTAsIDQwLCAyMCk7CiAgICBcKi8KICAgIHByb3RvLmVsbGlwc2UgPSBmdW5jdGlvbiAoY3gsIGN5LCByeCwgcnkpIHsKICAgICAgICB2YXIgYXR0cjsKICAgICAgICBpZiAoaXMoY3gsICJvYmplY3QiKSAmJiBjeCA9PSAiW29iamVjdCBPYmplY3RdIikgewogICAgICAgICAgICBhdHRyID0gY3g7CiAgICAgICAgfSBlbHNlIGlmIChjeCAhPSBudWxsKSB7CiAgICAgICAgICAgIGF0dHIgPXsKICAgICAgICAgICAgICAgIGN4OiBjeCwKICAgICAgICAgICAgICAgIGN5OiBjeSwKICAgICAgICAgICAgICAgIHJ4OiByeCwKICAgICAgICAgICAgICAgIHJ5OiByeQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5lbCgiZWxsaXBzZSIsIGF0dHIpOwogICAgfTsKICAgIC8vIFNJRVJSQSBQYXBlci5wYXRoKCk6IFVuY2xlYXIgZnJvbSB0aGUgbGluayB3aGF0IGEgQ2F0bXVsbC1Sb20gY3VydmV0byBpcywgYW5kIHdoeSBpdCB3b3VsZCBtYWtlIGxpZmUgYW55IGVhc2llci4KICAgIC8qXAogICAgICogUGFwZXIucGF0aAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogQ3JlYXRlcyBhIGA8cGF0aD5gIGVsZW1lbnQgdXNpbmcgdGhlIGdpdmVuIHN0cmluZyBhcyB0aGUgcGF0aCdzIGRlZmluaXRpb24KICAgICAtIHBhdGhTdHJpbmcgKHN0cmluZykgI29wdGlvbmFsIHBhdGggc3RyaW5nIGluIFNWRyBmb3JtYXQKICAgICAqIFBhdGggc3RyaW5nIGNvbnNpc3RzIG9mIG9uZS1sZXR0ZXIgY29tbWFuZHMsIGZvbGxvd2VkIGJ5IGNvbW1hIHNlcHJhcmF0ZWQgYXJndW1lbnRzIGluIG51bWVyaWNhbCBmb3JtLiBFeGFtcGxlOgogICAgIHwgIk0xMCwyMEwzMCw0MCIKICAgICAqIFRoaXMgZXhhbXBsZSBmZWF0dXJlcyB0d28gY29tbWFuZHM6IGBNYCwgd2l0aCBhcmd1bWVudHMgYCgxMCwgMjApYCBhbmQgYExgIHdpdGggYXJndW1lbnRzIGAoMzAsIDQwKWAuIFVwcGVyY2FzZSBsZXR0ZXIgY29tbWFuZHMgZXhwcmVzcyBjb29yZGluYXRlcyBpbiBhYnNvbHV0ZSB0ZXJtcywgd2hpbGUgbG93ZXJjYXNlIGNvbW1hbmRzIGV4cHJlc3MgdGhlbSBpbiByZWxhdGl2ZSB0ZXJtcyBmcm9tIHRoZSBtb3N0IHJlY2VudGx5IGRlY2xhcmVkIGNvb3JkaW5hdGVzLgogICAgICoKICAgICAjIDxwPkhlcmUgaXMgc2hvcnQgbGlzdCBvZiBjb21tYW5kcyBhdmFpbGFibGUsIGZvciBtb3JlIGRldGFpbHMgc2VlIDxhIGhyZWY9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRy9wYXRocy5odG1sI1BhdGhEYXRhIiB0aXRsZT0iRGV0YWlscyBvZiBhIHBhdGgncyBkYXRhIGF0dHJpYnV0ZSdzIGZvcm1hdCBhcmUgZGVzY3JpYmVkIGluIHRoZSBTVkcgc3BlY2lmaWNhdGlvbi4iPlNWRyBwYXRoIHN0cmluZyBmb3JtYXQ8L2E+IG9yIDxhIGhyZWY9Imh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL1NWRy9UdXRvcmlhbC9QYXRocyI+YXJ0aWNsZSBhYm91dCBwYXRoIHN0cmluZ3MgYXQgTUROPC9hPi48L3A+CiAgICAgIyA8dGFibGU+PHRoZWFkPjx0cj48dGg+Q29tbWFuZDwvdGg+PHRoPk5hbWU8L3RoPjx0aD5QYXJhbWV0ZXJzPC90aD48L3RyPjwvdGhlYWQ+PHRib2R5PgogICAgICMgPHRyPjx0ZD5NPC90ZD48dGQ+bW92ZXRvPC90ZD48dGQ+KHggeSkrPC90ZD48L3RyPgogICAgICMgPHRyPjx0ZD5aPC90ZD48dGQ+Y2xvc2VwYXRoPC90ZD48dGQ+KG5vbmUpPC90ZD48L3RyPgogICAgICMgPHRyPjx0ZD5MPC90ZD48dGQ+bGluZXRvPC90ZD48dGQ+KHggeSkrPC90ZD48L3RyPgogICAgICMgPHRyPjx0ZD5IPC90ZD48dGQ+aG9yaXpvbnRhbCBsaW5ldG88L3RkPjx0ZD54KzwvdGQ+PC90cj4KICAgICAjIDx0cj48dGQ+VjwvdGQ+PHRkPnZlcnRpY2FsIGxpbmV0bzwvdGQ+PHRkPnkrPC90ZD48L3RyPgogICAgICMgPHRyPjx0ZD5DPC90ZD48dGQ+Y3VydmV0bzwvdGQ+PHRkPih4MSB5MSB4MiB5MiB4IHkpKzwvdGQ+PC90cj4KICAgICAjIDx0cj48dGQ+UzwvdGQ+PHRkPnNtb290aCBjdXJ2ZXRvPC90ZD48dGQ+KHgyIHkyIHggeSkrPC90ZD48L3RyPgogICAgICMgPHRyPjx0ZD5RPC90ZD48dGQ+cXVhZHJhdGljIELDqXppZXIgY3VydmV0bzwvdGQ+PHRkPih4MSB5MSB4IHkpKzwvdGQ+PC90cj4KICAgICAjIDx0cj48dGQ+VDwvdGQ+PHRkPnNtb290aCBxdWFkcmF0aWMgQsOpemllciBjdXJ2ZXRvPC90ZD48dGQ+KHggeSkrPC90ZD48L3RyPgogICAgICMgPHRyPjx0ZD5BPC90ZD48dGQ+ZWxsaXB0aWNhbCBhcmM8L3RkPjx0ZD4ocnggcnkgeC1heGlzLXJvdGF0aW9uIGxhcmdlLWFyYy1mbGFnIHN3ZWVwLWZsYWcgeCB5KSs8L3RkPjwvdHI+CiAgICAgIyA8dHI+PHRkPlI8L3RkPjx0ZD48YSBocmVmPSJodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0NhdG11bGzigJNSb21fc3BsaW5lI0NhdG11bGwuRTIuODAuOTNSb21fc3BsaW5lIj5DYXRtdWxsLVJvbSBjdXJ2ZXRvPC9hPio8L3RkPjx0ZD54MSB5MSAoeCB5KSs8L3RkPjwvdHI+PC90Ym9keT48L3RhYmxlPgogICAgICogKiBfQ2F0bXVsbC1Sb20gY3VydmV0b18gaXMgYSBub3Qgc3RhbmRhcmQgU1ZHIGNvbW1hbmQgYW5kIGFkZGVkIHRvIG1ha2UgbGlmZSBlYXNpZXIuCiAgICAgKiBOb3RlOiB0aGVyZSBpcyBhIHNwZWNpYWwgY2FzZSB3aGVuIGEgcGF0aCBjb25zaXN0cyBvZiBvbmx5IHRocmVlIGNvbW1hbmRzOiBgTTEwLDEwUuKApnpgLiBJbiB0aGlzIGNhc2UgdGhlIHBhdGggY29ubmVjdHMgYmFjayB0byBpdHMgc3RhcnRpbmcgcG9pbnQuCiAgICAgPiBVc2FnZQogICAgIHwgdmFyIGMgPSBwYXBlci5wYXRoKCJNMTAgMTBMOTAgOTAiKTsKICAgICB8IC8vIGRyYXcgYSBkaWFnb25hbCBsaW5lOgogICAgIHwgLy8gbW92ZSB0byAxMCwxMCwgbGluZSB0byA5MCw5MAogICAgXCovCiAgICBwcm90by5wYXRoID0gZnVuY3Rpb24gKGQpIHsKICAgICAgICB2YXIgYXR0cjsKICAgICAgICBpZiAoaXMoZCwgIm9iamVjdCIpICYmICFpcyhkLCAiYXJyYXkiKSkgewogICAgICAgICAgICBhdHRyID0gZDsKICAgICAgICB9IGVsc2UgaWYgKGQpIHsKICAgICAgICAgICAgYXR0ciA9IHtkOiBkfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuZWwoInBhdGgiLCBhdHRyKTsKICAgIH07CiAgICAvKlwKICAgICAqIFBhcGVyLmcKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIENyZWF0ZXMgYSBncm91cCBlbGVtZW50CiAgICAgKioKICAgICAtIHZhcmFyZ3MgKOKApikgI29wdGlvbmFsIGVsZW1lbnRzIHRvIG5lc3Qgd2l0aGluIHRoZSBncm91cAogICAgID0gKG9iamVjdCkgdGhlIGBnYCBlbGVtZW50CiAgICAgKioKICAgICA+IFVzYWdlCiAgICAgfCB2YXIgYzEgPSBwYXBlci5jaXJjbGUoKSwKICAgICB8ICAgICBjMiA9IHBhcGVyLnJlY3QoKSwKICAgICB8ICAgICBnID0gcGFwZXIuZyhjMiwgYzEpOyAvLyBub3RlIHRoYXQgdGhlIG9yZGVyIG9mIGVsZW1lbnRzIGlzIGRpZmZlcmVudAogICAgICogb3IKICAgICB8IHZhciBjMSA9IHBhcGVyLmNpcmNsZSgpLAogICAgIHwgICAgIGMyID0gcGFwZXIucmVjdCgpLAogICAgIHwgICAgIGcgPSBwYXBlci5nKCk7CiAgICAgfCBnLmFkZChjMiwgYzEpOwogICAgXCovCiAgICAvKlwKICAgICAqIFBhcGVyLmdyb3VwCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBTZWUgQFBhcGVyLmcKICAgIFwqLwogICAgcHJvdG8uZ3JvdXAgPSBwcm90by5nID0gZnVuY3Rpb24gKGZpcnN0KSB7CiAgICAgICAgdmFyIGF0dHIsCiAgICAgICAgICAgIGVsID0gdGhpcy5lbCgiZyIpOwogICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEgJiYgZmlyc3QgJiYgIWZpcnN0LnR5cGUpIHsKICAgICAgICAgICAgZWwuYXR0cihmaXJzdCk7CiAgICAgICAgfSBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoKSB7CiAgICAgICAgICAgIGVsLmFkZChBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVsOwogICAgfTsKICAgIC8qXAogICAgICogUGFwZXIuc3ZnCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBDcmVhdGVzIGEgbmVzdGVkIFNWRyBlbGVtZW50LgogICAgIC0geCAobnVtYmVyKSBAb3B0aW9uYWwgWCBvZiB0aGUgZWxlbWVudAogICAgIC0geSAobnVtYmVyKSBAb3B0aW9uYWwgWSBvZiB0aGUgZWxlbWVudAogICAgIC0gd2lkdGggKG51bWJlcikgQG9wdGlvbmFsIHdpZHRoIG9mIHRoZSBlbGVtZW50CiAgICAgLSBoZWlnaHQgKG51bWJlcikgQG9wdGlvbmFsIGhlaWdodCBvZiB0aGUgZWxlbWVudAogICAgIC0gdmJ4IChudW1iZXIpIEBvcHRpb25hbCB2aWV3Ym94IFgKICAgICAtIHZieSAobnVtYmVyKSBAb3B0aW9uYWwgdmlld2JveCBZCiAgICAgLSB2YncgKG51bWJlcikgQG9wdGlvbmFsIHZpZXdib3ggd2lkdGgKICAgICAtIHZiaCAobnVtYmVyKSBAb3B0aW9uYWwgdmlld2JveCBoZWlnaHQKICAgICAqKgogICAgID0gKG9iamVjdCkgdGhlIGBzdmdgIGVsZW1lbnQKICAgICAqKgogICAgXCovCiAgICBwcm90by5zdmcgPSBmdW5jdGlvbiAoeCwgeSwgd2lkdGgsIGhlaWdodCwgdmJ4LCB2YnksIHZidywgdmJoKSB7CiAgICAgICAgdmFyIGF0dHJzID0ge307CiAgICAgICAgaWYgKGlzKHgsICJvYmplY3QiKSAmJiB5ID09IG51bGwpIHsKICAgICAgICAgICAgYXR0cnMgPSB4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh4ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGF0dHJzLnggPSB4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh5ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGF0dHJzLnkgPSB5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh3aWR0aCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBhdHRycy53aWR0aCA9IHdpZHRoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZWlnaHQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgYXR0cnMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh2YnggIT0gbnVsbCAmJiB2YnkgIT0gbnVsbCAmJiB2YncgIT0gbnVsbCAmJiB2YmggIT0gbnVsbCkgewogICAgICAgICAgICAgICAgYXR0cnMudmlld0JveCA9IFt2YngsIHZieSwgdmJ3LCB2YmhdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmVsKCJzdmciLCBhdHRycyk7CiAgICB9OwogICAgLypcCiAgICAgKiBQYXBlci5tYXNrCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBFcXVpdmFsZW50IGluIGJlaGF2aW91ciB0byBAUGFwZXIuZywgZXhjZXB0IGl04oCZcyBhIG1hc2suCiAgICAgKioKICAgICA9IChvYmplY3QpIHRoZSBgbWFza2AgZWxlbWVudAogICAgICoqCiAgICBcKi8KICAgIHByb3RvLm1hc2sgPSBmdW5jdGlvbiAoZmlyc3QpIHsKICAgICAgICB2YXIgYXR0ciwKICAgICAgICAgICAgZWwgPSB0aGlzLmVsKCJtYXNrIik7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSAmJiBmaXJzdCAmJiAhZmlyc3QudHlwZSkgewogICAgICAgICAgICBlbC5hdHRyKGZpcnN0KTsKICAgICAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgICAgICAgZWwuYWRkKEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZWw7CiAgICB9OwogICAgLypcCiAgICAgKiBQYXBlci5wdHJuCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBFcXVpdmFsZW50IGluIGJlaGF2aW91ciB0byBAUGFwZXIuZywgZXhjZXB0IGl04oCZcyBhIG1hc2suCiAgICAgLSB4IChudW1iZXIpIEBvcHRpb25hbCBYIG9mIHRoZSBlbGVtZW50CiAgICAgLSB5IChudW1iZXIpIEBvcHRpb25hbCBZIG9mIHRoZSBlbGVtZW50CiAgICAgLSB3aWR0aCAobnVtYmVyKSBAb3B0aW9uYWwgd2lkdGggb2YgdGhlIGVsZW1lbnQKICAgICAtIGhlaWdodCAobnVtYmVyKSBAb3B0aW9uYWwgaGVpZ2h0IG9mIHRoZSBlbGVtZW50CiAgICAgLSB2YnggKG51bWJlcikgQG9wdGlvbmFsIHZpZXdib3ggWAogICAgIC0gdmJ5IChudW1iZXIpIEBvcHRpb25hbCB2aWV3Ym94IFkKICAgICAtIHZidyAobnVtYmVyKSBAb3B0aW9uYWwgdmlld2JveCB3aWR0aAogICAgIC0gdmJoIChudW1iZXIpIEBvcHRpb25hbCB2aWV3Ym94IGhlaWdodAogICAgICoqCiAgICAgPSAob2JqZWN0KSB0aGUgYG1hc2tgIGVsZW1lbnQKICAgICAqKgogICAgXCovCiAgICBwcm90by5wdHJuID0gZnVuY3Rpb24gKHgsIHksIHdpZHRoLCBoZWlnaHQsIHZ4LCB2eSwgdncsIHZoKSB7CiAgICAgICAgaWYgKGlzKHgsICJvYmplY3QiKSkgewogICAgICAgICAgICB2YXIgYXR0ciA9IHg7CiAgICAgICAgfSBlbHNlIGlmICghYXJndW1lbnRzLmxlbmd0aCkgewogICAgICAgICAgICBhdHRyID0ge3BhdHRlcm5Vbml0czogInVzZXJTcGFjZU9uVXNlIn07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYXR0ciA9IHt9OwogICAgICAgICAgICBpZiAoeCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBhdHRyLnggPSB4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh5ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGF0dHIueSA9IHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHdpZHRoICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGF0dHIud2lkdGggPSB3aWR0aDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGVpZ2h0ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGF0dHIuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh2eCAhPSBudWxsICYmIHZ5ICE9IG51bGwgJiYgdncgIT0gbnVsbCAmJiB2aCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBhdHRyLnZpZXdCb3ggPSBbdngsIHZ5LCB2dywgdmhdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmVsKCJwYXR0ZXJuIiwgYXR0cik7CiAgICB9OwogICAgLypcCiAgICAgKiBQYXBlci51c2UKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIENyZWF0ZXMgYSA8dXNlPiBlbGVtZW50LgogICAgIC0gaWQgKHN0cmluZykgQG9wdGlvbmFsIGlkIG9mIGVsZW1lbnQgdG8gbGluawogICAgICogb3IKICAgICAtIGlkIChFbGVtZW50KSBAb3B0aW9uYWwgZWxlbWVudCB0byBsaW5rCiAgICAgKioKICAgICA9IChvYmplY3QpIHRoZSBgdXNlYCBlbGVtZW50CiAgICAgKioKICAgIFwqLwogICAgcHJvdG8udXNlID0gZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgaWYgKGlkICE9IG51bGwpIHsKICAgICAgICAgICAgdmFyIGVsID0gbWFrZSgidXNlIiwgdGhpcy5ub2RlKTsKICAgICAgICAgICAgaWYgKGlkIGluc3RhbmNlb2YgRWxlbWVudCkgewogICAgICAgICAgICAgICAgaWYgKCFpZC5hdHRyKCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgaWQuYXR0cih7aWQ6IElEKCl9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlkID0gaWQuYXR0cigiaWQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5lbCgidXNlIiwgeyJ4bGluazpocmVmIjogaWR9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gRWxlbWVudC5wcm90b3R5cGUudXNlLmNhbGwodGhpcyk7CiAgICAgICAgfQogICAgfTsKICAgIC8qXAogICAgICogUGFwZXIudGV4dAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogRHJhd3MgYSB0ZXh0IHN0cmluZwogICAgICoqCiAgICAgLSB4IChudW1iZXIpIHggY29vcmRpbmF0ZSBwb3NpdGlvbgogICAgIC0geSAobnVtYmVyKSB5IGNvb3JkaW5hdGUgcG9zaXRpb24KICAgICAtIHRleHQgKHN0cmluZ3xhcnJheSkgVGhlIHRleHQgc3RyaW5nIHRvIGRyYXcgb3IgYXJyYXkgb2Ygc3RyaW5ncyB0byBuZXN0IHdpdGhpbiBzZXBhcmF0ZSBgPHRzcGFuPmAgZWxlbWVudHMKICAgICA9IChvYmplY3QpIHRoZSBgdGV4dGAgZWxlbWVudAogICAgICoqCiAgICAgPiBVc2FnZQogICAgIHwgdmFyIHQxID0gcGFwZXIudGV4dCg1MCwgNTAsICJTbmFwIik7CiAgICAgfCB2YXIgdDIgPSBwYXBlci50ZXh0KDUwLCA1MCwgWyJTIiwibiIsImEiLCJwIl0pOwogICAgIHwgLy8gVGV4dCBwYXRoIHVzYWdlCiAgICAgfCB0MS5hdHRyKHt0ZXh0cGF0aDogIk0xMCwxMEwxMDAsMTAwIn0pOwogICAgIHwgLy8gb3IKICAgICB8IHZhciBwdGggPSBwYXBlci5wYXRoKCJNMTAsMTBMMTAwLDEwMCIpOwogICAgIHwgdDEuYXR0cih7dGV4dHBhdGg6IHB0aH0pOwogICAgXCovCiAgICBwcm90by50ZXh0ID0gZnVuY3Rpb24gKHgsIHksIHRleHQpIHsKICAgICAgICB2YXIgYXR0ciA9IHt9OwogICAgICAgIGlmIChpcyh4LCAib2JqZWN0IikpIHsKICAgICAgICAgICAgYXR0ciA9IHg7CiAgICAgICAgfSBlbHNlIGlmICh4ICE9IG51bGwpIHsKICAgICAgICAgICAgYXR0ciA9IHsKICAgICAgICAgICAgICAgIHg6IHgsCiAgICAgICAgICAgICAgICB5OiB5LAogICAgICAgICAgICAgICAgdGV4dDogdGV4dCB8fCAiIgogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5lbCgidGV4dCIsIGF0dHIpOwogICAgfTsKICAgIC8qXAogICAgICogUGFwZXIubGluZQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogRHJhd3MgYSBsaW5lCiAgICAgKioKICAgICAtIHgxIChudW1iZXIpIHggY29vcmRpbmF0ZSBwb3NpdGlvbiBvZiB0aGUgc3RhcnQKICAgICAtIHkxIChudW1iZXIpIHkgY29vcmRpbmF0ZSBwb3NpdGlvbiBvZiB0aGUgc3RhcnQKICAgICAtIHgyIChudW1iZXIpIHggY29vcmRpbmF0ZSBwb3NpdGlvbiBvZiB0aGUgZW5kCiAgICAgLSB5MiAobnVtYmVyKSB5IGNvb3JkaW5hdGUgcG9zaXRpb24gb2YgdGhlIGVuZAogICAgID0gKG9iamVjdCkgdGhlIGBsaW5lYCBlbGVtZW50CiAgICAgKioKICAgICA+IFVzYWdlCiAgICAgfCB2YXIgdDEgPSBwYXBlci5saW5lKDUwLCA1MCwgMTAwLCAxMDApOwogICAgXCovCiAgICBwcm90by5saW5lID0gZnVuY3Rpb24gKHgxLCB5MSwgeDIsIHkyKSB7CiAgICAgICAgdmFyIGF0dHIgPSB7fTsKICAgICAgICBpZiAoaXMoeDEsICJvYmplY3QiKSkgewogICAgICAgICAgICBhdHRyID0geDE7CiAgICAgICAgfSBlbHNlIGlmICh4MSAhPSBudWxsKSB7CiAgICAgICAgICAgIGF0dHIgPSB7CiAgICAgICAgICAgICAgICB4MTogeDEsCiAgICAgICAgICAgICAgICB4MjogeDIsCiAgICAgICAgICAgICAgICB5MTogeTEsCiAgICAgICAgICAgICAgICB5MjogeTIKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuZWwoImxpbmUiLCBhdHRyKTsKICAgIH07CiAgICAvKlwKICAgICAqIFBhcGVyLnBvbHlsaW5lCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBEcmF3cyBhIHBvbHlsaW5lCiAgICAgKioKICAgICAtIHBvaW50cyAoYXJyYXkpIGFycmF5IG9mIHBvaW50cwogICAgICogb3IKICAgICAtIHZhcmFyZ3MgKOKApikgcG9pbnRzCiAgICAgPSAob2JqZWN0KSB0aGUgYHBvbHlsaW5lYCBlbGVtZW50CiAgICAgKioKICAgICA+IFVzYWdlCiAgICAgfCB2YXIgcDEgPSBwYXBlci5wb2x5bGluZShbMTAsIDEwLCAxMDAsIDEwMF0pOwogICAgIHwgdmFyIHAyID0gcGFwZXIucG9seWxpbmUoMTAsIDEwLCAxMDAsIDEwMCk7CiAgICBcKi8KICAgIHByb3RvLnBvbHlsaW5lID0gZnVuY3Rpb24gKHBvaW50cykgewogICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkgewogICAgICAgICAgICBwb2ludHMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApOwogICAgICAgIH0KICAgICAgICB2YXIgYXR0ciA9IHt9OwogICAgICAgIGlmIChpcyhwb2ludHMsICJvYmplY3QiKSAmJiAhaXMocG9pbnRzLCAiYXJyYXkiKSkgewogICAgICAgICAgICBhdHRyID0gcG9pbnRzOwogICAgICAgIH0gZWxzZSBpZiAocG9pbnRzICE9IG51bGwpIHsKICAgICAgICAgICAgYXR0ciA9IHtwb2ludHM6IHBvaW50c307CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmVsKCJwb2x5bGluZSIsIGF0dHIpOwogICAgfTsKICAgIC8qXAogICAgICogUGFwZXIucG9seWdvbgogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogRHJhd3MgYSBwb2x5Z29uLiBTZWUgQFBhcGVyLnBvbHlsaW5lCiAgICBcKi8KICAgIHByb3RvLnBvbHlnb24gPSBmdW5jdGlvbiAocG9pbnRzKSB7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIHBvaW50cyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7CiAgICAgICAgfQogICAgICAgIHZhciBhdHRyID0ge307CiAgICAgICAgaWYgKGlzKHBvaW50cywgIm9iamVjdCIpICYmICFpcyhwb2ludHMsICJhcnJheSIpKSB7CiAgICAgICAgICAgIGF0dHIgPSBwb2ludHM7CiAgICAgICAgfSBlbHNlIGlmIChwb2ludHMgIT0gbnVsbCkgewogICAgICAgICAgICBhdHRyID0ge3BvaW50czogcG9pbnRzfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuZWwoInBvbHlnb24iLCBhdHRyKTsKICAgIH07CiAgICAvLyBncmFkaWVudHMKICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyICQgPSBTbmFwLl8uJDsKICAgICAgICAvLyBncmFkaWVudHMnIGhlbHBlcnMKICAgICAgICBmdW5jdGlvbiBHc3RvcHMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbGVjdEFsbCgic3RvcCIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBHYWRkU3RvcChjb2xvciwgb2Zmc2V0KSB7CiAgICAgICAgICAgIHZhciBzdG9wID0gJCgic3RvcCIpLAogICAgICAgICAgICAgICAgYXR0ciA9IHsKICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6ICtvZmZzZXQgKyAiJSIKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNvbG9yID0gU25hcC5jb2xvcihjb2xvcik7CiAgICAgICAgICAgIGF0dHJbInN0b3AtY29sb3IiXSA9IGNvbG9yLmhleDsKICAgICAgICAgICAgaWYgKGNvbG9yLm9wYWNpdHkgPCAxKSB7CiAgICAgICAgICAgICAgICBhdHRyWyJzdG9wLW9wYWNpdHkiXSA9IGNvbG9yLm9wYWNpdHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJChzdG9wLCBhdHRyKTsKICAgICAgICAgICAgdGhpcy5ub2RlLmFwcGVuZENoaWxkKHN0b3ApOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gR2dldEJCb3goKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnR5cGUgPT0gImxpbmVhckdyYWRpZW50IikgewogICAgICAgICAgICAgICAgdmFyIHgxID0gJCh0aGlzLm5vZGUsICJ4MSIpIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgeDIgPSAkKHRoaXMubm9kZSwgIngyIikgfHwgMSwKICAgICAgICAgICAgICAgICAgICB5MSA9ICQodGhpcy5ub2RlLCAieTEiKSB8fCAwLAogICAgICAgICAgICAgICAgICAgIHkyID0gJCh0aGlzLm5vZGUsICJ5MiIpIHx8IDA7CiAgICAgICAgICAgICAgICByZXR1cm4gU25hcC5fLmJveCh4MSwgeTEsIG1hdGguYWJzKHgyIC0geDEpLCBtYXRoLmFicyh5MiAtIHkxKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgY3ggPSB0aGlzLm5vZGUuY3ggfHwgLjUsCiAgICAgICAgICAgICAgICAgICAgY3kgPSB0aGlzLm5vZGUuY3kgfHwgLjUsCiAgICAgICAgICAgICAgICAgICAgciA9IHRoaXMubm9kZS5yIHx8IDA7CiAgICAgICAgICAgICAgICByZXR1cm4gU25hcC5fLmJveChjeCAtIHIsIGN5IC0gciwgciAqIDIsIHIgKiAyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBncmFkaWVudChkZWZzLCBzdHIpIHsKICAgICAgICAgICAgdmFyIGdyYWQgPSBldmUoInNuYXAudXRpbC5ncmFkLnBhcnNlIiwgbnVsbCwgc3RyKS5maXJzdERlZmluZWQoKSwKICAgICAgICAgICAgICAgIGVsOwogICAgICAgICAgICBpZiAoIWdyYWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGdyYWQucGFyYW1zLnVuc2hpZnQoZGVmcyk7CiAgICAgICAgICAgIGlmIChncmFkLnR5cGUudG9Mb3dlckNhc2UoKSA9PSAibCIpIHsKICAgICAgICAgICAgICAgIGVsID0gZ3JhZGllbnRMaW5lYXIuYXBwbHkoMCwgZ3JhZC5wYXJhbXMpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZWwgPSBncmFkaWVudFJhZGlhbC5hcHBseSgwLCBncmFkLnBhcmFtcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGdyYWQudHlwZSAhPSBncmFkLnR5cGUudG9Mb3dlckNhc2UoKSkgewogICAgICAgICAgICAgICAgJChlbC5ub2RlLCB7CiAgICAgICAgICAgICAgICAgICAgZ3JhZGllbnRVbml0czogInVzZXJTcGFjZU9uVXNlIgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHN0b3BzID0gZ3JhZC5zdG9wcywKICAgICAgICAgICAgICAgIGxlbiA9IHN0b3BzLmxlbmd0aCwKICAgICAgICAgICAgICAgIHN0YXJ0ID0gMCwKICAgICAgICAgICAgICAgIGogPSAwOwogICAgICAgICAgICBmdW5jdGlvbiBzZWVkKGksIGVuZCkgewogICAgICAgICAgICAgICAgdmFyIHN0ZXAgPSAoZW5kIC0gc3RhcnQpIC8gKGkgLSBqKTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSBqOyBrIDwgaTsgaysrKSB7CiAgICAgICAgICAgICAgICAgICAgc3RvcHNba10ub2Zmc2V0ID0gKygrc3RhcnQgKyBzdGVwICogKGsgLSBqKSkudG9GaXhlZCgyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGogPSBpOwogICAgICAgICAgICAgICAgc3RhcnQgPSBlbmQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGVuLS07CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIGlmICgib2Zmc2V0IiBpbiBzdG9wc1tpXSkgewogICAgICAgICAgICAgICAgc2VlZChpLCBzdG9wc1tpXS5vZmZzZXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0b3BzW2xlbl0ub2Zmc2V0ID0gc3RvcHNbbGVuXS5vZmZzZXQgfHwgMTAwOwogICAgICAgICAgICBzZWVkKGxlbiwgc3RvcHNbbGVuXS5vZmZzZXQpOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDw9IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgc3RvcCA9IHN0b3BzW2ldOwogICAgICAgICAgICAgICAgZWwuYWRkU3RvcChzdG9wLmNvbG9yLCBzdG9wLm9mZnNldCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGVsOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBncmFkaWVudExpbmVhcihkZWZzLCB4MSwgeTEsIHgyLCB5MikgewogICAgICAgICAgICB2YXIgZWwgPSBTbmFwLl8ubWFrZSgibGluZWFyR3JhZGllbnQiLCBkZWZzKTsKICAgICAgICAgICAgZWwuc3RvcHMgPSBHc3RvcHM7CiAgICAgICAgICAgIGVsLmFkZFN0b3AgPSBHYWRkU3RvcDsKICAgICAgICAgICAgZWwuZ2V0QkJveCA9IEdnZXRCQm94OwogICAgICAgICAgICBpZiAoeDEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgJChlbC5ub2RlLCB7CiAgICAgICAgICAgICAgICAgICAgeDE6IHgxLAogICAgICAgICAgICAgICAgICAgIHkxOiB5MSwKICAgICAgICAgICAgICAgICAgICB4MjogeDIsCiAgICAgICAgICAgICAgICAgICAgeTI6IHkyCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZWw7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdyYWRpZW50UmFkaWFsKGRlZnMsIGN4LCBjeSwgciwgZngsIGZ5KSB7CiAgICAgICAgICAgIHZhciBlbCA9IFNuYXAuXy5tYWtlKCJyYWRpYWxHcmFkaWVudCIsIGRlZnMpOwogICAgICAgICAgICBlbC5zdG9wcyA9IEdzdG9wczsKICAgICAgICAgICAgZWwuYWRkU3RvcCA9IEdhZGRTdG9wOwogICAgICAgICAgICBlbC5nZXRCQm94ID0gR2dldEJCb3g7CiAgICAgICAgICAgIGlmIChjeCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAkKGVsLm5vZGUsIHsKICAgICAgICAgICAgICAgICAgICBjeDogY3gsCiAgICAgICAgICAgICAgICAgICAgY3k6IGN5LAogICAgICAgICAgICAgICAgICAgIHI6IHIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmeCAhPSBudWxsICYmIGZ5ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICQoZWwubm9kZSwgewogICAgICAgICAgICAgICAgICAgIGZ4OiBmeCwKICAgICAgICAgICAgICAgICAgICBmeTogZnkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBlbDsKICAgICAgICB9CiAgICAgICAgLypcCiAgICAgICAgICogUGFwZXIuZ3JhZGllbnQKICAgICAgICAgWyBtZXRob2QgXQogICAgICAgICAqKgogICAgICAgICAqIENyZWF0ZXMgYSBncmFkaWVudCBlbGVtZW50CiAgICAgICAgICoqCiAgICAgICAgIC0gZ3JhZGllbnQgKHN0cmluZykgZ3JhZGllbnQgZGVzY3JpcHRvcgogICAgICAgICA+IEdyYWRpZW50IERlc2NyaXB0b3IKICAgICAgICAgKiBUaGUgZ3JhZGllbnQgZGVzY3JpcHRvciBpcyBhbiBleHByZXNzaW9uIGZvcm1hdHRlZCBhcwogICAgICAgICAqIGZvbGxvd3M6IGA8dHlwZT4oPGNvb3Jkcz4pPGNvbG9ycz5gLiAgVGhlIGA8dHlwZT5gIGNhbiBiZQogICAgICAgICAqIGVpdGhlciBsaW5lYXIgb3IgcmFkaWFsLiAgVGhlIHVwcGVyY2FzZSBgTGAgb3IgYFJgIGxldHRlcnMKICAgICAgICAgKiBpbmRpY2F0ZSBhYnNvbHV0ZSBjb29yZGluYXRlcyBvZmZzZXQgZnJvbSB0aGUgU1ZHIHN1cmZhY2UuCiAgICAgICAgICogTG93ZXJjYXNlIGBsYCBvciBgcmAgbGV0dGVycyBpbmRpY2F0ZSBjb29yZGluYXRlcwogICAgICAgICAqIGNhbGN1bGF0ZWQgcmVsYXRpdmUgdG8gdGhlIGVsZW1lbnQgdG8gd2hpY2ggdGhlIGdyYWRpZW50IGlzCiAgICAgICAgICogYXBwbGllZC4gIENvb3JkaW5hdGVzIHNwZWNpZnkgYSBsaW5lYXIgZ3JhZGllbnQgdmVjdG9yIGFzCiAgICAgICAgICogYHgxYCwgYHkxYCwgYHgyYCwgYHkyYCwgb3IgYSByYWRpYWwgZ3JhZGllbnQgYXMgYGN4YCwgYGN5YCwKICAgICAgICAgKiBgcmAgYW5kIG9wdGlvbmFsIGBmeGAsIGBmeWAgc3BlY2lmeWluZyBhIGZvY2FsIHBvaW50IGF3YXkKICAgICAgICAgKiBmcm9tIHRoZSBjZW50ZXIgb2YgdGhlIGNpcmNsZS4gU3BlY2lmeSBgPGNvbG9ycz5gIGFzIGEgbGlzdAogICAgICAgICAqIG9mIGRhc2gtc2VwYXJhdGVkIENTUyBjb2xvciB2YWx1ZXMuICBFYWNoIGNvbG9yIG1heSBiZQogICAgICAgICAqIGZvbGxvd2VkIGJ5IGEgY3VzdG9tIG9mZnNldCB2YWx1ZSwgc2VwYXJhdGVkIHdpdGggYSBjb2xvbgogICAgICAgICAqIGNoYXJhY3Rlci4KICAgICAgICAgPiBFeGFtcGxlcwogICAgICAgICAqIExpbmVhciBncmFkaWVudCwgcmVsYXRpdmUgZnJvbSB0b3AtbGVmdCBjb3JuZXIgdG8gYm90dG9tLXJpZ2h0CiAgICAgICAgICogY29ybmVyLCBmcm9tIGJsYWNrIHRocm91Z2ggcmVkIHRvIHdoaXRlOgogICAgICAgICB8IHZhciBnID0gcGFwZXIuZ3JhZGllbnQoImwoMCwgMCwgMSwgMSkjMDAwLSNmMDAtI2ZmZiIpOwogICAgICAgICAqIExpbmVhciBncmFkaWVudCwgYWJzb2x1dGUgZnJvbSAoMCwgMCkgdG8gKDEwMCwgMTAwKSwgZnJvbSBibGFjawogICAgICAgICAqIHRocm91Z2ggcmVkIGF0IDI1JSB0byB3aGl0ZToKICAgICAgICAgfCB2YXIgZyA9IHBhcGVyLmdyYWRpZW50KCJMKDAsIDAsIDEwMCwgMTAwKSMwMDAtI2YwMDoyNS0jZmZmIik7CiAgICAgICAgICogUmFkaWFsIGdyYWRpZW50LCByZWxhdGl2ZSBmcm9tIHRoZSBjZW50ZXIgb2YgdGhlIGVsZW1lbnQgd2l0aCByYWRpdXMKICAgICAgICAgKiBoYWxmIHRoZSB3aWR0aCwgZnJvbSBibGFjayB0byB3aGl0ZToKICAgICAgICAgfCB2YXIgZyA9IHBhcGVyLmdyYWRpZW50KCJyKDAuNSwgMC41LCAwLjUpIzAwMC0jZmZmIik7CiAgICAgICAgICogVG8gYXBwbHkgdGhlIGdyYWRpZW50OgogICAgICAgICB8IHBhcGVyLmNpcmNsZSg1MCwgNTAsIDQwKS5hdHRyKHsKICAgICAgICAgfCAgICAgZmlsbDogZwogICAgICAgICB8IH0pOwogICAgICAgICA9IChvYmplY3QpIHRoZSBgZ3JhZGllbnRgIGVsZW1lbnQKICAgICAgICBcKi8KICAgICAgICBwcm90by5ncmFkaWVudCA9IGZ1bmN0aW9uIChzdHIpIHsKICAgICAgICAgICAgcmV0dXJuIGdyYWRpZW50KHRoaXMuZGVmcywgc3RyKTsKICAgICAgICB9OwogICAgICAgIHByb3RvLmdyYWRpZW50TGluZWFyID0gZnVuY3Rpb24gKHgxLCB5MSwgeDIsIHkyKSB7CiAgICAgICAgICAgIHJldHVybiBncmFkaWVudExpbmVhcih0aGlzLmRlZnMsIHgxLCB5MSwgeDIsIHkyKTsKICAgICAgICB9OwogICAgICAgIHByb3RvLmdyYWRpZW50UmFkaWFsID0gZnVuY3Rpb24gKGN4LCBjeSwgciwgZngsIGZ5KSB7CiAgICAgICAgICAgIHJldHVybiBncmFkaWVudFJhZGlhbCh0aGlzLmRlZnMsIGN4LCBjeSwgciwgZngsIGZ5KTsKICAgICAgICB9OwogICAgICAgIC8qXAogICAgICAgICAqIFBhcGVyLnRvU3RyaW5nCiAgICAgICAgIFsgbWV0aG9kIF0KICAgICAgICAgKioKICAgICAgICAgKiBSZXR1cm5zIFNWRyBjb2RlIGZvciB0aGUgQFBhcGVyCiAgICAgICAgID0gKHN0cmluZykgU1ZHIGNvZGUgZm9yIHRoZSBAUGFwZXIKICAgICAgICBcKi8KICAgICAgICBwcm90by50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGRvYyA9IHRoaXMubm9kZS5vd25lckRvY3VtZW50LAogICAgICAgICAgICAgICAgZiA9IGRvYy5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksCiAgICAgICAgICAgICAgICBkID0gZG9jLmNyZWF0ZUVsZW1lbnQoImRpdiIpLAogICAgICAgICAgICAgICAgc3ZnID0gdGhpcy5ub2RlLmNsb25lTm9kZSh0cnVlKSwKICAgICAgICAgICAgICAgIHJlczsKICAgICAgICAgICAgZi5hcHBlbmRDaGlsZChkKTsKICAgICAgICAgICAgZC5hcHBlbmRDaGlsZChzdmcpOwogICAgICAgICAgICBTbmFwLl8uJChzdmcsIHt4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIn0pOwogICAgICAgICAgICByZXMgPSBkLmlubmVySFRNTDsKICAgICAgICAgICAgZi5yZW1vdmVDaGlsZChmLmZpcnN0Q2hpbGQpOwogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH07CiAgICAgICAgLypcCiAgICAgICAgICogUGFwZXIuY2xlYXIKICAgICAgICAgWyBtZXRob2QgXQogICAgICAgICAqKgogICAgICAgICAqIFJlbW92ZXMgYWxsIGNoaWxkIG5vZGVzIG9mIHRoZSBwYXBlciwgZXhjZXB0IDxkZWZzPi4KICAgICAgICBcKi8KICAgICAgICBwcm90by5jbGVhciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIG5vZGUgPSB0aGlzLm5vZGUuZmlyc3RDaGlsZCwKICAgICAgICAgICAgICAgIG5leHQ7CiAgICAgICAgICAgIHdoaWxlIChub2RlKSB7CiAgICAgICAgICAgICAgICBuZXh0ID0gbm9kZS5uZXh0U2libGluZzsKICAgICAgICAgICAgICAgIGlmIChub2RlLnRhZ05hbWUgIT0gImRlZnMiKSB7CiAgICAgICAgICAgICAgICAgICAgbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwcm90by5jbGVhci5jYWxsKHtub2RlOiBub2RlfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBub2RlID0gbmV4dDsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9KCkpOwp9KTsKLy8gQ29weXJpZ2h0IChjKSAyMDEzIEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkLiBBbGwgcmlnaHRzIHJlc2VydmVkLgovLyAKLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7Ci8vIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KLy8gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0Ci8vIAovLyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKLy8gCi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKLy8gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKLy8gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCi8vIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKLy8gbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuClNuYXAucGx1Z2luKGZ1bmN0aW9uIChTbmFwLCBFbGVtZW50LCBQYXBlciwgZ2xvYikgewogICAgdmFyIGVscHJvdG8gPSBFbGVtZW50LnByb3RvdHlwZSwKICAgICAgICBpcyA9IFNuYXAuaXMsCiAgICAgICAgY2xvbmUgPSBTbmFwLl8uY2xvbmUsCiAgICAgICAgaGFzID0gImhhc093blByb3BlcnR5IiwKICAgICAgICBwMnMgPSAvLD8oW2Etel0pLD8vZ2ksCiAgICAgICAgdG9GbG9hdCA9IHBhcnNlRmxvYXQsCiAgICAgICAgbWF0aCA9IE1hdGgsCiAgICAgICAgUEkgPSBtYXRoLlBJLAogICAgICAgIG1taW4gPSBtYXRoLm1pbiwKICAgICAgICBtbWF4ID0gbWF0aC5tYXgsCiAgICAgICAgcG93ID0gbWF0aC5wb3csCiAgICAgICAgYWJzID0gbWF0aC5hYnM7CiAgICBmdW5jdGlvbiBwYXRocyhwcykgewogICAgICAgIHZhciBwID0gcGF0aHMucHMgPSBwYXRocy5wcyB8fCB7fTsKICAgICAgICBpZiAocFtwc10pIHsKICAgICAgICAgICAgcFtwc10uc2xlZXAgPSAxMDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcFtwc10gPSB7CiAgICAgICAgICAgICAgICBzbGVlcDogMTAwCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gcCkgaWYgKHBbaGFzXShrZXkpICYmIGtleSAhPSBwcykgewogICAgICAgICAgICAgICAgcFtrZXldLnNsZWVwLS07CiAgICAgICAgICAgICAgICAhcFtrZXldLnNsZWVwICYmIGRlbGV0ZSBwW2tleV07CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcFtwc107CiAgICB9CiAgICBmdW5jdGlvbiBib3goeCwgeSwgd2lkdGgsIGhlaWdodCkgewogICAgICAgIGlmICh4ID09IG51bGwpIHsKICAgICAgICAgICAgeCA9IHkgPSB3aWR0aCA9IGhlaWdodCA9IDA7CiAgICAgICAgfQogICAgICAgIGlmICh5ID09IG51bGwpIHsKICAgICAgICAgICAgeSA9IHgueTsKICAgICAgICAgICAgd2lkdGggPSB4LndpZHRoOwogICAgICAgICAgICBoZWlnaHQgPSB4LmhlaWdodDsKICAgICAgICAgICAgeCA9IHgueDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgeDogeCwKICAgICAgICAgICAgeTogeSwKICAgICAgICAgICAgd2lkdGg6IHdpZHRoLAogICAgICAgICAgICB3OiB3aWR0aCwKICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsCiAgICAgICAgICAgIGg6IGhlaWdodCwKICAgICAgICAgICAgeDI6IHggKyB3aWR0aCwKICAgICAgICAgICAgeTI6IHkgKyBoZWlnaHQsCiAgICAgICAgICAgIGN4OiB4ICsgd2lkdGggLyAyLAogICAgICAgICAgICBjeTogeSArIGhlaWdodCAvIDIsCiAgICAgICAgICAgIHIxOiBtYXRoLm1pbih3aWR0aCwgaGVpZ2h0KSAvIDIsCiAgICAgICAgICAgIHIyOiBtYXRoLm1heCh3aWR0aCwgaGVpZ2h0KSAvIDIsCiAgICAgICAgICAgIHIwOiBtYXRoLnNxcnQod2lkdGggKiB3aWR0aCArIGhlaWdodCAqIGhlaWdodCkgLyAyLAogICAgICAgICAgICBwYXRoOiByZWN0UGF0aCh4LCB5LCB3aWR0aCwgaGVpZ2h0KSwKICAgICAgICAgICAgdmI6IFt4LCB5LCB3aWR0aCwgaGVpZ2h0XS5qb2luKCIgIikKICAgICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuam9pbigiLCIpLnJlcGxhY2UocDJzLCAiJDEiKTsKICAgIH0KICAgIGZ1bmN0aW9uIHBhdGhDbG9uZShwYXRoQXJyYXkpIHsKICAgICAgICB2YXIgcmVzID0gY2xvbmUocGF0aEFycmF5KTsKICAgICAgICByZXMudG9TdHJpbmcgPSB0b1N0cmluZzsKICAgICAgICByZXR1cm4gcmVzOwogICAgfQogICAgZnVuY3Rpb24gZ2V0UG9pbnRBdFNlZ21lbnRMZW5ndGgocDF4LCBwMXksIGMxeCwgYzF5LCBjMngsIGMyeSwgcDJ4LCBwMnksIGxlbmd0aCkgewogICAgICAgIGlmIChsZW5ndGggPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gYmV6bGVuKHAxeCwgcDF5LCBjMXgsIGMxeSwgYzJ4LCBjMnksIHAyeCwgcDJ5KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmluZERvdHNBdFNlZ21lbnQocDF4LCBwMXksIGMxeCwgYzF5LCBjMngsIGMyeSwgcDJ4LCBwMnksCiAgICAgICAgICAgICAgICBnZXRUb3RMZW4ocDF4LCBwMXksIGMxeCwgYzF5LCBjMngsIGMyeSwgcDJ4LCBwMnksIGxlbmd0aCkpOwogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGdldExlbmd0aEZhY3RvcnkoaXN0b3RhbCwgc3VicGF0aCkgewogICAgICAgIGZ1bmN0aW9uIE8odmFsKSB7CiAgICAgICAgICAgIHJldHVybiArKCt2YWwpLnRvRml4ZWQoMyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBTbmFwLl8uY2FjaGVyKGZ1bmN0aW9uIChwYXRoLCBsZW5ndGgsIG9ubHlzdGFydCkgewogICAgICAgICAgICBpZiAocGF0aCBpbnN0YW5jZW9mIEVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIHBhdGggPSBwYXRoLmF0dHIoImQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwYXRoID0gcGF0aDJjdXJ2ZShwYXRoKTsKICAgICAgICAgICAgdmFyIHgsIHksIHAsIGwsIHNwID0gIiIsIHN1YnBhdGhzID0ge30sIHBvaW50LAogICAgICAgICAgICAgICAgbGVuID0gMDsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcGF0aC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgICBwID0gcGF0aFtpXTsKICAgICAgICAgICAgICAgIGlmIChwWzBdID09ICJNIikgewogICAgICAgICAgICAgICAgICAgIHggPSArcFsxXTsKICAgICAgICAgICAgICAgICAgICB5ID0gK3BbMl07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGwgPSBnZXRQb2ludEF0U2VnbWVudExlbmd0aCh4LCB5LCBwWzFdLCBwWzJdLCBwWzNdLCBwWzRdLCBwWzVdLCBwWzZdKTsKICAgICAgICAgICAgICAgICAgICBpZiAobGVuICsgbCA+IGxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3VicGF0aCAmJiAhc3VicGF0aHMuc3RhcnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50ID0gZ2V0UG9pbnRBdFNlZ21lbnRMZW5ndGgoeCwgeSwgcFsxXSwgcFsyXSwgcFszXSwgcFs0XSwgcFs1XSwgcFs2XSwgbGVuZ3RoIC0gbGVuKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwICs9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQyIgKyBPKHBvaW50LnN0YXJ0LngpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE8ocG9pbnQuc3RhcnQueSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTyhwb2ludC5tLngpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE8ocG9pbnQubS55KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPKHBvaW50LngpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE8ocG9pbnQueSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob25seXN0YXJ0KSB7cmV0dXJuIHNwO30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnBhdGhzLnN0YXJ0ID0gc3A7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcCA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiTSIgKyBPKHBvaW50LngpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE8ocG9pbnQueSkgKyAiQyIgKyBPKHBvaW50Lm4ueCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTyhwb2ludC5uLnkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE8ocG9pbnQuZW5kLngpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE8ocG9pbnQuZW5kLnkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE8ocFs1XSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTyhwWzZdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW4gKz0gbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHggPSArcFs1XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSArcFs2XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXN0b3RhbCAmJiAhc3VicGF0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQgPSBnZXRQb2ludEF0U2VnbWVudExlbmd0aCh4LCB5LCBwWzFdLCBwWzJdLCBwWzNdLCBwWzRdLCBwWzVdLCBwWzZdLCBsZW5ndGggLSBsZW4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBvaW50OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxlbiArPSBsOwogICAgICAgICAgICAgICAgICAgIHggPSArcFs1XTsKICAgICAgICAgICAgICAgICAgICB5ID0gK3BbNl07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzcCArPSBwLnNoaWZ0KCkgKyBwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN1YnBhdGhzLmVuZCA9IHNwOwogICAgICAgICAgICBwb2ludCA9IGlzdG90YWwgPyBsZW4gOiBzdWJwYXRoID8gc3VicGF0aHMgOiBmaW5kRG90c0F0U2VnbWVudCh4LCB5LCBwWzBdLCBwWzFdLCBwWzJdLCBwWzNdLCBwWzRdLCBwWzVdLCAxKTsKICAgICAgICAgICAgcmV0dXJuIHBvaW50OwogICAgICAgIH0sIG51bGwsIFNuYXAuXy5jbG9uZSk7CiAgICB9CiAgICB2YXIgZ2V0VG90YWxMZW5ndGggPSBnZXRMZW5ndGhGYWN0b3J5KDEpLAogICAgICAgIGdldFBvaW50QXRMZW5ndGggPSBnZXRMZW5ndGhGYWN0b3J5KCksCiAgICAgICAgZ2V0U3VicGF0aHNBdExlbmd0aCA9IGdldExlbmd0aEZhY3RvcnkoMCwgMSk7CiAgICBmdW5jdGlvbiBmaW5kRG90c0F0U2VnbWVudChwMXgsIHAxeSwgYzF4LCBjMXksIGMyeCwgYzJ5LCBwMngsIHAyeSwgdCkgewogICAgICAgIHZhciB0MSA9IDEgLSB0LAogICAgICAgICAgICB0MTMgPSBwb3codDEsIDMpLAogICAgICAgICAgICB0MTIgPSBwb3codDEsIDIpLAogICAgICAgICAgICB0MiA9IHQgKiB0LAogICAgICAgICAgICB0MyA9IHQyICogdCwKICAgICAgICAgICAgeCA9IHQxMyAqIHAxeCArIHQxMiAqIDMgKiB0ICogYzF4ICsgdDEgKiAzICogdCAqIHQgKiBjMnggKyB0MyAqIHAyeCwKICAgICAgICAgICAgeSA9IHQxMyAqIHAxeSArIHQxMiAqIDMgKiB0ICogYzF5ICsgdDEgKiAzICogdCAqIHQgKiBjMnkgKyB0MyAqIHAyeSwKICAgICAgICAgICAgbXggPSBwMXggKyAyICogdCAqIChjMXggLSBwMXgpICsgdDIgKiAoYzJ4IC0gMiAqIGMxeCArIHAxeCksCiAgICAgICAgICAgIG15ID0gcDF5ICsgMiAqIHQgKiAoYzF5IC0gcDF5KSArIHQyICogKGMyeSAtIDIgKiBjMXkgKyBwMXkpLAogICAgICAgICAgICBueCA9IGMxeCArIDIgKiB0ICogKGMyeCAtIGMxeCkgKyB0MiAqIChwMnggLSAyICogYzJ4ICsgYzF4KSwKICAgICAgICAgICAgbnkgPSBjMXkgKyAyICogdCAqIChjMnkgLSBjMXkpICsgdDIgKiAocDJ5IC0gMiAqIGMyeSArIGMxeSksCiAgICAgICAgICAgIGF4ID0gdDEgKiBwMXggKyB0ICogYzF4LAogICAgICAgICAgICBheSA9IHQxICogcDF5ICsgdCAqIGMxeSwKICAgICAgICAgICAgY3ggPSB0MSAqIGMyeCArIHQgKiBwMngsCiAgICAgICAgICAgIGN5ID0gdDEgKiBjMnkgKyB0ICogcDJ5LAogICAgICAgICAgICBhbHBoYSA9ICg5MCAtIG1hdGguYXRhbjIobXggLSBueCwgbXkgLSBueSkgKiAxODAgLyBQSSk7CiAgICAgICAgLy8gKG14ID4gbnggfHwgbXkgPCBueSkgJiYgKGFscGhhICs9IDE4MCk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgeDogeCwKICAgICAgICAgICAgeTogeSwKICAgICAgICAgICAgbToge3g6IG14LCB5OiBteX0sCiAgICAgICAgICAgIG46IHt4OiBueCwgeTogbnl9LAogICAgICAgICAgICBzdGFydDoge3g6IGF4LCB5OiBheX0sCiAgICAgICAgICAgIGVuZDoge3g6IGN4LCB5OiBjeX0sCiAgICAgICAgICAgIGFscGhhOiBhbHBoYQogICAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBiZXppZXJCQm94KHAxeCwgcDF5LCBjMXgsIGMxeSwgYzJ4LCBjMnksIHAyeCwgcDJ5KSB7CiAgICAgICAgaWYgKCFTbmFwLmlzKHAxeCwgImFycmF5IikpIHsKICAgICAgICAgICAgcDF4ID0gW3AxeCwgcDF5LCBjMXgsIGMxeSwgYzJ4LCBjMnksIHAyeCwgcDJ5XTsKICAgICAgICB9CiAgICAgICAgdmFyIGJib3ggPSBjdXJ2ZURpbS5hcHBseShudWxsLCBwMXgpOwogICAgICAgIHJldHVybiBib3goCiAgICAgICAgICAgIGJib3gubWluLngsCiAgICAgICAgICAgIGJib3gubWluLnksCiAgICAgICAgICAgIGJib3gubWF4LnggLSBiYm94Lm1pbi54LAogICAgICAgICAgICBiYm94Lm1heC55IC0gYmJveC5taW4ueQogICAgICAgICk7CiAgICB9CiAgICBmdW5jdGlvbiBpc1BvaW50SW5zaWRlQkJveChiYm94LCB4LCB5KSB7CiAgICAgICAgcmV0dXJuICB4ID49IGJib3gueCAmJgogICAgICAgICAgICAgICAgeCA8PSBiYm94LnggKyBiYm94LndpZHRoICYmCiAgICAgICAgICAgICAgICB5ID49IGJib3gueSAmJgogICAgICAgICAgICAgICAgeSA8PSBiYm94LnkgKyBiYm94LmhlaWdodDsKICAgIH0KICAgIGZ1bmN0aW9uIGlzQkJveEludGVyc2VjdChiYm94MSwgYmJveDIpIHsKICAgICAgICBiYm94MSA9IGJveChiYm94MSk7CiAgICAgICAgYmJveDIgPSBib3goYmJveDIpOwogICAgICAgIHJldHVybiBpc1BvaW50SW5zaWRlQkJveChiYm94MiwgYmJveDEueCwgYmJveDEueSkKICAgICAgICAgICAgfHwgaXNQb2ludEluc2lkZUJCb3goYmJveDIsIGJib3gxLngyLCBiYm94MS55KQogICAgICAgICAgICB8fCBpc1BvaW50SW5zaWRlQkJveChiYm94MiwgYmJveDEueCwgYmJveDEueTIpCiAgICAgICAgICAgIHx8IGlzUG9pbnRJbnNpZGVCQm94KGJib3gyLCBiYm94MS54MiwgYmJveDEueTIpCiAgICAgICAgICAgIHx8IGlzUG9pbnRJbnNpZGVCQm94KGJib3gxLCBiYm94Mi54LCBiYm94Mi55KQogICAgICAgICAgICB8fCBpc1BvaW50SW5zaWRlQkJveChiYm94MSwgYmJveDIueDIsIGJib3gyLnkpCiAgICAgICAgICAgIHx8IGlzUG9pbnRJbnNpZGVCQm94KGJib3gxLCBiYm94Mi54LCBiYm94Mi55MikKICAgICAgICAgICAgfHwgaXNQb2ludEluc2lkZUJCb3goYmJveDEsIGJib3gyLngyLCBiYm94Mi55MikKICAgICAgICAgICAgfHwgKGJib3gxLnggPCBiYm94Mi54MiAmJiBiYm94MS54ID4gYmJveDIueAogICAgICAgICAgICAgICAgfHwgYmJveDIueCA8IGJib3gxLngyICYmIGJib3gyLnggPiBiYm94MS54KQogICAgICAgICAgICAmJiAoYmJveDEueSA8IGJib3gyLnkyICYmIGJib3gxLnkgPiBiYm94Mi55CiAgICAgICAgICAgICAgICB8fCBiYm94Mi55IDwgYmJveDEueTIgJiYgYmJveDIueSA+IGJib3gxLnkpOwogICAgfQogICAgZnVuY3Rpb24gYmFzZTModCwgcDEsIHAyLCBwMywgcDQpIHsKICAgICAgICB2YXIgdDEgPSAtMyAqIHAxICsgOSAqIHAyIC0gOSAqIHAzICsgMyAqIHA0LAogICAgICAgICAgICB0MiA9IHQgKiB0MSArIDYgKiBwMSAtIDEyICogcDIgKyA2ICogcDM7CiAgICAgICAgcmV0dXJuIHQgKiB0MiAtIDMgKiBwMSArIDMgKiBwMjsKICAgIH0KICAgIGZ1bmN0aW9uIGJlemxlbih4MSwgeTEsIHgyLCB5MiwgeDMsIHkzLCB4NCwgeTQsIHopIHsKICAgICAgICBpZiAoeiA9PSBudWxsKSB7CiAgICAgICAgICAgIHogPSAxOwogICAgICAgIH0KICAgICAgICB6ID0geiA+IDEgPyAxIDogeiA8IDAgPyAwIDogejsKICAgICAgICB2YXIgejIgPSB6IC8gMiwKICAgICAgICAgICAgbiA9IDEyLAogICAgICAgICAgICBUdmFsdWVzID0gWy0uMTI1MiwuMTI1MiwtLjM2NzgsLjM2NzgsLS41ODczLC41ODczLC0uNzY5OSwuNzY5OSwtLjkwNDEsLjkwNDEsLS45ODE2LC45ODE2XSwKICAgICAgICAgICAgQ3ZhbHVlcyA9IFswLjI0OTEsMC4yNDkxLDAuMjMzNSwwLjIzMzUsMC4yMDMyLDAuMjAzMiwwLjE2MDEsMC4xNjAxLDAuMTA2OSwwLjEwNjksMC4wNDcyLDAuMDQ3Ml0sCiAgICAgICAgICAgIHN1bSA9IDA7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgdmFyIGN0ID0gejIgKiBUdmFsdWVzW2ldICsgejIsCiAgICAgICAgICAgICAgICB4YmFzZSA9IGJhc2UzKGN0LCB4MSwgeDIsIHgzLCB4NCksCiAgICAgICAgICAgICAgICB5YmFzZSA9IGJhc2UzKGN0LCB5MSwgeTIsIHkzLCB5NCksCiAgICAgICAgICAgICAgICBjb21iID0geGJhc2UgKiB4YmFzZSArIHliYXNlICogeWJhc2U7CiAgICAgICAgICAgIHN1bSArPSBDdmFsdWVzW2ldICogbWF0aC5zcXJ0KGNvbWIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gejIgKiBzdW07CiAgICB9CiAgICBmdW5jdGlvbiBnZXRUb3RMZW4oeDEsIHkxLCB4MiwgeTIsIHgzLCB5MywgeDQsIHk0LCBsbCkgewogICAgICAgIGlmIChsbCA8IDAgfHwgYmV6bGVuKHgxLCB5MSwgeDIsIHkyLCB4MywgeTMsIHg0LCB5NCkgPCBsbCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciB0ID0gMSwKICAgICAgICAgICAgc3RlcCA9IHQgLyAyLAogICAgICAgICAgICB0MiA9IHQgLSBzdGVwLAogICAgICAgICAgICBsLAogICAgICAgICAgICBlID0gLjAxOwogICAgICAgIGwgPSBiZXpsZW4oeDEsIHkxLCB4MiwgeTIsIHgzLCB5MywgeDQsIHk0LCB0Mik7CiAgICAgICAgd2hpbGUgKGFicyhsIC0gbGwpID4gZSkgewogICAgICAgICAgICBzdGVwIC89IDI7CiAgICAgICAgICAgIHQyICs9IChsIDwgbGwgPyAxIDogLTEpICogc3RlcDsKICAgICAgICAgICAgbCA9IGJlemxlbih4MSwgeTEsIHgyLCB5MiwgeDMsIHkzLCB4NCwgeTQsIHQyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHQyOwogICAgfQogICAgZnVuY3Rpb24gaW50ZXJzZWN0KHgxLCB5MSwgeDIsIHkyLCB4MywgeTMsIHg0LCB5NCkgewogICAgICAgIGlmICgKICAgICAgICAgICAgbW1heCh4MSwgeDIpIDwgbW1pbih4MywgeDQpIHx8CiAgICAgICAgICAgIG1taW4oeDEsIHgyKSA+IG1tYXgoeDMsIHg0KSB8fAogICAgICAgICAgICBtbWF4KHkxLCB5MikgPCBtbWluKHkzLCB5NCkgfHwKICAgICAgICAgICAgbW1pbih5MSwgeTIpID4gbW1heCh5MywgeTQpCiAgICAgICAgKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIG54ID0gKHgxICogeTIgLSB5MSAqIHgyKSAqICh4MyAtIHg0KSAtICh4MSAtIHgyKSAqICh4MyAqIHk0IC0geTMgKiB4NCksCiAgICAgICAgICAgIG55ID0gKHgxICogeTIgLSB5MSAqIHgyKSAqICh5MyAtIHk0KSAtICh5MSAtIHkyKSAqICh4MyAqIHk0IC0geTMgKiB4NCksCiAgICAgICAgICAgIGRlbm9taW5hdG9yID0gKHgxIC0geDIpICogKHkzIC0geTQpIC0gKHkxIC0geTIpICogKHgzIC0geDQpOwoKICAgICAgICBpZiAoIWRlbm9taW5hdG9yKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIHB4ID0gbnggLyBkZW5vbWluYXRvciwKICAgICAgICAgICAgcHkgPSBueSAvIGRlbm9taW5hdG9yLAogICAgICAgICAgICBweDIgPSArcHgudG9GaXhlZCgyKSwKICAgICAgICAgICAgcHkyID0gK3B5LnRvRml4ZWQoMik7CiAgICAgICAgaWYgKAogICAgICAgICAgICBweDIgPCArbW1pbih4MSwgeDIpLnRvRml4ZWQoMikgfHwKICAgICAgICAgICAgcHgyID4gK21tYXgoeDEsIHgyKS50b0ZpeGVkKDIpIHx8CiAgICAgICAgICAgIHB4MiA8ICttbWluKHgzLCB4NCkudG9GaXhlZCgyKSB8fAogICAgICAgICAgICBweDIgPiArbW1heCh4MywgeDQpLnRvRml4ZWQoMikgfHwKICAgICAgICAgICAgcHkyIDwgK21taW4oeTEsIHkyKS50b0ZpeGVkKDIpIHx8CiAgICAgICAgICAgIHB5MiA+ICttbWF4KHkxLCB5MikudG9GaXhlZCgyKSB8fAogICAgICAgICAgICBweTIgPCArbW1pbih5MywgeTQpLnRvRml4ZWQoMikgfHwKICAgICAgICAgICAgcHkyID4gK21tYXgoeTMsIHk0KS50b0ZpeGVkKDIpCiAgICAgICAgKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHt4OiBweCwgeTogcHl9OwogICAgfQogICAgZnVuY3Rpb24gaW50ZXIoYmV6MSwgYmV6MikgewogICAgICAgIHJldHVybiBpbnRlckhlbHBlcihiZXoxLCBiZXoyKTsKICAgIH0KICAgIGZ1bmN0aW9uIGludGVyQ291bnQoYmV6MSwgYmV6MikgewogICAgICAgIHJldHVybiBpbnRlckhlbHBlcihiZXoxLCBiZXoyLCAxKTsKICAgIH0KICAgIGZ1bmN0aW9uIGludGVySGVscGVyKGJlejEsIGJlejIsIGp1c3RDb3VudCkgewogICAgICAgIHZhciBiYm94MSA9IGJlemllckJCb3goYmV6MSksCiAgICAgICAgICAgIGJib3gyID0gYmV6aWVyQkJveChiZXoyKTsKICAgICAgICBpZiAoIWlzQkJveEludGVyc2VjdChiYm94MSwgYmJveDIpKSB7CiAgICAgICAgICAgIHJldHVybiBqdXN0Q291bnQgPyAwIDogW107CiAgICAgICAgfQogICAgICAgIHZhciBsMSA9IGJlemxlbi5hcHBseSgwLCBiZXoxKSwKICAgICAgICAgICAgbDIgPSBiZXpsZW4uYXBwbHkoMCwgYmV6MiksCiAgICAgICAgICAgIG4xID0gfn4obDEgLyA4KSwKICAgICAgICAgICAgbjIgPSB+fihsMiAvIDgpLAogICAgICAgICAgICBkb3RzMSA9IFtdLAogICAgICAgICAgICBkb3RzMiA9IFtdLAogICAgICAgICAgICB4eSA9IHt9LAogICAgICAgICAgICByZXMgPSBqdXN0Q291bnQgPyAwIDogW107CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuMSArIDE7IGkrKykgewogICAgICAgICAgICB2YXIgcCA9IGZpbmREb3RzQXRTZWdtZW50LmFwcGx5KDAsIGJlejEuY29uY2F0KGkgLyBuMSkpOwogICAgICAgICAgICBkb3RzMS5wdXNoKHt4OiBwLngsIHk6IHAueSwgdDogaSAvIG4xfSk7CiAgICAgICAgfQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBuMiArIDE7IGkrKykgewogICAgICAgICAgICBwID0gZmluZERvdHNBdFNlZ21lbnQuYXBwbHkoMCwgYmV6Mi5jb25jYXQoaSAvIG4yKSk7CiAgICAgICAgICAgIGRvdHMyLnB1c2goe3g6IHAueCwgeTogcC55LCB0OiBpIC8gbjJ9KTsKICAgICAgICB9CiAgICAgICAgZm9yIChpID0gMDsgaSA8IG4xOyBpKyspIHsKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBuMjsgaisrKSB7CiAgICAgICAgICAgICAgICB2YXIgZGkgPSBkb3RzMVtpXSwKICAgICAgICAgICAgICAgICAgICBkaTEgPSBkb3RzMVtpICsgMV0sCiAgICAgICAgICAgICAgICAgICAgZGogPSBkb3RzMltqXSwKICAgICAgICAgICAgICAgICAgICBkajEgPSBkb3RzMltqICsgMV0sCiAgICAgICAgICAgICAgICAgICAgY2kgPSBhYnMoZGkxLnggLSBkaS54KSA8IC4wMDEgPyAieSIgOiAieCIsCiAgICAgICAgICAgICAgICAgICAgY2ogPSBhYnMoZGoxLnggLSBkai54KSA8IC4wMDEgPyAieSIgOiAieCIsCiAgICAgICAgICAgICAgICAgICAgaXMgPSBpbnRlcnNlY3QoZGkueCwgZGkueSwgZGkxLngsIGRpMS55LCBkai54LCBkai55LCBkajEueCwgZGoxLnkpOwogICAgICAgICAgICAgICAgaWYgKGlzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHh5W2lzLngudG9GaXhlZCg0KV0gPT0gaXMueS50b0ZpeGVkKDQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB4eVtpcy54LnRvRml4ZWQoNCldID0gaXMueS50b0ZpeGVkKDQpOwogICAgICAgICAgICAgICAgICAgIHZhciB0MSA9IGRpLnQgKyBhYnMoKGlzW2NpXSAtIGRpW2NpXSkgLyAoZGkxW2NpXSAtIGRpW2NpXSkpICogKGRpMS50IC0gZGkudCksCiAgICAgICAgICAgICAgICAgICAgICAgIHQyID0gZGoudCArIGFicygoaXNbY2pdIC0gZGpbY2pdKSAvIChkajFbY2pdIC0gZGpbY2pdKSkgKiAoZGoxLnQgLSBkai50KTsKICAgICAgICAgICAgICAgICAgICBpZiAodDEgPj0gMCAmJiB0MSA8PSAxICYmIHQyID49IDAgJiYgdDIgPD0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoanVzdENvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiBpcy54LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IGlzLnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDE6IHQxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQyOiB0MgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlczsKICAgIH0KICAgIGZ1bmN0aW9uIHBhdGhJbnRlcnNlY3Rpb24ocGF0aDEsIHBhdGgyKSB7CiAgICAgICAgcmV0dXJuIGludGVyUGF0aEhlbHBlcihwYXRoMSwgcGF0aDIpOwogICAgfQogICAgZnVuY3Rpb24gcGF0aEludGVyc2VjdGlvbk51bWJlcihwYXRoMSwgcGF0aDIpIHsKICAgICAgICByZXR1cm4gaW50ZXJQYXRoSGVscGVyKHBhdGgxLCBwYXRoMiwgMSk7CiAgICB9CiAgICBmdW5jdGlvbiBpbnRlclBhdGhIZWxwZXIocGF0aDEsIHBhdGgyLCBqdXN0Q291bnQpIHsKICAgICAgICBwYXRoMSA9IHBhdGgyY3VydmUocGF0aDEpOwogICAgICAgIHBhdGgyID0gcGF0aDJjdXJ2ZShwYXRoMik7CiAgICAgICAgdmFyIHgxLCB5MSwgeDIsIHkyLCB4MW0sIHkxbSwgeDJtLCB5Mm0sIGJlejEsIGJlejIsCiAgICAgICAgICAgIHJlcyA9IGp1c3RDb3VudCA/IDAgOiBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBwYXRoMS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIHZhciBwaSA9IHBhdGgxW2ldOwogICAgICAgICAgICBpZiAocGlbMF0gPT0gIk0iKSB7CiAgICAgICAgICAgICAgICB4MSA9IHgxbSA9IHBpWzFdOwogICAgICAgICAgICAgICAgeTEgPSB5MW0gPSBwaVsyXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChwaVswXSA9PSAiQyIpIHsKICAgICAgICAgICAgICAgICAgICBiZXoxID0gW3gxLCB5MV0uY29uY2F0KHBpLnNsaWNlKDEpKTsKICAgICAgICAgICAgICAgICAgICB4MSA9IGJlejFbNl07CiAgICAgICAgICAgICAgICAgICAgeTEgPSBiZXoxWzddOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBiZXoxID0gW3gxLCB5MSwgeDEsIHkxLCB4MW0sIHkxbSwgeDFtLCB5MW1dOwogICAgICAgICAgICAgICAgICAgIHgxID0geDFtOwogICAgICAgICAgICAgICAgICAgIHkxID0geTFtOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpqID0gcGF0aDIubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgICAgICAgICAgIHZhciBwaiA9IHBhdGgyW2pdOwogICAgICAgICAgICAgICAgICAgIGlmIChwalswXSA9PSAiTSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgeDIgPSB4Mm0gPSBwalsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgeTIgPSB5Mm0gPSBwalsyXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGpbMF0gPT0gIkMiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZXoyID0gW3gyLCB5Ml0uY29uY2F0KHBqLnNsaWNlKDEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgyID0gYmV6Mls2XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkyID0gYmV6Mls3XTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlejIgPSBbeDIsIHkyLCB4MiwgeTIsIHgybSwgeTJtLCB4Mm0sIHkybV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4MiA9IHgybTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkyID0geTJtOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnRyID0gaW50ZXJIZWxwZXIoYmV6MSwgYmV6MiwganVzdENvdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGp1c3RDb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzICs9IGludHI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMCwga2sgPSBpbnRyLmxlbmd0aDsgayA8IGtrOyBrKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRyW2tdLnNlZ21lbnQxID0gaTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRyW2tdLnNlZ21lbnQyID0gajsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRyW2tdLmJlejEgPSBiZXoxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludHJba10uYmV6MiA9IGJlejI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMgPSByZXMuY29uY2F0KGludHIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXM7CiAgICB9CiAgICBmdW5jdGlvbiBpc1BvaW50SW5zaWRlUGF0aChwYXRoLCB4LCB5KSB7CiAgICAgICAgdmFyIGJib3ggPSBwYXRoQkJveChwYXRoKTsKICAgICAgICByZXR1cm4gaXNQb2ludEluc2lkZUJCb3goYmJveCwgeCwgeSkgJiYKICAgICAgICAgICAgICAgaW50ZXJQYXRoSGVscGVyKHBhdGgsIFtbIk0iLCB4LCB5XSwgWyJIIiwgYmJveC54MiArIDEwXV0sIDEpICUgMiA9PSAxOwogICAgfQogICAgZnVuY3Rpb24gcGF0aEJCb3gocGF0aCkgewogICAgICAgIHZhciBwdGggPSBwYXRocyhwYXRoKTsKICAgICAgICBpZiAocHRoLmJib3gpIHsKICAgICAgICAgICAgcmV0dXJuIGNsb25lKHB0aC5iYm94KTsKICAgICAgICB9CiAgICAgICAgaWYgKCFwYXRoKSB7CiAgICAgICAgICAgIHJldHVybiBib3goKTsKICAgICAgICB9CiAgICAgICAgcGF0aCA9IHBhdGgyY3VydmUocGF0aCk7CiAgICAgICAgdmFyIHggPSAwLCAKICAgICAgICAgICAgeSA9IDAsCiAgICAgICAgICAgIFggPSBbXSwKICAgICAgICAgICAgWSA9IFtdLAogICAgICAgICAgICBwOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHBhdGgubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICBwID0gcGF0aFtpXTsKICAgICAgICAgICAgaWYgKHBbMF0gPT0gIk0iKSB7CiAgICAgICAgICAgICAgICB4ID0gcFsxXTsKICAgICAgICAgICAgICAgIHkgPSBwWzJdOwogICAgICAgICAgICAgICAgWC5wdXNoKHgpOwogICAgICAgICAgICAgICAgWS5wdXNoKHkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyIGRpbSA9IGN1cnZlRGltKHgsIHksIHBbMV0sIHBbMl0sIHBbM10sIHBbNF0sIHBbNV0sIHBbNl0pOwogICAgICAgICAgICAgICAgWCA9IFguY29uY2F0KGRpbS5taW4ueCwgZGltLm1heC54KTsKICAgICAgICAgICAgICAgIFkgPSBZLmNvbmNhdChkaW0ubWluLnksIGRpbS5tYXgueSk7CiAgICAgICAgICAgICAgICB4ID0gcFs1XTsKICAgICAgICAgICAgICAgIHkgPSBwWzZdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciB4bWluID0gbW1pbi5hcHBseSgwLCBYKSwKICAgICAgICAgICAgeW1pbiA9IG1taW4uYXBwbHkoMCwgWSksCiAgICAgICAgICAgIHhtYXggPSBtbWF4LmFwcGx5KDAsIFgpLAogICAgICAgICAgICB5bWF4ID0gbW1heC5hcHBseSgwLCBZKSwKICAgICAgICAgICAgYmIgPSBib3goeG1pbiwgeW1pbiwgeG1heCAtIHhtaW4sIHltYXggLSB5bWluKTsKICAgICAgICBwdGguYmJveCA9IGNsb25lKGJiKTsKICAgICAgICByZXR1cm4gYmI7CiAgICB9CiAgICBmdW5jdGlvbiByZWN0UGF0aCh4LCB5LCB3LCBoLCByKSB7CiAgICAgICAgaWYgKHIpIHsKICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgIFsiTSIsICt4ICsgKCtyKSwgeV0sCiAgICAgICAgICAgICAgICBbImwiLCB3IC0gciAqIDIsIDBdLAogICAgICAgICAgICAgICAgWyJhIiwgciwgciwgMCwgMCwgMSwgciwgcl0sCiAgICAgICAgICAgICAgICBbImwiLCAwLCBoIC0gciAqIDJdLAogICAgICAgICAgICAgICAgWyJhIiwgciwgciwgMCwgMCwgMSwgLXIsIHJdLAogICAgICAgICAgICAgICAgWyJsIiwgciAqIDIgLSB3LCAwXSwKICAgICAgICAgICAgICAgIFsiYSIsIHIsIHIsIDAsIDAsIDEsIC1yLCAtcl0sCiAgICAgICAgICAgICAgICBbImwiLCAwLCByICogMiAtIGhdLAogICAgICAgICAgICAgICAgWyJhIiwgciwgciwgMCwgMCwgMSwgciwgLXJdLAogICAgICAgICAgICAgICAgWyJ6Il0KICAgICAgICAgICAgXTsKICAgICAgICB9CiAgICAgICAgdmFyIHJlcyA9IFtbIk0iLCB4LCB5XSwgWyJsIiwgdywgMF0sIFsibCIsIDAsIGhdLCBbImwiLCAtdywgMF0sIFsieiJdXTsKICAgICAgICByZXMudG9TdHJpbmcgPSB0b1N0cmluZzsKICAgICAgICByZXR1cm4gcmVzOwogICAgfQogICAgZnVuY3Rpb24gZWxsaXBzZVBhdGgoeCwgeSwgcngsIHJ5LCBhKSB7CiAgICAgICAgaWYgKGEgPT0gbnVsbCAmJiByeSA9PSBudWxsKSB7CiAgICAgICAgICAgIHJ5ID0gcng7CiAgICAgICAgfQogICAgICAgIHggPSAreDsKICAgICAgICB5ID0gK3k7CiAgICAgICAgcnggPSArcng7CiAgICAgICAgcnkgPSArcnk7CiAgICAgICAgaWYgKGEgIT0gbnVsbCkgewogICAgICAgICAgICB2YXIgcmFkID0gTWF0aC5QSSAvIDE4MCwKICAgICAgICAgICAgICAgIHgxID0geCArIHJ4ICogTWF0aC5jb3MoLXJ5ICogcmFkKSwKICAgICAgICAgICAgICAgIHgyID0geCArIHJ4ICogTWF0aC5jb3MoLWEgKiByYWQpLAogICAgICAgICAgICAgICAgeTEgPSB5ICsgcnggKiBNYXRoLnNpbigtcnkgKiByYWQpLAogICAgICAgICAgICAgICAgeTIgPSB5ICsgcnggKiBNYXRoLnNpbigtYSAqIHJhZCksCiAgICAgICAgICAgICAgICByZXMgPSBbWyJNIiwgeDEsIHkxXSwgWyJBIiwgcngsIHJ4LCAwLCArKGEgLSByeSA+IDE4MCksIDAsIHgyLCB5Ml1dOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlcyA9IFsKICAgICAgICAgICAgICAgIFsiTSIsIHgsIHldLAogICAgICAgICAgICAgICAgWyJtIiwgMCwgLXJ5XSwKICAgICAgICAgICAgICAgIFsiYSIsIHJ4LCByeSwgMCwgMSwgMSwgMCwgMiAqIHJ5XSwKICAgICAgICAgICAgICAgIFsiYSIsIHJ4LCByeSwgMCwgMSwgMSwgMCwgLTIgKiByeV0sCiAgICAgICAgICAgICAgICBbInoiXQogICAgICAgICAgICBdOwogICAgICAgIH0KICAgICAgICByZXMudG9TdHJpbmcgPSB0b1N0cmluZzsKICAgICAgICByZXR1cm4gcmVzOwogICAgfQogICAgdmFyIHVuaXQycHggPSBTbmFwLl91bml0MnB4LAogICAgICAgIGdldFBhdGggPSB7CiAgICAgICAgcGF0aDogZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICAgIHJldHVybiBlbC5hdHRyKCJwYXRoIik7CiAgICAgICAgfSwKICAgICAgICBjaXJjbGU6IGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgICB2YXIgYXR0ciA9IHVuaXQycHgoZWwpOwogICAgICAgICAgICByZXR1cm4gZWxsaXBzZVBhdGgoYXR0ci5jeCwgYXR0ci5jeSwgYXR0ci5yKTsKICAgICAgICB9LAogICAgICAgIGVsbGlwc2U6IGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgICB2YXIgYXR0ciA9IHVuaXQycHgoZWwpOwogICAgICAgICAgICByZXR1cm4gZWxsaXBzZVBhdGgoYXR0ci5jeCB8fCAwLCBhdHRyLmN5IHx8IDAsIGF0dHIucngsIGF0dHIucnkpOwogICAgICAgIH0sCiAgICAgICAgcmVjdDogZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICAgIHZhciBhdHRyID0gdW5pdDJweChlbCk7CiAgICAgICAgICAgIHJldHVybiByZWN0UGF0aChhdHRyLnggfHwgMCwgYXR0ci55IHx8IDAsIGF0dHIud2lkdGgsIGF0dHIuaGVpZ2h0LCBhdHRyLnJ4LCBhdHRyLnJ5KTsKICAgICAgICB9LAogICAgICAgIGltYWdlOiBmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgdmFyIGF0dHIgPSB1bml0MnB4KGVsKTsKICAgICAgICAgICAgcmV0dXJuIHJlY3RQYXRoKGF0dHIueCB8fCAwLCBhdHRyLnkgfHwgMCwgYXR0ci53aWR0aCwgYXR0ci5oZWlnaHQpOwogICAgICAgIH0sCiAgICAgICAgbGluZTogZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICAgIHJldHVybiAiTSIgKyBbZWwuYXR0cigieDEiKSB8fCAwLCBlbC5hdHRyKCJ5MSIpIHx8IDAsIGVsLmF0dHIoIngyIiksIGVsLmF0dHIoInkyIildOwogICAgICAgIH0sCiAgICAgICAgcG9seWxpbmU6IGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgICByZXR1cm4gIk0iICsgZWwuYXR0cigicG9pbnRzIik7CiAgICAgICAgfSwKICAgICAgICBwb2x5Z29uOiBmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgcmV0dXJuICJNIiArIGVsLmF0dHIoInBvaW50cyIpICsgInoiOwogICAgICAgIH0sCiAgICAgICAgZGVmbHQ6IGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgICB2YXIgYmJveCA9IGVsLm5vZGUuZ2V0QkJveCgpOwogICAgICAgICAgICByZXR1cm4gcmVjdFBhdGgoYmJveC54LCBiYm94LnksIGJib3gud2lkdGgsIGJib3guaGVpZ2h0KTsKICAgICAgICB9CiAgICB9OwogICAgZnVuY3Rpb24gcGF0aFRvUmVsYXRpdmUocGF0aEFycmF5KSB7CiAgICAgICAgdmFyIHB0aCA9IHBhdGhzKHBhdGhBcnJheSksCiAgICAgICAgICAgIGxvd2VyQ2FzZSA9IFN0cmluZy5wcm90b3R5cGUudG9Mb3dlckNhc2U7CiAgICAgICAgaWYgKHB0aC5yZWwpIHsKICAgICAgICAgICAgcmV0dXJuIHBhdGhDbG9uZShwdGgucmVsKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFTbmFwLmlzKHBhdGhBcnJheSwgImFycmF5IikgfHwgIVNuYXAuaXMocGF0aEFycmF5ICYmIHBhdGhBcnJheVswXSwgImFycmF5IikpIHsKICAgICAgICAgICAgcGF0aEFycmF5ID0gU25hcC5wYXJzZVBhdGhTdHJpbmcocGF0aEFycmF5KTsKICAgICAgICB9CiAgICAgICAgdmFyIHJlcyA9IFtdLAogICAgICAgICAgICB4ID0gMCwKICAgICAgICAgICAgeSA9IDAsCiAgICAgICAgICAgIG14ID0gMCwKICAgICAgICAgICAgbXkgPSAwLAogICAgICAgICAgICBzdGFydCA9IDA7CiAgICAgICAgaWYgKHBhdGhBcnJheVswXVswXSA9PSAiTSIpIHsKICAgICAgICAgICAgeCA9IHBhdGhBcnJheVswXVsxXTsKICAgICAgICAgICAgeSA9IHBhdGhBcnJheVswXVsyXTsKICAgICAgICAgICAgbXggPSB4OwogICAgICAgICAgICBteSA9IHk7CiAgICAgICAgICAgIHN0YXJ0Kys7CiAgICAgICAgICAgIHJlcy5wdXNoKFsiTSIsIHgsIHldKTsKICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0LCBpaSA9IHBhdGhBcnJheS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIHZhciByID0gcmVzW2ldID0gW10sCiAgICAgICAgICAgICAgICBwYSA9IHBhdGhBcnJheVtpXTsKICAgICAgICAgICAgaWYgKHBhWzBdICE9IGxvd2VyQ2FzZS5jYWxsKHBhWzBdKSkgewogICAgICAgICAgICAgICAgclswXSA9IGxvd2VyQ2FzZS5jYWxsKHBhWzBdKTsKICAgICAgICAgICAgICAgIHN3aXRjaCAoclswXSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgImEiOgogICAgICAgICAgICAgICAgICAgICAgICByWzFdID0gcGFbMV07CiAgICAgICAgICAgICAgICAgICAgICAgIHJbMl0gPSBwYVsyXTsKICAgICAgICAgICAgICAgICAgICAgICAgclszXSA9IHBhWzNdOwogICAgICAgICAgICAgICAgICAgICAgICByWzRdID0gcGFbNF07CiAgICAgICAgICAgICAgICAgICAgICAgIHJbNV0gPSBwYVs1XTsKICAgICAgICAgICAgICAgICAgICAgICAgcls2XSA9ICsocGFbNl0gLSB4KS50b0ZpeGVkKDMpOwogICAgICAgICAgICAgICAgICAgICAgICByWzddID0gKyhwYVs3XSAtIHkpLnRvRml4ZWQoMyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgInYiOgogICAgICAgICAgICAgICAgICAgICAgICByWzFdID0gKyhwYVsxXSAtIHkpLnRvRml4ZWQoMyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgIm0iOgogICAgICAgICAgICAgICAgICAgICAgICBteCA9IHBhWzFdOwogICAgICAgICAgICAgICAgICAgICAgICBteSA9IHBhWzJdOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAxLCBqaiA9IHBhLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJbal0gPSArKHBhW2pdIC0gKChqICUgMikgPyB4IDogeSkpLnRvRml4ZWQoMyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHIgPSByZXNbaV0gPSBbXTsKICAgICAgICAgICAgICAgIGlmIChwYVswXSA9PSAibSIpIHsKICAgICAgICAgICAgICAgICAgICBteCA9IHBhWzFdICsgeDsKICAgICAgICAgICAgICAgICAgICBteSA9IHBhWzJdICsgeTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwLCBrayA9IHBhLmxlbmd0aDsgayA8IGtrOyBrKyspIHsKICAgICAgICAgICAgICAgICAgICByZXNbaV1ba10gPSBwYVtrXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbGVuID0gcmVzW2ldLmxlbmd0aDsKICAgICAgICAgICAgc3dpdGNoIChyZXNbaV1bMF0pIHsKICAgICAgICAgICAgICAgIGNhc2UgInoiOgogICAgICAgICAgICAgICAgICAgIHggPSBteDsKICAgICAgICAgICAgICAgICAgICB5ID0gbXk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJoIjoKICAgICAgICAgICAgICAgICAgICB4ICs9ICtyZXNbaV1bbGVuIC0gMV07CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJ2IjoKICAgICAgICAgICAgICAgICAgICB5ICs9ICtyZXNbaV1bbGVuIC0gMV07CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHggKz0gK3Jlc1tpXVtsZW4gLSAyXTsKICAgICAgICAgICAgICAgICAgICB5ICs9ICtyZXNbaV1bbGVuIC0gMV07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmVzLnRvU3RyaW5nID0gdG9TdHJpbmc7CiAgICAgICAgcHRoLnJlbCA9IHBhdGhDbG9uZShyZXMpOwogICAgICAgIHJldHVybiByZXM7CiAgICB9CiAgICBmdW5jdGlvbiBwYXRoVG9BYnNvbHV0ZShwYXRoQXJyYXkpIHsKICAgICAgICB2YXIgcHRoID0gcGF0aHMocGF0aEFycmF5KTsKICAgICAgICBpZiAocHRoLmFicykgewogICAgICAgICAgICByZXR1cm4gcGF0aENsb25lKHB0aC5hYnMpOwogICAgICAgIH0KICAgICAgICBpZiAoIWlzKHBhdGhBcnJheSwgImFycmF5IikgfHwgIWlzKHBhdGhBcnJheSAmJiBwYXRoQXJyYXlbMF0sICJhcnJheSIpKSB7IC8vIHJvdWdoIGFzc3VtcHRpb24KICAgICAgICAgICAgcGF0aEFycmF5ID0gU25hcC5wYXJzZVBhdGhTdHJpbmcocGF0aEFycmF5KTsKICAgICAgICB9CiAgICAgICAgaWYgKCFwYXRoQXJyYXkgfHwgIXBhdGhBcnJheS5sZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIFtbIk0iLCAwLCAwXV07CiAgICAgICAgfQogICAgICAgIHZhciByZXMgPSBbXSwKICAgICAgICAgICAgeCA9IDAsCiAgICAgICAgICAgIHkgPSAwLAogICAgICAgICAgICBteCA9IDAsCiAgICAgICAgICAgIG15ID0gMCwKICAgICAgICAgICAgc3RhcnQgPSAwLAogICAgICAgICAgICBwYTA7CiAgICAgICAgaWYgKHBhdGhBcnJheVswXVswXSA9PSAiTSIpIHsKICAgICAgICAgICAgeCA9ICtwYXRoQXJyYXlbMF1bMV07CiAgICAgICAgICAgIHkgPSArcGF0aEFycmF5WzBdWzJdOwogICAgICAgICAgICBteCA9IHg7CiAgICAgICAgICAgIG15ID0geTsKICAgICAgICAgICAgc3RhcnQrKzsKICAgICAgICAgICAgcmVzWzBdID0gWyJNIiwgeCwgeV07CiAgICAgICAgfQogICAgICAgIHZhciBjcnogPSBwYXRoQXJyYXkubGVuZ3RoID09IDMgJiYKICAgICAgICAgICAgcGF0aEFycmF5WzBdWzBdID09ICJNIiAmJgogICAgICAgICAgICBwYXRoQXJyYXlbMV1bMF0udG9VcHBlckNhc2UoKSA9PSAiUiIgJiYKICAgICAgICAgICAgcGF0aEFycmF5WzJdWzBdLnRvVXBwZXJDYXNlKCkgPT0gIloiOwogICAgICAgIGZvciAodmFyIHIsIHBhLCBpID0gc3RhcnQsIGlpID0gcGF0aEFycmF5Lmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgcmVzLnB1c2gociA9IFtdKTsKICAgICAgICAgICAgcGEgPSBwYXRoQXJyYXlbaV07CiAgICAgICAgICAgIHBhMCA9IHBhWzBdOwogICAgICAgICAgICBpZiAocGEwICE9IHBhMC50b1VwcGVyQ2FzZSgpKSB7CiAgICAgICAgICAgICAgICByWzBdID0gcGEwLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKHJbMF0pIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJBIjoKICAgICAgICAgICAgICAgICAgICAgICAgclsxXSA9IHBhWzFdOwogICAgICAgICAgICAgICAgICAgICAgICByWzJdID0gcGFbMl07CiAgICAgICAgICAgICAgICAgICAgICAgIHJbM10gPSBwYVszXTsKICAgICAgICAgICAgICAgICAgICAgICAgcls0XSA9IHBhWzRdOwogICAgICAgICAgICAgICAgICAgICAgICByWzVdID0gcGFbNV07CiAgICAgICAgICAgICAgICAgICAgICAgIHJbNl0gPSArcGFbNl0gKyB4OwogICAgICAgICAgICAgICAgICAgICAgICByWzddID0gK3BhWzddICsgeTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiViI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJbMV0gPSArcGFbMV0gKyB5OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJIIjoKICAgICAgICAgICAgICAgICAgICAgICAgclsxXSA9ICtwYVsxXSArIHg7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgIlIiOgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZG90cyA9IFt4LCB5XS5jb25jYXQocGEuc2xpY2UoMSkpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMiwgamogPSBkb3RzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvdHNbal0gPSArZG90c1tqXSArIHg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb3RzWysral0gPSArZG90c1tqXSArIHk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXMgPSByZXMuY29uY2F0KGNhdG11bGxSb20yYmV6aWVyKGRvdHMsIGNyeikpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJPIjoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICBkb3RzID0gZWxsaXBzZVBhdGgoeCwgeSwgcGFbMV0sIHBhWzJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgZG90cy5wdXNoKGRvdHNbMF0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXMgPSByZXMuY29uY2F0KGRvdHMpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJVIjoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXMgPSByZXMuY29uY2F0KGVsbGlwc2VQYXRoKHgsIHksIHBhWzFdLCBwYVsyXSwgcGFbM10pKTsKICAgICAgICAgICAgICAgICAgICAgICAgciA9IFsiVSJdLmNvbmNhdChyZXNbcmVzLmxlbmd0aCAtIDFdLnNsaWNlKC0yKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgIk0iOgogICAgICAgICAgICAgICAgICAgICAgICBteCA9ICtwYVsxXSArIHg7CiAgICAgICAgICAgICAgICAgICAgICAgIG15ID0gK3BhWzJdICsgeTsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSAxLCBqaiA9IHBhLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJbal0gPSArcGFbal0gKyAoKGogJSAyKSA/IHggOiB5KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHBhMCA9PSAiUiIpIHsKICAgICAgICAgICAgICAgIGRvdHMgPSBbeCwgeV0uY29uY2F0KHBhLnNsaWNlKDEpKTsKICAgICAgICAgICAgICAgIHJlcy5wb3AoKTsKICAgICAgICAgICAgICAgIHJlcyA9IHJlcy5jb25jYXQoY2F0bXVsbFJvbTJiZXppZXIoZG90cywgY3J6KSk7CiAgICAgICAgICAgICAgICByID0gWyJSIl0uY29uY2F0KHBhLnNsaWNlKC0yKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocGEwID09ICJPIikgewogICAgICAgICAgICAgICAgcmVzLnBvcCgpOwogICAgICAgICAgICAgICAgZG90cyA9IGVsbGlwc2VQYXRoKHgsIHksIHBhWzFdLCBwYVsyXSk7CiAgICAgICAgICAgICAgICBkb3RzLnB1c2goZG90c1swXSk7CiAgICAgICAgICAgICAgICByZXMgPSByZXMuY29uY2F0KGRvdHMpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHBhMCA9PSAiVSIpIHsKICAgICAgICAgICAgICAgIHJlcy5wb3AoKTsKICAgICAgICAgICAgICAgIHJlcyA9IHJlcy5jb25jYXQoZWxsaXBzZVBhdGgoeCwgeSwgcGFbMV0sIHBhWzJdLCBwYVszXSkpOwogICAgICAgICAgICAgICAgciA9IFsiVSJdLmNvbmNhdChyZXNbcmVzLmxlbmd0aCAtIDFdLnNsaWNlKC0yKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMCwga2sgPSBwYS5sZW5ndGg7IGsgPCBrazsgaysrKSB7CiAgICAgICAgICAgICAgICAgICAgcltrXSA9IHBhW2tdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHBhMCA9IHBhMC50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICBpZiAocGEwICE9ICJPIikgewogICAgICAgICAgICAgICAgc3dpdGNoIChyWzBdKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiWiI6CiAgICAgICAgICAgICAgICAgICAgICAgIHggPSArbXg7CiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSArbXk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgIkgiOgogICAgICAgICAgICAgICAgICAgICAgICB4ID0gclsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiViI6CiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSByWzFdOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJNIjoKICAgICAgICAgICAgICAgICAgICAgICAgbXggPSByW3IubGVuZ3RoIC0gMl07CiAgICAgICAgICAgICAgICAgICAgICAgIG15ID0gcltyLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHggPSByW3IubGVuZ3RoIC0gMl07CiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSByW3IubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmVzLnRvU3RyaW5nID0gdG9TdHJpbmc7CiAgICAgICAgcHRoLmFicyA9IHBhdGhDbG9uZShyZXMpOwogICAgICAgIHJldHVybiByZXM7CiAgICB9CiAgICBmdW5jdGlvbiBsMmMoeDEsIHkxLCB4MiwgeTIpIHsKICAgICAgICByZXR1cm4gW3gxLCB5MSwgeDIsIHkyLCB4MiwgeTJdOwogICAgfQogICAgZnVuY3Rpb24gcTJjKHgxLCB5MSwgYXgsIGF5LCB4MiwgeTIpIHsKICAgICAgICB2YXIgXzEzID0gMSAvIDMsCiAgICAgICAgICAgIF8yMyA9IDIgLyAzOwogICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICBfMTMgKiB4MSArIF8yMyAqIGF4LAogICAgICAgICAgICAgICAgXzEzICogeTEgKyBfMjMgKiBheSwKICAgICAgICAgICAgICAgIF8xMyAqIHgyICsgXzIzICogYXgsCiAgICAgICAgICAgICAgICBfMTMgKiB5MiArIF8yMyAqIGF5LAogICAgICAgICAgICAgICAgeDIsCiAgICAgICAgICAgICAgICB5MgogICAgICAgICAgICBdOwogICAgfQogICAgZnVuY3Rpb24gYTJjKHgxLCB5MSwgcngsIHJ5LCBhbmdsZSwgbGFyZ2VfYXJjX2ZsYWcsIHN3ZWVwX2ZsYWcsIHgyLCB5MiwgcmVjdXJzaXZlKSB7CiAgICAgICAgLy8gZm9yIG1vcmUgaW5mb3JtYXRpb24gb2Ygd2hlcmUgdGhpcyBtYXRoIGNhbWUgZnJvbSB2aXNpdDoKICAgICAgICAvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9pbXBsbm90ZS5odG1sI0FyY0ltcGxlbWVudGF0aW9uTm90ZXMKICAgICAgICB2YXIgXzEyMCA9IFBJICogMTIwIC8gMTgwLAogICAgICAgICAgICByYWQgPSBQSSAvIDE4MCAqICgrYW5nbGUgfHwgMCksCiAgICAgICAgICAgIHJlcyA9IFtdLAogICAgICAgICAgICB4eSwKICAgICAgICAgICAgcm90YXRlID0gU25hcC5fLmNhY2hlcihmdW5jdGlvbiAoeCwgeSwgcmFkKSB7CiAgICAgICAgICAgICAgICB2YXIgWCA9IHggKiBtYXRoLmNvcyhyYWQpIC0geSAqIG1hdGguc2luKHJhZCksCiAgICAgICAgICAgICAgICAgICAgWSA9IHggKiBtYXRoLnNpbihyYWQpICsgeSAqIG1hdGguY29zKHJhZCk7CiAgICAgICAgICAgICAgICByZXR1cm4ge3g6IFgsIHk6IFl9OwogICAgICAgICAgICB9KTsKICAgICAgICBpZiAoIXJlY3Vyc2l2ZSkgewogICAgICAgICAgICB4eSA9IHJvdGF0ZSh4MSwgeTEsIC1yYWQpOwogICAgICAgICAgICB4MSA9IHh5Lng7CiAgICAgICAgICAgIHkxID0geHkueTsKICAgICAgICAgICAgeHkgPSByb3RhdGUoeDIsIHkyLCAtcmFkKTsKICAgICAgICAgICAgeDIgPSB4eS54OwogICAgICAgICAgICB5MiA9IHh5Lnk7CiAgICAgICAgICAgIHZhciBjb3MgPSBtYXRoLmNvcyhQSSAvIDE4MCAqIGFuZ2xlKSwKICAgICAgICAgICAgICAgIHNpbiA9IG1hdGguc2luKFBJIC8gMTgwICogYW5nbGUpLAogICAgICAgICAgICAgICAgeCA9ICh4MSAtIHgyKSAvIDIsCiAgICAgICAgICAgICAgICB5ID0gKHkxIC0geTIpIC8gMjsKICAgICAgICAgICAgdmFyIGggPSAoeCAqIHgpIC8gKHJ4ICogcngpICsgKHkgKiB5KSAvIChyeSAqIHJ5KTsKICAgICAgICAgICAgaWYgKGggPiAxKSB7CiAgICAgICAgICAgICAgICBoID0gbWF0aC5zcXJ0KGgpOwogICAgICAgICAgICAgICAgcnggPSBoICogcng7CiAgICAgICAgICAgICAgICByeSA9IGggKiByeTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcngyID0gcnggKiByeCwKICAgICAgICAgICAgICAgIHJ5MiA9IHJ5ICogcnksCiAgICAgICAgICAgICAgICBrID0gKGxhcmdlX2FyY19mbGFnID09IHN3ZWVwX2ZsYWcgPyAtMSA6IDEpICoKICAgICAgICAgICAgICAgICAgICBtYXRoLnNxcnQoYWJzKChyeDIgKiByeTIgLSByeDIgKiB5ICogeSAtIHJ5MiAqIHggKiB4KSAvIChyeDIgKiB5ICogeSArIHJ5MiAqIHggKiB4KSkpLAogICAgICAgICAgICAgICAgY3ggPSBrICogcnggKiB5IC8gcnkgKyAoeDEgKyB4MikgLyAyLAogICAgICAgICAgICAgICAgY3kgPSBrICogLXJ5ICogeCAvIHJ4ICsgKHkxICsgeTIpIC8gMiwKICAgICAgICAgICAgICAgIGYxID0gbWF0aC5hc2luKCgoeTEgLSBjeSkgLyByeSkudG9GaXhlZCg5KSksCiAgICAgICAgICAgICAgICBmMiA9IG1hdGguYXNpbigoKHkyIC0gY3kpIC8gcnkpLnRvRml4ZWQoOSkpOwoKICAgICAgICAgICAgZjEgPSB4MSA8IGN4ID8gUEkgLSBmMSA6IGYxOwogICAgICAgICAgICBmMiA9IHgyIDwgY3ggPyBQSSAtIGYyIDogZjI7CiAgICAgICAgICAgIGYxIDwgMCAmJiAoZjEgPSBQSSAqIDIgKyBmMSk7CiAgICAgICAgICAgIGYyIDwgMCAmJiAoZjIgPSBQSSAqIDIgKyBmMik7CiAgICAgICAgICAgIGlmIChzd2VlcF9mbGFnICYmIGYxID4gZjIpIHsKICAgICAgICAgICAgICAgIGYxID0gZjEgLSBQSSAqIDI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFzd2VlcF9mbGFnICYmIGYyID4gZjEpIHsKICAgICAgICAgICAgICAgIGYyID0gZjIgLSBQSSAqIDI7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmMSA9IHJlY3Vyc2l2ZVswXTsKICAgICAgICAgICAgZjIgPSByZWN1cnNpdmVbMV07CiAgICAgICAgICAgIGN4ID0gcmVjdXJzaXZlWzJdOwogICAgICAgICAgICBjeSA9IHJlY3Vyc2l2ZVszXTsKICAgICAgICB9CiAgICAgICAgdmFyIGRmID0gZjIgLSBmMTsKICAgICAgICBpZiAoYWJzKGRmKSA+IF8xMjApIHsKICAgICAgICAgICAgdmFyIGYyb2xkID0gZjIsCiAgICAgICAgICAgICAgICB4Mm9sZCA9IHgyLAogICAgICAgICAgICAgICAgeTJvbGQgPSB5MjsKICAgICAgICAgICAgZjIgPSBmMSArIF8xMjAgKiAoc3dlZXBfZmxhZyAmJiBmMiA+IGYxID8gMSA6IC0xKTsKICAgICAgICAgICAgeDIgPSBjeCArIHJ4ICogbWF0aC5jb3MoZjIpOwogICAgICAgICAgICB5MiA9IGN5ICsgcnkgKiBtYXRoLnNpbihmMik7CiAgICAgICAgICAgIHJlcyA9IGEyYyh4MiwgeTIsIHJ4LCByeSwgYW5nbGUsIDAsIHN3ZWVwX2ZsYWcsIHgyb2xkLCB5Mm9sZCwgW2YyLCBmMm9sZCwgY3gsIGN5XSk7CiAgICAgICAgfQogICAgICAgIGRmID0gZjIgLSBmMTsKICAgICAgICB2YXIgYzEgPSBtYXRoLmNvcyhmMSksCiAgICAgICAgICAgIHMxID0gbWF0aC5zaW4oZjEpLAogICAgICAgICAgICBjMiA9IG1hdGguY29zKGYyKSwKICAgICAgICAgICAgczIgPSBtYXRoLnNpbihmMiksCiAgICAgICAgICAgIHQgPSBtYXRoLnRhbihkZiAvIDQpLAogICAgICAgICAgICBoeCA9IDQgLyAzICogcnggKiB0LAogICAgICAgICAgICBoeSA9IDQgLyAzICogcnkgKiB0LAogICAgICAgICAgICBtMSA9IFt4MSwgeTFdLAogICAgICAgICAgICBtMiA9IFt4MSArIGh4ICogczEsIHkxIC0gaHkgKiBjMV0sCiAgICAgICAgICAgIG0zID0gW3gyICsgaHggKiBzMiwgeTIgLSBoeSAqIGMyXSwKICAgICAgICAgICAgbTQgPSBbeDIsIHkyXTsKICAgICAgICBtMlswXSA9IDIgKiBtMVswXSAtIG0yWzBdOwogICAgICAgIG0yWzFdID0gMiAqIG0xWzFdIC0gbTJbMV07CiAgICAgICAgaWYgKHJlY3Vyc2l2ZSkgewogICAgICAgICAgICByZXR1cm4gW20yLCBtMywgbTRdLmNvbmNhdChyZXMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlcyA9IFttMiwgbTMsIG00XS5jb25jYXQocmVzKS5qb2luKCkuc3BsaXQoIiwiKTsKICAgICAgICAgICAgdmFyIG5ld3JlcyA9IFtdOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSByZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgICAgbmV3cmVzW2ldID0gaSAlIDIgPyByb3RhdGUocmVzW2kgLSAxXSwgcmVzW2ldLCByYWQpLnkgOiByb3RhdGUocmVzW2ldLCByZXNbaSArIDFdLCByYWQpLng7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5ld3JlczsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBmaW5kRG90QXRTZWdtZW50KHAxeCwgcDF5LCBjMXgsIGMxeSwgYzJ4LCBjMnksIHAyeCwgcDJ5LCB0KSB7CiAgICAgICAgdmFyIHQxID0gMSAtIHQ7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgeDogcG93KHQxLCAzKSAqIHAxeCArIHBvdyh0MSwgMikgKiAzICogdCAqIGMxeCArIHQxICogMyAqIHQgKiB0ICogYzJ4ICsgcG93KHQsIDMpICogcDJ4LAogICAgICAgICAgICB5OiBwb3codDEsIDMpICogcDF5ICsgcG93KHQxLCAyKSAqIDMgKiB0ICogYzF5ICsgdDEgKiAzICogdCAqIHQgKiBjMnkgKyBwb3codCwgMykgKiBwMnkKICAgICAgICB9OwogICAgfQogICAgCiAgICAvLyBSZXR1cm5zIGJvdW5kaW5nIGJveCBvZiBjdWJpYyBiZXppZXIgY3VydmUuCiAgICAvLyBTb3VyY2U6IGh0dHA6Ly9ibG9nLmhhY2tlcnMtY2FmZS5uZXQvMjAwOS8wNi9ob3ctdG8tY2FsY3VsYXRlLWJlemllci1jdXJ2ZXMtYm91bmRpbmcuaHRtbAogICAgLy8gT3JpZ2luYWwgdmVyc2lvbjogTklTSElPIEhpcm9rYXp1CiAgICAvLyBNb2RpZmljYXRpb25zOiBodHRwczovL2dpdGh1Yi5jb20vdGltbzIyMzQ1CiAgICBmdW5jdGlvbiBjdXJ2ZURpbSh4MCwgeTAsIHgxLCB5MSwgeDIsIHkyLCB4MywgeTMpIHsKICAgICAgICB2YXIgdHZhbHVlcyA9IFtdLAogICAgICAgICAgICBib3VuZHMgPSBbW10sIFtdXSwKICAgICAgICAgICAgYSwgYiwgYywgdCwgdDEsIHQyLCBiMmFjLCBzcXJ0YjJhYzsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI7ICsraSkgewogICAgICAgICAgICBpZiAoaSA9PSAwKSB7CiAgICAgICAgICAgICAgICBiID0gNiAqIHgwIC0gMTIgKiB4MSArIDYgKiB4MjsKICAgICAgICAgICAgICAgIGEgPSAtMyAqIHgwICsgOSAqIHgxIC0gOSAqIHgyICsgMyAqIHgzOwogICAgICAgICAgICAgICAgYyA9IDMgKiB4MSAtIDMgKiB4MDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGIgPSA2ICogeTAgLSAxMiAqIHkxICsgNiAqIHkyOwogICAgICAgICAgICAgICAgYSA9IC0zICogeTAgKyA5ICogeTEgLSA5ICogeTIgKyAzICogeTM7CiAgICAgICAgICAgICAgICBjID0gMyAqIHkxIC0gMyAqIHkwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhYnMoYSkgPCAxZS0xMikgewogICAgICAgICAgICAgICAgaWYgKGFicyhiKSA8IDFlLTEyKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0ID0gLWMgLyBiOwogICAgICAgICAgICAgICAgaWYgKDAgPCB0ICYmIHQgPCAxKSB7CiAgICAgICAgICAgICAgICAgICAgdHZhbHVlcy5wdXNoKHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYjJhYyA9IGIgKiBiIC0gNCAqIGMgKiBhOwogICAgICAgICAgICBzcXJ0YjJhYyA9IG1hdGguc3FydChiMmFjKTsKICAgICAgICAgICAgaWYgKGIyYWMgPCAwKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0MSA9ICgtYiArIHNxcnRiMmFjKSAvICgyICogYSk7CiAgICAgICAgICAgIGlmICgwIDwgdDEgJiYgdDEgPCAxKSB7CiAgICAgICAgICAgICAgICB0dmFsdWVzLnB1c2godDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHQyID0gKC1iIC0gc3FydGIyYWMpIC8gKDIgKiBhKTsKICAgICAgICAgICAgaWYgKDAgPCB0MiAmJiB0MiA8IDEpIHsKICAgICAgICAgICAgICAgIHR2YWx1ZXMucHVzaCh0Mik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciB4LCB5LCBqID0gdHZhbHVlcy5sZW5ndGgsCiAgICAgICAgICAgIGpsZW4gPSBqLAogICAgICAgICAgICBtdDsKICAgICAgICB3aGlsZSAoai0tKSB7CiAgICAgICAgICAgIHQgPSB0dmFsdWVzW2pdOwogICAgICAgICAgICBtdCA9IDEgLSB0OwogICAgICAgICAgICBib3VuZHNbMF1bal0gPSAobXQgKiBtdCAqIG10ICogeDApICsgKDMgKiBtdCAqIG10ICogdCAqIHgxKSArICgzICogbXQgKiB0ICogdCAqIHgyKSArICh0ICogdCAqIHQgKiB4Myk7CiAgICAgICAgICAgIGJvdW5kc1sxXVtqXSA9IChtdCAqIG10ICogbXQgKiB5MCkgKyAoMyAqIG10ICogbXQgKiB0ICogeTEpICsgKDMgKiBtdCAqIHQgKiB0ICogeTIpICsgKHQgKiB0ICogdCAqIHkzKTsKICAgICAgICB9CgogICAgICAgIGJvdW5kc1swXVtqbGVuXSA9IHgwOwogICAgICAgIGJvdW5kc1sxXVtqbGVuXSA9IHkwOwogICAgICAgIGJvdW5kc1swXVtqbGVuICsgMV0gPSB4MzsKICAgICAgICBib3VuZHNbMV1bamxlbiArIDFdID0geTM7CiAgICAgICAgYm91bmRzWzBdLmxlbmd0aCA9IGJvdW5kc1sxXS5sZW5ndGggPSBqbGVuICsgMjsKCgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBtaW46IHt4OiBtbWluLmFwcGx5KDAsIGJvdW5kc1swXSksIHk6IG1taW4uYXBwbHkoMCwgYm91bmRzWzFdKX0sCiAgICAgICAgICBtYXg6IHt4OiBtbWF4LmFwcGx5KDAsIGJvdW5kc1swXSksIHk6IG1tYXguYXBwbHkoMCwgYm91bmRzWzFdKX0KICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIHBhdGgyY3VydmUocGF0aCwgcGF0aDIpIHsKICAgICAgICB2YXIgcHRoID0gIXBhdGgyICYmIHBhdGhzKHBhdGgpOwogICAgICAgIGlmICghcGF0aDIgJiYgcHRoLmN1cnZlKSB7CiAgICAgICAgICAgIHJldHVybiBwYXRoQ2xvbmUocHRoLmN1cnZlKTsKICAgICAgICB9CiAgICAgICAgdmFyIHAgPSBwYXRoVG9BYnNvbHV0ZShwYXRoKSwKICAgICAgICAgICAgcDIgPSBwYXRoMiAmJiBwYXRoVG9BYnNvbHV0ZShwYXRoMiksCiAgICAgICAgICAgIGF0dHJzID0ge3g6IDAsIHk6IDAsIGJ4OiAwLCBieTogMCwgWDogMCwgWTogMCwgcXg6IG51bGwsIHF5OiBudWxsfSwKICAgICAgICAgICAgYXR0cnMyID0ge3g6IDAsIHk6IDAsIGJ4OiAwLCBieTogMCwgWDogMCwgWTogMCwgcXg6IG51bGwsIHF5OiBudWxsfSwKICAgICAgICAgICAgcHJvY2Vzc1BhdGggPSBmdW5jdGlvbiAocGF0aCwgZCwgcGNvbSkgewogICAgICAgICAgICAgICAgdmFyIG54LCBueTsKICAgICAgICAgICAgICAgIGlmICghcGF0aCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBbIkMiLCBkLngsIGQueSwgZC54LCBkLnksIGQueCwgZC55XTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICEocGF0aFswXSBpbiB7VDogMSwgUTogMX0pICYmIChkLnF4ID0gZC5xeSA9IG51bGwpOwogICAgICAgICAgICAgICAgc3dpdGNoIChwYXRoWzBdKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiTSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGQuWCA9IHBhdGhbMV07CiAgICAgICAgICAgICAgICAgICAgICAgIGQuWSA9IHBhdGhbMl07CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgIkEiOgogICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gWyJDIl0uY29uY2F0KGEyYy5hcHBseSgwLCBbZC54LCBkLnldLmNvbmNhdChwYXRoLnNsaWNlKDEpKSkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJTIjoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBjb20gPT0gIkMiIHx8IHBjb20gPT0gIlMiKSB7IC8vIEluICJTIiBjYXNlIHdlIGhhdmUgdG8gdGFrZSBpbnRvIGFjY291bnQsIGlmIHRoZSBwcmV2aW91cyBjb21tYW5kIGlzIEMvUy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG54ID0gZC54ICogMiAtIGQuYng7ICAgICAgICAgIC8vIEFuZCByZWZsZWN0IHRoZSBwcmV2aW91cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbnkgPSBkLnkgKiAyIC0gZC5ieTsgICAgICAgICAgLy8gY29tbWFuZCdzIGNvbnRyb2wgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgcG9pbnQuCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9yIHNvbWUgZWxzZSBvciBub3RoaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBueCA9IGQueDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG55ID0gZC55OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSBbIkMiLCBueCwgbnldLmNvbmNhdChwYXRoLnNsaWNlKDEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiVCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwY29tID09ICJRIiB8fCBwY29tID09ICJUIikgeyAvLyBJbiAiVCIgY2FzZSB3ZSBoYXZlIHRvIHRha2UgaW50byBhY2NvdW50LCBpZiB0aGUgcHJldmlvdXMgY29tbWFuZCBpcyBRL1QuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnF4ID0gZC54ICogMiAtIGQucXg7ICAgICAgICAvLyBBbmQgbWFrZSBhIHJlZmxlY3Rpb24gc2ltaWxhcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5xeSA9IGQueSAqIDIgLSBkLnF5OyAgICAgICAgLy8gdG8gY2FzZSAiUyIuCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9yIHNvbWV0aGluZyBlbHNlIG9yIG5vdGhpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucXggPSBkLng7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnF5ID0gZC55OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSBbIkMiXS5jb25jYXQocTJjKGQueCwgZC55LCBkLnF4LCBkLnF5LCBwYXRoWzFdLCBwYXRoWzJdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgIlEiOgogICAgICAgICAgICAgICAgICAgICAgICBkLnF4ID0gcGF0aFsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgZC5xeSA9IHBhdGhbMl07CiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSBbIkMiXS5jb25jYXQocTJjKGQueCwgZC55LCBwYXRoWzFdLCBwYXRoWzJdLCBwYXRoWzNdLCBwYXRoWzRdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgIkwiOgogICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gWyJDIl0uY29uY2F0KGwyYyhkLngsIGQueSwgcGF0aFsxXSwgcGF0aFsyXSkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJIIjoKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IFsiQyJdLmNvbmNhdChsMmMoZC54LCBkLnksIHBhdGhbMV0sIGQueSkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJWIjoKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IFsiQyJdLmNvbmNhdChsMmMoZC54LCBkLnksIGQueCwgcGF0aFsxXSkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJaIjoKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IFsiQyJdLmNvbmNhdChsMmMoZC54LCBkLnksIGQuWCwgZC5ZKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHBhdGg7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZpeEFyYyA9IGZ1bmN0aW9uIChwcCwgaSkgewogICAgICAgICAgICAgICAgaWYgKHBwW2ldLmxlbmd0aCA+IDcpIHsKICAgICAgICAgICAgICAgICAgICBwcFtpXS5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIHZhciBwaSA9IHBwW2ldOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChwaS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGNvbXMxW2ldID0gIkEiOyAvLyBpZiBjcmVhdGVkIG11bHRpcGxlIEM6cywgdGhlaXIgb3JpZ2luYWwgc2VnIGlzIHNhdmVkCiAgICAgICAgICAgICAgICAgICAgICAgIHAyICYmIChwY29tczJbaV0gPSAiQSIpOyAvLyB0aGUgc2FtZSBhcyBhYm92ZQogICAgICAgICAgICAgICAgICAgICAgICBwcC5zcGxpY2UoaSsrLCAwLCBbIkMiXS5jb25jYXQocGkuc3BsaWNlKDAsIDYpKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHBwLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgICAgICBpaSA9IG1tYXgocC5sZW5ndGgsIHAyICYmIHAyLmxlbmd0aCB8fCAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZml4TSA9IGZ1bmN0aW9uIChwYXRoMSwgcGF0aDIsIGExLCBhMiwgaSkgewogICAgICAgICAgICAgICAgaWYgKHBhdGgxICYmIHBhdGgyICYmIHBhdGgxW2ldWzBdID09ICJNIiAmJiBwYXRoMltpXVswXSAhPSAiTSIpIHsKICAgICAgICAgICAgICAgICAgICBwYXRoMi5zcGxpY2UoaSwgMCwgWyJNIiwgYTIueCwgYTIueV0pOwogICAgICAgICAgICAgICAgICAgIGExLmJ4ID0gMDsKICAgICAgICAgICAgICAgICAgICBhMS5ieSA9IDA7CiAgICAgICAgICAgICAgICAgICAgYTEueCA9IHBhdGgxW2ldWzFdOwogICAgICAgICAgICAgICAgICAgIGExLnkgPSBwYXRoMVtpXVsyXTsKICAgICAgICAgICAgICAgICAgICBpaSA9IG1tYXgocC5sZW5ndGgsIHAyICYmIHAyLmxlbmd0aCB8fCAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcGNvbXMxID0gW10sIC8vIHBhdGggY29tbWFuZHMgb2Ygb3JpZ2luYWwgcGF0aCBwCiAgICAgICAgICAgIHBjb21zMiA9IFtdLCAvLyBwYXRoIGNvbW1hbmRzIG9mIG9yaWdpbmFsIHBhdGggcDIKICAgICAgICAgICAgcGZpcnN0ID0gIiIsIC8vIHRlbXBvcmFyeSBob2xkZXIgZm9yIG9yaWdpbmFsIHBhdGggY29tbWFuZAogICAgICAgICAgICBwY29tID0gIiI7IC8vIGhvbGRlciBmb3IgcHJldmlvdXMgcGF0aCBjb21tYW5kIG9mIG9yaWdpbmFsIHBhdGgKICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBtbWF4KHAubGVuZ3RoLCBwMiAmJiBwMi5sZW5ndGggfHwgMCk7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIHBbaV0gJiYgKHBmaXJzdCA9IHBbaV1bMF0pOyAvLyBzYXZlIGN1cnJlbnQgcGF0aCBjb21tYW5kCgogICAgICAgICAgICBpZiAocGZpcnN0ICE9ICJDIikgLy8gQyBpcyBub3Qgc2F2ZWQgeWV0LCBiZWNhdXNlIGl0IG1heSBiZSByZXN1bHQgb2YgY29udmVyc2lvbgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBwY29tczFbaV0gPSBwZmlyc3Q7IC8vIFNhdmUgY3VycmVudCBwYXRoIGNvbW1hbmQKICAgICAgICAgICAgICAgIGkgJiYgKCBwY29tID0gcGNvbXMxW2kgLSAxXSk7IC8vIEdldCBwcmV2aW91cyBwYXRoIGNvbW1hbmQgcGNvbQogICAgICAgICAgICB9CiAgICAgICAgICAgIHBbaV0gPSBwcm9jZXNzUGF0aChwW2ldLCBhdHRycywgcGNvbSk7IC8vIFByZXZpb3VzIHBhdGggY29tbWFuZCBpcyBpbnB1dHRlZCB0byBwcm9jZXNzUGF0aAoKICAgICAgICAgICAgaWYgKHBjb21zMVtpXSAhPSAiQSIgJiYgcGZpcnN0ID09ICJDIikgcGNvbXMxW2ldID0gIkMiOyAvLyBBIGlzIHRoZSBvbmx5IGNvbW1hbmQKICAgICAgICAgICAgLy8gd2hpY2ggbWF5IHByb2R1Y2UgbXVsdGlwbGUgQzpzCiAgICAgICAgICAgIC8vIHNvIHdlIGhhdmUgdG8gbWFrZSBzdXJlIHRoYXQgQyBpcyBhbHNvIEMgaW4gb3JpZ2luYWwgcGF0aAoKICAgICAgICAgICAgZml4QXJjKHAsIGkpOyAvLyBmaXhBcmMgYWRkcyBhbHNvIHRoZSByaWdodCBhbW91bnQgb2YgQTpzIHRvIHBjb21zMQoKICAgICAgICAgICAgaWYgKHAyKSB7IC8vIHRoZSBzYW1lIHByb2NlZHVyZXMgaXMgZG9uZSB0byBwMgogICAgICAgICAgICAgICAgcDJbaV0gJiYgKHBmaXJzdCA9IHAyW2ldWzBdKTsKICAgICAgICAgICAgICAgIGlmIChwZmlyc3QgIT0gIkMiKSB7CiAgICAgICAgICAgICAgICAgICAgcGNvbXMyW2ldID0gcGZpcnN0OwogICAgICAgICAgICAgICAgICAgIGkgJiYgKHBjb20gPSBwY29tczJbaSAtIDFdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHAyW2ldID0gcHJvY2Vzc1BhdGgocDJbaV0sIGF0dHJzMiwgcGNvbSk7CgogICAgICAgICAgICAgICAgaWYgKHBjb21zMltpXSAhPSAiQSIgJiYgcGZpcnN0ID09ICJDIikgewogICAgICAgICAgICAgICAgICAgIHBjb21zMltpXSA9ICJDIjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmaXhBcmMocDIsIGkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZpeE0ocCwgcDIsIGF0dHJzLCBhdHRyczIsIGkpOwogICAgICAgICAgICBmaXhNKHAyLCBwLCBhdHRyczIsIGF0dHJzLCBpKTsKICAgICAgICAgICAgdmFyIHNlZyA9IHBbaV0sCiAgICAgICAgICAgICAgICBzZWcyID0gcDIgJiYgcDJbaV0sCiAgICAgICAgICAgICAgICBzZWdsZW4gPSBzZWcubGVuZ3RoLAogICAgICAgICAgICAgICAgc2VnMmxlbiA9IHAyICYmIHNlZzIubGVuZ3RoOwogICAgICAgICAgICBhdHRycy54ID0gc2VnW3NlZ2xlbiAtIDJdOwogICAgICAgICAgICBhdHRycy55ID0gc2VnW3NlZ2xlbiAtIDFdOwogICAgICAgICAgICBhdHRycy5ieCA9IHRvRmxvYXQoc2VnW3NlZ2xlbiAtIDRdKSB8fCBhdHRycy54OwogICAgICAgICAgICBhdHRycy5ieSA9IHRvRmxvYXQoc2VnW3NlZ2xlbiAtIDNdKSB8fCBhdHRycy55OwogICAgICAgICAgICBhdHRyczIuYnggPSBwMiAmJiAodG9GbG9hdChzZWcyW3NlZzJsZW4gLSA0XSkgfHwgYXR0cnMyLngpOwogICAgICAgICAgICBhdHRyczIuYnkgPSBwMiAmJiAodG9GbG9hdChzZWcyW3NlZzJsZW4gLSAzXSkgfHwgYXR0cnMyLnkpOwogICAgICAgICAgICBhdHRyczIueCA9IHAyICYmIHNlZzJbc2VnMmxlbiAtIDJdOwogICAgICAgICAgICBhdHRyczIueSA9IHAyICYmIHNlZzJbc2VnMmxlbiAtIDFdOwogICAgICAgIH0KICAgICAgICBpZiAoIXAyKSB7CiAgICAgICAgICAgIHB0aC5jdXJ2ZSA9IHBhdGhDbG9uZShwKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHAyID8gW3AsIHAyXSA6IHA7CiAgICB9CiAgICBmdW5jdGlvbiBtYXBQYXRoKHBhdGgsIG1hdHJpeCkgewogICAgICAgIGlmICghbWF0cml4KSB7CiAgICAgICAgICAgIHJldHVybiBwYXRoOwogICAgICAgIH0KICAgICAgICB2YXIgeCwgeSwgaSwgaiwgaWksIGpqLCBwYXRoaTsKICAgICAgICBwYXRoID0gcGF0aDJjdXJ2ZShwYXRoKTsKICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHBhdGgubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICBwYXRoaSA9IHBhdGhbaV07CiAgICAgICAgICAgIGZvciAoaiA9IDEsIGpqID0gcGF0aGkubGVuZ3RoOyBqIDwgamo7IGogKz0gMikgewogICAgICAgICAgICAgICAgeCA9IG1hdHJpeC54KHBhdGhpW2pdLCBwYXRoaVtqICsgMV0pOwogICAgICAgICAgICAgICAgeSA9IG1hdHJpeC55KHBhdGhpW2pdLCBwYXRoaVtqICsgMV0pOwogICAgICAgICAgICAgICAgcGF0aGlbal0gPSB4OwogICAgICAgICAgICAgICAgcGF0aGlbaiArIDFdID0geTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcGF0aDsKICAgIH0KCiAgICAvLyBodHRwOi8vc2NoZXBlcnMuY2MvZ2V0dGluZy10by10aGUtcG9pbnQKICAgIGZ1bmN0aW9uIGNhdG11bGxSb20yYmV6aWVyKGNycCwgeikgewogICAgICAgIHZhciBkID0gW107CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlMZW4gPSBjcnAubGVuZ3RoOyBpTGVuIC0gMiAqICF6ID4gaTsgaSArPSAyKSB7CiAgICAgICAgICAgIHZhciBwID0gWwogICAgICAgICAgICAgICAgICAgICAgICB7eDogK2NycFtpIC0gMl0sIHk6ICtjcnBbaSAtIDFdfSwKICAgICAgICAgICAgICAgICAgICAgICAge3g6ICtjcnBbaV0sICAgICB5OiArY3JwW2kgKyAxXX0sCiAgICAgICAgICAgICAgICAgICAgICAgIHt4OiArY3JwW2kgKyAyXSwgeTogK2NycFtpICsgM119LAogICAgICAgICAgICAgICAgICAgICAgICB7eDogK2NycFtpICsgNF0sIHk6ICtjcnBbaSArIDVdfQogICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgIGlmICh6KSB7CiAgICAgICAgICAgICAgICBpZiAoIWkpIHsKICAgICAgICAgICAgICAgICAgICBwWzBdID0ge3g6ICtjcnBbaUxlbiAtIDJdLCB5OiArY3JwW2lMZW4gLSAxXX07CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlMZW4gLSA0ID09IGkpIHsKICAgICAgICAgICAgICAgICAgICBwWzNdID0ge3g6ICtjcnBbMF0sIHk6ICtjcnBbMV19OwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpTGVuIC0gMiA9PSBpKSB7CiAgICAgICAgICAgICAgICAgICAgcFsyXSA9IHt4OiArY3JwWzBdLCB5OiArY3JwWzFdfTsKICAgICAgICAgICAgICAgICAgICBwWzNdID0ge3g6ICtjcnBbMl0sIHk6ICtjcnBbM119OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGlMZW4gLSA0ID09IGkpIHsKICAgICAgICAgICAgICAgICAgICBwWzNdID0gcFsyXTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWkpIHsKICAgICAgICAgICAgICAgICAgICBwWzBdID0ge3g6ICtjcnBbaV0sIHk6ICtjcnBbaSArIDFdfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBkLnB1c2goWyJDIiwKICAgICAgICAgICAgICAgICAgKC1wWzBdLnggKyA2ICogcFsxXS54ICsgcFsyXS54KSAvIDYsCiAgICAgICAgICAgICAgICAgICgtcFswXS55ICsgNiAqIHBbMV0ueSArIHBbMl0ueSkgLyA2LAogICAgICAgICAgICAgICAgICAocFsxXS54ICsgNiAqIHBbMl0ueCAtIHBbM10ueCkgLyA2LAogICAgICAgICAgICAgICAgICAocFsxXS55ICsgNipwWzJdLnkgLSBwWzNdLnkpIC8gNiwKICAgICAgICAgICAgICAgICAgcFsyXS54LAogICAgICAgICAgICAgICAgICBwWzJdLnkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZDsKICAgIH0KCiAgICAvLyBleHBvcnQKICAgIFNuYXAucGF0aCA9IHBhdGhzOwoKICAgIC8qXAogICAgICogU25hcC5wYXRoLmdldFRvdGFsTGVuZ3RoCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgdGhlIGdpdmVuIHBhdGggaW4gcGl4ZWxzCiAgICAgKioKICAgICAtIHBhdGggKHN0cmluZykgU1ZHIHBhdGggc3RyaW5nCiAgICAgKioKICAgICA9IChudW1iZXIpIGxlbmd0aAogICAgXCovCiAgICBTbmFwLnBhdGguZ2V0VG90YWxMZW5ndGggPSBnZXRUb3RhbExlbmd0aDsKICAgIC8qXAogICAgICogU25hcC5wYXRoLmdldFBvaW50QXRMZW5ndGgKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJldHVybnMgdGhlIGNvb3JkaW5hdGVzIG9mIHRoZSBwb2ludCBsb2NhdGVkIGF0IHRoZSBnaXZlbiBsZW5ndGggYWxvbmcgdGhlIGdpdmVuIHBhdGgKICAgICAqKgogICAgIC0gcGF0aCAoc3RyaW5nKSBTVkcgcGF0aCBzdHJpbmcKICAgICAtIGxlbmd0aCAobnVtYmVyKSBsZW5ndGgsIGluIHBpeGVscywgZnJvbSB0aGUgc3RhcnQgb2YgdGhlIHBhdGgsIGV4Y2x1ZGluZyBub24tcmVuZGVyaW5nIGp1bXBzCiAgICAgKioKICAgICA9IChvYmplY3QpIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBwb2ludDoKICAgICBvIHsKICAgICBvICAgICB4OiAobnVtYmVyKSB4IGNvb3JkaW5hdGUsCiAgICAgbyAgICAgeTogKG51bWJlcikgeSBjb29yZGluYXRlLAogICAgIG8gICAgIGFscGhhOiAobnVtYmVyKSBhbmdsZSBvZiBkZXJpdmF0aXZlCiAgICAgbyB9CiAgICBcKi8KICAgIFNuYXAucGF0aC5nZXRQb2ludEF0TGVuZ3RoID0gZ2V0UG9pbnRBdExlbmd0aDsKICAgIC8qXAogICAgICogU25hcC5wYXRoLmdldFN1YnBhdGgKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJldHVybnMgdGhlIHN1YnBhdGggb2YgYSBnaXZlbiBwYXRoIGJldHdlZW4gZ2l2ZW4gc3RhcnQgYW5kIGVuZCBsZW5ndGhzCiAgICAgKioKICAgICAtIHBhdGggKHN0cmluZykgU1ZHIHBhdGggc3RyaW5nCiAgICAgLSBmcm9tIChudW1iZXIpIGxlbmd0aCwgaW4gcGl4ZWxzLCBmcm9tIHRoZSBzdGFydCBvZiB0aGUgcGF0aCB0byB0aGUgc3RhcnQgb2YgdGhlIHNlZ21lbnQKICAgICAtIHRvIChudW1iZXIpIGxlbmd0aCwgaW4gcGl4ZWxzLCBmcm9tIHRoZSBzdGFydCBvZiB0aGUgcGF0aCB0byB0aGUgZW5kIG9mIHRoZSBzZWdtZW50CiAgICAgKioKICAgICA9IChzdHJpbmcpIHBhdGggc3RyaW5nIGRlZmluaXRpb24gZm9yIHRoZSBzZWdtZW50CiAgICBcKi8KICAgIFNuYXAucGF0aC5nZXRTdWJwYXRoID0gZnVuY3Rpb24gKHBhdGgsIGZyb20sIHRvKSB7CiAgICAgICAgaWYgKHRoaXMuZ2V0VG90YWxMZW5ndGgocGF0aCkgLSB0byA8IDFlLTYpIHsKICAgICAgICAgICAgcmV0dXJuIGdldFN1YnBhdGhzQXRMZW5ndGgocGF0aCwgZnJvbSkuZW5kOwogICAgICAgIH0KICAgICAgICB2YXIgYSA9IGdldFN1YnBhdGhzQXRMZW5ndGgocGF0aCwgdG8sIDEpOwogICAgICAgIHJldHVybiBmcm9tID8gZ2V0U3VicGF0aHNBdExlbmd0aChhLCBmcm9tKS5lbmQgOiBhOwogICAgfTsKICAgIC8qXAogICAgICogRWxlbWVudC5nZXRUb3RhbExlbmd0aAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogUmV0dXJucyB0aGUgbGVuZ3RoIG9mIHRoZSBwYXRoIGluIHBpeGVscyAob25seSB3b3JrcyBmb3IgYHBhdGhgIGVsZW1lbnRzKQogICAgID0gKG51bWJlcikgbGVuZ3RoCiAgICBcKi8KICAgIGVscHJvdG8uZ2V0VG90YWxMZW5ndGggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHRoaXMubm9kZS5nZXRUb3RhbExlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ub2RlLmdldFRvdGFsTGVuZ3RoKCk7CiAgICAgICAgfQogICAgfTsKICAgIC8vIFNJRVJSQSBFbGVtZW50LmdldFBvaW50QXRMZW5ndGgoKS9FbGVtZW50LmdldFRvdGFsTGVuZ3RoKCk6IElmIGEgPHBhdGg+IGlzIGJyb2tlbiBpbnRvIGRpZmZlcmVudCBzZWdtZW50cywgaXMgdGhlIGp1bXAgZGlzdGFuY2UgdG8gdGhlIG5ldyBjb29yZGluYXRlcyBzZXQgYnkgdGhlIF9NXyBvciBfbV8gY29tbWFuZHMgY2FsY3VsYXRlZCBhcyBwYXJ0IG9mIHRoZSBwYXRoJ3MgdG90YWwgbGVuZ3RoPwogICAgLypcCiAgICAgKiBFbGVtZW50LmdldFBvaW50QXRMZW5ndGgKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJldHVybnMgY29vcmRpbmF0ZXMgb2YgdGhlIHBvaW50IGxvY2F0ZWQgYXQgdGhlIGdpdmVuIGxlbmd0aCBvbiB0aGUgZ2l2ZW4gcGF0aCAob25seSB3b3JrcyBmb3IgYHBhdGhgIGVsZW1lbnRzKQogICAgICoqCiAgICAgLSBsZW5ndGggKG51bWJlcikgbGVuZ3RoLCBpbiBwaXhlbHMsIGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBwYXRoLCBleGNsdWRpbmcgbm9uLXJlbmRlcmluZyBqdW1wcwogICAgICoqCiAgICAgPSAob2JqZWN0KSByZXByZXNlbnRhdGlvbiBvZiB0aGUgcG9pbnQ6CiAgICAgbyB7CiAgICAgbyAgICAgeDogKG51bWJlcikgeCBjb29yZGluYXRlLAogICAgIG8gICAgIHk6IChudW1iZXIpIHkgY29vcmRpbmF0ZSwKICAgICBvICAgICBhbHBoYTogKG51bWJlcikgYW5nbGUgb2YgZGVyaXZhdGl2ZQogICAgIG8gfQogICAgXCovCiAgICBlbHByb3RvLmdldFBvaW50QXRMZW5ndGggPSBmdW5jdGlvbiAobGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGdldFBvaW50QXRMZW5ndGgodGhpcy5hdHRyKCJkIiksIGxlbmd0aCk7CiAgICB9OwogICAgLy8gU0lFUlJBIEVsZW1lbnQuZ2V0U3VicGF0aCgpOiBTaW1pbGFyIHRvIHRoZSBwcm9ibGVtIGZvciBFbGVtZW50LmdldFBvaW50QXRMZW5ndGgoKS4gVW5jbGVhciBob3cgdGhpcyB3b3VsZCB3b3JrIGZvciBhIHNlZ21lbnRlZCBwYXRoLiBPdmVyYWxsLCB0aGUgY29uY2VwdCBvZiBfc3VicGF0aF8gYW5kIHdoYXQgSSdtIGNhbGxpbmcgYSBfc2VnbWVudF8gKHNlcmllcyBvZiBub24tX01fIG9yIF9aXyBjb21tYW5kcykgaXMgdW5jbGVhci4KICAgIC8qXAogICAgICogRWxlbWVudC5nZXRTdWJwYXRoCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBSZXR1cm5zIHN1YnBhdGggb2YgYSBnaXZlbiBlbGVtZW50IGZyb20gZ2l2ZW4gc3RhcnQgYW5kIGVuZCBsZW5ndGhzIChvbmx5IHdvcmtzIGZvciBgcGF0aGAgZWxlbWVudHMpCiAgICAgKioKICAgICAtIGZyb20gKG51bWJlcikgbGVuZ3RoLCBpbiBwaXhlbHMsIGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBwYXRoIHRvIHRoZSBzdGFydCBvZiB0aGUgc2VnbWVudAogICAgIC0gdG8gKG51bWJlcikgbGVuZ3RoLCBpbiBwaXhlbHMsIGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBwYXRoIHRvIHRoZSBlbmQgb2YgdGhlIHNlZ21lbnQKICAgICAqKgogICAgID0gKHN0cmluZykgcGF0aCBzdHJpbmcgZGVmaW5pdGlvbiBmb3IgdGhlIHNlZ21lbnQKICAgIFwqLwogICAgZWxwcm90by5nZXRTdWJwYXRoID0gZnVuY3Rpb24gKGZyb20sIHRvKSB7CiAgICAgICAgcmV0dXJuIFNuYXAucGF0aC5nZXRTdWJwYXRoKHRoaXMuYXR0cigiZCIpLCBmcm9tLCB0byk7CiAgICB9OwogICAgU25hcC5fLmJveCA9IGJveDsKICAgIC8qXAogICAgICogU25hcC5wYXRoLmZpbmREb3RzQXRTZWdtZW50CiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBVdGlsaXR5IG1ldGhvZAogICAgICoqCiAgICAgKiBGaW5kcyBkb3QgY29vcmRpbmF0ZXMgb24gdGhlIGdpdmVuIGN1YmljIGJlemnDqXIgY3VydmUgYXQgdGhlIGdpdmVuIHQKICAgICAtIHAxeCAobnVtYmVyKSB4IG9mIHRoZSBmaXJzdCBwb2ludCBvZiB0aGUgY3VydmUKICAgICAtIHAxeSAobnVtYmVyKSB5IG9mIHRoZSBmaXJzdCBwb2ludCBvZiB0aGUgY3VydmUKICAgICAtIGMxeCAobnVtYmVyKSB4IG9mIHRoZSBmaXJzdCBhbmNob3Igb2YgdGhlIGN1cnZlCiAgICAgLSBjMXkgKG51bWJlcikgeSBvZiB0aGUgZmlyc3QgYW5jaG9yIG9mIHRoZSBjdXJ2ZQogICAgIC0gYzJ4IChudW1iZXIpIHggb2YgdGhlIHNlY29uZCBhbmNob3Igb2YgdGhlIGN1cnZlCiAgICAgLSBjMnkgKG51bWJlcikgeSBvZiB0aGUgc2Vjb25kIGFuY2hvciBvZiB0aGUgY3VydmUKICAgICAtIHAyeCAobnVtYmVyKSB4IG9mIHRoZSBzZWNvbmQgcG9pbnQgb2YgdGhlIGN1cnZlCiAgICAgLSBwMnkgKG51bWJlcikgeSBvZiB0aGUgc2Vjb25kIHBvaW50IG9mIHRoZSBjdXJ2ZQogICAgIC0gdCAobnVtYmVyKSBwb3NpdGlvbiBvbiB0aGUgY3VydmUgKDAuLjEpCiAgICAgPSAob2JqZWN0KSBwb2ludCBpbmZvcm1hdGlvbiBpbiBmb3JtYXQ6CiAgICAgbyB7CiAgICAgbyAgICAgeDogKG51bWJlcikgeCBjb29yZGluYXRlIG9mIHRoZSBwb2ludCwKICAgICBvICAgICB5OiAobnVtYmVyKSB5IGNvb3JkaW5hdGUgb2YgdGhlIHBvaW50LAogICAgIG8gICAgIG06IHsKICAgICBvICAgICAgICAgeDogKG51bWJlcikgeCBjb29yZGluYXRlIG9mIHRoZSBsZWZ0IGFuY2hvciwKICAgICBvICAgICAgICAgeTogKG51bWJlcikgeSBjb29yZGluYXRlIG9mIHRoZSBsZWZ0IGFuY2hvcgogICAgIG8gICAgIH0sCiAgICAgbyAgICAgbjogewogICAgIG8gICAgICAgICB4OiAobnVtYmVyKSB4IGNvb3JkaW5hdGUgb2YgdGhlIHJpZ2h0IGFuY2hvciwKICAgICBvICAgICAgICAgeTogKG51bWJlcikgeSBjb29yZGluYXRlIG9mIHRoZSByaWdodCBhbmNob3IKICAgICBvICAgICB9LAogICAgIG8gICAgIHN0YXJ0OiB7CiAgICAgbyAgICAgICAgIHg6IChudW1iZXIpIHggY29vcmRpbmF0ZSBvZiB0aGUgc3RhcnQgb2YgdGhlIGN1cnZlLAogICAgIG8gICAgICAgICB5OiAobnVtYmVyKSB5IGNvb3JkaW5hdGUgb2YgdGhlIHN0YXJ0IG9mIHRoZSBjdXJ2ZQogICAgIG8gICAgIH0sCiAgICAgbyAgICAgZW5kOiB7CiAgICAgbyAgICAgICAgIHg6IChudW1iZXIpIHggY29vcmRpbmF0ZSBvZiB0aGUgZW5kIG9mIHRoZSBjdXJ2ZSwKICAgICBvICAgICAgICAgeTogKG51bWJlcikgeSBjb29yZGluYXRlIG9mIHRoZSBlbmQgb2YgdGhlIGN1cnZlCiAgICAgbyAgICAgfSwKICAgICBvICAgICBhbHBoYTogKG51bWJlcikgYW5nbGUgb2YgdGhlIGN1cnZlIGRlcml2YXRpdmUgYXQgdGhlIHBvaW50CiAgICAgbyB9CiAgICBcKi8KICAgIFNuYXAucGF0aC5maW5kRG90c0F0U2VnbWVudCA9IGZpbmREb3RzQXRTZWdtZW50OwogICAgLypcCiAgICAgKiBTbmFwLnBhdGguYmV6aWVyQkJveAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogVXRpbGl0eSBtZXRob2QKICAgICAqKgogICAgICogUmV0dXJucyB0aGUgYm91bmRpbmcgYm94IG9mIGEgZ2l2ZW4gY3ViaWMgYmV6acOpciBjdXJ2ZQogICAgIC0gcDF4IChudW1iZXIpIHggb2YgdGhlIGZpcnN0IHBvaW50IG9mIHRoZSBjdXJ2ZQogICAgIC0gcDF5IChudW1iZXIpIHkgb2YgdGhlIGZpcnN0IHBvaW50IG9mIHRoZSBjdXJ2ZQogICAgIC0gYzF4IChudW1iZXIpIHggb2YgdGhlIGZpcnN0IGFuY2hvciBvZiB0aGUgY3VydmUKICAgICAtIGMxeSAobnVtYmVyKSB5IG9mIHRoZSBmaXJzdCBhbmNob3Igb2YgdGhlIGN1cnZlCiAgICAgLSBjMnggKG51bWJlcikgeCBvZiB0aGUgc2Vjb25kIGFuY2hvciBvZiB0aGUgY3VydmUKICAgICAtIGMyeSAobnVtYmVyKSB5IG9mIHRoZSBzZWNvbmQgYW5jaG9yIG9mIHRoZSBjdXJ2ZQogICAgIC0gcDJ4IChudW1iZXIpIHggb2YgdGhlIHNlY29uZCBwb2ludCBvZiB0aGUgY3VydmUKICAgICAtIHAyeSAobnVtYmVyKSB5IG9mIHRoZSBzZWNvbmQgcG9pbnQgb2YgdGhlIGN1cnZlCiAgICAgKiBvcgogICAgIC0gYmV6IChhcnJheSkgYXJyYXkgb2Ygc2l4IHBvaW50cyBmb3IgYmV6acOpciBjdXJ2ZQogICAgID0gKG9iamVjdCkgYm91bmRpbmcgYm94CiAgICAgbyB7CiAgICAgbyAgICAgeDogKG51bWJlcikgeCBjb29yZGluYXRlIG9mIHRoZSBsZWZ0IHRvcCBwb2ludCBvZiB0aGUgYm94LAogICAgIG8gICAgIHk6IChudW1iZXIpIHkgY29vcmRpbmF0ZSBvZiB0aGUgbGVmdCB0b3AgcG9pbnQgb2YgdGhlIGJveCwKICAgICBvICAgICB4MjogKG51bWJlcikgeCBjb29yZGluYXRlIG9mIHRoZSByaWdodCBib3R0b20gcG9pbnQgb2YgdGhlIGJveCwKICAgICBvICAgICB5MjogKG51bWJlcikgeSBjb29yZGluYXRlIG9mIHRoZSByaWdodCBib3R0b20gcG9pbnQgb2YgdGhlIGJveCwKICAgICBvICAgICB3aWR0aDogKG51bWJlcikgd2lkdGggb2YgdGhlIGJveCwKICAgICBvICAgICBoZWlnaHQ6IChudW1iZXIpIGhlaWdodCBvZiB0aGUgYm94CiAgICAgbyB9CiAgICBcKi8KICAgIFNuYXAucGF0aC5iZXppZXJCQm94ID0gYmV6aWVyQkJveDsKICAgIC8qXAogICAgICogU25hcC5wYXRoLmlzUG9pbnRJbnNpZGVCQm94CiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBVdGlsaXR5IG1ldGhvZAogICAgICoqCiAgICAgKiBSZXR1cm5zIGB0cnVlYCBpZiBnaXZlbiBwb2ludCBpcyBpbnNpZGUgYm91bmRpbmcgYm94CiAgICAgLSBiYm94IChzdHJpbmcpIGJvdW5kaW5nIGJveAogICAgIC0geCAoc3RyaW5nKSB4IGNvb3JkaW5hdGUgb2YgdGhlIHBvaW50CiAgICAgLSB5IChzdHJpbmcpIHkgY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnQKICAgICA9IChib29sZWFuKSBgdHJ1ZWAgaWYgcG9pbnQgaXMgaW5zaWRlCiAgICBcKi8KICAgIFNuYXAucGF0aC5pc1BvaW50SW5zaWRlQkJveCA9IGlzUG9pbnRJbnNpZGVCQm94OwogICAgLypcCiAgICAgKiBTbmFwLnBhdGguaXNCQm94SW50ZXJzZWN0CiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBVdGlsaXR5IG1ldGhvZAogICAgICoqCiAgICAgKiBSZXR1cm5zIGB0cnVlYCBpZiB0d28gYm91bmRpbmcgYm94ZXMgaW50ZXJzZWN0CiAgICAgLSBiYm94MSAoc3RyaW5nKSBmaXJzdCBib3VuZGluZyBib3gKICAgICAtIGJib3gyIChzdHJpbmcpIHNlY29uZCBib3VuZGluZyBib3gKICAgICA9IChib29sZWFuKSBgdHJ1ZWAgaWYgYm91bmRpbmcgYm94ZXMgaW50ZXJzZWN0CiAgICBcKi8KICAgIFNuYXAucGF0aC5pc0JCb3hJbnRlcnNlY3QgPSBpc0JCb3hJbnRlcnNlY3Q7CiAgICAvKlwKICAgICAqIFNuYXAucGF0aC5pbnRlcnNlY3Rpb24KICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFV0aWxpdHkgbWV0aG9kCiAgICAgKioKICAgICAqIEZpbmRzIGludGVyc2VjdGlvbnMgb2YgdHdvIHBhdGhzCiAgICAgLSBwYXRoMSAoc3RyaW5nKSBwYXRoIHN0cmluZwogICAgIC0gcGF0aDIgKHN0cmluZykgcGF0aCBzdHJpbmcKICAgICA9IChhcnJheSkgZG90cyBvZiBpbnRlcnNlY3Rpb24KICAgICBvIFsKICAgICBvICAgICB7CiAgICAgbyAgICAgICAgIHg6IChudW1iZXIpIHggY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnQsCiAgICAgbyAgICAgICAgIHk6IChudW1iZXIpIHkgY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnQsCiAgICAgbyAgICAgICAgIHQxOiAobnVtYmVyKSB0IHZhbHVlIGZvciBzZWdtZW50IG9mIHBhdGgxLAogICAgIG8gICAgICAgICB0MjogKG51bWJlcikgdCB2YWx1ZSBmb3Igc2VnbWVudCBvZiBwYXRoMiwKICAgICBvICAgICAgICAgc2VnbWVudDE6IChudW1iZXIpIG9yZGVyIG51bWJlciBmb3Igc2VnbWVudCBvZiBwYXRoMSwKICAgICBvICAgICAgICAgc2VnbWVudDI6IChudW1iZXIpIG9yZGVyIG51bWJlciBmb3Igc2VnbWVudCBvZiBwYXRoMiwKICAgICBvICAgICAgICAgYmV6MTogKGFycmF5KSBlaWdodCBjb29yZGluYXRlcyByZXByZXNlbnRpbmcgYmV6acOpciBjdXJ2ZSBmb3IgdGhlIHNlZ21lbnQgb2YgcGF0aDEsCiAgICAgbyAgICAgICAgIGJlejI6IChhcnJheSkgZWlnaHQgY29vcmRpbmF0ZXMgcmVwcmVzZW50aW5nIGJlemnDqXIgY3VydmUgZm9yIHRoZSBzZWdtZW50IG9mIHBhdGgyCiAgICAgbyAgICAgfQogICAgIG8gXQogICAgXCovCiAgICBTbmFwLnBhdGguaW50ZXJzZWN0aW9uID0gcGF0aEludGVyc2VjdGlvbjsKICAgIFNuYXAucGF0aC5pbnRlcnNlY3Rpb25OdW1iZXIgPSBwYXRoSW50ZXJzZWN0aW9uTnVtYmVyOwogICAgLypcCiAgICAgKiBTbmFwLnBhdGguaXNQb2ludEluc2lkZQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogVXRpbGl0eSBtZXRob2QKICAgICAqKgogICAgICogUmV0dXJucyBgdHJ1ZWAgaWYgZ2l2ZW4gcG9pbnQgaXMgaW5zaWRlIGEgZ2l2ZW4gY2xvc2VkIHBhdGguCiAgICAgKgogICAgICogTm90ZTogZmlsbCBtb2RlIGRvZXNu4oCZdCBhZmZlY3QgdGhlIHJlc3VsdCBvZiB0aGlzIG1ldGhvZC4KICAgICAtIHBhdGggKHN0cmluZykgcGF0aCBzdHJpbmcKICAgICAtIHggKG51bWJlcikgeCBvZiB0aGUgcG9pbnQKICAgICAtIHkgKG51bWJlcikgeSBvZiB0aGUgcG9pbnQKICAgICA9IChib29sZWFuKSBgdHJ1ZWAgaWYgcG9pbnQgaXMgaW5zaWRlIHRoZSBwYXRoCiAgICBcKi8KICAgIFNuYXAucGF0aC5pc1BvaW50SW5zaWRlID0gaXNQb2ludEluc2lkZVBhdGg7CiAgICAvKlwKICAgICAqIFNuYXAucGF0aC5nZXRCQm94CiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBVdGlsaXR5IG1ldGhvZAogICAgICoqCiAgICAgKiBSZXR1cm5zIHRoZSBib3VuZGluZyBib3ggb2YgYSBnaXZlbiBwYXRoCiAgICAgLSBwYXRoIChzdHJpbmcpIHBhdGggc3RyaW5nCiAgICAgPSAob2JqZWN0KSBib3VuZGluZyBib3gKICAgICBvIHsKICAgICBvICAgICB4OiAobnVtYmVyKSB4IGNvb3JkaW5hdGUgb2YgdGhlIGxlZnQgdG9wIHBvaW50IG9mIHRoZSBib3gsCiAgICAgbyAgICAgeTogKG51bWJlcikgeSBjb29yZGluYXRlIG9mIHRoZSBsZWZ0IHRvcCBwb2ludCBvZiB0aGUgYm94LAogICAgIG8gICAgIHgyOiAobnVtYmVyKSB4IGNvb3JkaW5hdGUgb2YgdGhlIHJpZ2h0IGJvdHRvbSBwb2ludCBvZiB0aGUgYm94LAogICAgIG8gICAgIHkyOiAobnVtYmVyKSB5IGNvb3JkaW5hdGUgb2YgdGhlIHJpZ2h0IGJvdHRvbSBwb2ludCBvZiB0aGUgYm94LAogICAgIG8gICAgIHdpZHRoOiAobnVtYmVyKSB3aWR0aCBvZiB0aGUgYm94LAogICAgIG8gICAgIGhlaWdodDogKG51bWJlcikgaGVpZ2h0IG9mIHRoZSBib3gKICAgICBvIH0KICAgIFwqLwogICAgU25hcC5wYXRoLmdldEJCb3ggPSBwYXRoQkJveDsKICAgIFNuYXAucGF0aC5nZXQgPSBnZXRQYXRoOwogICAgLypcCiAgICAgKiBTbmFwLnBhdGgudG9SZWxhdGl2ZQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogVXRpbGl0eSBtZXRob2QKICAgICAqKgogICAgICogQ29udmVydHMgcGF0aCBjb29yZGluYXRlcyBpbnRvIHJlbGF0aXZlIHZhbHVlcwogICAgIC0gcGF0aCAoc3RyaW5nKSBwYXRoIHN0cmluZwogICAgID0gKGFycmF5KSBwYXRoIHN0cmluZwogICAgXCovCiAgICBTbmFwLnBhdGgudG9SZWxhdGl2ZSA9IHBhdGhUb1JlbGF0aXZlOwogICAgLypcCiAgICAgKiBTbmFwLnBhdGgudG9BYnNvbHV0ZQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogVXRpbGl0eSBtZXRob2QKICAgICAqKgogICAgICogQ29udmVydHMgcGF0aCBjb29yZGluYXRlcyBpbnRvIGFic29sdXRlIHZhbHVlcwogICAgIC0gcGF0aCAoc3RyaW5nKSBwYXRoIHN0cmluZwogICAgID0gKGFycmF5KSBwYXRoIHN0cmluZwogICAgXCovCiAgICBTbmFwLnBhdGgudG9BYnNvbHV0ZSA9IHBhdGhUb0Fic29sdXRlOwogICAgLypcCiAgICAgKiBTbmFwLnBhdGgudG9DdWJpYwogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogVXRpbGl0eSBtZXRob2QKICAgICAqKgogICAgICogQ29udmVydHMgcGF0aCB0byBhIG5ldyBwYXRoIHdoZXJlIGFsbCBzZWdtZW50cyBhcmUgY3ViaWMgYmV6acOpciBjdXJ2ZXMKICAgICAtIHBhdGhTdHJpbmcgKHN0cmluZ3xhcnJheSkgcGF0aCBzdHJpbmcgb3IgYXJyYXkgb2Ygc2VnbWVudHMKICAgICA9IChhcnJheSkgYXJyYXkgb2Ygc2VnbWVudHMKICAgIFwqLwogICAgU25hcC5wYXRoLnRvQ3ViaWMgPSBwYXRoMmN1cnZlOwogICAgLypcCiAgICAgKiBTbmFwLnBhdGgubWFwCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBUcmFuc2Zvcm0gdGhlIHBhdGggc3RyaW5nIHdpdGggdGhlIGdpdmVuIG1hdHJpeAogICAgIC0gcGF0aCAoc3RyaW5nKSBwYXRoIHN0cmluZwogICAgIC0gbWF0cml4IChvYmplY3QpIHNlZSBATWF0cml4CiAgICAgPSAoc3RyaW5nKSB0cmFuc2Zvcm1lZCBwYXRoIHN0cmluZwogICAgXCovCiAgICBTbmFwLnBhdGgubWFwID0gbWFwUGF0aDsKICAgIFNuYXAucGF0aC50b1N0cmluZyA9IHRvU3RyaW5nOwogICAgU25hcC5wYXRoLmNsb25lID0gcGF0aENsb25lOwp9KTsKLy8gQ29weXJpZ2h0IChjKSAyMDEzIEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkLiBBbGwgcmlnaHRzIHJlc2VydmVkLgovLyAKLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7Ci8vIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KLy8gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0Ci8vIAovLyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKLy8gCi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKLy8gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKLy8gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCi8vIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKLy8gbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuClNuYXAucGx1Z2luKGZ1bmN0aW9uIChTbmFwLCBFbGVtZW50LCBQYXBlciwgZ2xvYikgewogICAgdmFyIG1tYXggPSBNYXRoLm1heCwKICAgICAgICBtbWluID0gTWF0aC5taW47CgogICAgLy8gU2V0CiAgICB2YXIgU2V0ID0gZnVuY3Rpb24gKGl0ZW1zKSB7CiAgICAgICAgdGhpcy5pdGVtcyA9IFtdOwoJdGhpcy5iaW5kaW5ncyA9IHt9OwogICAgICAgIHRoaXMubGVuZ3RoID0gMDsKICAgICAgICB0aGlzLnR5cGUgPSAic2V0IjsKICAgICAgICBpZiAoaXRlbXMpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gaXRlbXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGl0ZW1zW2ldKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpc1t0aGlzLml0ZW1zLmxlbmd0aF0gPSB0aGlzLml0ZW1zW3RoaXMuaXRlbXMubGVuZ3RoXSA9IGl0ZW1zW2ldOwogICAgICAgICAgICAgICAgICAgIHRoaXMubGVuZ3RoKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAogICAgc2V0cHJvdG8gPSBTZXQucHJvdG90eXBlOwogICAgLypcCiAgICAgKiBTZXQucHVzaAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogQWRkcyBlYWNoIGFyZ3VtZW50IHRvIHRoZSBjdXJyZW50IHNldAogICAgID0gKG9iamVjdCkgb3JpZ2luYWwgZWxlbWVudAogICAgXCovCiAgICBzZXRwcm90by5wdXNoID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBpdGVtLAogICAgICAgICAgICBsZW47CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgaXRlbSA9IGFyZ3VtZW50c1tpXTsKICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGxlbiA9IHRoaXMuaXRlbXMubGVuZ3RoOwogICAgICAgICAgICAgICAgdGhpc1tsZW5dID0gdGhpcy5pdGVtc1tsZW5dID0gaXRlbTsKICAgICAgICAgICAgICAgIHRoaXMubGVuZ3RoKys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgLypcCiAgICAgKiBTZXQucG9wCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBSZW1vdmVzIGxhc3QgZWxlbWVudCBhbmQgcmV0dXJucyBpdAogICAgID0gKG9iamVjdCkgZWxlbWVudAogICAgXCovCiAgICBzZXRwcm90by5wb3AgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5sZW5ndGggJiYgZGVsZXRlIHRoaXNbdGhpcy5sZW5ndGgtLV07CiAgICAgICAgcmV0dXJuIHRoaXMuaXRlbXMucG9wKCk7CiAgICB9OwogICAgLypcCiAgICAgKiBTZXQuZm9yRWFjaAogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogRXhlY3V0ZXMgZ2l2ZW4gZnVuY3Rpb24gZm9yIGVhY2ggZWxlbWVudCBpbiB0aGUgc2V0CiAgICAgKgogICAgICogSWYgdGhlIGZ1bmN0aW9uIHJldHVybnMgYGZhbHNlYCwgdGhlIGxvb3Agc3RvcHMgcnVubmluZy4KICAgICAqKgogICAgIC0gY2FsbGJhY2sgKGZ1bmN0aW9uKSBmdW5jdGlvbiB0byBydW4KICAgICAtIHRoaXNBcmcgKG9iamVjdCkgY29udGV4dCBvYmplY3QgZm9yIHRoZSBjYWxsYmFjawogICAgID0gKG9iamVjdCkgU2V0IG9iamVjdAogICAgXCovCiAgICBzZXRwcm90by5mb3JFYWNoID0gZnVuY3Rpb24gKGNhbGxiYWNrLCB0aGlzQXJnKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gdGhpcy5pdGVtcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIGlmIChjYWxsYmFjay5jYWxsKHRoaXNBcmcsIHRoaXMuaXRlbXNbaV0sIGkpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgLypcCiAgICAgKiBTZXQuYW5pbWF0ZQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogQW5pbWF0ZXMgZWFjaCBlbGVtZW50IGluIHNldCBpbiBzeW5jLgogICAgICoKICAgICAqKgogICAgIC0gYXR0cnMgKG9iamVjdCkga2V5LXZhbHVlIHBhaXJzIG9mIGRlc3RpbmF0aW9uIGF0dHJpYnV0ZXMKICAgICAtIGR1cmF0aW9uIChudW1iZXIpIGR1cmF0aW9uIG9mIHRoZSBhbmltYXRpb24gaW4gbWlsbGlzZWNvbmRzCiAgICAgLSBlYXNpbmcgKGZ1bmN0aW9uKSAjb3B0aW9uYWwgZWFzaW5nIGZ1bmN0aW9uIGZyb20gQG1pbmEgb3IgY3VzdG9tCiAgICAgLSBjYWxsYmFjayAoZnVuY3Rpb24pICNvcHRpb25hbCBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IGV4ZWN1dGVzIHdoZW4gdGhlIGFuaW1hdGlvbiBlbmRzCiAgICAgKiBvcgogICAgIC0gYW5pbWF0aW9uIChhcnJheSkgYXJyYXkgb2YgYW5pbWF0aW9uIHBhcmFtZXRlciBmb3IgZWFjaCBlbGVtZW50IGluIHNldCBpbiBmb3JtYXQgYFthdHRycywgZHVyYXRpb24sIGVhc2luZywgY2FsbGJhY2tdYAogICAgID4gVXNhZ2UKICAgICB8IC8vIGFuaW1hdGUgYWxsIGVsZW1lbnRzIGluIHNldCB0byByYWRpdXMgMTAKICAgICB8IHNldC5hbmltYXRlKHtyOiAxMH0sIDUwMCwgbWluYS5lYXNlaW4pOwogICAgIHwgLy8gb3IKICAgICB8IC8vIGFuaW1hdGUgZmlyc3QgZWxlbWVudCB0byByYWRpdXMgMTAsIGJ1dCBzZWNvbmQgdG8gcmFkaXVzIDIwIGFuZCBpbiBkaWZmZXJlbnQgdGltZQogICAgIHwgc2V0LmFuaW1hdGUoW3tyOiAxMH0sIDUwMCwgbWluYS5lYXNlaW5dLCBbe3I6IDIwfSwgMTUwMCwgbWluYS5lYXNlaW5dKTsKICAgICA9IChFbGVtZW50KSB0aGUgY3VycmVudCBlbGVtZW50CiAgICBcKi8KICAgIHNldHByb3RvLmFuaW1hdGUgPSBmdW5jdGlvbiAoYXR0cnMsIG1zLCBlYXNpbmcsIGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKHR5cGVvZiBlYXNpbmcgPT0gImZ1bmN0aW9uIiAmJiAhZWFzaW5nLmxlbmd0aCkgewogICAgICAgICAgICBjYWxsYmFjayA9IGVhc2luZzsKICAgICAgICAgICAgZWFzaW5nID0gbWluYS5saW5lYXI7CiAgICAgICAgfQogICAgICAgIGlmIChhdHRycyBpbnN0YW5jZW9mIFNuYXAuXy5BbmltYXRpb24pIHsKICAgICAgICAgICAgY2FsbGJhY2sgPSBhdHRycy5jYWxsYmFjazsKICAgICAgICAgICAgZWFzaW5nID0gYXR0cnMuZWFzaW5nOwogICAgICAgICAgICBtcyA9IGVhc2luZy5kdXI7CiAgICAgICAgICAgIGF0dHJzID0gYXR0cnMuYXR0cjsKICAgICAgICB9CiAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgaWYgKFNuYXAuaXMoYXR0cnMsICJhcnJheSIpICYmIFNuYXAuaXMoYXJnc1thcmdzLmxlbmd0aCAtIDFdLCAiYXJyYXkiKSkgewogICAgICAgICAgICB2YXIgZWFjaCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHZhciBiZWdpbiwKICAgICAgICAgICAgaGFuZGxlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmIChiZWdpbikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYiA9IGJlZ2luOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBiZWdpbiA9IHRoaXMuYjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2IgPSAwLAogICAgICAgICAgICBjYWxsYmFja2VyID0gY2FsbGJhY2sgJiYgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKGNiKysgPT0gdGhpcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24gKGVsLCBpKSB7CiAgICAgICAgICAgIGV2ZS5vbmNlKCJzbmFwLmFuaW1jcmVhdGVkLiIgKyBlbC5pZCwgaGFuZGxlcik7CiAgICAgICAgICAgIGlmIChlYWNoKSB7CiAgICAgICAgICAgICAgICBhcmdzW2ldICYmIGVsLmFuaW1hdGUuYXBwbHkoZWwsIGFyZ3NbaV0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZWwuYW5pbWF0ZShhdHRycywgbXMsIGVhc2luZywgY2FsbGJhY2tlcik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CiAgICBzZXRwcm90by5yZW1vdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgd2hpbGUgKHRoaXMubGVuZ3RoKSB7CiAgICAgICAgICAgIHRoaXMucG9wKCkucmVtb3ZlKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIC8qXAogICAgICogU2V0LmJpbmQKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFNwZWNpZmllcyBob3cgdG8gaGFuZGxlIGEgc3BlY2lmaWMgYXR0cmlidXRlIHdoZW4gYXBwbGllZAogICAgICogdG8gYSBzZXQuCiAgICAgKgogICAgICoqCiAgICAgLSBhdHRyIChzdHJpbmcpIGF0dHJpYnV0ZSBuYW1lCiAgICAgLSBjYWxsYmFjayAoZnVuY3Rpb24pIGZ1bmN0aW9uIHRvIHJ1bgogICAgICogb3IKICAgICAtIGF0dHIgKHN0cmluZykgYXR0cmlidXRlIG5hbWUKICAgICAtIGVsZW1lbnQgKEVsZW1lbnQpIHNwZWNpZmljIGVsZW1lbnQgaW4gdGhlIHNldCB0byBhcHBseSB0aGUgYXR0cmlidXRlIHRvCiAgICAgKiBvcgogICAgIC0gYXR0ciAoc3RyaW5nKSBhdHRyaWJ1dGUgbmFtZQogICAgIC0gZWxlbWVudCAoRWxlbWVudCkgc3BlY2lmaWMgZWxlbWVudCBpbiB0aGUgc2V0IHRvIGFwcGx5IHRoZSBhdHRyaWJ1dGUgdG8KICAgICAtIGVhdHRyIChzdHJpbmcpIGF0dHJpYnV0ZSBvbiB0aGUgZWxlbWVudCB0byBiaW5kIHRoZSBhdHRyaWJ1dGUgdG8KICAgICA9IChvYmplY3QpIFNldCBvYmplY3QKICAgIFwqLwogICAgc2V0cHJvdG8uYmluZCA9IGZ1bmN0aW9uIChhdHRyLCBhLCBiKSB7CiAgICAgICAgdmFyIGRhdGEgPSB7fTsKICAgICAgICBpZiAodHlwZW9mIGEgPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICB0aGlzLmJpbmRpbmdzW2F0dHJdID0gYTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgYW5hbWUgPSBiIHx8IGF0dHI7CiAgICAgICAgICAgIHRoaXMuYmluZGluZ3NbYXR0cl0gPSBmdW5jdGlvbiAodikgewogICAgICAgICAgICAgICAgZGF0YVthbmFtZV0gPSB2OwogICAgICAgICAgICAgICAgYS5hdHRyKGRhdGEpOwogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICBzZXRwcm90by5hdHRyID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgdmFyIHVuYm91bmQgPSB7fTsKICAgICAgICBmb3IgKHZhciBrIGluIHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmJpbmRpbmdzW2tdKSB7CiAgICAgICAgICAgICAgICB0aGlzLmJpbmRpbmdzW2tdKHZhbHVlW2tdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHVuYm91bmRba10gPSB2YWx1ZVtrXTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSB0aGlzLml0ZW1zLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgdGhpcy5pdGVtc1tpXS5hdHRyKHVuYm91bmQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICAvKlwKICAgICAqIFNldC5jbGVhcgogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogUmVtb3ZlcyBhbGwgZWxlbWVudHMgZnJvbSB0aGUgc2V0CiAgICBcKi8KICAgIHNldHByb3RvLmNsZWFyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHdoaWxlICh0aGlzLmxlbmd0aCkgewogICAgICAgICAgICB0aGlzLnBvcCgpOwogICAgICAgIH0KICAgIH07CiAgICAvKlwKICAgICAqIFNldC5zcGxpY2UKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJlbW92ZXMgcmFuZ2Ugb2YgZWxlbWVudHMgZnJvbSB0aGUgc2V0CiAgICAgKioKICAgICAtIGluZGV4IChudW1iZXIpIHBvc2l0aW9uIG9mIHRoZSBkZWxldGlvbgogICAgIC0gY291bnQgKG51bWJlcikgbnVtYmVyIG9mIGVsZW1lbnQgdG8gcmVtb3ZlCiAgICAgLSBpbnNlcnRpb27igKYgKG9iamVjdCkgI29wdGlvbmFsIGVsZW1lbnRzIHRvIGluc2VydAogICAgID0gKG9iamVjdCkgc2V0IGVsZW1lbnRzIHRoYXQgd2VyZSBkZWxldGVkCiAgICBcKi8KICAgIHNldHByb3RvLnNwbGljZSA9IGZ1bmN0aW9uIChpbmRleCwgY291bnQsIGluc2VydGlvbikgewogICAgICAgIGluZGV4ID0gaW5kZXggPCAwID8gbW1heCh0aGlzLmxlbmd0aCArIGluZGV4LCAwKSA6IGluZGV4OwogICAgICAgIGNvdW50ID0gbW1heCgwLCBtbWluKHRoaXMubGVuZ3RoIC0gaW5kZXgsIGNvdW50KSk7CiAgICAgICAgdmFyIHRhaWwgPSBbXSwKICAgICAgICAgICAgdG9kZWwgPSBbXSwKICAgICAgICAgICAgYXJncyA9IFtdLAogICAgICAgICAgICBpOwogICAgICAgIGZvciAoaSA9IDI7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYXJncy5wdXNoKGFyZ3VtZW50c1tpXSk7CiAgICAgICAgfQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgICAgICAgIHRvZGVsLnB1c2godGhpc1tpbmRleCArIGldKTsKICAgICAgICB9CiAgICAgICAgZm9yICg7IGkgPCB0aGlzLmxlbmd0aCAtIGluZGV4OyBpKyspIHsKICAgICAgICAgICAgdGFpbC5wdXNoKHRoaXNbaW5kZXggKyBpXSk7CiAgICAgICAgfQogICAgICAgIHZhciBhcmdsZW4gPSBhcmdzLmxlbmd0aDsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJnbGVuICsgdGFpbC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0aGlzLml0ZW1zW2luZGV4ICsgaV0gPSB0aGlzW2luZGV4ICsgaV0gPSBpIDwgYXJnbGVuID8gYXJnc1tpXSA6IHRhaWxbaSAtIGFyZ2xlbl07CiAgICAgICAgfQogICAgICAgIGkgPSB0aGlzLml0ZW1zLmxlbmd0aCA9IHRoaXMubGVuZ3RoIC09IGNvdW50IC0gYXJnbGVuOwogICAgICAgIHdoaWxlICh0aGlzW2ldKSB7CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzW2krK107CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgU2V0KHRvZGVsKTsKICAgIH07CiAgICAvKlwKICAgICAqIFNldC5leGNsdWRlCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBSZW1vdmVzIGdpdmVuIGVsZW1lbnQgZnJvbSB0aGUgc2V0CiAgICAgKioKICAgICAtIGVsZW1lbnQgKG9iamVjdCkgZWxlbWVudCB0byByZW1vdmUKICAgICA9IChib29sZWFuKSBgdHJ1ZWAgaWYgb2JqZWN0IHdhcyBmb3VuZCBhbmQgcmVtb3ZlZCBmcm9tIHRoZSBzZXQKICAgIFwqLwogICAgc2V0cHJvdG8uZXhjbHVkZSA9IGZ1bmN0aW9uIChlbCkgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHRoaXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgaWYgKHRoaXNbaV0gPT0gZWwpIHsKICAgICAgICAgICAgdGhpcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwogICAgc2V0cHJvdG8uaW5zZXJ0QWZ0ZXIgPSBmdW5jdGlvbiAoZWwpIHsKICAgICAgICB2YXIgaSA9IHRoaXMuaXRlbXMubGVuZ3RoOwogICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgdGhpcy5pdGVtc1tpXS5pbnNlcnRBZnRlcihlbCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIHNldHByb3RvLmdldEJCb3ggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHggPSBbXSwKICAgICAgICAgICAgeSA9IFtdLAogICAgICAgICAgICB4MiA9IFtdLAogICAgICAgICAgICB5MiA9IFtdOwogICAgICAgIGZvciAodmFyIGkgPSB0aGlzLml0ZW1zLmxlbmd0aDsgaS0tOykgaWYgKCF0aGlzLml0ZW1zW2ldLnJlbW92ZWQpIHsKICAgICAgICAgICAgdmFyIGJveCA9IHRoaXMuaXRlbXNbaV0uZ2V0QkJveCgpOwogICAgICAgICAgICB4LnB1c2goYm94LngpOwogICAgICAgICAgICB5LnB1c2goYm94LnkpOwogICAgICAgICAgICB4Mi5wdXNoKGJveC54ICsgYm94LndpZHRoKTsKICAgICAgICAgICAgeTIucHVzaChib3gueSArIGJveC5oZWlnaHQpOwogICAgICAgIH0KICAgICAgICB4ID0gbW1pbi5hcHBseSgwLCB4KTsKICAgICAgICB5ID0gbW1pbi5hcHBseSgwLCB5KTsKICAgICAgICB4MiA9IG1tYXguYXBwbHkoMCwgeDIpOwogICAgICAgIHkyID0gbW1heC5hcHBseSgwLCB5Mik7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgeDogeCwKICAgICAgICAgICAgeTogeSwKICAgICAgICAgICAgeDI6IHgyLAogICAgICAgICAgICB5MjogeTIsCiAgICAgICAgICAgIHdpZHRoOiB4MiAtIHgsCiAgICAgICAgICAgIGhlaWdodDogeTIgLSB5LAogICAgICAgICAgICBjeDogeCArICh4MiAtIHgpIC8gMiwKICAgICAgICAgICAgY3k6IHkgKyAoeTIgLSB5KSAvIDIKICAgICAgICB9OwogICAgfTsKICAgIHNldHByb3RvLmNsb25lID0gZnVuY3Rpb24gKHMpIHsKICAgICAgICBzID0gbmV3IFNldDsKICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSB0aGlzLml0ZW1zLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgcy5wdXNoKHRoaXMuaXRlbXNbaV0uY2xvbmUoKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzOwogICAgfTsKICAgIHNldHByb3RvLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAiU25hcFx1MjAxOHMgc2V0IjsKICAgIH07CiAgICBzZXRwcm90by50eXBlID0gInNldCI7CiAgICAvLyBleHBvcnQKICAgIFNuYXAuc2V0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzZXQgPSBuZXcgU2V0OwogICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHNldC5wdXNoLmFwcGx5KHNldCwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZXQ7CiAgICB9Owp9KTsKCi8vIENvcHlyaWdodCAoYykgMjAxMyBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KLy8gCi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwovLyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCi8vIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAovLyAKLy8gaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCi8vIAovLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCi8vIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCi8vIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgovLyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCi8vIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgpTbmFwLnBsdWdpbihmdW5jdGlvbiAoU25hcCwgRWxlbWVudCwgUGFwZXIsIGdsb2IpIHsKICAgIHZhciBuYW1lcyA9IHt9LAogICAgICAgIHJlVW5pdCA9IC9bYS16XSskL2ksCiAgICAgICAgU3RyID0gU3RyaW5nOwogICAgbmFtZXMuc3Ryb2tlID0gbmFtZXMuZmlsbCA9ICJjb2xvdXIiOwogICAgZnVuY3Rpb24gZ2V0RW1wdHkoaXRlbSkgewogICAgICAgIHZhciBsID0gaXRlbVswXTsKICAgICAgICBzd2l0Y2ggKGwudG9Mb3dlckNhc2UoKSkgewogICAgICAgICAgICBjYXNlICJ0IjogcmV0dXJuIFtsLCAwLCAwXTsKICAgICAgICAgICAgY2FzZSAibSI6IHJldHVybiBbbCwgMSwgMCwgMCwgMSwgMCwgMF07CiAgICAgICAgICAgIGNhc2UgInIiOiBpZiAoaXRlbS5sZW5ndGggPT0gNCkgewogICAgICAgICAgICAgICAgcmV0dXJuIFtsLCAwLCBpdGVtWzJdLCBpdGVtWzNdXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBbbCwgMF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAicyI6IGlmIChpdGVtLmxlbmd0aCA9PSA1KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gW2wsIDEsIDEsIGl0ZW1bM10sIGl0ZW1bNF1dOwogICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0ubGVuZ3RoID09IDMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBbbCwgMSwgMV07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gW2wsIDFdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gZXF1YWxpc2VUcmFuc2Zvcm0odDEsIHQyLCBnZXRCQm94KSB7CiAgICAgICAgdDIgPSBTdHIodDIpLnJlcGxhY2UoL1wuezN9fFx1MjAyNi9nLCB0MSk7CiAgICAgICAgdDEgPSBTbmFwLnBhcnNlVHJhbnNmb3JtU3RyaW5nKHQxKSB8fCBbXTsKICAgICAgICB0MiA9IFNuYXAucGFyc2VUcmFuc2Zvcm1TdHJpbmcodDIpIHx8IFtdOwogICAgICAgIHZhciBtYXhsZW5ndGggPSBNYXRoLm1heCh0MS5sZW5ndGgsIHQyLmxlbmd0aCksCiAgICAgICAgICAgIGZyb20gPSBbXSwKICAgICAgICAgICAgdG8gPSBbXSwKICAgICAgICAgICAgaSA9IDAsIGosIGpqLAogICAgICAgICAgICB0dDEsIHR0MjsKICAgICAgICBmb3IgKDsgaSA8IG1heGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHR0MSA9IHQxW2ldIHx8IGdldEVtcHR5KHQyW2ldKTsKICAgICAgICAgICAgdHQyID0gdDJbaV0gfHwgZ2V0RW1wdHkodHQxKTsKICAgICAgICAgICAgaWYgKCh0dDFbMF0gIT0gdHQyWzBdKSB8fAogICAgICAgICAgICAgICAgKHR0MVswXS50b0xvd2VyQ2FzZSgpID09ICJyIiAmJiAodHQxWzJdICE9IHR0MlsyXSB8fCB0dDFbM10gIT0gdHQyWzNdKSkgfHwKICAgICAgICAgICAgICAgICh0dDFbMF0udG9Mb3dlckNhc2UoKSA9PSAicyIgJiYgKHR0MVszXSAhPSB0dDJbM10gfHwgdHQxWzRdICE9IHR0Mls0XSkpCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICB0MSA9IFNuYXAuXy50cmFuc2Zvcm0ybWF0cml4KHQxLCBnZXRCQm94KCkpOwogICAgICAgICAgICAgICAgICAgIHQyID0gU25hcC5fLnRyYW5zZm9ybTJtYXRyaXgodDIsIGdldEJCb3goKSk7CiAgICAgICAgICAgICAgICAgICAgZnJvbSA9IFtbIm0iLCB0MS5hLCB0MS5iLCB0MS5jLCB0MS5kLCB0MS5lLCB0MS5mXV07CiAgICAgICAgICAgICAgICAgICAgdG8gPSBbWyJtIiwgdDIuYSwgdDIuYiwgdDIuYywgdDIuZCwgdDIuZSwgdDIuZl1dOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZyb21baV0gPSBbXTsKICAgICAgICAgICAgdG9baV0gPSBbXTsKICAgICAgICAgICAgZm9yIChqID0gMCwgamogPSBNYXRoLm1heCh0dDEubGVuZ3RoLCB0dDIubGVuZ3RoKTsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICAgIGogaW4gdHQxICYmIChmcm9tW2ldW2pdID0gdHQxW2pdKTsKICAgICAgICAgICAgICAgIGogaW4gdHQyICYmICh0b1tpXVtqXSA9IHR0MltqXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZnJvbTogcGF0aDJhcnJheShmcm9tKSwKICAgICAgICAgICAgdG86IHBhdGgyYXJyYXkodG8pLAogICAgICAgICAgICBmOiBnZXRQYXRoKGZyb20pCiAgICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldE51bWJlcih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsOwogICAgfQogICAgZnVuY3Rpb24gZ2V0VW5pdCh1bml0KSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgICAgcmV0dXJuICt2YWwudG9GaXhlZCgzKSArIHVuaXQ7CiAgICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldENvbG91cihjbHIpIHsKICAgICAgICByZXR1cm4gU25hcC5yZ2IoY2xyWzBdLCBjbHJbMV0sIGNsclsyXSk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRQYXRoKHBhdGgpIHsKICAgICAgICB2YXIgayA9IDAsIGksIGlpLCBqLCBqaiwgb3V0LCBhLCBiID0gW107CiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBwYXRoLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgb3V0ID0gIlsiOwogICAgICAgICAgICBhID0gWyciJyArIHBhdGhbaV1bMF0gKyAnIiddOwogICAgICAgICAgICBmb3IgKGogPSAxLCBqaiA9IHBhdGhbaV0ubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgICAgICAgYVtqXSA9ICJ2YWxbIiArIChrKyspICsgIl0iOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG91dCArPSBhICsgIl0iOwogICAgICAgICAgICBiW2ldID0gb3V0OwogICAgICAgIH0KICAgICAgICByZXR1cm4gRnVuY3Rpb24oInZhbCIsICJyZXR1cm4gU25hcC5wYXRoLnRvU3RyaW5nLmNhbGwoWyIgKyBiICsgIl0pIik7CiAgICB9CiAgICBmdW5jdGlvbiBwYXRoMmFycmF5KHBhdGgpIHsKICAgICAgICB2YXIgb3V0ID0gW107CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcGF0aC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIGZvciAodmFyIGogPSAxLCBqaiA9IHBhdGhbaV0ubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgICAgICAgb3V0LnB1c2gocGF0aFtpXVtqXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIEVsZW1lbnQucHJvdG90eXBlLmVxdWFsID0gZnVuY3Rpb24gKG5hbWUsIGIpIHsKICAgICAgICByZXR1cm4gZXZlKCJzbmFwLnV0aWwuZXF1YWwiLCB0aGlzLCBuYW1lLCBiKS5maXJzdERlZmluZWQoKTsKICAgIH07CiAgICBldmUub24oInNuYXAudXRpbC5lcXVhbCIsIGZ1bmN0aW9uIChuYW1lLCBiKSB7CiAgICAgICAgdmFyIEEsIEIsIGEgPSBTdHIodGhpcy5hdHRyKG5hbWUpIHx8ICIiKSwKICAgICAgICAgICAgZWwgPSB0aGlzOwogICAgICAgIGlmIChhID09ICthICYmIGIgPT0gK2IpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGZyb206ICthLAogICAgICAgICAgICAgICAgdG86ICtiLAogICAgICAgICAgICAgICAgZjogZ2V0TnVtYmVyCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGlmIChuYW1lc1tuYW1lXSA9PSAiY29sb3VyIikgewogICAgICAgICAgICBBID0gU25hcC5jb2xvcihhKTsKICAgICAgICAgICAgQiA9IFNuYXAuY29sb3IoYik7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBmcm9tOiBbQS5yLCBBLmcsIEEuYiwgQS5vcGFjaXR5XSwKICAgICAgICAgICAgICAgIHRvOiBbQi5yLCBCLmcsIEIuYiwgQi5vcGFjaXR5XSwKICAgICAgICAgICAgICAgIGY6IGdldENvbG91cgogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBpZiAobmFtZSA9PSAidHJhbnNmb3JtIiB8fCBuYW1lID09ICJncmFkaWVudFRyYW5zZm9ybSIgfHwgbmFtZSA9PSAicGF0dGVyblRyYW5zZm9ybSIpIHsKICAgICAgICAgICAgaWYgKGIgaW5zdGFuY2VvZiBTbmFwLk1hdHJpeCkgewogICAgICAgICAgICAgICAgYiA9IGIudG9UcmFuc2Zvcm1TdHJpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIVNuYXAuXy5yZ1RyYW5zZm9ybS50ZXN0KGIpKSB7CiAgICAgICAgICAgICAgICBiID0gU25hcC5fLnN2Z1RyYW5zZm9ybTJzdHJpbmcoYik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGVxdWFsaXNlVHJhbnNmb3JtKGEsIGIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBlbC5nZXRCQm94KDEpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKG5hbWUgPT0gImQiIHx8IG5hbWUgPT0gInBhdGgiKSB7CiAgICAgICAgICAgIEEgPSBTbmFwLnBhdGgudG9DdWJpYyhhLCBiKTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGZyb206IHBhdGgyYXJyYXkoQVswXSksCiAgICAgICAgICAgICAgICB0bzogcGF0aDJhcnJheShBWzFdKSwKICAgICAgICAgICAgICAgIGY6IGdldFBhdGgoQVswXSkKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgaWYgKG5hbWUgPT0gInBvaW50cyIpIHsKICAgICAgICAgICAgQSA9IFN0cihhKS5zcGxpdChTbmFwLl8uc2VwYXJhdG9yKTsKICAgICAgICAgICAgQiA9IFN0cihiKS5zcGxpdChTbmFwLl8uc2VwYXJhdG9yKTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGZyb206IEEsCiAgICAgICAgICAgICAgICB0bzogQiwKICAgICAgICAgICAgICAgIGY6IGZ1bmN0aW9uICh2YWwpIHsgcmV0dXJuIHZhbDsgfQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBhVW5pdCA9IGEubWF0Y2gocmVVbml0KTsKICAgICAgICB2YXIgYlVuaXQgPSBTdHIoYikubWF0Y2gocmVVbml0KTsKICAgICAgICBpZiAoYVVuaXQgJiYgYVVuaXQgPT0gYlVuaXQpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGZyb206IHBhcnNlRmxvYXQoYSksCiAgICAgICAgICAgICAgICB0bzogcGFyc2VGbG9hdChiKSwKICAgICAgICAgICAgICAgIGY6IGdldFVuaXQoYVVuaXQpCiAgICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGZyb206IHRoaXMuYXNQWChuYW1lKSwKICAgICAgICAgICAgICAgIHRvOiB0aGlzLmFzUFgobmFtZSwgYiksCiAgICAgICAgICAgICAgICBmOiBnZXROdW1iZXIKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9KTsKfSk7Ci8vIENvcHlyaWdodCAoYykgMjAxMyBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KLy8gCi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwovLyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCi8vIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAovLyAKLy8gaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCi8vIAovLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCi8vIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCi8vIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgovLyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCi8vIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgpTbmFwLnBsdWdpbihmdW5jdGlvbiAoU25hcCwgRWxlbWVudCwgUGFwZXIsIGdsb2IpIHsKICAgIHZhciBlbHByb3RvID0gRWxlbWVudC5wcm90b3R5cGUsCiAgICBoYXMgPSAiaGFzT3duUHJvcGVydHkiLAogICAgc3VwcG9ydHNUb3VjaCA9ICJjcmVhdGVUb3VjaCIgaW4gZ2xvYi5kb2MsCiAgICBldmVudHMgPSBbCiAgICAgICAgImNsaWNrIiwgImRibGNsaWNrIiwgIm1vdXNlZG93biIsICJtb3VzZW1vdmUiLCAibW91c2VvdXQiLAogICAgICAgICJtb3VzZW92ZXIiLCAibW91c2V1cCIsICJ0b3VjaHN0YXJ0IiwgInRvdWNobW92ZSIsICJ0b3VjaGVuZCIsCiAgICAgICAgInRvdWNoY2FuY2VsIgogICAgXSwKICAgIHRvdWNoTWFwID0gewogICAgICAgIG1vdXNlZG93bjogInRvdWNoc3RhcnQiLAogICAgICAgIG1vdXNlbW92ZTogInRvdWNobW92ZSIsCiAgICAgICAgbW91c2V1cDogInRvdWNoZW5kIgogICAgfSwKICAgIGdldFNjcm9sbCA9IGZ1bmN0aW9uICh4eSwgZWwpIHsKICAgICAgICB2YXIgbmFtZSA9IHh5ID09ICJ5IiA/ICJzY3JvbGxUb3AiIDogInNjcm9sbExlZnQiLAogICAgICAgICAgICBkb2MgPSBlbCAmJiBlbC5ub2RlID8gZWwubm9kZS5vd25lckRvY3VtZW50IDogZ2xvYi5kb2M7CiAgICAgICAgcmV0dXJuIGRvY1tuYW1lIGluIGRvYy5kb2N1bWVudEVsZW1lbnQgPyAiZG9jdW1lbnRFbGVtZW50IiA6ICJib2R5Il1bbmFtZV07CiAgICB9LAogICAgcHJldmVudERlZmF1bHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5yZXR1cm5WYWx1ZSA9IGZhbHNlOwogICAgfSwKICAgIHByZXZlbnRUb3VjaCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5vcmlnaW5hbEV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICB9LAogICAgc3RvcFByb3BhZ2F0aW9uID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuY2FuY2VsQnViYmxlID0gdHJ1ZTsKICAgIH0sCiAgICBzdG9wVG91Y2ggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMub3JpZ2luYWxFdmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0sCiAgICBhZGRFdmVudCA9IChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKGdsb2IuZG9jLmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChvYmosIHR5cGUsIGZuLCBlbGVtZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgcmVhbE5hbWUgPSBzdXBwb3J0c1RvdWNoICYmIHRvdWNoTWFwW3R5cGVdID8gdG91Y2hNYXBbdHlwZV0gOiB0eXBlLAogICAgICAgICAgICAgICAgICAgIGYgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsWSA9IGdldFNjcm9sbCgieSIsIGVsZW1lbnQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsWCA9IGdldFNjcm9sbCgieCIsIGVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3VwcG9ydHNUb3VjaCAmJiB0b3VjaE1hcFtoYXNdKHR5cGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBlLnRhcmdldFRvdWNoZXMgJiYgZS50YXJnZXRUb3VjaGVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXRUb3VjaGVzW2ldLnRhcmdldCA9PSBvYmogfHwgb2JqLmNvbnRhaW5zKGUudGFyZ2V0VG91Y2hlc1tpXS50YXJnZXQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvbGRlID0gZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGUudGFyZ2V0VG91Y2hlc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5vcmlnaW5hbEV2ZW50ID0gb2xkZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCA9IHByZXZlbnRUb3VjaDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24gPSBzdG9wVG91Y2g7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IGUuY2xpZW50WCArIHNjcm9sbFgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ID0gZS5jbGllbnRZICsgc2Nyb2xsWTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZuLmNhbGwoZWxlbWVudCwgZSwgeCwgeSk7CiAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBpZiAodHlwZSAhPT0gcmVhbE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBvYmouYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBmLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgb2JqLmFkZEV2ZW50TGlzdGVuZXIocmVhbE5hbWUsIGYsIGZhbHNlKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlICE9PSByZWFsTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBmLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcihyZWFsTmFtZSwgZiwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgaWYgKGdsb2IuZG9jLmF0dGFjaEV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAob2JqLCB0eXBlLCBmbiwgZWxlbWVudCkgewogICAgICAgICAgICAgICAgdmFyIGYgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgIGUgPSBlIHx8IGVsZW1lbnQubm9kZS5vd25lckRvY3VtZW50LndpbmRvdy5ldmVudDsKICAgICAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsWSA9IGdldFNjcm9sbCgieSIsIGVsZW1lbnQpLAogICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxYID0gZ2V0U2Nyb2xsKCJ4IiwgZWxlbWVudCksCiAgICAgICAgICAgICAgICAgICAgICAgIHggPSBlLmNsaWVudFggKyBzY3JvbGxYLAogICAgICAgICAgICAgICAgICAgICAgICB5ID0gZS5jbGllbnRZICsgc2Nyb2xsWTsKICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0ID0gZS5wcmV2ZW50RGVmYXVsdCB8fCBwcmV2ZW50RGVmYXVsdDsKICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbiA9IGUuc3RvcFByb3BhZ2F0aW9uIHx8IHN0b3BQcm9wYWdhdGlvbjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm4uY2FsbChlbGVtZW50LCBlLCB4LCB5KTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBvYmouYXR0YWNoRXZlbnQoIm9uIiArIHR5cGUsIGYpOwogICAgICAgICAgICAgICAgdmFyIGRldGFjaGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIG9iai5kZXRhY2hFdmVudCgib24iICsgdHlwZSwgZik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcmV0dXJuIGRldGFjaGVyOwogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0pKCksCiAgICBkcmFnID0gW10sCiAgICBkcmFnTW92ZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHggPSBlLmNsaWVudFgsCiAgICAgICAgICAgIHkgPSBlLmNsaWVudFksCiAgICAgICAgICAgIHNjcm9sbFkgPSBnZXRTY3JvbGwoInkiKSwKICAgICAgICAgICAgc2Nyb2xsWCA9IGdldFNjcm9sbCgieCIpLAogICAgICAgICAgICBkcmFnaSwKICAgICAgICAgICAgaiA9IGRyYWcubGVuZ3RoOwogICAgICAgIHdoaWxlIChqLS0pIHsKICAgICAgICAgICAgZHJhZ2kgPSBkcmFnW2pdOwogICAgICAgICAgICBpZiAoc3VwcG9ydHNUb3VjaCkgewogICAgICAgICAgICAgICAgdmFyIGkgPSBlLnRvdWNoZXMgJiYgZS50b3VjaGVzLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICB0b3VjaDsKICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgICAgICB0b3VjaCA9IGUudG91Y2hlc1tpXTsKICAgICAgICAgICAgICAgICAgICBpZiAodG91Y2guaWRlbnRpZmllciA9PSBkcmFnaS5lbC5fZHJhZy5pZCB8fCBkcmFnaS5lbC5ub2RlLmNvbnRhaW5zKHRvdWNoLnRhcmdldCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgeCA9IHRvdWNoLmNsaWVudFg7CiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSB0b3VjaC5jbGllbnRZOwogICAgICAgICAgICAgICAgICAgICAgICAoZS5vcmlnaW5hbEV2ZW50ID8gZS5vcmlnaW5hbEV2ZW50IDogZSkucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBub2RlID0gZHJhZ2kuZWwubm9kZSwKICAgICAgICAgICAgICAgIG8sCiAgICAgICAgICAgICAgICBuZXh0ID0gbm9kZS5uZXh0U2libGluZywKICAgICAgICAgICAgICAgIHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZSwKICAgICAgICAgICAgICAgIGRpc3BsYXkgPSBub2RlLnN0eWxlLmRpc3BsYXk7CiAgICAgICAgICAgIC8vIGdsb2Iud2luLm9wZXJhICYmIHBhcmVudC5yZW1vdmVDaGlsZChub2RlKTsKICAgICAgICAgICAgLy8gbm9kZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICAvLyBvID0gZHJhZ2kuZWwucGFwZXIuZ2V0RWxlbWVudEJ5UG9pbnQoeCwgeSk7CiAgICAgICAgICAgIC8vIG5vZGUuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXk7CiAgICAgICAgICAgIC8vIGdsb2Iud2luLm9wZXJhICYmIChuZXh0ID8gcGFyZW50Lmluc2VydEJlZm9yZShub2RlLCBuZXh0KSA6IHBhcmVudC5hcHBlbmRDaGlsZChub2RlKSk7CiAgICAgICAgICAgIC8vIG8gJiYgZXZlKCJzbmFwLmRyYWcub3Zlci4iICsgZHJhZ2kuZWwuaWQsIGRyYWdpLmVsLCBvKTsKICAgICAgICAgICAgeCArPSBzY3JvbGxYOwogICAgICAgICAgICB5ICs9IHNjcm9sbFk7CiAgICAgICAgICAgIGV2ZSgic25hcC5kcmFnLm1vdmUuIiArIGRyYWdpLmVsLmlkLCBkcmFnaS5tb3ZlX3Njb3BlIHx8IGRyYWdpLmVsLCB4IC0gZHJhZ2kuZWwuX2RyYWcueCwgeSAtIGRyYWdpLmVsLl9kcmFnLnksIHgsIHksIGUpOwogICAgICAgIH0KICAgIH0sCiAgICBkcmFnVXAgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIFNuYXAudW5tb3VzZW1vdmUoZHJhZ01vdmUpLnVubW91c2V1cChkcmFnVXApOwogICAgICAgIHZhciBpID0gZHJhZy5sZW5ndGgsCiAgICAgICAgICAgIGRyYWdpOwogICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgZHJhZ2kgPSBkcmFnW2ldOwogICAgICAgICAgICBkcmFnaS5lbC5fZHJhZyA9IHt9OwogICAgICAgICAgICBldmUoInNuYXAuZHJhZy5lbmQuIiArIGRyYWdpLmVsLmlkLCBkcmFnaS5lbmRfc2NvcGUgfHwgZHJhZ2kuc3RhcnRfc2NvcGUgfHwgZHJhZ2kubW92ZV9zY29wZSB8fCBkcmFnaS5lbCwgZSk7CiAgICAgICAgfQogICAgICAgIGRyYWcgPSBbXTsKICAgIH07CiAgICAvKlwKICAgICAqIEVsZW1lbnQuY2xpY2sKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIEFkZHMgYSBjbGljayBldmVudCBoYW5kbGVyIHRvIHRoZSBlbGVtZW50CiAgICAgLSBoYW5kbGVyIChmdW5jdGlvbikgaGFuZGxlciBmb3IgdGhlIGV2ZW50CiAgICAgPSAob2JqZWN0KSBARWxlbWVudAogICAgXCovCiAgICAvKlwKICAgICAqIEVsZW1lbnQudW5jbGljawogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogUmVtb3ZlcyBhIGNsaWNrIGV2ZW50IGhhbmRsZXIgZnJvbSB0aGUgZWxlbWVudAogICAgIC0gaGFuZGxlciAoZnVuY3Rpb24pIGhhbmRsZXIgZm9yIHRoZSBldmVudAogICAgID0gKG9iamVjdCkgQEVsZW1lbnQKICAgIFwqLwogICAgCiAgICAvKlwKICAgICAqIEVsZW1lbnQuZGJsY2xpY2sKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIEFkZHMgYSBkb3VibGUgY2xpY2sgZXZlbnQgaGFuZGxlciB0byB0aGUgZWxlbWVudAogICAgIC0gaGFuZGxlciAoZnVuY3Rpb24pIGhhbmRsZXIgZm9yIHRoZSBldmVudAogICAgID0gKG9iamVjdCkgQEVsZW1lbnQKICAgIFwqLwogICAgLypcCiAgICAgKiBFbGVtZW50LnVuZGJsY2xpY2sKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJlbW92ZXMgYSBkb3VibGUgY2xpY2sgZXZlbnQgaGFuZGxlciBmcm9tIHRoZSBlbGVtZW50CiAgICAgLSBoYW5kbGVyIChmdW5jdGlvbikgaGFuZGxlciBmb3IgdGhlIGV2ZW50CiAgICAgPSAob2JqZWN0KSBARWxlbWVudAogICAgXCovCiAgICAKICAgIC8qXAogICAgICogRWxlbWVudC5tb3VzZWRvd24KICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIEFkZHMgYSBtb3VzZWRvd24gZXZlbnQgaGFuZGxlciB0byB0aGUgZWxlbWVudAogICAgIC0gaGFuZGxlciAoZnVuY3Rpb24pIGhhbmRsZXIgZm9yIHRoZSBldmVudAogICAgID0gKG9iamVjdCkgQEVsZW1lbnQKICAgIFwqLwogICAgLypcCiAgICAgKiBFbGVtZW50LnVubW91c2Vkb3duCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBSZW1vdmVzIGEgbW91c2Vkb3duIGV2ZW50IGhhbmRsZXIgZnJvbSB0aGUgZWxlbWVudAogICAgIC0gaGFuZGxlciAoZnVuY3Rpb24pIGhhbmRsZXIgZm9yIHRoZSBldmVudAogICAgID0gKG9iamVjdCkgQEVsZW1lbnQKICAgIFwqLwogICAgCiAgICAvKlwKICAgICAqIEVsZW1lbnQubW91c2Vtb3ZlCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBBZGRzIGEgbW91c2Vtb3ZlIGV2ZW50IGhhbmRsZXIgdG8gdGhlIGVsZW1lbnQKICAgICAtIGhhbmRsZXIgKGZ1bmN0aW9uKSBoYW5kbGVyIGZvciB0aGUgZXZlbnQKICAgICA9IChvYmplY3QpIEBFbGVtZW50CiAgICBcKi8KICAgIC8qXAogICAgICogRWxlbWVudC51bm1vdXNlbW92ZQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogUmVtb3ZlcyBhIG1vdXNlbW92ZSBldmVudCBoYW5kbGVyIGZyb20gdGhlIGVsZW1lbnQKICAgICAtIGhhbmRsZXIgKGZ1bmN0aW9uKSBoYW5kbGVyIGZvciB0aGUgZXZlbnQKICAgICA9IChvYmplY3QpIEBFbGVtZW50CiAgICBcKi8KICAgIAogICAgLypcCiAgICAgKiBFbGVtZW50Lm1vdXNlb3V0CiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBBZGRzIGEgbW91c2VvdXQgZXZlbnQgaGFuZGxlciB0byB0aGUgZWxlbWVudAogICAgIC0gaGFuZGxlciAoZnVuY3Rpb24pIGhhbmRsZXIgZm9yIHRoZSBldmVudAogICAgID0gKG9iamVjdCkgQEVsZW1lbnQKICAgIFwqLwogICAgLypcCiAgICAgKiBFbGVtZW50LnVubW91c2VvdXQKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJlbW92ZXMgYSBtb3VzZW91dCBldmVudCBoYW5kbGVyIGZyb20gdGhlIGVsZW1lbnQKICAgICAtIGhhbmRsZXIgKGZ1bmN0aW9uKSBoYW5kbGVyIGZvciB0aGUgZXZlbnQKICAgICA9IChvYmplY3QpIEBFbGVtZW50CiAgICBcKi8KICAgIAogICAgLypcCiAgICAgKiBFbGVtZW50Lm1vdXNlb3ZlcgogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogQWRkcyBhIG1vdXNlb3ZlciBldmVudCBoYW5kbGVyIHRvIHRoZSBlbGVtZW50CiAgICAgLSBoYW5kbGVyIChmdW5jdGlvbikgaGFuZGxlciBmb3IgdGhlIGV2ZW50CiAgICAgPSAob2JqZWN0KSBARWxlbWVudAogICAgXCovCiAgICAvKlwKICAgICAqIEVsZW1lbnQudW5tb3VzZW92ZXIKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJlbW92ZXMgYSBtb3VzZW92ZXIgZXZlbnQgaGFuZGxlciBmcm9tIHRoZSBlbGVtZW50CiAgICAgLSBoYW5kbGVyIChmdW5jdGlvbikgaGFuZGxlciBmb3IgdGhlIGV2ZW50CiAgICAgPSAob2JqZWN0KSBARWxlbWVudAogICAgXCovCiAgICAKICAgIC8qXAogICAgICogRWxlbWVudC5tb3VzZXVwCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBBZGRzIGEgbW91c2V1cCBldmVudCBoYW5kbGVyIHRvIHRoZSBlbGVtZW50CiAgICAgLSBoYW5kbGVyIChmdW5jdGlvbikgaGFuZGxlciBmb3IgdGhlIGV2ZW50CiAgICAgPSAob2JqZWN0KSBARWxlbWVudAogICAgXCovCiAgICAvKlwKICAgICAqIEVsZW1lbnQudW5tb3VzZXVwCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBSZW1vdmVzIGEgbW91c2V1cCBldmVudCBoYW5kbGVyIGZyb20gdGhlIGVsZW1lbnQKICAgICAtIGhhbmRsZXIgKGZ1bmN0aW9uKSBoYW5kbGVyIGZvciB0aGUgZXZlbnQKICAgICA9IChvYmplY3QpIEBFbGVtZW50CiAgICBcKi8KICAgIAogICAgLypcCiAgICAgKiBFbGVtZW50LnRvdWNoc3RhcnQKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIEFkZHMgYSB0b3VjaHN0YXJ0IGV2ZW50IGhhbmRsZXIgdG8gdGhlIGVsZW1lbnQKICAgICAtIGhhbmRsZXIgKGZ1bmN0aW9uKSBoYW5kbGVyIGZvciB0aGUgZXZlbnQKICAgICA9IChvYmplY3QpIEBFbGVtZW50CiAgICBcKi8KICAgIC8qXAogICAgICogRWxlbWVudC51bnRvdWNoc3RhcnQKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJlbW92ZXMgYSB0b3VjaHN0YXJ0IGV2ZW50IGhhbmRsZXIgZnJvbSB0aGUgZWxlbWVudAogICAgIC0gaGFuZGxlciAoZnVuY3Rpb24pIGhhbmRsZXIgZm9yIHRoZSBldmVudAogICAgID0gKG9iamVjdCkgQEVsZW1lbnQKICAgIFwqLwogICAgCiAgICAvKlwKICAgICAqIEVsZW1lbnQudG91Y2htb3ZlCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBBZGRzIGEgdG91Y2htb3ZlIGV2ZW50IGhhbmRsZXIgdG8gdGhlIGVsZW1lbnQKICAgICAtIGhhbmRsZXIgKGZ1bmN0aW9uKSBoYW5kbGVyIGZvciB0aGUgZXZlbnQKICAgICA9IChvYmplY3QpIEBFbGVtZW50CiAgICBcKi8KICAgIC8qXAogICAgICogRWxlbWVudC51bnRvdWNobW92ZQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogUmVtb3ZlcyBhIHRvdWNobW92ZSBldmVudCBoYW5kbGVyIGZyb20gdGhlIGVsZW1lbnQKICAgICAtIGhhbmRsZXIgKGZ1bmN0aW9uKSBoYW5kbGVyIGZvciB0aGUgZXZlbnQKICAgICA9IChvYmplY3QpIEBFbGVtZW50CiAgICBcKi8KICAgIAogICAgLypcCiAgICAgKiBFbGVtZW50LnRvdWNoZW5kCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBBZGRzIGEgdG91Y2hlbmQgZXZlbnQgaGFuZGxlciB0byB0aGUgZWxlbWVudAogICAgIC0gaGFuZGxlciAoZnVuY3Rpb24pIGhhbmRsZXIgZm9yIHRoZSBldmVudAogICAgID0gKG9iamVjdCkgQEVsZW1lbnQKICAgIFwqLwogICAgLypcCiAgICAgKiBFbGVtZW50LnVudG91Y2hlbmQKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJlbW92ZXMgYSB0b3VjaGVuZCBldmVudCBoYW5kbGVyIGZyb20gdGhlIGVsZW1lbnQKICAgICAtIGhhbmRsZXIgKGZ1bmN0aW9uKSBoYW5kbGVyIGZvciB0aGUgZXZlbnQKICAgICA9IChvYmplY3QpIEBFbGVtZW50CiAgICBcKi8KICAgIAogICAgLypcCiAgICAgKiBFbGVtZW50LnRvdWNoY2FuY2VsCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBBZGRzIGEgdG91Y2hjYW5jZWwgZXZlbnQgaGFuZGxlciB0byB0aGUgZWxlbWVudAogICAgIC0gaGFuZGxlciAoZnVuY3Rpb24pIGhhbmRsZXIgZm9yIHRoZSBldmVudAogICAgID0gKG9iamVjdCkgQEVsZW1lbnQKICAgIFwqLwogICAgLypcCiAgICAgKiBFbGVtZW50LnVudG91Y2hjYW5jZWwKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJlbW92ZXMgYSB0b3VjaGNhbmNlbCBldmVudCBoYW5kbGVyIGZyb20gdGhlIGVsZW1lbnQKICAgICAtIGhhbmRsZXIgKGZ1bmN0aW9uKSBoYW5kbGVyIGZvciB0aGUgZXZlbnQKICAgICA9IChvYmplY3QpIEBFbGVtZW50CiAgICBcKi8KICAgIGZvciAodmFyIGkgPSBldmVudHMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgKGZ1bmN0aW9uIChldmVudE5hbWUpIHsKICAgICAgICAgICAgU25hcFtldmVudE5hbWVdID0gZWxwcm90b1tldmVudE5hbWVdID0gZnVuY3Rpb24gKGZuLCBzY29wZSkgewogICAgICAgICAgICAgICAgaWYgKFNuYXAuaXMoZm4sICJmdW5jdGlvbiIpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5ldmVudHMgPSB0aGlzLmV2ZW50cyB8fCBbXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmV2ZW50cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZXZlbnROYW1lLAogICAgICAgICAgICAgICAgICAgICAgICBmOiBmbiwKICAgICAgICAgICAgICAgICAgICAgICAgdW5iaW5kOiBhZGRFdmVudCh0aGlzLm5vZGUgfHwgZG9jdW1lbnQsIGV2ZW50TmFtZSwgZm4sIHNjb3BlIHx8IHRoaXMpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgU25hcFsidW4iICsgZXZlbnROYW1lXSA9CiAgICAgICAgICAgIGVscHJvdG9bInVuIiArIGV2ZW50TmFtZV0gPSBmdW5jdGlvbiAoZm4pIHsKICAgICAgICAgICAgICAgIHZhciBldmVudHMgPSB0aGlzLmV2ZW50cyB8fCBbXSwKICAgICAgICAgICAgICAgICAgICBsID0gZXZlbnRzLmxlbmd0aDsKICAgICAgICAgICAgICAgIHdoaWxlIChsLS0pIGlmIChldmVudHNbbF0ubmFtZSA9PSBldmVudE5hbWUgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChldmVudHNbbF0uZiA9PSBmbiB8fCAhZm4pKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnRzW2xdLnVuYmluZCgpOwogICAgICAgICAgICAgICAgICAgIGV2ZW50cy5zcGxpY2UobCwgMSk7CiAgICAgICAgICAgICAgICAgICAgIWV2ZW50cy5sZW5ndGggJiYgZGVsZXRlIHRoaXMuZXZlbnRzOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH07CiAgICAgICAgfSkoZXZlbnRzW2ldKTsKICAgIH0KICAgIC8qXAogICAgICogRWxlbWVudC5ob3ZlcgogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogQWRkcyBob3ZlciBldmVudCBoYW5kbGVycyB0byB0aGUgZWxlbWVudAogICAgIC0gZl9pbiAoZnVuY3Rpb24pIGhhbmRsZXIgZm9yIGhvdmVyIGluCiAgICAgLSBmX291dCAoZnVuY3Rpb24pIGhhbmRsZXIgZm9yIGhvdmVyIG91dAogICAgIC0gaWNvbnRleHQgKG9iamVjdCkgI29wdGlvbmFsIGNvbnRleHQgZm9yIGhvdmVyIGluIGhhbmRsZXIKICAgICAtIG9jb250ZXh0IChvYmplY3QpICNvcHRpb25hbCBjb250ZXh0IGZvciBob3ZlciBvdXQgaGFuZGxlcgogICAgID0gKG9iamVjdCkgQEVsZW1lbnQKICAgIFwqLwogICAgZWxwcm90by5ob3ZlciA9IGZ1bmN0aW9uIChmX2luLCBmX291dCwgc2NvcGVfaW4sIHNjb3BlX291dCkgewogICAgICAgIHJldHVybiB0aGlzLm1vdXNlb3ZlcihmX2luLCBzY29wZV9pbikubW91c2VvdXQoZl9vdXQsIHNjb3BlX291dCB8fCBzY29wZV9pbik7CiAgICB9OwogICAgLypcCiAgICAgKiBFbGVtZW50LnVuaG92ZXIKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJlbW92ZXMgaG92ZXIgZXZlbnQgaGFuZGxlcnMgZnJvbSB0aGUgZWxlbWVudAogICAgIC0gZl9pbiAoZnVuY3Rpb24pIGhhbmRsZXIgZm9yIGhvdmVyIGluCiAgICAgLSBmX291dCAoZnVuY3Rpb24pIGhhbmRsZXIgZm9yIGhvdmVyIG91dAogICAgID0gKG9iamVjdCkgQEVsZW1lbnQKICAgIFwqLwogICAgZWxwcm90by51bmhvdmVyID0gZnVuY3Rpb24gKGZfaW4sIGZfb3V0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMudW5tb3VzZW92ZXIoZl9pbikudW5tb3VzZW91dChmX291dCk7CiAgICB9OwogICAgdmFyIGRyYWdnYWJsZSA9IFtdOwogICAgLy8gU0lFUlJBIHVuY2xlYXIgd2hhdCBfY29udGV4dF8gcmVmZXJzIHRvIGZvciBzdGFydGluZywgZW5kaW5nLCBtb3ZpbmcgdGhlIGRyYWcgZ2VzdHVyZS4KICAgIC8vIFNJRVJSQSBFbGVtZW50LmRyYWcoKTogX3ggcG9zaXRpb24gb2YgdGhlIG1vdXNlXzogV2hlcmUgYXJlIHRoZSB4L3kgdmFsdWVzIG9mZnNldCBmcm9tPwogICAgLy8gU0lFUlJBIEVsZW1lbnQuZHJhZygpOiBtdWNoIG9mIHRoaXMgbWVtYmVyJ3MgZG9jIGFwcGVhcnMgdG8gYmUgZHVwbGljYXRlZCBmb3Igc29tZSByZWFzb24uCiAgICAvLyBTSUVSUkEgVW5jbGVhciBhYm91dCB0aGlzIHNlbnRlbmNlOiBfQWRkaXRpb25hbGx5IGZvbGxvd2luZyBkcmFnIGV2ZW50cyB3aWxsIGJlIHRyaWdnZXJlZDogZHJhZy5zdGFydC48aWQ+IG9uIHN0YXJ0LCBkcmFnLmVuZC48aWQ+IG9uIGVuZCBhbmQgZHJhZy5tb3ZlLjxpZD4gb24gZXZlcnkgbW92ZS5fIElzIHRoZXJlIGEgZ2xvYmFsIF9kcmFnXyBvYmplY3QgdG8gd2hpY2ggeW91IGNhbiBhc3NpZ24gaGFuZGxlcnMga2V5ZWQgYnkgYW4gZWxlbWVudCdzIElEPwogICAgLypcCiAgICAgKiBFbGVtZW50LmRyYWcKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIEFkZHMgZXZlbnQgaGFuZGxlcnMgZm9yIGFuIGVsZW1lbnQncyBkcmFnIGdlc3R1cmUKICAgICAqKgogICAgIC0gb25tb3ZlIChmdW5jdGlvbikgaGFuZGxlciBmb3IgbW92aW5nCiAgICAgLSBvbnN0YXJ0IChmdW5jdGlvbikgaGFuZGxlciBmb3IgZHJhZyBzdGFydAogICAgIC0gb25lbmQgKGZ1bmN0aW9uKSBoYW5kbGVyIGZvciBkcmFnIGVuZAogICAgIC0gbWNvbnRleHQgKG9iamVjdCkgI29wdGlvbmFsIGNvbnRleHQgZm9yIG1vdmluZyBoYW5kbGVyCiAgICAgLSBzY29udGV4dCAob2JqZWN0KSAjb3B0aW9uYWwgY29udGV4dCBmb3IgZHJhZyBzdGFydCBoYW5kbGVyCiAgICAgLSBlY29udGV4dCAob2JqZWN0KSAjb3B0aW9uYWwgY29udGV4dCBmb3IgZHJhZyBlbmQgaGFuZGxlcgogICAgICogQWRkaXRpb25hbHkgZm9sbG93aW5nIGBkcmFnYCBldmVudHMgYXJlIHRyaWdnZXJlZDogYGRyYWcuc3RhcnQuPGlkPmAgb24gc3RhcnQsIAogICAgICogYGRyYWcuZW5kLjxpZD5gIG9uIGVuZCBhbmQgYGRyYWcubW92ZS48aWQ+YCBvbiBldmVyeSBtb3ZlLiBXaGVuIGVsZW1lbnQgaXMgZHJhZ2dlZCBvdmVyIGFub3RoZXIgZWxlbWVudCAKICAgICAqIGBkcmFnLm92ZXIuPGlkPmAgZmlyZXMgYXMgd2VsbC4KICAgICAqCiAgICAgKiBTdGFydCBldmVudCBhbmQgc3RhcnQgaGFuZGxlciBhcmUgY2FsbGVkIGluIHNwZWNpZmllZCBjb250ZXh0IG9yIGluIGNvbnRleHQgb2YgdGhlIGVsZW1lbnQgd2l0aCBmb2xsb3dpbmcgcGFyYW1ldGVyczoKICAgICBvIHggKG51bWJlcikgeCBwb3NpdGlvbiBvZiB0aGUgbW91c2UKICAgICBvIHkgKG51bWJlcikgeSBwb3NpdGlvbiBvZiB0aGUgbW91c2UKICAgICBvIGV2ZW50IChvYmplY3QpIERPTSBldmVudCBvYmplY3QKICAgICAqIE1vdmUgZXZlbnQgYW5kIG1vdmUgaGFuZGxlciBhcmUgY2FsbGVkIGluIHNwZWNpZmllZCBjb250ZXh0IG9yIGluIGNvbnRleHQgb2YgdGhlIGVsZW1lbnQgd2l0aCBmb2xsb3dpbmcgcGFyYW1ldGVyczoKICAgICBvIGR4IChudW1iZXIpIHNoaWZ0IGJ5IHggZnJvbSB0aGUgc3RhcnQgcG9pbnQKICAgICBvIGR5IChudW1iZXIpIHNoaWZ0IGJ5IHkgZnJvbSB0aGUgc3RhcnQgcG9pbnQKICAgICBvIHggKG51bWJlcikgeCBwb3NpdGlvbiBvZiB0aGUgbW91c2UKICAgICBvIHkgKG51bWJlcikgeSBwb3NpdGlvbiBvZiB0aGUgbW91c2UKICAgICBvIGV2ZW50IChvYmplY3QpIERPTSBldmVudCBvYmplY3QKICAgICAqIEVuZCBldmVudCBhbmQgZW5kIGhhbmRsZXIgYXJlIGNhbGxlZCBpbiBzcGVjaWZpZWQgY29udGV4dCBvciBpbiBjb250ZXh0IG9mIHRoZSBlbGVtZW50IHdpdGggZm9sbG93aW5nIHBhcmFtZXRlcnM6CiAgICAgbyBldmVudCAob2JqZWN0KSBET00gZXZlbnQgb2JqZWN0CiAgICAgPSAob2JqZWN0KSBARWxlbWVudAogICAgXCovCiAgICBlbHByb3RvLmRyYWcgPSBmdW5jdGlvbiAob25tb3ZlLCBvbnN0YXJ0LCBvbmVuZCwgbW92ZV9zY29wZSwgc3RhcnRfc2NvcGUsIGVuZF9zY29wZSkgewogICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgewogICAgICAgICAgICB2YXIgb3JpZ1RyYW5zZm9ybTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZHJhZyhmdW5jdGlvbiAoZHgsIGR5KSB7CiAgICAgICAgICAgICAgICB0aGlzLmF0dHIoewogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogb3JpZ1RyYW5zZm9ybSArIChvcmlnVHJhbnNmb3JtID8gIlQiIDogInQiKSArIFtkeCwgZHldCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgb3JpZ1RyYW5zZm9ybSA9IHRoaXMudHJhbnNmb3JtKCkubG9jYWw7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzdGFydChlLCB4LCB5KSB7CiAgICAgICAgICAgIChlLm9yaWdpbmFsRXZlbnQgfHwgZSkucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdGhpcy5fZHJhZy54ID0geDsKICAgICAgICAgICAgdGhpcy5fZHJhZy55ID0geTsKICAgICAgICAgICAgdGhpcy5fZHJhZy5pZCA9IGUuaWRlbnRpZmllcjsKICAgICAgICAgICAgIWRyYWcubGVuZ3RoICYmIFNuYXAubW91c2Vtb3ZlKGRyYWdNb3ZlKS5tb3VzZXVwKGRyYWdVcCk7CiAgICAgICAgICAgIGRyYWcucHVzaCh7ZWw6IHRoaXMsIG1vdmVfc2NvcGU6IG1vdmVfc2NvcGUsIHN0YXJ0X3Njb3BlOiBzdGFydF9zY29wZSwgZW5kX3Njb3BlOiBlbmRfc2NvcGV9KTsKICAgICAgICAgICAgb25zdGFydCAmJiBldmUub24oInNuYXAuZHJhZy5zdGFydC4iICsgdGhpcy5pZCwgb25zdGFydCk7CiAgICAgICAgICAgIG9ubW92ZSAmJiBldmUub24oInNuYXAuZHJhZy5tb3ZlLiIgKyB0aGlzLmlkLCBvbm1vdmUpOwogICAgICAgICAgICBvbmVuZCAmJiBldmUub24oInNuYXAuZHJhZy5lbmQuIiArIHRoaXMuaWQsIG9uZW5kKTsKICAgICAgICAgICAgZXZlKCJzbmFwLmRyYWcuc3RhcnQuIiArIHRoaXMuaWQsIHN0YXJ0X3Njb3BlIHx8IG1vdmVfc2NvcGUgfHwgdGhpcywgeCwgeSwgZSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2RyYWcgPSB7fTsKICAgICAgICBkcmFnZ2FibGUucHVzaCh7ZWw6IHRoaXMsIHN0YXJ0OiBzdGFydH0pOwogICAgICAgIHRoaXMubW91c2Vkb3duKHN0YXJ0KTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICAvKgogICAgICogRWxlbWVudC5vbkRyYWdPdmVyCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBTaG9ydGN1dCB0byBhc3NpZ24gZXZlbnQgaGFuZGxlciBmb3IgYGRyYWcub3Zlci48aWQ+YCBldmVudCwgd2hlcmUgYGlkYCBpcyB0aGUgZWxlbWVudCdzIGBpZGAgKHNlZSBARWxlbWVudC5pZCkKICAgICAtIGYgKGZ1bmN0aW9uKSBoYW5kbGVyIGZvciBldmVudCwgZmlyc3QgYXJndW1lbnQgd291bGQgYmUgdGhlIGVsZW1lbnQgeW91IGFyZSBkcmFnZ2luZyBvdmVyCiAgICBcKi8KICAgIC8vIGVscHJvdG8ub25EcmFnT3ZlciA9IGZ1bmN0aW9uIChmKSB7CiAgICAvLyAgICAgZiA/IGV2ZS5vbigic25hcC5kcmFnLm92ZXIuIiArIHRoaXMuaWQsIGYpIDogZXZlLnVuYmluZCgic25hcC5kcmFnLm92ZXIuIiArIHRoaXMuaWQpOwogICAgLy8gfTsKICAgIC8qXAogICAgICogRWxlbWVudC51bmRyYWcKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJlbW92ZXMgYWxsIGRyYWcgZXZlbnQgaGFuZGxlcnMgZnJvbSB0aGUgZ2l2ZW4gZWxlbWVudAogICAgXCovCiAgICBlbHByb3RvLnVuZHJhZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgaSA9IGRyYWdnYWJsZS5sZW5ndGg7CiAgICAgICAgd2hpbGUgKGktLSkgaWYgKGRyYWdnYWJsZVtpXS5lbCA9PSB0aGlzKSB7CiAgICAgICAgICAgIHRoaXMudW5tb3VzZWRvd24oZHJhZ2dhYmxlW2ldLnN0YXJ0KTsKICAgICAgICAgICAgZHJhZ2dhYmxlLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgZXZlLnVuYmluZCgic25hcC5kcmFnLiouIiArIHRoaXMuaWQpOwogICAgICAgIH0KICAgICAgICAhZHJhZ2dhYmxlLmxlbmd0aCAmJiBTbmFwLnVubW91c2Vtb3ZlKGRyYWdNb3ZlKS51bm1vdXNldXAoZHJhZ1VwKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07Cn0pOwovLyBDb3B5cmlnaHQgKGMpIDIwMTMgQWRvYmUgU3lzdGVtcyBJbmNvcnBvcmF0ZWQuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCi8vIAovLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKLy8geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgovLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKLy8gCi8vIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAovLyAKLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQovLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAovLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KLy8gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAovLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KU25hcC5wbHVnaW4oZnVuY3Rpb24gKFNuYXAsIEVsZW1lbnQsIFBhcGVyLCBnbG9iKSB7CiAgICB2YXIgZWxwcm90byA9IEVsZW1lbnQucHJvdG90eXBlLAogICAgICAgIHBwcm90byA9IFBhcGVyLnByb3RvdHlwZSwKICAgICAgICByZ3VybCA9IC9eXHMqdXJsXCgoLispXCkvLAogICAgICAgIFN0ciA9IFN0cmluZywKICAgICAgICAkID0gU25hcC5fLiQ7CiAgICBTbmFwLmZpbHRlciA9IHt9OwovLyBTSUVSUkEgUGFwZXIuZmlsdGVyKCk6IEkgZG9uJ3QgdW5kZXJzdGFuZCB0aGUgbm90ZS4gRG9lcyB0aGF0IG1lYW4gYW4gSFRNTCBzaG91bGQgZGVkaWNhdGUgYSBzZXBhcmF0ZSBTVkcgcmVnaW9uIGZvciBhIGZpbHRlciBkZWZpbml0aW9uPyBXaGF0J3MgdGhlIGFkdmFudGFnZSBvdmVyIGEgREVGUz8KICAgIC8qXAogICAgICogUGFwZXIuZmlsdGVyCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBDcmVhdGVzIGEgYDxmaWx0ZXI+YCBlbGVtZW50CiAgICAgKioKICAgICAtIGZpbHN0ciAoc3RyaW5nKSBTVkcgZnJhZ21lbnQgb2YgZmlsdGVyIHByb3ZpZGVkIGFzIGEgc3RyaW5nCiAgICAgPSAob2JqZWN0KSBARWxlbWVudAogICAgICogTm90ZTogSXQgaXMgcmVjb21tZW5kZWQgdG8gdXNlIGZpbHRlcnMgZW1iZWRkZWQgaW50byB0aGUgcGFnZSBpbnNpZGUgYW4gZW1wdHkgU1ZHIGVsZW1lbnQuCiAgICAgPiBVc2FnZQogICAgIHwgdmFyIGYgPSBwYXBlci5maWx0ZXIoJzxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjIiLz4nKSwKICAgICB8ICAgICBjID0gcGFwZXIuY2lyY2xlKDEwLCAxMCwgMTApLmF0dHIoewogICAgIHwgICAgICAgICBmaWx0ZXI6IGYKICAgICB8ICAgICB9KTsKICAgIFwqLwogICAgcHByb3RvLmZpbHRlciA9IGZ1bmN0aW9uIChmaWxzdHIpIHsKICAgICAgICB2YXIgcGFwZXIgPSB0aGlzOwogICAgICAgIGlmIChwYXBlci50eXBlICE9ICJzdmciKSB7CiAgICAgICAgICAgIHBhcGVyID0gcGFwZXIucGFwZXI7CiAgICAgICAgfQogICAgICAgIHZhciBmID0gU25hcC5wYXJzZShTdHIoZmlsc3RyKSksCiAgICAgICAgICAgIGlkID0gU25hcC5fLmlkKCksCiAgICAgICAgICAgIHdpZHRoID0gcGFwZXIubm9kZS5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgaGVpZ2h0ID0gcGFwZXIubm9kZS5vZmZzZXRIZWlnaHQsCiAgICAgICAgICAgIGZpbHRlciA9ICQoImZpbHRlciIpOwogICAgICAgICQoZmlsdGVyLCB7CiAgICAgICAgICAgIGlkOiBpZCwKICAgICAgICAgICAgZmlsdGVyVW5pdHM6ICJ1c2VyU3BhY2VPblVzZSIKICAgICAgICB9KTsKICAgICAgICBmaWx0ZXIuYXBwZW5kQ2hpbGQoZi5ub2RlKTsKICAgICAgICBwYXBlci5kZWZzLmFwcGVuZENoaWxkKGZpbHRlcik7CiAgICAgICAgcmV0dXJuIG5ldyBFbGVtZW50KGZpbHRlcik7CiAgICB9OwogICAgCiAgICBldmUub24oInNuYXAudXRpbC5nZXRhdHRyLmZpbHRlciIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBldmUuc3RvcCgpOwogICAgICAgIHZhciBwID0gJCh0aGlzLm5vZGUsICJmaWx0ZXIiKTsKICAgICAgICBpZiAocCkgewogICAgICAgICAgICB2YXIgbWF0Y2ggPSBTdHIocCkubWF0Y2gocmd1cmwpOwogICAgICAgICAgICByZXR1cm4gbWF0Y2ggJiYgU25hcC5zZWxlY3QobWF0Y2hbMV0pOwogICAgICAgIH0KICAgIH0pOwogICAgZXZlLm9uKCJzbmFwLnV0aWwuYXR0ci5maWx0ZXIiLCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBFbGVtZW50ICYmIHZhbHVlLnR5cGUgPT0gImZpbHRlciIpIHsKICAgICAgICAgICAgZXZlLnN0b3AoKTsKICAgICAgICAgICAgdmFyIGlkID0gdmFsdWUubm9kZS5pZDsKICAgICAgICAgICAgaWYgKCFpZCkgewogICAgICAgICAgICAgICAgJCh2YWx1ZS5ub2RlLCB7aWQ6IHZhbHVlLmlkfSk7CiAgICAgICAgICAgICAgICBpZCA9IHZhbHVlLmlkOwogICAgICAgICAgICB9CiAgICAgICAgICAgICQodGhpcy5ub2RlLCB7CiAgICAgICAgICAgICAgICBmaWx0ZXI6IFNuYXAudXJsKGlkKQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZSA9PSAibm9uZSIpIHsKICAgICAgICAgICAgZXZlLnN0b3AoKTsKICAgICAgICAgICAgdGhpcy5ub2RlLnJlbW92ZUF0dHJpYnV0ZSgiZmlsdGVyIik7CiAgICAgICAgfQogICAgfSk7CiAgICAvKlwKICAgICAqIFNuYXAuZmlsdGVyLmJsdXIKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJldHVybnMgYW4gU1ZHIG1hcmt1cCBzdHJpbmcgZm9yIHRoZSBibHVyIGZpbHRlcgogICAgICoqCiAgICAgLSB4IChudW1iZXIpIGFtb3VudCBvZiBob3Jpem9udGFsIGJsdXIsIGluIHBpeGVscwogICAgIC0geSAobnVtYmVyKSAjb3B0aW9uYWwgYW1vdW50IG9mIHZlcnRpY2FsIGJsdXIsIGluIHBpeGVscwogICAgID0gKHN0cmluZykgZmlsdGVyIHJlcHJlc2VudGF0aW9uCiAgICAgPiBVc2FnZQogICAgIHwgdmFyIGYgPSBwYXBlci5maWx0ZXIoU25hcC5maWx0ZXIuYmx1cig1LCAxMCkpLAogICAgIHwgICAgIGMgPSBwYXBlci5jaXJjbGUoMTAsIDEwLCAxMCkuYXR0cih7CiAgICAgfCAgICAgICAgIGZpbHRlcjogZgogICAgIHwgICAgIH0pOwogICAgXCovCiAgICBTbmFwLmZpbHRlci5ibHVyID0gZnVuY3Rpb24gKHgsIHkpIHsKICAgICAgICBpZiAoeCA9PSBudWxsKSB7CiAgICAgICAgICAgIHggPSAyOwogICAgICAgIH0KICAgICAgICB2YXIgZGVmID0geSA9PSBudWxsID8geCA6IFt4LCB5XTsKICAgICAgICByZXR1cm4gU25hcC5mb3JtYXQoJ1w8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSJ7ZGVmfSIvPicsIHsKICAgICAgICAgICAgZGVmOiBkZWYKICAgICAgICB9KTsKICAgIH07CiAgICBTbmFwLmZpbHRlci5ibHVyLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzKCk7CiAgICB9OwogICAgLypcCiAgICAgKiBTbmFwLmZpbHRlci5zaGFkb3cKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJldHVybnMgYW4gU1ZHIG1hcmt1cCBzdHJpbmcgZm9yIHRoZSBzaGFkb3cgZmlsdGVyCiAgICAgKioKICAgICAtIGR4IChudW1iZXIpICNvcHRpb25hbCBob3Jpem9udGFsIHNoaWZ0IG9mIHRoZSBzaGFkb3csIGluIHBpeGVscwogICAgIC0gZHkgKG51bWJlcikgI29wdGlvbmFsIHZlcnRpY2FsIHNoaWZ0IG9mIHRoZSBzaGFkb3csIGluIHBpeGVscwogICAgIC0gYmx1ciAobnVtYmVyKSAjb3B0aW9uYWwgYW1vdW50IG9mIGJsdXIKICAgICAtIGNvbG9yIChzdHJpbmcpICNvcHRpb25hbCBjb2xvciBvZiB0aGUgc2hhZG93CiAgICAgLSBvcGFjaXR5IChudW1iZXIpICNvcHRpb25hbCBgMC4uMWAgb3BhY2l0eSBvZiB0aGUgc2hhZG93CiAgICAgKiBvcgogICAgIC0gZHggKG51bWJlcikgI29wdGlvbmFsIGhvcml6b250YWwgc2hpZnQgb2YgdGhlIHNoYWRvdywgaW4gcGl4ZWxzCiAgICAgLSBkeSAobnVtYmVyKSAjb3B0aW9uYWwgdmVydGljYWwgc2hpZnQgb2YgdGhlIHNoYWRvdywgaW4gcGl4ZWxzCiAgICAgLSBjb2xvciAoc3RyaW5nKSAjb3B0aW9uYWwgY29sb3Igb2YgdGhlIHNoYWRvdwogICAgIC0gb3BhY2l0eSAobnVtYmVyKSAjb3B0aW9uYWwgYDAuLjFgIG9wYWNpdHkgb2YgdGhlIHNoYWRvdwogICAgICogd2hpY2ggbWFrZXMgYmx1ciBkZWZhdWx0IHRvIGA0YC4gT3IKICAgICAtIGR4IChudW1iZXIpICNvcHRpb25hbCBob3Jpem9udGFsIHNoaWZ0IG9mIHRoZSBzaGFkb3csIGluIHBpeGVscwogICAgIC0gZHkgKG51bWJlcikgI29wdGlvbmFsIHZlcnRpY2FsIHNoaWZ0IG9mIHRoZSBzaGFkb3csIGluIHBpeGVscwogICAgIC0gb3BhY2l0eSAobnVtYmVyKSAjb3B0aW9uYWwgYDAuLjFgIG9wYWNpdHkgb2YgdGhlIHNoYWRvdwogICAgID0gKHN0cmluZykgZmlsdGVyIHJlcHJlc2VudGF0aW9uCiAgICAgPiBVc2FnZQogICAgIHwgdmFyIGYgPSBwYXBlci5maWx0ZXIoU25hcC5maWx0ZXIuc2hhZG93KDAsIDIsIDMpKSwKICAgICB8ICAgICBjID0gcGFwZXIuY2lyY2xlKDEwLCAxMCwgMTApLmF0dHIoewogICAgIHwgICAgICAgICBmaWx0ZXI6IGYKICAgICB8ICAgICB9KTsKICAgIFwqLwogICAgU25hcC5maWx0ZXIuc2hhZG93ID0gZnVuY3Rpb24gKGR4LCBkeSwgYmx1ciwgY29sb3IsIG9wYWNpdHkpIHsKICAgICAgICBpZiAodHlwZW9mIGJsdXIgPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgY29sb3IgPSBibHVyOwogICAgICAgICAgICBvcGFjaXR5ID0gY29sb3I7CiAgICAgICAgICAgIGJsdXIgPSA0OwogICAgICAgIH0KICAgICAgICBpZiAodHlwZW9mIGNvbG9yICE9ICJzdHJpbmciKSB7CiAgICAgICAgICAgIG9wYWNpdHkgPSBjb2xvcjsKICAgICAgICAgICAgY29sb3IgPSAiIzAwMCI7CiAgICAgICAgfQogICAgICAgIGNvbG9yID0gY29sb3IgfHwgIiMwMDAiOwogICAgICAgIGlmIChibHVyID09IG51bGwpIHsKICAgICAgICAgICAgYmx1ciA9IDQ7CiAgICAgICAgfQogICAgICAgIGlmIChvcGFjaXR5ID09IG51bGwpIHsKICAgICAgICAgICAgb3BhY2l0eSA9IDE7CiAgICAgICAgfQogICAgICAgIGlmIChkeCA9PSBudWxsKSB7CiAgICAgICAgICAgIGR4ID0gMDsKICAgICAgICAgICAgZHkgPSAyOwogICAgICAgIH0KICAgICAgICBpZiAoZHkgPT0gbnVsbCkgewogICAgICAgICAgICBkeSA9IGR4OwogICAgICAgIH0KICAgICAgICBjb2xvciA9IFNuYXAuY29sb3IoY29sb3IpOwogICAgICAgIHJldHVybiBTbmFwLmZvcm1hdCgnPGZlR2F1c3NpYW5CbHVyIGluPSJTb3VyY2VBbHBoYSIgc3RkRGV2aWF0aW9uPSJ7Ymx1cn0iLz48ZmVPZmZzZXQgZHg9IntkeH0iIGR5PSJ7ZHl9IiByZXN1bHQ9Im9mZnNldGJsdXIiLz48ZmVGbG9vZCBmbG9vZC1jb2xvcj0ie2NvbG9yfSIvPjxmZUNvbXBvc2l0ZSBpbjI9Im9mZnNldGJsdXIiIG9wZXJhdG9yPSJpbiIvPjxmZUNvbXBvbmVudFRyYW5zZmVyPjxmZUZ1bmNBIHR5cGU9ImxpbmVhciIgc2xvcGU9IntvcGFjaXR5fSIvPjwvZmVDb21wb25lbnRUcmFuc2Zlcj48ZmVNZXJnZT48ZmVNZXJnZU5vZGUvPjxmZU1lcmdlTm9kZSBpbj0iU291cmNlR3JhcGhpYyIvPjwvZmVNZXJnZT4nLCB7CiAgICAgICAgICAgIGNvbG9yOiBjb2xvciwKICAgICAgICAgICAgZHg6IGR4LAogICAgICAgICAgICBkeTogZHksCiAgICAgICAgICAgIGJsdXI6IGJsdXIsCiAgICAgICAgICAgIG9wYWNpdHk6IG9wYWNpdHkKICAgICAgICB9KTsKICAgIH07CiAgICBTbmFwLmZpbHRlci5zaGFkb3cudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMoKTsKICAgIH07CiAgICAvKlwKICAgICAqIFNuYXAuZmlsdGVyLmdyYXlzY2FsZQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogUmV0dXJucyBhbiBTVkcgbWFya3VwIHN0cmluZyBmb3IgdGhlIGdyYXlzY2FsZSBmaWx0ZXIKICAgICAqKgogICAgIC0gYW1vdW50IChudW1iZXIpIGFtb3VudCBvZiBmaWx0ZXIgKGAwLi4xYCkKICAgICA9IChzdHJpbmcpIGZpbHRlciByZXByZXNlbnRhdGlvbgogICAgXCovCiAgICBTbmFwLmZpbHRlci5ncmF5c2NhbGUgPSBmdW5jdGlvbiAoYW1vdW50KSB7CiAgICAgICAgaWYgKGFtb3VudCA9PSBudWxsKSB7CiAgICAgICAgICAgIGFtb3VudCA9IDE7CiAgICAgICAgfQogICAgICAgIHJldHVybiBTbmFwLmZvcm1hdCgnPGZlQ29sb3JNYXRyaXggdHlwZT0ibWF0cml4IiB2YWx1ZXM9InthfSB7Yn0ge2N9IDAgMCB7ZH0ge2V9IHtmfSAwIDAge2d9IHtifSB7aH0gMCAwIDAgMCAwIDEgMCIvPicsIHsKICAgICAgICAgICAgYTogMC4yMTI2ICsgMC43ODc0ICogKDEgLSBhbW91bnQpLAogICAgICAgICAgICBiOiAwLjcxNTIgLSAwLjcxNTIgKiAoMSAtIGFtb3VudCksCiAgICAgICAgICAgIGM6IDAuMDcyMiAtIDAuMDcyMiAqICgxIC0gYW1vdW50KSwKICAgICAgICAgICAgZDogMC4yMTI2IC0gMC4yMTI2ICogKDEgLSBhbW91bnQpLAogICAgICAgICAgICBlOiAwLjcxNTIgKyAwLjI4NDggKiAoMSAtIGFtb3VudCksCiAgICAgICAgICAgIGY6IDAuMDcyMiAtIDAuMDcyMiAqICgxIC0gYW1vdW50KSwKICAgICAgICAgICAgZzogMC4yMTI2IC0gMC4yMTI2ICogKDEgLSBhbW91bnQpLAogICAgICAgICAgICBoOiAwLjA3MjIgKyAwLjkyNzggKiAoMSAtIGFtb3VudCkKICAgICAgICB9KTsKICAgIH07CiAgICBTbmFwLmZpbHRlci5ncmF5c2NhbGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMoKTsKICAgIH07CiAgICAvKlwKICAgICAqIFNuYXAuZmlsdGVyLnNlcGlhCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBSZXR1cm5zIGFuIFNWRyBtYXJrdXAgc3RyaW5nIGZvciB0aGUgc2VwaWEgZmlsdGVyCiAgICAgKioKICAgICAtIGFtb3VudCAobnVtYmVyKSBhbW91bnQgb2YgZmlsdGVyIChgMC4uMWApCiAgICAgPSAoc3RyaW5nKSBmaWx0ZXIgcmVwcmVzZW50YXRpb24KICAgIFwqLwogICAgU25hcC5maWx0ZXIuc2VwaWEgPSBmdW5jdGlvbiAoYW1vdW50KSB7CiAgICAgICAgaWYgKGFtb3VudCA9PSBudWxsKSB7CiAgICAgICAgICAgIGFtb3VudCA9IDE7CiAgICAgICAgfQogICAgICAgIHJldHVybiBTbmFwLmZvcm1hdCgnPGZlQ29sb3JNYXRyaXggdHlwZT0ibWF0cml4IiB2YWx1ZXM9InthfSB7Yn0ge2N9IDAgMCB7ZH0ge2V9IHtmfSAwIDAge2d9IHtofSB7aX0gMCAwIDAgMCAwIDEgMCIvPicsIHsKICAgICAgICAgICAgYTogMC4zOTMgKyAwLjYwNyAqICgxIC0gYW1vdW50KSwKICAgICAgICAgICAgYjogMC43NjkgLSAwLjc2OSAqICgxIC0gYW1vdW50KSwKICAgICAgICAgICAgYzogMC4xODkgLSAwLjE4OSAqICgxIC0gYW1vdW50KSwKICAgICAgICAgICAgZDogMC4zNDkgLSAwLjM0OSAqICgxIC0gYW1vdW50KSwKICAgICAgICAgICAgZTogMC42ODYgKyAwLjMxNCAqICgxIC0gYW1vdW50KSwKICAgICAgICAgICAgZjogMC4xNjggLSAwLjE2OCAqICgxIC0gYW1vdW50KSwKICAgICAgICAgICAgZzogMC4yNzIgLSAwLjI3MiAqICgxIC0gYW1vdW50KSwKICAgICAgICAgICAgaDogMC41MzQgLSAwLjUzNCAqICgxIC0gYW1vdW50KSwKICAgICAgICAgICAgaTogMC4xMzEgKyAwLjg2OSAqICgxIC0gYW1vdW50KQogICAgICAgIH0pOwogICAgfTsKICAgIFNuYXAuZmlsdGVyLnNlcGlhLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzKCk7CiAgICB9OwogICAgLypcCiAgICAgKiBTbmFwLmZpbHRlci5zYXR1cmF0ZQogICAgIFsgbWV0aG9kIF0KICAgICAqKgogICAgICogUmV0dXJucyBhbiBTVkcgbWFya3VwIHN0cmluZyBmb3IgdGhlIHNhdHVyYXRlIGZpbHRlcgogICAgICoqCiAgICAgLSBhbW91bnQgKG51bWJlcikgYW1vdW50IG9mIGZpbHRlciAoYDAuLjFgKQogICAgID0gKHN0cmluZykgZmlsdGVyIHJlcHJlc2VudGF0aW9uCiAgICBcKi8KICAgIFNuYXAuZmlsdGVyLnNhdHVyYXRlID0gZnVuY3Rpb24gKGFtb3VudCkgewogICAgICAgIGlmIChhbW91bnQgPT0gbnVsbCkgewogICAgICAgICAgICBhbW91bnQgPSAxOwogICAgICAgIH0KICAgICAgICByZXR1cm4gU25hcC5mb3JtYXQoJzxmZUNvbG9yTWF0cml4IHR5cGU9InNhdHVyYXRlIiB2YWx1ZXM9InthbW91bnR9Ii8+JywgewogICAgICAgICAgICBhbW91bnQ6IDEgLSBhbW91bnQKICAgICAgICB9KTsKICAgIH07CiAgICBTbmFwLmZpbHRlci5zYXR1cmF0ZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcygpOwogICAgfTsKICAgIC8qXAogICAgICogU25hcC5maWx0ZXIuaHVlUm90YXRlCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBSZXR1cm5zIGFuIFNWRyBtYXJrdXAgc3RyaW5nIGZvciB0aGUgaHVlLXJvdGF0ZSBmaWx0ZXIKICAgICAqKgogICAgIC0gYW5nbGUgKG51bWJlcikgYW5nbGUgb2Ygcm90YXRpb24KICAgICA9IChzdHJpbmcpIGZpbHRlciByZXByZXNlbnRhdGlvbgogICAgXCovCiAgICBTbmFwLmZpbHRlci5odWVSb3RhdGUgPSBmdW5jdGlvbiAoYW5nbGUpIHsKICAgICAgICBhbmdsZSA9IGFuZ2xlIHx8IDA7CiAgICAgICAgcmV0dXJuIFNuYXAuZm9ybWF0KCc8ZmVDb2xvck1hdHJpeCB0eXBlPSJodWVSb3RhdGUiIHZhbHVlcz0ie2FuZ2xlfSIvPicsIHsKICAgICAgICAgICAgYW5nbGU6IGFuZ2xlCiAgICAgICAgfSk7CiAgICB9OwogICAgU25hcC5maWx0ZXIuaHVlUm90YXRlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzKCk7CiAgICB9OwogICAgLypcCiAgICAgKiBTbmFwLmZpbHRlci5pbnZlcnQKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJldHVybnMgYW4gU1ZHIG1hcmt1cCBzdHJpbmcgZm9yIHRoZSBpbnZlcnQgZmlsdGVyCiAgICAgKioKICAgICAtIGFtb3VudCAobnVtYmVyKSBhbW91bnQgb2YgZmlsdGVyIChgMC4uMWApCiAgICAgPSAoc3RyaW5nKSBmaWx0ZXIgcmVwcmVzZW50YXRpb24KICAgIFwqLwogICAgU25hcC5maWx0ZXIuaW52ZXJ0ID0gZnVuY3Rpb24gKGFtb3VudCkgewogICAgICAgIGlmIChhbW91bnQgPT0gbnVsbCkgewogICAgICAgICAgICBhbW91bnQgPSAxOwogICAgICAgIH0KICAgICAgICByZXR1cm4gU25hcC5mb3JtYXQoJzxmZUNvbXBvbmVudFRyYW5zZmVyPjxmZUZ1bmNSIHR5cGU9InRhYmxlIiB0YWJsZVZhbHVlcz0ie2Ftb3VudH0ge2Ftb3VudDJ9Ii8+PGZlRnVuY0cgdHlwZT0idGFibGUiIHRhYmxlVmFsdWVzPSJ7YW1vdW50fSB7YW1vdW50Mn0iLz48ZmVGdW5jQiB0eXBlPSJ0YWJsZSIgdGFibGVWYWx1ZXM9InthbW91bnR9IHthbW91bnQyfSIvPjwvZmVDb21wb25lbnRUcmFuc2Zlcj4nLCB7CiAgICAgICAgICAgIGFtb3VudDogYW1vdW50LAogICAgICAgICAgICBhbW91bnQyOiAxIC0gYW1vdW50CiAgICAgICAgfSk7CiAgICB9OwogICAgU25hcC5maWx0ZXIuaW52ZXJ0LnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzKCk7CiAgICB9OwogICAgLypcCiAgICAgKiBTbmFwLmZpbHRlci5icmlnaHRuZXNzCiAgICAgWyBtZXRob2QgXQogICAgICoqCiAgICAgKiBSZXR1cm5zIGFuIFNWRyBtYXJrdXAgc3RyaW5nIGZvciB0aGUgYnJpZ2h0bmVzcyBmaWx0ZXIKICAgICAqKgogICAgIC0gYW1vdW50IChudW1iZXIpIGFtb3VudCBvZiBmaWx0ZXIgKGAwLi4xYCkKICAgICA9IChzdHJpbmcpIGZpbHRlciByZXByZXNlbnRhdGlvbgogICAgXCovCiAgICBTbmFwLmZpbHRlci5icmlnaHRuZXNzID0gZnVuY3Rpb24gKGFtb3VudCkgewogICAgICAgIGlmIChhbW91bnQgPT0gbnVsbCkgewogICAgICAgICAgICBhbW91bnQgPSAxOwogICAgICAgIH0KICAgICAgICByZXR1cm4gU25hcC5mb3JtYXQoJzxmZUNvbXBvbmVudFRyYW5zZmVyPjxmZUZ1bmNSIHR5cGU9ImxpbmVhciIgc2xvcGU9InthbW91bnR9Ii8+PGZlRnVuY0cgdHlwZT0ibGluZWFyIiBzbG9wZT0ie2Ftb3VudH0iLz48ZmVGdW5jQiB0eXBlPSJsaW5lYXIiIHNsb3BlPSJ7YW1vdW50fSIvPjwvZmVDb21wb25lbnRUcmFuc2Zlcj4nLCB7CiAgICAgICAgICAgIGFtb3VudDogYW1vdW50CiAgICAgICAgfSk7CiAgICB9OwogICAgU25hcC5maWx0ZXIuYnJpZ2h0bmVzcy50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcygpOwogICAgfTsKICAgIC8qXAogICAgICogU25hcC5maWx0ZXIuY29udHJhc3QKICAgICBbIG1ldGhvZCBdCiAgICAgKioKICAgICAqIFJldHVybnMgYW4gU1ZHIG1hcmt1cCBzdHJpbmcgZm9yIHRoZSBjb250cmFzdCBmaWx0ZXIKICAgICAqKgogICAgIC0gYW1vdW50IChudW1iZXIpIGFtb3VudCBvZiBmaWx0ZXIgKGAwLi4xYCkKICAgICA9IChzdHJpbmcpIGZpbHRlciByZXByZXNlbnRhdGlvbgogICAgXCovCiAgICBTbmFwLmZpbHRlci5jb250cmFzdCA9IGZ1bmN0aW9uIChhbW91bnQpIHsKICAgICAgICBpZiAoYW1vdW50ID09IG51bGwpIHsKICAgICAgICAgICAgYW1vdW50ID0gMTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFNuYXAuZm9ybWF0KCc8ZmVDb21wb25lbnRUcmFuc2Zlcj48ZmVGdW5jUiB0eXBlPSJsaW5lYXIiIHNsb3BlPSJ7YW1vdW50fSIgaW50ZXJjZXB0PSJ7YW1vdW50Mn0iLz48ZmVGdW5jRyB0eXBlPSJsaW5lYXIiIHNsb3BlPSJ7YW1vdW50fSIgaW50ZXJjZXB0PSJ7YW1vdW50Mn0iLz48ZmVGdW5jQiB0eXBlPSJsaW5lYXIiIHNsb3BlPSJ7YW1vdW50fSIgaW50ZXJjZXB0PSJ7YW1vdW50Mn0iLz48L2ZlQ29tcG9uZW50VHJhbnNmZXI+JywgewogICAgICAgICAgICBhbW91bnQ6IGFtb3VudCwKICAgICAgICAgICAgYW1vdW50MjogLjUgLSBhbW91bnQgLyAyCiAgICAgICAgfSk7CiAgICB9OwogICAgU25hcC5maWx0ZXIuY29udHJhc3QudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMoKTsKICAgIH07Cn0pOwpyZXR1cm4gU25hcDsKfSkpOw==</content>
    <filesize>251221</filesize>
  </attachment>
</xwikidoc>